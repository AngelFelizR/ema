<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visualisal Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visualisal Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visualisal Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-03-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="variableEngeneering.html">
<link rel="next" href="marginal-profiles.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-cleaning"><i class="fa fa-check"></i><b>2.1.1</b> Data cleaning</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration"><i class="fa fa-check"></i><b>2.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>2.1.3</b> Logistic regression is always a good choice</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>2.1.4</b> Random Forest to the rescue</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#gradient-boosting-for-interactions"><i class="fa fa-check"></i><b>2.1.5</b> Gradient boosting for interactions</a></li>
<li class="chapter" data-level="2.1.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-predictions"><i class="fa fa-check"></i><b>2.1.6</b> Model predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>4</b> What-If analysis with the Ceteris Paribus Profiles</a><ul>
<li class="chapter" data-level="4.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#the-method"><i class="fa fa-check"></i><b>4.3</b> The Method</a><ul>
<li class="chapter" data-level="4.3.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>4.3.1</b> 1D Ceteris Paribus Profiles</a></li>
<li class="chapter" data-level="4.3.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>4.3.2</b> Profile oscillations</a></li>
<li class="chapter" data-level="4.3.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>4.3.3</b> 2D profiles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>4.4</b> Local model fidelity</a></li>
<li class="chapter" data-level="4.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons"><i class="fa fa-check"></i><b>4.5</b> Pros and cons</a></li>
<li class="chapter" data-level="4.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>5</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="5.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-1"><i class="fa fa-check"></i><b>5.2</b> Intuition</a></li>
<li class="chapter" data-level="5.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>5.3</b> Method</a></li>
<li class="chapter" data-level="5.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>5.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="5.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="5.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>5.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>6</b> Variable attributions</a><ul>
<li class="chapter" data-level="6.1" data-path="breakDown.html"><a href="breakDown.html#intuition-2"><i class="fa fa-check"></i><b>6.1</b> Intuition</a></li>
<li class="chapter" data-level="6.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>6.2</b> Method</a></li>
<li class="chapter" data-level="6.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>6.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="6.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-2"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html"><i class="fa fa-check"></i><b>7</b> Variable attribution with interactions</a><ul>
<li class="chapter" data-level="7.1" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#intuition-3"><i class="fa fa-check"></i><b>7.1</b> Intuition</a></li>
<li class="chapter" data-level="7.2" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#method-2"><i class="fa fa-check"></i><b>7.2</b> Method</a></li>
<li class="chapter" data-level="7.3" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>7.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="7.4" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#break-down-plots"><i class="fa fa-check"></i><b>7.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="7.5" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#pros-and-cons-3"><i class="fa fa-check"></i><b>7.5</b> Pros and cons</a></li>
<li class="chapter" data-level="7.6" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>7.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>8</b> Average variable attributions</a><ul>
<li class="chapter" data-level="8.1" data-path="shapley.html"><a href="shapley.html#intuition-4"><i class="fa fa-check"></i><b>8.1</b> Intuition</a></li>
<li class="chapter" data-level="8.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>8.2</b> Method</a></li>
<li class="chapter" data-level="8.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>8.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="8.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-4"><i class="fa fa-check"></i><b>8.4</b> Pros and cons</a></li>
<li class="chapter" data-level="8.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>8.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>9</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="9.1" data-path="LIME.html"><a href="LIME.html#intuition-5"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>9.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="9.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-5"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="9.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>9.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="9.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>9.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="9.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>9.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>10</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="10.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>10.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="11" data-path="introduction-3.html"><a href="introduction-3.html"><i class="fa fa-check"></i><b>11</b> Introduction</a><ul>
<li class="chapter" data-level="11.1" data-path="introduction-3.html"><a href="introduction-3.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>11.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="11.2" data-path="introduction-3.html"><a href="introduction-3.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>11.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>12</b> Feature Importance</a><ul>
<li class="chapter" data-level="12.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>12.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="12.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic"><i class="fa fa-check"></i><b>12.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="12.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>12.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="12.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>12.4</b> More models</a></li>
<li class="chapter" data-level="12.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>12.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>13</b> Feature effects</a></li>
<li class="chapter" data-level="14" data-path="partialDependence.html"><a href="partialDependence.html"><i class="fa fa-check"></i><b>14</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="14.0.1" data-path="partialDependence.html"><a href="partialDependence.html#interactions-and-partial-dependency-profiles"><i class="fa fa-check"></i><b>14.0.1</b> Interactions and Partial Dependency profiles</a></li>
<li class="chapter" data-level="14.0.2" data-path="partialDependence.html"><a href="partialDependence.html#groups-of-partial-dependency-profiles"><i class="fa fa-check"></i><b>14.0.2</b> Groups of Partial Dependency profiles</a></li>
<li class="chapter" data-level="14.0.3" data-path="partialDependence.html"><a href="partialDependence.html#model-comparisons-with-partial-dependency-plots"><i class="fa fa-check"></i><b>14.0.3</b> Model comparisons with Partial Dependency Plots</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="marginal-profiles.html"><a href="marginal-profiles.html"><i class="fa fa-check"></i><b>15</b> Marginal Profiles</a><ul>
<li class="chapter" data-level="15.0.1" data-path="marginal-profiles.html"><a href="marginal-profiles.html#marginal-profiles-1"><i class="fa fa-check"></i><b>15.0.1</b> Marginal Profiles</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="accumulated-local-profiles.html"><a href="accumulated-local-profiles.html"><i class="fa fa-check"></i><b>16</b> Accumulated Local Profiles</a></li>
<li class="chapter" data-level="17" data-path="merging-path-plots-and-others.html"><a href="merging-path-plots-and-others.html"><i class="fa fa-check"></i><b>17</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="18" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>18</b> Other topics</a></li>
<li class="chapter" data-level="19" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>19</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="20" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>20</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="21" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>21</b> Concept Drift</a><ul>
<li class="chapter" data-level="21.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-4"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>21.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="21.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>21.3</b> Code snippets</a></li>
<li class="chapter" data-level="21.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>21.4</b> Residual Drift</a></li>
<li class="chapter" data-level="21.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>21.5</b> Code snippets</a></li>
<li class="chapter" data-level="21.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>21.6</b> Model Drift</a></li>
<li class="chapter" data-level="21.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>21.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="22" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>22</b> Data Sets</a><ul>
<li class="chapter" data-level="22.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>22.1</b> Hire or Fire? HR in Call Center</a></li>
<li class="chapter" data-level="22.2" data-path="DataSets.html"><a href="DataSets.html#apartmentsDataset"><i class="fa fa-check"></i><b>22.2</b> How much does it cost? Price prediction for a square meter</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>23</b> Packages</a><ul>
<li class="chapter" data-level="23.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>23.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisal Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="partialDependence" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Partial Dependency Profiles</h1>
<p>One of the first and the most popular tools for model understanding
are Partial Dependence Plots (sometimes named Partial Dependence Profiles) <span class="citation">(Friedman <a href="#ref-Friedman00greedyfunction">2000</a>)</span>.</p>
<p>PDP was introduced by Friedman in 2000 in the paper devoted to Gradient Boosting Machines (GBM) - new type of complex yet effective models. For many years PDP as sleeping beauties stay in the shadow of the boosting. It has changed in recent years.</p>
<p>General idea is to show how the expected model response behaves as a function of a selected feature. Here the word ,,expected’’ means averaged over the population.
We can think about them as about an average from Ceteris Paribus Profiles introduced in @ref{ceterisParibus}.</p>
<p>Let’s see how they are constructed step by step.
Here we will use a <em>random forest model</em> created for the <em>titanic</em> dataset. Examples are related to a single variable <em>Age</em>.</p>
<ol style="list-style-type: decimal">
<li>Calculate Ceteris Paribus profiles for observations from the dataset</li>
</ol>
<p>As it was introduced in @ref{ceterisParibus} Ceteris Paribus profiles are calculated for observations. They show how model response change is a selected variable in this observation is modified.</p>
<p><span class="math display">\[
CP^{f, j, x}(z) := f(x|^j = z).
\]</span></p>
<p>Such profiles can be calculated for example with the <code>ceteris_paribus{ingredients}</code> function.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb109-2" data-line-number="2">selected_passangers &lt;-<span class="st"> </span><span class="kw">select_sample</span>(titanic_small, <span class="dt">n =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb109-3" data-line-number="3">cp_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_rf, selected_passangers)</a></code></pre></div>
<p>So for a single model and a single variable we get a bunch of <em>what-if</em> profiles. In the figure @ref{pdp_part_1} we show an example for 100 observations. Despite some variation (random forest are not as stable as we would hope) we see that most profiles are decreasing. So the older the passengers is the lower is the survival probability.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/pdp_part_1-1.png" alt="Ceteris Paribus profiles for 100 observations, the Age variable and the random forest model" width="480" />
<p class="caption">
(#fig:pdp_part_1)Ceteris Paribus profiles for 100 observations, the Age variable and the random forest model
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Aggregate Ceteris Paribus into a single Partial Dependency Profile</li>
</ol>
<p>In the most common formulation Partial Dependency Plots are expected values for CP profiles (see <code>pdp</code> package <span class="citation">(Greenwell <a href="#ref-pdp">2017</a><a href="#ref-pdp">a</a>)</span>).</p>
<p><span class="math display">\[
g_i(z) = E_{x_{-i}}[ f(x|^i = z, x^{-i}) ].
\]</span></p>
<p>Of course, this expectation cannot be calculated directly as we do not know fully neither the distribution of <span class="math inline">\(x_{-i}\)</span> nor the <span class="math inline">\(f()\)</span>. Yet this value may be estimated by</p>
<p><span class="math display">\[
\hat g_i(z) = \frac{1}{n} \sum_{j=1}^{n} f(x|^i = z, x_j^{-i}).
\]</span></p>
<p>Such average can be calculated with the <code>aggregate_profiles{ingredients}</code> function.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb110-2" data-line-number="2">selected_passangers &lt;-<span class="st"> </span><span class="kw">select_sample</span>(titanic_small, <span class="dt">n =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb110-3" data-line-number="3">cp_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_rf, selected_passangers)</a>
<a class="sourceLine" id="cb110-4" data-line-number="4">pdp_rf &lt;-<span class="st"> </span><span class="kw">aggregate_profiles</span>(cp_rf, <span class="dt">variables =</span> <span class="st">&quot;Age&quot;</span>)</a></code></pre></div>
<p>So for a single model and a single variable we get a profile. See an example in figure @ref{pdp_part_2}. It is much easier than following 100 separate curves, and in cases in which Ceteris Paribus are more or less parallel, the Partial Dependency is a good summary of them.</p>
<p>The average response is of course more stable (as it’s an average) and in this case is more or less a decreasing curve. It’s much easier to notice that the older the passenger is the lower the survival probability.
Moreover it is easier to notice that the largest drop in survival changes happen for teenagers. On average the survival for adults is 30 percent points smaller than for kids.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/pdp_part_2-1.png" alt="Partial Dependency profile as an average for 100 observations" width="480" />
<p class="caption">
(#fig:pdp_part_2)Partial Dependency profile as an average for 100 observations
</p>
</div>
<div id="interactions-and-partial-dependency-profiles" class="section level3">
<h3><span class="header-section-number">14.0.1</span> Interactions and Partial Dependency profiles</h3>
<p>As we said in the previous section, Partial Dependency is a good summary if Ceteris Paribus profiles are similar, i.e. parallel. But it may happen that the variable of interest is in interaction with some other variable. Then profiles are not parallel because the effect of variable of interest depends on some other variables.</p>
<p>So on one hand it would be good to summaries all this Ceteris Paribus profiles with smaller number of profiles. But on another hand a single aggregate may not be enough.
To deal with this problem we propose to cluster Ceteris Paribus profiles and check how homogenous are these profiles.</p>
<p>The most straightforward approach would be to use a method for clustering, like k-means algorithm or hierarchical clustering, and see how these cluster of profiles behave. Once clusters are established we can aggregate within clusters in the same way as in case of Partial Dependency Plots.</p>
<p>Such clusters can be calculated with the <code>cluster_profiles{ingredients}</code> function. We choose the hierarchical clustering with Ward linkage as it gives most stable results.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2">selected_passangers &lt;-<span class="st"> </span><span class="kw">select_sample</span>(titanic_small, <span class="dt">n =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb111-3" data-line-number="3">cp_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_rf, selected_passangers)</a>
<a class="sourceLine" id="cb111-4" data-line-number="4">clust_rf &lt;-<span class="st"> </span><span class="kw">cluster_profiles</span>(cp_rf, <span class="dt">k =</span> <span class="dv">3</span>, <span class="dt">variables =</span> <span class="st">&quot;Age&quot;</span>)</a></code></pre></div>
<p>So for a single model and a single variable we get <span class="math inline">\(k\)</span> profiles. The common problem in clustering is the selection of <span class="math inline">\(k\)</span>. However in our case, as it’s an exploration, the problem is simpler, as we are interesting if <span class="math inline">\(k=1\)</span> (Partial Dependency is a good summary) or not (there are some interactions).</p>
<p>See an example in Figure @ref{pdp_part_4}. It is easier to notice that Ceteris Paribus profiles can be groups in three clusters. Group of passengers with a very large drop in the survival (cluster 1), moderate drop (cluster 2) and almost no drop in survival (cluster 3). Here we do not know what other factors are linked with these clusters, but some additional exploratory analysis can be done to identify these factors.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/pdp_part_4-1.png" alt="Cluster profiles for 3 clusters over 100 Ceteris Paribus profiles" width="480" />
<p class="caption">
(#fig:pdp_part_4)Cluster profiles for 3 clusters over 100 Ceteris Paribus profiles
</p>
</div>
</div>
<div id="groups-of-partial-dependency-profiles" class="section level3">
<h3><span class="header-section-number">14.0.2</span> Groups of Partial Dependency profiles</h3>
<p>Once we see that variable of interest may be in interaction with some other variable, it is tempting to look for the factor that distinguish clusters.</p>
<p>The most straightforward approach is to use some other variable as a grouping variable. This can be done by setting the <code>groups</code> argument in the <code>aggregate_profiles{ingredients}</code> function.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb112-2" data-line-number="2">selected_passangers &lt;-<span class="st"> </span><span class="kw">select_sample</span>(titanic_small, <span class="dt">n =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb112-3" data-line-number="3">cp_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_rf, selected_passangers)</a>
<a class="sourceLine" id="cb112-4" data-line-number="4">pdp_Sex_rf &lt;-<span class="st"> </span><span class="kw">aggregate_profiles</span>(cp_rf, <span class="dt">variables =</span> <span class="st">&quot;Age&quot;</span>,</a>
<a class="sourceLine" id="cb112-5" data-line-number="5">                <span class="dt">groups =</span> <span class="st">&quot;Sex&quot;</span>)</a></code></pre></div>
<p>See an example in Figure @ref{pdp_part_5}. Clearly there is an interaction between Age and Sex. The survival for woman is more stable, while for man there is more sudden drop in Survival for older passengers.
Check how the interaction for <code>Pclass</code> (passenger class) looks like.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/pdp_part_5-1.png" alt="Grouped profiles with respect to the Sex variable" width="480" />
<p class="caption">
(#fig:pdp_part_5)Grouped profiles with respect to the Sex variable
</p>
</div>
</div>
<div id="model-comparisons-with-partial-dependency-plots" class="section level3">
<h3><span class="header-section-number">14.0.3</span> Model comparisons with Partial Dependency Plots</h3>
<p>Contrastive comparisons of Partial Dependency Plots are useful not only for subgroups of observations but also for model comparisons.</p>
<p>Why one would like to compare models? There are at least three reasons for it.</p>
<ul>
<li><em>Agreement of models will calm us.</em> Some models are known to be more stable other to be more elastic. If profiles for models from these two classes are not far from each other we can be more convinced that elastic model is not over-fitted.</li>
<li><em>Disagreement of models helps to improve.</em> If simpler interpretable model disagree with an elastic model, this may suggest a feature transformation that can be used to improve the interpretable model. For example if random forest learned non linear relation then it can be captures by a linear model after suitable transformation.</li>
<li><em>Validation of boundary conditions.</em> Some models are know to have different behavior on the boundary, for largest or lowest values. Random forest is known to shrink predictions towards the average, while support vector machines are known to have larger variance at edges. Contrastive comparisons may help to understand differences in boundary behavior.</li>
</ul>
<p>Generic <code>plot{ingredients}</code> function handles multiple models as consecutive arguments.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="kw">plot</span>(pdp_rf, pdp_glm, pdp_gbm, <span class="dt">variables =</span> <span class="st">&quot;Age&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;_label_&quot;</span>)</a></code></pre></div>
<p>See an example in Figure @ref{pdp_part_7}. Random forest is compared with gradient boosting model and generalized linear model (logistic regression). All three models agree when it comes to a general relation between Age and Survival. Logistic regression is of course the most smooth. Gradient boosting has on average higher predictions than random forest.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/pdp_part_7-1.png" alt="Comparison on three predictive models with different structures." width="480" />
<p class="caption">
(#fig:pdp_part_7)Comparison on three predictive models with different structures.
</p>
</div>

<pre><code>## Distribution not specified, assuming bernoulli ...</code></pre>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Friedman00greedyfunction">
<p>Friedman, Jerome H. 2000. “Greedy Function Approximation: A Gradient Boosting Machine.” <em>Annals of Statistics</em> 29: 1189–1232.</p>
</div>
<div id="ref-pdp">
<p>Greenwell, Brandon M. 2017a. “Pdp: An R Package for Constructing Partial Dependence Plots.” <em>The R Journal</em> 9 (1): 421–36. <a href="https://journal.r-project.org/archive/2017/RJ-2017-016/index.html">https://journal.r-project.org/archive/2017/RJ-2017-016/index.html</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="variableEngeneering.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="marginal-profiles.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
