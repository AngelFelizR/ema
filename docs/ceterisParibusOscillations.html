<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-05-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="ceterisParibus.html">
<link rel="next" href="ceterisParibus2d.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html"><i class="fa fa-check"></i><b>2</b> DIY with R</a><ul>
<li class="chapter" data-level="2.1" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-install-dependencies"><i class="fa fa-check"></i><b>2.1</b> How to install dependencies</a></li>
<li class="chapter" data-level="2.2" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-work-with-dalex"><i class="fa fa-check"></i><b>2.2</b> How to work with <code>DALEX</code></a></li>
<li class="chapter" data-level="2.3" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-work-with-archivist"><i class="fa fa-check"></i><b>2.3</b> How to work with <code>archivist</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="PythonCodeSnippets.html"><a href="PythonCodeSnippets.html"><i class="fa fa-check"></i><b>3</b> DIY with Python</a></li>
<li class="chapter" data-level="4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>4</b> Data Sets</a><ul>
<li class="chapter" data-level="4.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>4.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="4.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_titanic"><i class="fa fa-check"></i><b>4.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>4.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="4.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>4.1.3</b> Random forest</a></li>
<li class="chapter" data-level="4.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_gbm"><i class="fa fa-check"></i><b>4.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="4.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_titanic"><i class="fa fa-check"></i><b>4.1.5</b> Model predictions</a></li>
<li class="chapter" data-level="4.1.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ExplainersTitanicRCode"><i class="fa fa-check"></i><b>4.1.6</b> Explainers</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsTitanic"><i class="fa fa-check"></i><b>4.2</b> List of objects for the <code>titanic</code> example</a></li>
<li class="chapter" data-level="4.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>4.3</b> Apartment prices</a><ul>
<li class="chapter" data-level="4.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_apartments"><i class="fa fa-check"></i><b>4.3.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_lr"><i class="fa fa-check"></i><b>4.3.2</b> Linear regression</a></li>
<li class="chapter" data-level="4.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_rf"><i class="fa fa-check"></i><b>4.3.3</b> Random forest</a></li>
<li class="chapter" data-level="4.3.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_apartments"><i class="fa fa-check"></i><b>4.3.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsApartments"><i class="fa fa-check"></i><b>4.4</b> List of objects for the <code>apartments</code> example</a></li>
<li class="chapter" data-level="4.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>4.5</b> Hire or fire</a><ul>
<li class="chapter" data-level="4.5.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_HR"><i class="fa fa-check"></i><b>4.5.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.5.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_mr"><i class="fa fa-check"></i><b>4.5.2</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="4.5.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_rf"><i class="fa fa-check"></i><b>4.5.3</b> Random forest</a></li>
<li class="chapter" data-level="4.5.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_HR"><i class="fa fa-check"></i><b>4.5.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsHR"><i class="fa fa-check"></i><b>4.6</b> List of objects for the <code>HR</code> example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="5" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>5</b> Introduction</a></li>
<li class="chapter" data-level="6" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>6</b> Ceteris-paribus Profiles and What-If Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>6.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>6.5</b> Pros and cons</a></li>
<li class="chapter" data-level="6.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>6.6</b> Code snippets for R</a><ul>
<li class="chapter" data-level="6.6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#basic-usage-for-the-ceteris_paribus-function"><i class="fa fa-check"></i><b>6.6.1</b> Basic usage for the <code>ceteris_paribus</code> function</a></li>
<li class="chapter" data-level="6.6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#advanced-usage-for-the-ceteris_paribus-function"><i class="fa fa-check"></i><b>6.6.2</b> Advanced usage for the <code>ceteris_paribus</code> function</a></li>
<li class="chapter" data-level="6.6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#champion-challenger-analysis"><i class="fa fa-check"></i><b>6.6.3</b> Champion-challenger analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>7</b> Ceteris-paribus Oscillations and Local Variable-importance</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>7.3</b> Method</a></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>7.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>7.5</b> Pros and cons</a></li>
<li class="chapter" data-level="7.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>7.6</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.6.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#basic-usage-for-the-calculate_oscillations-function"><i class="fa fa-check"></i><b>7.6.1</b> Basic usage for the <code>calculate_oscillations</code> function</a></li>
<li class="chapter" data-level="7.6.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#advanced-usage-for-the-calculate_oscillations-function"><i class="fa fa-check"></i><b>7.6.2</b> Advanced usage for the <code>calculate_oscillations</code> function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>8</b> Ceteris-paribus Two-dimensional Profiles - a Tool for Pairwise Interactions</a><ul>
<li class="chapter" data-level="8.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dIntro"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dIntuition"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dMethod"><i class="fa fa-check"></i><b>8.3</b> Method</a></li>
<li class="chapter" data-level="8.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dExample"><i class="fa fa-check"></i><b>8.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="8.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dProsCons"><i class="fa fa-check"></i><b>8.5</b> Pros and cons</a></li>
<li class="chapter" data-level="8.6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2R"><i class="fa fa-check"></i><b>8.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>9</b> Local Diagnostics With Ceteris-paribus Profiles</a><ul>
<li class="chapter" data-level="9.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagIntro"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagIntuition"><i class="fa fa-check"></i><b>9.2</b> Intuition</a></li>
<li class="chapter" data-level="9.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagMethod"><i class="fa fa-check"></i><b>9.3</b> Method</a><ul>
<li class="chapter" data-level="9.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagNeighbors"><i class="fa fa-check"></i><b>9.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="9.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagProfiles"><i class="fa fa-check"></i><b>9.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="9.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagLFplot"><i class="fa fa-check"></i><b>9.3.3</b> Local fidelity plot</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagExample"><i class="fa fa-check"></i><b>9.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagProsCons"><i class="fa fa-check"></i><b>9.5</b> Pros and cons</a></li>
<li class="chapter" data-level="9.6" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagR"><i class="fa fa-check"></i><b>9.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>10</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="10.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-1"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition"><i class="fa fa-check"></i><b>10.2</b> Intuition</a></li>
<li class="chapter" data-level="10.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>10.3</b> Method</a></li>
<li class="chapter" data-level="10.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>10.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="10.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons"><i class="fa fa-check"></i><b>10.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="10.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>10.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>11</b> BreakDown for Additive Variable Attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="breakDown.html"><a href="breakDown.html#intuition-1"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="breakDown.html"><a href="breakDown.html#example-titanic-data"><i class="fa fa-check"></i><b>11.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="11.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-1"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>12</b> iBreakDown for Variable Attributions with Interactions</a><ul>
<li class="chapter" data-level="12.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-2"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-2"><i class="fa fa-check"></i><b>12.2</b> Method</a><ul>
<li class="chapter" data-level="12.2.1" data-path="iBreakDown.html"><a href="iBreakDown.html#single-step-contributions"><i class="fa fa-check"></i><b>12.2.1</b> Single step contributions</a></li>
<li class="chapter" data-level="12.2.2" data-path="iBreakDown.html"><a href="iBreakDown.html#two-steps-contributions"><i class="fa fa-check"></i><b>12.2.2</b> Two steps contributions</a></li>
<li class="chapter" data-level="12.2.3" data-path="iBreakDown.html"><a href="iBreakDown.html#sequential-contributions"><i class="fa fa-check"></i><b>12.2.3</b> Sequential contributions</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-titanic"><i class="fa fa-check"></i><b>12.3</b> Example: Titanic</a></li>
<li class="chapter" data-level="12.4" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-2"><i class="fa fa-check"></i><b>12.4</b> Pros and cons</a></li>
<li class="chapter" data-level="12.5" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>12.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>13</b> SHapley Additive exPlanations (SHAP) and Average Variable Attributions</a><ul>
<li class="chapter" data-level="13.1" data-path="shapley.html"><a href="shapley.html#intuition-3"><i class="fa fa-check"></i><b>13.1</b> Intuition</a></li>
<li class="chapter" data-level="13.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>13.2</b> Method</a></li>
<li class="chapter" data-level="13.3" data-path="shapley.html"><a href="shapley.html#titanic"><i class="fa fa-check"></i><b>13.3</b> Titanic</a></li>
<li class="chapter" data-level="13.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-3"><i class="fa fa-check"></i><b>13.4</b> Pros and cons</a></li>
<li class="chapter" data-level="13.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>13.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>14</b> Local Interpretable Model-Agnostic Explanations (LIME)</a><ul>
<li class="chapter" data-level="14.1" data-path="LIME.html"><a href="LIME.html#intuition-4"><i class="fa fa-check"></i><b>14.1</b> Intuition</a></li>
<li class="chapter" data-level="14.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>14.2</b> Method</a></li>
<li class="chapter" data-level="14.3" data-path="LIME.html"><a href="LIME.html#pros-and-cons-4"><i class="fa fa-check"></i><b>14.3</b> Pros and cons</a></li>
<li class="chapter" data-level="14.4" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>14.4</b> Code snippets for R</a><ul>
<li class="chapter" data-level="14.4.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>14.4.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="14.4.2" data-path="LIME.html"><a href="LIME.html#the-localmodel-package"><i class="fa fa-check"></i><b>14.4.2</b> <strong>The localModel package</strong></a></li>
<li class="chapter" data-level="14.4.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>14.4.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="comparision-of-instance-level-explainers.html"><a href="comparision-of-instance-level-explainers.html"><i class="fa fa-check"></i><b>15</b> Comparision of instance level explainers</a><ul>
<li class="chapter" data-level="15.1" data-path="comparision-of-instance-level-explainers.html"><a href="comparision-of-instance-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>15.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="16" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>16</b> Introduction</a><ul>
<li class="chapter" data-level="16.1" data-path="introduction-2.html"><a href="introduction-2.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>16.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="16.2" data-path="introduction-2.html"><a href="introduction-2.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>16.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>17</b> Feature Importance</a><ul>
<li class="chapter" data-level="17.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>17.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="17.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic-1"><i class="fa fa-check"></i><b>17.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="17.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>17.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="17.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>17.4</b> More models</a></li>
<li class="chapter" data-level="17.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>17.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>18</b> Feature effects</a><ul>
<li class="chapter" data-level="18.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>18.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>19</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
<li class="chapter" data-level="19.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>19.2</b> Estimation</a></li>
<li class="chapter" data-level="19.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>19.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="19.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>19.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="19.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>19.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>20</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="20.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>20.1</b> Definition</a></li>
<li class="chapter" data-level="20.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>20.2</b> Estimation</a></li>
<li class="chapter" data-level="20.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>20.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>21</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="21.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>21.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>22</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="23" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>23</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="24" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>24</b> Other topics</a></li>
<li class="chapter" data-level="25" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>25</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="26" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>26</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="27" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>27</b> Concept Drift</a><ul>
<li class="chapter" data-level="27.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-3"><i class="fa fa-check"></i><b>27.1</b> Introduction</a></li>
<li class="chapter" data-level="27.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>27.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="27.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>27.3</b> Code snippets</a></li>
<li class="chapter" data-level="27.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>27.4</b> Residual Drift</a></li>
<li class="chapter" data-level="27.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>27.5</b> Code snippets</a></li>
<li class="chapter" data-level="27.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>27.6</b> Model Drift</a></li>
<li class="chapter" data-level="27.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>27.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="28" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>28</b> Data Sets</a><ul>
<li class="chapter" data-level="28.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>28.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>29</b> Packages</a><ul>
<li class="chapter" data-level="29.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>29.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ceterisParibusOscillations" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Ceteris-paribus Oscillations and Local Variable-importance</h1>
<div id="CPOscIntro" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<p>Visual examination of Ceteris-paribus (CP) profiles is insightful, but for a model with a large number of explanatory variables we may end up with a large number of plots which may be overwhelming. To prioritize between the profiles we need a measure that would summarize the impact of a selected variable on model’s predictions. In this chapter we describe a solution closely linked with CP profiles. An alternative is also discussed in the Chapters <a href="breakDown.html#breakDown">11</a> and <a href="shapley.html#shapley">13</a>.</p>
</div>
<div id="CPOscIntuition" class="section level2">
<h2><span class="header-section-number">7.2</span> Intuition</h2>
<p>To assign importance to CP profiles, we can use the concept of profile oscillations. In particular, the larger influence of an explanatory variable on prediction at a particular instance, the larger the fluctuations along the corresponding CP profile. For a variable that exercises little or no influence on model prediction, the profile will be flat or will barely change. Figure <a href="ceterisParibusOscillations.html#fig:CPVIPprofiles">7.1</a> illustrates the idea behind measuring oscillations. The figure corresponds to the CP profiles presented in Figure <a href="ceterisParibus.html#fig:profileV4Rf">6.4</a>.</p>
<p>The larger the highlighted area, the more important is the variable.</p>
<div class="figure" style="text-align: center"><span id="fig:CPVIPprofiles"></span>
<img src="figure/profile_v4_rf2.png" alt="(fig:CPVIPprofiles) The value of the colored area summarizes the CP oscillations and provides the mean of the absolute deviations between the CP profile and the instance prediction. Panel A shows continuous variables while panel B shows categorical variables. Example for the `titanic_rf_v6` model." width="99%" />
<p class="caption">
Figure 7.1: (fig:CPVIPprofiles) The value of the colored area summarizes the CP oscillations and provides the mean of the absolute deviations between the CP profile and the instance prediction. Panel A shows continuous variables while panel B shows categorical variables. Example for the <code>titanic_rf_v6</code> model.
</p>
</div>
</div>
<div id="CPOscMethod" class="section level2">
<h2><span class="header-section-number">7.3</span> Method</h2>
<p>Let us formalize this concept now. Denote by <span class="math inline">\(g^j(z)\)</span> the probability density function of the distribution of the <span class="math inline">\(j\)</span>-th explanatory variable. The summary measure of the variable’s importance for model prediction at point <span class="math inline">\(x\)</span>, <span class="math inline">\(vip^{CP}_j(x)\)</span>, computed based on the variable’s CP profile, is defined as follows:</p>
<p><span class="math display">\[
vip^{CP}_j(x^*) = \int_{\mathcal R} |CP^{f,j,x^*}(z) - f(x^*)| g^j(z)dz=E_{X_j}[|CP^{f,j,x^*}(X_j) - f(x^*)|].
\]</span>
Thus, <span class="math inline">\(vip^{CP}_j(x^*)\)</span> is the expected absolute deviation of the CP profile from the model prediction for <span class="math inline">\(x^*\)</span> over the distribution of the <span class="math inline">\(j\)</span>-th explanatory variable. A straightforward estimator of <span class="math inline">\(vip^{CP}_j(x^*)\)</span> is</p>
<p><span class="math display">\[
\widehat{ vip^{CP}_j(x^*)} = \frac 1n \sum_{i=1}^n |CP^{f,j,x^*}(x^{*j}_i) - f(x^*)|,
\]</span>
where index <span class="math inline">\(i\)</span> goes through all observations in a dataset.</p>
<p>Note that the importance of an explanatory variable for instance prediction may be very different for different points <span class="math inline">\(x^*\)</span>. For example, consider model
<span class="math display">\[
f(x_1, x_2) = x_1 * x_2,
\]</span>
where <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> take values in <span class="math inline">\([0,1]\)</span>. Consider prediction for an observation described by vector <span class="math inline">\(x^* = (0,1)\)</span>. In that case, the importance of <span class="math inline">\(X_1\)</span> is larger than <span class="math inline">\(X_2\)</span>. This is because the CP profile for the first variable, given by the values of function <span class="math inline">\(f(z,1)=z\)</span>, will have oscillations, while the profile for the second variable will show no oscillation, because it is given by function <span class="math inline">\(f(0,z)=0\)</span>. Obviously, the situation is reversed for <span class="math inline">\(x^*=(1,0)\)</span>.</p>
</div>
<div id="CPOscExample" class="section level2">
<h2><span class="header-section-number">7.4</span> Example: Titanic data</h2>
<p>Figure <a href="ceterisParibusOscillations.html#fig:CPVIP1">7.2</a> provides a bbarplot of variable importance measures for different continuous explanatory variables for the logistic regression model (<code>titanic_lmr_v6</code>) for <code>henry</code>.</p>
<p>The longer the bar, the larger the CP-profile oscillations for a particular explanatory variable. Thus, Figure <a href="ceterisParibusOscillations.html#fig:CPVIP1">7.2</a> indicates that the most important variable for prediction for the selected observation are <code>gender</code> and <code>sibsp</code>, followed by <code>age</code>.</p>
<p>If Henry were older, this would significantly lower the chances of survival. One the other hand, Henry were not travelling alone, this would increase these chances.</p>
<div class="figure" style="text-align: center"><span id="fig:CPVIP1"></span>
<img src="figure/oscillations_all_lmr_plot.png" alt="(fig:CPVIP1) Variable-importance measures calculated for Ceteris-paribus oscillations for `henry` based on the `titanic_rf_v6` model" width="75%" />
<p class="caption">
Figure 7.2: (fig:CPVIP1) Variable-importance measures calculated for Ceteris-paribus oscillations for <code>henry</code> based on the <code>titanic_rf_v6</code> model
</p>
</div>
</div>
<div id="CPOscProsCons" class="section level2">
<h2><span class="header-section-number">7.5</span> Pros and cons</h2>
<p>Oscillations of CP profiels are easy to interpret and understand. By using the average of oscillations it is possible to select the most important variables for instance prediction. The methodology can easily be extended to two or more variables.</p>
<p>There are several issues related to the use of the CP oscillations. For instance, the oscillations may not be of help in situations when the use of CP profiles may itself be problematic (e.g., in the case of correlated explanatory variables or interactions - see Section <a href="ceterisParibus.html#CPProsCons">6.5</a>). An important issue is that the local variable importances do not sum up to the instsance prediction for which they are calculated. In Chapters <a href="breakDown.html#breakDown">11</a> and <a href="shapley.html#shapley">13</a> we will introduce measures that address this problem.</p>
</div>
<div id="CPOscR" class="section level2">
<h2><span class="header-section-number">7.6</span> Code snippets for R</h2>
<p>In this section we present key features of the R package <code>ingredients</code> which is a part of <code>DrWhy.AI</code> universe and covers all methods presented in this chapter. More details and examples can be found at <a href="https://modeloriented.github.io/ingredients/" class="uri">https://modeloriented.github.io/ingredients/</a>.</p>
<p>In this section, we use a random forest classification model developed in the chapter <a href="DataSetsIntro.html#TitanicDataset">4.1</a>, namely the <code>titanic_rf_v6</code> model. It is trained to predict probability of survival from sinking of Titanic. Instance level explanations are calculated for a single observation <code>henry</code> - 47 years old passenger that travels 1st class.</p>
<p><code>DALEX</code> explainers for both models and the Henry data are retrieved via <code>archivist</code> hooks as listed in Chapter <a href="DataSetsIntro.html#ListOfModelsTitanic">4.2</a>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb88-2" data-line-number="2">explain_rf_v6 &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/9b971&quot;</span>)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb88-5" data-line-number="5">henry &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/a6538&quot;</span>)</a>
<a class="sourceLine" id="cb88-6" data-line-number="6">henry</a></code></pre></div>
<div id="basic-usage-for-the-calculate_oscillations-function" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Basic usage for the <code>calculate_oscillations</code> function</h3>
<p>To calculate CP oscillations, we have got to calculate CP profiles for the selected observation. Let us use <code>henry</code> as the instance prediction of interest.</p>
<p>CP profiles are calculated by applying the <code>ceteris_paribus()</code> function to the wrapper object. Resulting object can be then processed with <code>calculate_oscillations()</code>.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</a>
<a class="sourceLine" id="cb89-3" data-line-number="3"></a>
<a class="sourceLine" id="cb89-4" data-line-number="4">cp_titanic_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explain_rf_v6, henry)</a></code></pre></div>
<p>The <code>calculate_oscillations()</code> function returns an object of class <code>ceteris_paribus_oscillations</code>, which has a form of a data frame, but has also an overloaded <code>plot()</code> function. We can use the latter function to plot the local variable-importance measures for the instance of interest.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">oscillations_titanic_rf &lt;-<span class="st"> </span><span class="kw">calculate_oscillations</span>(cp_titanic_rf)</a>
<a class="sourceLine" id="cb90-2" data-line-number="2">oscillations_titanic_rf</a></code></pre></div>
<pre><code>##    _vname_ _ids_ oscillations
## 2   gender     1   0.33700000
## 4    sibsp     1   0.15500000
## 3      age     1   0.14700000
## 1    class     1   0.14257143
## 6     fare     1   0.05407273
## 7 embarked     1   0.02400000
## 5    parch     1   0.00800000</code></pre>
<p>It can be then plotted with the generic <code>plot()</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">oscillations_titanic_rf<span class="op">$</span><span class="st">`</span><span class="dt">_ids_</span><span class="st">`</span> &lt;-<span class="st"> &quot;Henry&quot;</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="kw">plot</span>(oscillations_titanic_rf) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Ceteris Paribus Oscillations&quot;</span>)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/titanicCeterisProfile02E-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="advanced-usage-for-the-calculate_oscillations-function" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Advanced usage for the <code>calculate_oscillations</code> function</h3>
<p>Note, that the <code>calculate_oscillations</code> function calculates <span class="math inline">\(\widehat{ vip^{CP}_j(x^*)}\)</span> as an average absolute difference between Ceteriws Paribus profile and the model prediction for a selected instance over selected grid of values.</p>
<p>The choice of grid of values may influence results as the expectation will be calculated over different distributions.</p>
<p>The default behavior is to use all unique values as grid points. But let us consider two alternative approaches.</p>
<p>One would be to calculate the expectation over uniform distribution for continuous variables.</p>
<p>To do this we manually specify a dense uniform grid of values for each variable.
Here we are doing it by setting the <code>variable_splits</code> argument.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">cp_titanic_rf_uniform &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explain_rf_v6, henry, </a>
<a class="sourceLine" id="cb93-2" data-line-number="2">              <span class="dt">variable_splits =</span> <span class="kw">list</span>(<span class="dt">age =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">65</span>, <span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb93-3" data-line-number="3">                                     <span class="dt">fare =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">                                     <span class="dt">sibsp =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>, <span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb93-5" data-line-number="5">                                     <span class="dt">parch =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>, <span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb93-6" data-line-number="6">                                     <span class="dt">gender =</span> <span class="kw">unique</span>(titanic<span class="op">$</span>gender),</a>
<a class="sourceLine" id="cb93-7" data-line-number="7">                                     <span class="dt">embarked =</span> <span class="kw">unique</span>(titanic<span class="op">$</span>embarked),</a>
<a class="sourceLine" id="cb93-8" data-line-number="8">                                     <span class="dt">class =</span> <span class="kw">unique</span>(titanic<span class="op">$</span>class)))</a></code></pre></div>
<p>Calculation of oscillations is easy.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">oscillations_uniform &lt;-<span class="st"> </span><span class="kw">calculate_oscillations</span>(cp_titanic_rf_uniform)</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">oscillations_uniform<span class="op">$</span><span class="st">`</span><span class="dt">_ids_</span><span class="st">`</span> &lt;-<span class="st"> &quot;Henry&quot;</span></a>
<a class="sourceLine" id="cb94-3" data-line-number="3">oscillations_uniform</a></code></pre></div>
<pre><code>##    _vname_ _ids_ oscillations
## 5   gender Henry    0.3370000
## 3    sibsp Henry    0.1677778
## 1      age Henry    0.1677235
## 7    class Henry    0.1425714
## 2     fare Henry    0.1040790
## 6 embarked Henry    0.0240000
## 4    parch Henry    0.0100000</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw">plot</span>(oscillations_uniform) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Ceteris Paribus Oscillations&quot;</span>, <span class="st">&quot;Expectation over uniform distribution&quot;</span>)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/titanicCeterisProfile02G-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Another approach would be to average over empirical distribution of each variable.</p>
<p>To do this we manually specify grid of values as a sample from validation data.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">titanic &lt;-<span class="st"> </span><span class="kw">na.omit</span>(titanic)</a>
<a class="sourceLine" id="cb97-2" data-line-number="2"></a>
<a class="sourceLine" id="cb97-3" data-line-number="3">cp_titanic_rf_empirical &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explain_rf_v6, henry, </a>
<a class="sourceLine" id="cb97-4" data-line-number="4">              <span class="dt">variable_splits =</span> <span class="kw">list</span>(<span class="dt">age =</span> titanic<span class="op">$</span>age,</a>
<a class="sourceLine" id="cb97-5" data-line-number="5">                                     <span class="dt">fare =</span> titanic<span class="op">$</span>fare,</a>
<a class="sourceLine" id="cb97-6" data-line-number="6">                                     <span class="dt">sibsp =</span> titanic<span class="op">$</span>sibsp,</a>
<a class="sourceLine" id="cb97-7" data-line-number="7">                                     <span class="dt">parch =</span> titanic<span class="op">$</span>parch,</a>
<a class="sourceLine" id="cb97-8" data-line-number="8">                                     <span class="dt">gender =</span> titanic<span class="op">$</span>gender,</a>
<a class="sourceLine" id="cb97-9" data-line-number="9">                                     <span class="dt">embarked =</span> titanic<span class="op">$</span>embarked,</a>
<a class="sourceLine" id="cb97-10" data-line-number="10">                                     <span class="dt">class =</span> titanic<span class="op">$</span>class))</a></code></pre></div>
<p>Having profiles we can then calculate oscillations with <code>calculate_oscillations</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">oscillations_empirical &lt;-<span class="st"> </span><span class="kw">calculate_oscillations</span>(cp_titanic_rf_empirical)</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">oscillations_empirical<span class="op">$</span><span class="st">`</span><span class="dt">_ids_</span><span class="st">`</span> &lt;-<span class="st"> &quot;Henry&quot;</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3">oscillations_empirical</a></code></pre></div>
<pre><code>##    _vname_ _ids_ oscillations
## 1      age Henry  0.153323969
## 5   gender Henry  0.149336656
## 7    class Henry  0.133567739
## 2     fare Henry  0.056883552
## 3    sibsp Henry  0.035932034
## 6 embarked Henry  0.019818758
## 4    parch Henry  0.001623924</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">plot</span>(oscillations_empirical) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Ceteris Paribus Oscillations&quot;</span>, <span class="st">&quot;Expectation over empirical distribution&quot;</span>)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/titanicCeterisProfile02I-1.png" width="70%" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ceterisParibus.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ceterisParibus2d.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
