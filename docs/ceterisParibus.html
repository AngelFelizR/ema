<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 4 What-If analysis with the Ceteris Paribus Profiles | Predictive Models: Visualisal Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 4 What-If analysis with the Ceteris Paribus Profiles | Predictive Models: Visualisal Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 What-If analysis with the Ceteris Paribus Profiles | Predictive Models: Visualisal Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-03-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="PredictionExplainers.html">
<link rel="next" href="variableAttributionMethods.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-cleaning"><i class="fa fa-check"></i><b>2.1.1</b> Data cleaning</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration"><i class="fa fa-check"></i><b>2.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#logistic-regression-is-always-a-good-choice"><i class="fa fa-check"></i><b>2.1.3</b> Logistic regression is always a good choice</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#random-forest-to-the-rescue"><i class="fa fa-check"></i><b>2.1.4</b> Random Forest to the rescue</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#gradient-boosting-for-interactions"><i class="fa fa-check"></i><b>2.1.5</b> Gradient boosting for interactions</a></li>
<li class="chapter" data-level="2.1.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-predictions"><i class="fa fa-check"></i><b>2.1.6</b> Model predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>4</b> What-If analysis with the Ceteris Paribus Profiles</a><ul>
<li class="chapter" data-level="4.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#the-method"><i class="fa fa-check"></i><b>4.3</b> The Method</a><ul>
<li class="chapter" data-level="4.3.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>4.3.1</b> 1D profiles</a></li>
<li class="chapter" data-level="4.3.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>4.3.2</b> Profile oscillations</a></li>
<li class="chapter" data-level="4.3.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>4.3.3</b> 2D profiles</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>4.4</b> Local model fidelity</a></li>
<li class="chapter" data-level="4.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons"><i class="fa fa-check"></i><b>4.5</b> Pros and cons</a></li>
<li class="chapter" data-level="4.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>5</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="5.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-1"><i class="fa fa-check"></i><b>5.2</b> Intuition</a></li>
<li class="chapter" data-level="5.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>5.3</b> Method</a></li>
<li class="chapter" data-level="5.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>5.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="5.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="5.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>5.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>6</b> Variable attributions</a><ul>
<li class="chapter" data-level="6.1" data-path="breakDown.html"><a href="breakDown.html#intuition-2"><i class="fa fa-check"></i><b>6.1</b> Intuition</a></li>
<li class="chapter" data-level="6.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>6.2</b> Method</a></li>
<li class="chapter" data-level="6.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>6.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="6.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-2"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html"><i class="fa fa-check"></i><b>7</b> Variable attribution with interactions</a><ul>
<li class="chapter" data-level="7.1" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#intuition-3"><i class="fa fa-check"></i><b>7.1</b> Intuition</a></li>
<li class="chapter" data-level="7.2" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#method-2"><i class="fa fa-check"></i><b>7.2</b> Method</a></li>
<li class="chapter" data-level="7.3" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>7.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="7.4" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#break-down-plots"><i class="fa fa-check"></i><b>7.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="7.5" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#pros-and-cons-3"><i class="fa fa-check"></i><b>7.5</b> Pros and cons</a></li>
<li class="chapter" data-level="7.6" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>7.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>8</b> Average variable attributions</a><ul>
<li class="chapter" data-level="8.1" data-path="shapley.html"><a href="shapley.html#intuition-4"><i class="fa fa-check"></i><b>8.1</b> Intuition</a></li>
<li class="chapter" data-level="8.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>8.2</b> Method</a></li>
<li class="chapter" data-level="8.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>8.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="8.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-4"><i class="fa fa-check"></i><b>8.4</b> Pros and cons</a></li>
<li class="chapter" data-level="8.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>8.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>9</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="9.1" data-path="LIME.html"><a href="LIME.html#intuition-5"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>9.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="9.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-5"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="9.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>9.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="9.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>9.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="9.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>9.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>10</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="10.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>10.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="11" data-path="introduction-3.html"><a href="introduction-3.html"><i class="fa fa-check"></i><b>11</b> Introduction</a><ul>
<li class="chapter" data-level="11.1" data-path="introduction-3.html"><a href="introduction-3.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>11.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="11.2" data-path="introduction-3.html"><a href="introduction-3.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>11.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>12</b> Feature Importance</a><ul>
<li class="chapter" data-level="12.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>12.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="12.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic"><i class="fa fa-check"></i><b>12.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="12.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>12.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="12.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>12.4</b> More models</a></li>
<li class="chapter" data-level="12.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>12.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>13</b> Feature effects</a><ul>
<li class="chapter" data-level="13.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#partialDependence"><i class="fa fa-check"></i><b>13.1</b> Partial Dependency Plots</a><ul>
<li class="chapter" data-level="13.1.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#interactions-and-partial-dependency-profiles"><i class="fa fa-check"></i><b>13.1.1</b> Interactions and Partial Dependency profiles</a></li>
<li class="chapter" data-level="13.1.2" data-path="variableEngeneering.html"><a href="variableEngeneering.html#groups-of-partial-dependency-profiles"><i class="fa fa-check"></i><b>13.1.2</b> Groups of Partial Dependency profiles</a></li>
<li class="chapter" data-level="13.1.3" data-path="variableEngeneering.html"><a href="variableEngeneering.html#model-comparisons-with-partial-dependency-plots"><i class="fa fa-check"></i><b>13.1.3</b> Model comparisons with Partial Dependency Plots</a></li>
<li class="chapter" data-level="13.1.4" data-path="variableEngeneering.html"><a href="variableEngeneering.html#correlation-between-features"><i class="fa fa-check"></i><b>13.1.4</b> Correlation between features</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="variableEngeneering.html"><a href="variableEngeneering.html#merging-path-plots"><i class="fa fa-check"></i><b>13.2</b> Merging Path Plots</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>14</b> Other topics</a></li>
<li class="chapter" data-level="15" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>15</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="16" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>16</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="17" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>17</b> Concept Drift</a><ul>
<li class="chapter" data-level="17.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-4"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>17.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="17.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>17.3</b> Code snippets</a></li>
<li class="chapter" data-level="17.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>17.4</b> Residual Drift</a></li>
<li class="chapter" data-level="17.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>17.5</b> Code snippets</a></li>
<li class="chapter" data-level="17.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>17.6</b> Model Drift</a></li>
<li class="chapter" data-level="17.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>17.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="18" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>18</b> Data Sets</a><ul>
<li class="chapter" data-level="18.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>18.1</b> Hire or Fire? HR in Call Center</a></li>
<li class="chapter" data-level="18.2" data-path="DataSets.html"><a href="DataSets.html#apartmentsDataset"><i class="fa fa-check"></i><b>18.2</b> How much does it cost? Price prediction for a square meter</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>19</b> Packages</a><ul>
<li class="chapter" data-level="19.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>19.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisal Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ceterisParibus" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> What-If analysis with the Ceteris Paribus Profiles</h1>
<p>In this section we introduce a technique for model exploration based on Ceteris Paribus principle. The main goal for this technique is to understand how changes in the model input affects changes in the model output. Sometimes these techniques are called sensitivity analysis.</p>
<p>Presented explainers are linked with the second law introduced in Section <a href="index.html#three-single-laws">1.2</a>, i.e. law for prediction’s speculations. This is why these explainers are also known as <em>What-If model analysis</em> or <em>Individual Conditional EXpectations</em> <span class="citation">(Goldstein et al. <a href="#ref-ICEbox">2015</a>)</span>. It turns out that it is easier to understand how a blacx-box model is working if we can explore the model by playing with inputs.</p>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p><em>Ceteris paribus</em> is a Latin phrase meaning “other things held constant” or “all else unchanged”. Using this principle we examine input variable per variable separatly, asumming that effects of all other variables are unchanged.</p>
</div>
<div id="intuition" class="section level2">
<h2><span class="header-section-number">4.2</span> Intuition</h2>
<p>See Figure <a href="ceterisParibus.html#fig:modelResponseCurveLine">4.1</a>. The panel A shows a model response surface for a function that takes two arguments, <em>floor</em> and <em>construction.year</em>. We are interested in an explanation of the model curvature around a single point, here marked as a black dot. Ceteris Paribus profiles examine this function dimension by dimension as a one-dimensional profiles. Panel B shows two such profiles.</p>
<div class="figure" style="text-align: center"><span id="fig:modelResponseCurveLine"></span>
<img src="figure/model_response_line.png" alt="(fig:modelResponseCurveLine) A) Model response surface. Ceteris Paribus profiles marked with black curves helps to understand the curvature of the model response by updating only a single variable. B) CP profiles are individual conditional model responses" width="70%" />
<p class="caption">
Figure 4.1: (fig:modelResponseCurveLine) A) Model response surface. Ceteris Paribus profiles marked with black curves helps to understand the curvature of the model response by updating only a single variable. B) CP profiles are individual conditional model responses
</p>
</div>
<p>In some sense this technique is similar to the LIME method introduced in the section <a href="LIME.html#LIME">9</a>. In both cases LIME and Ceteris Paribus profiles examine curvature of a model response function. The difference between these two methods that LIME approximates the model curvature with a simpler white-box model that is easier to present. Usually the LIME model is sparse, thus our attention may be limited to smaller number of dimensions. In contrary, the CP plots show conditional model response for every variable. In most cases it is much easier to explain how to read CP profiles than LIME attributions. In the last subsection we discuss pros and cons of this approach.</p>
</div>
<div id="the-method" class="section level2">
<h2><span class="header-section-number">4.3</span> The Method</h2>
<p>In next sections we introduce 1D and 2D Ceteris Profiles more formally. Here we present profiles for continuous variable, but they can be easily generalized for variables of other types, like line, color or categorical variables.</p>
<div id="ceterisParibus1d" class="section level3">
<h3><span class="header-section-number">4.3.1</span> 1D profiles</h3>
<p>Let <span class="math inline">\(f(x): \mathcal R^{d} \rightarrow \mathcal R\)</span> denote a predictive model, i.e. function that takes <span class="math inline">\(d\)</span> dimensional vector and calculate numerical score. Symbol <span class="math inline">\(x \in \mathcal R^d\)</span> refers to a point in the feature space. We use subscript <span class="math inline">\(x_i\)</span> to refer to a different data points and superscript <span class="math inline">\(x^j\)</span> to refer to specific dimensions/features. Additionally, let <span class="math inline">\(x^{-j}\)</span> denote all coordinates except <span class="math inline">\(j\)</span>-th and let <span class="math inline">\(x|^j=z\)</span> denote a data point <span class="math inline">\(x\)</span> with all coordinates equal to <span class="math inline">\(x\)</span> except for a coordinate <span class="math inline">\(j\)</span> equal to value <span class="math inline">\(z\)</span>. I.e. <span class="math inline">\(\forall_{i \neq {j}} x^i = x^{*,i}\)</span> and <span class="math inline">\(x^j = z\)</span>. In other words <span class="math inline">\(x|^j=z\)</span> denote a <span class="math inline">\(x\)</span> with <span class="math inline">\(j\)</span>th coordinate changed to <span class="math inline">\(z\)</span>.</p>
<p>Now we can define uni-dimensional Ceteris Paribus Profile for model <span class="math inline">\(f\)</span>, variable <span class="math inline">\(j\)</span> and point <span class="math inline">\(x\)</span> as</p>
<p><span class="math display">\[
CP^{f, j, x}(z) := f(x|^j = z).
\]</span> I.e. CP profile is a model response obtained for observations created based on <span class="math inline">\(x\)</span> with coordinate <span class="math inline">\(j\)</span> changed and all other coordinates kept unchanged.</p>
<p>A natural way to visualise CP profiles is to use a profile plot as in Figure <a href="ceterisParibus.html#fig:HRCPFiredHours">4.2</a>.</p>
<p>Figure <a href="ceterisParibus.html#fig:HRCPFiredHours">4.2</a> shows an example of Ceteris Paribus profile. The black dot stands for prediction for a single observation <span class="math inline">\((x, f(x))\)</span>. Red curve shows how the model response change if in this single observation coordinate <code>hours</code> is changed to selected value. One thing that we can read is that the model response is not smooth and there is some variability along the profile. Second thing is that for this particular observation the model response would drop significantly if the variable <code>hours</code> will be higher than 45.</p>
<div class="figure" style="text-align: center"><span id="fig:HRCPFiredHours"></span>
<img src="figure/HR_cp_fired_hours.png" alt="(fig:HRCPHiredHours) Ceteris Paribus profile for Random Forest model that assess the probability of being fired in call center as a function of average number of working hours" width="50%" />
<p class="caption">
Figure 4.2: (fig:HRCPHiredHours) Ceteris Paribus profile for Random Forest model that assess the probability of being fired in call center as a function of average number of working hours
</p>
</div>
<p>Since in the <code>HR</code> dataset we are struggling with model for three classes, it is a good idea to plot CP profiles for each class in the same panel. In this way we can compare effect of the <code>hours</code> on all three classes in the same time. See an example in the Figure <a href="ceterisParibus.html#fig:HRCPAllHours">4.3</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:HRCPAllHours"></span>
<img src="figure/HR_cp_all_hours.png" alt="(fig:HRCPAllHours) Ceteris Paribus profiles for three classess predicted by the Random Forest model as a function of average number of working hours" width="60%" />
<p class="caption">
Figure 4.3: (fig:HRCPAllHours) Ceteris Paribus profiles for three classess predicted by the Random Forest model as a function of average number of working hours
</p>
</div>
<p>Usually the model input consist many variables. CP profiles are readable even for tiny subplots, what makes them perfect for the small multiples. This way we can analysis more variables at the same time. The easiest way to do so is to plot consecutive variables on separate panels. See an example in Figure <a href="ceterisParibus.html#fig:HRCPFiredAll">4.4</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:HRCPFiredAll"></span>
<img src="figure/HR_cp_fired_all.png" alt="(fig:HRCPFiredAll) Ceteris Paribus profiles for all continuous variables in the HR dataset" width="70%" />
<p class="caption">
Figure 4.4: (fig:HRCPFiredAll) Ceteris Paribus profiles for all continuous variables in the HR dataset
</p>
</div>
</div>
<div id="oscillations" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Profile oscillations</h3>
<p>Visual examination of Ceteris Paribus profiles is insightful, but for large number of features we end up with large number of panels. In order to prioritize panels that are more important we need a measure that assess an impact of a selected feature on model output.</p>
<p>Profile oscillations are one of such measures. They can be used for proper ordering of CP profiles for important features or for filtering of feature of interest. CP profiles lead to a very natural and intuitive way of assessing the local feature importance for a single prediction. The intuition is: the more important is a feature the larger are fluctuations along its CP profile. If feature is not important then model response will be flat of barely changed. If variable is important the CP profile fluctuates a lot depending on a value for selected feature.</p>
<p>Let’s write it down in a more formal way.</p>
<p>Let <span class="math inline">\(vip^{CP}_j(x)\)</span> denotes local variable importance calculated based on a CP profile for feature <span class="math inline">\(j\)</span> in a point <span class="math inline">\(x\)</span>. Let <span class="math inline">\(g^j(z)\)</span> stands for a density of feature <span class="math inline">\(j\)</span> then expected absolute oscilations are defined as</p>
<p><span class="math display">\[
vip^{CP}_j(x) = \int_{\mathcal R} |CP^{f,j,x}(z) - f(x)| g^j(z)dz.
\]</span></p>
<p>So it’s an area between <span class="math inline">\(f(x)\)</span> and Ceteris Paribus profile weighted by density of feature <span class="math inline">\(j\)</span>. Note that one can consider different modification of this measure, for example deviations can be calculated not as a distance from <span class="math inline">\(f(x)\)</span> but from average <span class="math inline">\(\bar CP^{f,j,x}(z)\)</span> or instead of absolute deviations one may use root from average squares.</p>
<p>The straightforward estimator for <span class="math inline">\(vip^{CP}_j(x)\)</span> is</p>
<p><span class="math display">\[
\widehat{ vip^{CP}_j(x)} = \frac 1n \sum_{i=1}^n |CP^{f,j,x}(x_i) - f(x)|.
\]</span></p>
<p>Figure <a href="ceterisParibus.html#fig:CPVIPprofiles">4.5</a> shows the idea behind measuring oscillations. The larger the highlighted area the more important is the variable.</p>
<div class="figure" style="text-align: center"><span id="fig:CPVIPprofiles"></span>
<img src="figure/CP_VIP_profiles.png" alt="(fig:CPVIPprofiles) CP oscillations are average deviations between CP profiles and the model response" width="50%" />
<p class="caption">
Figure 4.5: (fig:CPVIPprofiles) CP oscillations are average deviations between CP profiles and the model response
</p>
</div>
<p>Figure <a href="ceterisParibus.html#fig:CPVIP1">4.6</a> summarizes variable oscillations. Such visuals help to quickly grasp how large are model oscillations around a specific point.</p>
<div class="figure" style="text-align: center"><span id="fig:CPVIP1"></span>
<img src="figure/cp_vip_1.png" alt="(fig:CPVIP1) Variable importance plots calculated for Ceteris Paribus profiles for observation ID: 1001" width="40%" />
<p class="caption">
Figure 4.6: (fig:CPVIP1) Variable importance plots calculated for Ceteris Paribus profiles for observation ID: 1001
</p>
</div>
<p><strong>NOTE</strong></p>
<p>Variable importance for single prediction may be very different than variable importance for the full model.</p>
<p>For example, consider a model <span class="math display">\[
f(x_1, x_2) = x_1 * x_2
\]</span> where variables <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> takes values in <span class="math inline">\([0,1]\)</span>.</p>
<p>From the global perspective both variables are equally important.</p>
<p>But local variable importance is very different. Around point <span class="math inline">\(x = (0, 1)\)</span> the importance of <span class="math inline">\(x_1\)</span> is much larger than <span class="math inline">\(x_2\)</span>. This is because profile for <span class="math inline">\(f(z, 1)\)</span> have larger oscillations than <span class="math inline">\(f(0, z)\)</span>.</p>
</div>
<div id="d-profiles" class="section level3">
<h3><span class="header-section-number">4.3.3</span> 2D profiles</h3>
<p>The definition of Ceteris Paribus profiles given in section <a href="ceterisParibus.html#ceterisParibus1d">4.3.1</a> may be easily extended to two or more variables. Also definition of CP oscillations <a href="ceterisParibus.html#oscillations">4.3.2</a> have straight forward generalization for larger number of dimensions. Such generalisations are usefull when model is non additive. Presence of pairwise interactions may be detected with 2D Ceteris Paribus plots.</p>
<p>Let’s define two-dimensional Ceteris Paribus Profile for model <span class="math inline">\(f\)</span>, variables <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> and point <span class="math inline">\(x\)</span> as</p>
<p><span class="math display">\[
CP^{f, (j,k), x}(z_1, z_2) := f(x|^{(j,k)} = (z_1,z_2)).
\]</span> I.e. CP profile is a model response obtained for observations created based on <span class="math inline">\(x\)</span> with <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> coordinates changed to <span class="math inline">\((z_1, z_2)\)</span> and all other coordinates kept unchanged.</p>
<p>A natural way to visualise 2D CP profiles is to use a level plot as in Figure <a href="ceterisParibus.html#fig:CP2Dsurflor">4.7</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:CP2Dsurflor"></span>
<img src="figure/cp_2d_surf_floor.png" alt="(fig:CP2Dsurflor) Ceteris Paribus plot for a pair of variales. Black cross marks coordinated for the observation of interest. Presented model estimates price of an appartment" width="60%" />
<p class="caption">
Figure 4.7: (fig:CP2Dsurflor) Ceteris Paribus plot for a pair of variales. Black cross marks coordinated for the observation of interest. Presented model estimates price of an appartment
</p>
</div>
<p>If number of variables is small or moderate thein it is possible to present all pairs of variables. See an example in Figure <a href="ceterisParibus.html#fig:CP2Dall">4.8</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:CP2Dall"></span>
<img src="figure/cp_2d_all.png" alt="(fig:CP2Dall) Ceteris Paribus plot for all pairs of variales." width="90%" />
<p class="caption">
Figure 4.8: (fig:CP2Dall) Ceteris Paribus plot for all pairs of variales.
</p>
</div>
</div>
</div>
<div id="local-model-fidelity" class="section level2">
<h2><span class="header-section-number">4.4</span> Local model fidelity</h2>
<p>Ceteris Paribus profiles are also a useful tool to validate local model fidelity. It may happen that global performance of the model is good, while for some points the local fit is very bad. Local fidelity helps to understand how good is the model fit around point of interest.</p>
<p>How does it work?</p>
<p>The idea behind fidelity plots is to select some number of points from the validation dataset that are closes to the point of interest. It’s a similar approach as in k nearest neighbours. Then for these neighbours we may plot Ceteris Paribus Profiles and check how stable they are.</p>
<p>Also, if we know true taget values for points from the validation dataset we may plot residuals to show how large are residuals.</p>
<p>An example fidelity plot is presented in Figure <a href="ceterisParibus.html#fig:CPfidelity1">4.9</a>. Black line shows the CP profiles for the point of interest, while grey lines show CP profiles for neihgbors. Red intervals stand for residuals and in this example it looks like residuals for neighbours are all negative. Thus maybe model is biased around the point of interest.</p>
<div class="figure" style="text-align: center"><span id="fig:CPfidelity1"></span>
<img src="figure/cp_fidelity_1.png" alt="(fig:CPfidelity1) Local fidelity plots. Black line shows the CP profile for the point of interest. Grey lines show CP profiles for nearest neighbors. Red intervals correspond to residuals. Each red interval starts in a model prediction for a selected neighbor and ends in its true value of target variable." width="70%" />
<p class="caption">
Figure 4.9: (fig:CPfidelity1) Local fidelity plots. Black line shows the CP profile for the point of interest. Grey lines show CP profiles for nearest neighbors. Red intervals correspond to residuals. Each red interval starts in a model prediction for a selected neighbor and ends in its true value of target variable.
</p>
</div>
<p>This observation may be confirmed by plots that compare distribution of all residuals against distribution of residuals for neighbors.</p>
<p>See Figure <a href="ceterisParibus.html#fig:CPfidelityBoxplot">4.10</a> for an example. Here residuals for neighbors are shifted towards highest values. This suggests that the model response is biased around the observation of interest.</p>
<div class="figure" style="text-align: center"><span id="fig:CPfidelityBoxplot"></span>
<img src="figure/cp_fidelity_boxplot.png" alt="(fig:CPfidelityBoxplot) Distribution of residuals for whole validation data (grey boxplot) and for selected closes 15 neighbors (red boxplot)." width="70%" />
<p class="caption">
Figure 4.10: (fig:CPfidelityBoxplot) Distribution of residuals for whole validation data (grey boxplot) and for selected closes 15 neighbors (red boxplot).
</p>
</div>
</div>
<div id="pros-and-cons" class="section level2">
<h2><span class="header-section-number">4.5</span> Pros and cons</h2>
<p>Ceteris Paribus principle gives a uniform and extendable approach to model exploration. Below we summarize key strengths and weaknesses of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>Graphical representation of Ceteris Paribus profile is easy to understand.</li>
<li>Ceteris Paribus profiles are compact and it is easy to fit many models or many variables in a small space.</li>
<li>Ceteris Paribus profiles helps to understand how model response would change and how stable it is</li>
<li>Oscillations calculated for CP profiles helps to select the most important variables.</li>
<li>2D Ceteris Paribus profiles help to identify pairwise interactions between variables.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>If variables are correlated (like surface and number of rooms) then the ‘<em>everything else kept unchanged</em>’ approach leads to unrealistic settings.</li>
<li>Interactions between variables are not visible in 1D plots.</li>
<li>This tool is not suited for very wide data, like hundreds or thousands of variables.</li>
<li>Visualization of categorical variables is non trivial.</li>
</ul>
</div>
<div id="code-snippets-for-r" class="section level2">
<h2><span class="header-section-number">4.6</span> Code snippets for R</h2>
<p>In this section we present key features of the <code>ingredients</code> package for R <span class="citation">(Biecek <a href="#ref-R-ceterisParibus">2018</a><a href="#ref-R-ceterisParibus">b</a>)</span>. This package covers all features presented in this chapter. It is available on CRAN and GitHub. Find more examples at the website of this package <code>https://modeloriented.github.io/ingredients/</code>.</p>
<p>A very interesting approach for model explorartion with similar principles is implemented in the <code>condvis</code> package <span class="citation">(O’Connell, Hurley, and Domijan <a href="#ref-JSSv081i05">2017</a>)</span>.</p>
<p><strong>Model preparation</strong></p>
<p>In this section we will present examples based on the <code>apartments</code> dataset. See section TODO for more details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)
<span class="kw">head</span>(apartments, <span class="dv">2</span>)</code></pre></div>
<pre><code>##   m2.price construction.year surface floor no.rooms    district
## 1     5897              1953      25     3        1 Srodmiescie
## 2     1818              1992     143     9        5     Bielany</code></pre>
<p>The problem here is to predict average price for square meter for an apartment. Let’s build a random forest model with <code>randomForest</code> package <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)
rf_model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(m2.price <span class="op">~</span><span class="st"> </span>construction.year <span class="op">+</span><span class="st"> </span>surface <span class="op">+</span><span class="st"> </span>floor <span class="op">+</span>
<span class="st">      </span>no.rooms, <span class="dt">data =</span> apartments)</code></pre></div>
<p>Ceteris Paribus profiles with <code>ingredients</code> package are calculated in four steps.</p>
<p><strong>1. Create an explainer - wrapper around model and validation data.</strong></p>
<p>Since all other functions work in a model agnostic fashion, first we need to define a wrapper around the model. Here we are using the <code>explain()</code> function from <code>DALEX</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a><a href="#ref-R-DALEX">c</a>)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)
explainer_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(rf_model, <span class="dt">data =</span> apartmentsTest, <span class="dt">y =</span> apartmentsTest<span class="op">$</span>m2.price)</code></pre></div>
<p><strong>2. Define point of interest.</strong></p>
<p>Certeris Paribus profiles explore model around a single point.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_apartment &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">construction.year =</span> <span class="dv">1965</span>, <span class="dt">no.rooms =</span> <span class="dv">5</span>, <span class="dt">surface =</span> <span class="dv">142</span>, <span class="dt">floor =</span> <span class="dv">8</span>)
<span class="kw">predict</span>(rf_model, new_apartment)</code></pre></div>
<pre><code>##        1 
## 2336.781</code></pre>
<p><strong>3. Calculate CP profiles</strong></p>
<p>The <code>ceteris_paribus()</code> function calculates CP profiles for selected model around selected observation.</p>
<p>By default CP profiles are calculated for all numerical variables. Use the <code>variables</code> argument to select subset of interesting variables. The result from <code>ceteris_paribus()</code>function is a data frame with model predictions for modified points around the point of interest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)
cp_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_rf, new_apartment, 
                            <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;construction.year&quot;</span>, <span class="st">&quot;floor&quot;</span>))
cp_rf</code></pre></div>
<pre><code>## Top profiles    : 
##     construction.year no.rooms surface floor   _yhat_           _vname_
## 1                1920        5     142     8 3063.816 construction.year
## 1.1              1921        5     142     8 3095.865 construction.year
## 1.2              1922        5     142     8 3102.228 construction.year
## 1.3              1923        5     142     8 3056.978 construction.year
## 1.4              1924        5     142     8 3062.221 construction.year
## 1.5              1925        5     142     8 3081.350 construction.year
##     _ids_      _label_
## 1       1 randomForest
## 1.1     1 randomForest
## 1.2     1 randomForest
## 1.3     1 randomForest
## 1.4     1 randomForest
## 1.5     1 randomForest
## 
## 
## Top observations:
##   construction.year no.rooms surface floor   _yhat_      _label_ _ids_
## 1              1965        5     142     8 2336.781 randomForest     1</code></pre>
<p><strong>4. Plot CP profiles.</strong></p>
<p>Generic <code>plot()</code> function plot CP profiles. It returns a <code>ggplot2</code> object that can be polished if needed. Use additional arguments of this function to select colors and sizes for elements visible in the plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cp_rf) <span class="op">+</span>
<span class="st">  </span><span class="kw">show_observations</span>(cp_rf)</code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>One of very useful features of <code>ceterisParibus</code> explainers is that profiles for two or more models may be superimposed in a single plot. This helps in model comparisons.</p>
<p>Let’s create a linear model for this dataset and repeat steps 1-3 for the lm model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lm_model &lt;-<span class="st"> </span><span class="kw">lm</span>(m2.price <span class="op">~</span><span class="st"> </span>construction.year <span class="op">+</span><span class="st"> </span>surface <span class="op">+</span><span class="st"> </span>floor <span class="op">+</span>
<span class="st">      </span>no.rooms, <span class="dt">data =</span> apartments)
explainer_lm &lt;-<span class="st"> </span><span class="kw">explain</span>(lm_model,
      <span class="dt">data =</span> apartmentsTest, <span class="dt">y =</span> apartmentsTest<span class="op">$</span>m2.price)
cp_lm &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_lm, new_apartment, 
                            <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;construction.year&quot;</span>, <span class="st">&quot;floor&quot;</span>))</code></pre></div>
<p>Now we can use function <code>plot()</code> to compare both models in a single chart. Additional argument <code>color = &quot;_label_&quot;</code> set color as a key for model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(cp_rf, cp_lm, <span class="dt">color =</span> <span class="st">&quot;_label_&quot;</span>)</code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p><strong>Oscillations</strong></p>
<p>The <code>calculate_oscillations()</code> function calculates oscillations for CP profiles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cp_rf_all &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explainer_rf, new_apartment)
co_rf_all &lt;-<span class="st"> </span><span class="kw">calculate_oscillations</span>(cp_rf_all)
co_rf_all</code></pre></div>
<pre><code>##             _vname_ _ids_ oscillations
## 3           surface     1     632.6083
## 2          no.rooms     1     407.6578
## 4             floor     1     327.0093
## 1 construction.year     1     238.4735</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(co_rf_all)</code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p><strong>2D Ceteris Paribus profiles</strong></p>
<p>And the <code>ceteris_paribus_2d()</code> function calculates 2D CP profiles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wi_rf_2d &lt;-<span class="st"> </span><span class="kw">ceteris_paribus_2d</span>(explainer_rf, <span class="dt">observation =</span> new_apartment, 
                 <span class="dt">selected_variables =</span> <span class="kw">c</span>(<span class="st">&quot;surface&quot;</span>,<span class="st">&quot;floor&quot;</span>, <span class="st">&quot;construction.year&quot;</span>))
<span class="kw">plot</span>(wi_rf_2d, <span class="dt">split_ncol =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ICEbox">
<p>Goldstein, Alex, Adam Kapelner, Justin Bleich, and Emil Pitkin. 2015. “Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation.” <em>Journal of Computational and Graphical Statistics</em> 24 (1): 44–65. doi:<a href="https://doi.org/10.1080/10618600.2014.907095">10.1080/10618600.2014.907095</a>.</p>
</div>
<div id="ref-R-ceterisParibus">
<p>Biecek, Przemyslaw. 2018b. <em>CeterisParibus: Ceteris Paribus Profiles</em>. <a href="https://pbiecek.github.io/ceterisParibus/" class="uri">https://pbiecek.github.io/ceterisParibus/</a>.</p>
</div>
<div id="ref-JSSv081i05">
<p>O’Connell, Mark, Catherine Hurley, and Katarina Domijan. 2017. “Conditional Visualization for Statistical Models: An Introduction to the Condvis Package in R.” <em>Journal of Statistical Software, Articles</em> 81 (5): 1–20. doi:<a href="https://doi.org/10.18637/jss.v081.i05">10.18637/jss.v081.i05</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest" class="uri">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
<div id="ref-R-DALEX">
<p>Biecek, Przemyslaw. 2018c. <em>DALEX: Descriptive mAchine Learning Explanations</em>. <a href="https://pbiecek.github.io/DALEX/" class="uri">https://pbiecek.github.io/DALEX/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PredictionExplainers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variableAttributionMethods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
