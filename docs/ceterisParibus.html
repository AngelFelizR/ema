<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-04-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="PredictionExplainers.html">
<link rel="next" href="ceterisParibusOscillations.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_titanic"><i class="fa fa-check"></i><b>2.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>2.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>2.1.3</b> Random forest</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_gbm"><i class="fa fa-check"></i><b>2.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_titanic"><i class="fa fa-check"></i><b>2.1.5</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>2.2</b> Apartment prices</a><ul>
<li class="chapter" data-level="2.2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_apartments"><i class="fa fa-check"></i><b>2.2.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_lr"><i class="fa fa-check"></i><b>2.2.2</b> Linear regression</a></li>
<li class="chapter" data-level="2.2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_rf"><i class="fa fa-check"></i><b>2.2.3</b> Random forest</a></li>
<li class="chapter" data-level="2.2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_apartments"><i class="fa fa-check"></i><b>2.2.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>2.3</b> Hire or fire</a><ul>
<li class="chapter" data-level="2.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_HR"><i class="fa fa-check"></i><b>2.3.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_mr"><i class="fa fa-check"></i><b>2.3.2</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="2.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_rf"><i class="fa fa-check"></i><b>2.3.3</b> Random forest</a></li>
<li class="chapter" data-level="2.3.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_HR"><i class="fa fa-check"></i><b>2.3.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModels"><i class="fa fa-check"></i><b>2.4</b> List of models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>4</b> Ceteris-paribus Profiles - a Tool for What-If Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>4.3</b> Method</a></li>
<li class="chapter" data-level="4.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>4.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="4.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>4.5</b> Pros and cons</a></li>
<li class="chapter" data-level="4.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>4.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>5</b> Ceteris Paribus Oscillations - a Tool for Local Variable-importance</a><ul>
<li class="chapter" data-level="5.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>5.2</b> Intuition</a></li>
<li class="chapter" data-level="5.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>5.3</b> Method</a></li>
<li class="chapter" data-level="5.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>5.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="5.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>5.5</b> Pros and cons</a></li>
<li class="chapter" data-level="5.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>5.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>6</b> Ceteris-Paribus 2D Profiles - a tool for pairwise interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#intuition"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#method"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#pros-and-cons"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#code-snippets-for-r"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>7</b> Local diagnostic with Ceteris-Paribus profiles</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#intuition-1"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#method-1"><i class="fa fa-check"></i><b>7.3</b> Method</a><ul>
<li class="chapter" data-level="7.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#nearest-neighbors"><i class="fa fa-check"></i><b>7.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="7.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#profiles-for-neighbors"><i class="fa fa-check"></i><b>7.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="7.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#residuals"><i class="fa fa-check"></i><b>7.3.3</b> Residuals</a></li>
<li class="chapter" data-level="7.3.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#local-fidelity-plot"><i class="fa fa-check"></i><b>7.3.4</b> Local Fidelity Plot</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#pros-and-cons-1"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#start-with-ceteris-paribus-profile"><i class="fa fa-check"></i><b>7.5.1</b> Start with Ceteris Paribus Profile</a></li>
<li class="chapter" data-level="7.5.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-profiles-for-neighbors"><i class="fa fa-check"></i><b>7.5.2</b> Add profiles for neighbors</a></li>
<li class="chapter" data-level="7.5.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-residuals-for-neighbors"><i class="fa fa-check"></i><b>7.5.3</b> Add residuals for neighbors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>8</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="8.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-2"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method-2"><i class="fa fa-check"></i><b>8.3</b> Method</a></li>
<li class="chapter" data-level="8.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>8.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="8.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-2"><i class="fa fa-check"></i><b>8.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="8.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>8.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>9</b> BreakDown for Additive Variable Attributions</a><ul>
<li class="chapter" data-level="9.1" data-path="breakDown.html"><a href="breakDown.html#intuition-3"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="breakDown.html"><a href="breakDown.html#method-3"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="breakDown.html"><a href="breakDown.html#example-titanic-data"><i class="fa fa-check"></i><b>9.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-3"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>10</b> iBreakDown for Variable Attributions with Interactions</a><ul>
<li class="chapter" data-level="10.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-4"><i class="fa fa-check"></i><b>10.1</b> Intuition</a></li>
<li class="chapter" data-level="10.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-4"><i class="fa fa-check"></i><b>10.2</b> Method</a><ul>
<li class="chapter" data-level="10.2.1" data-path="iBreakDown.html"><a href="iBreakDown.html#single-step-contributions"><i class="fa fa-check"></i><b>10.2.1</b> Single step contributions</a></li>
<li class="chapter" data-level="10.2.2" data-path="iBreakDown.html"><a href="iBreakDown.html#two-steps-contributions"><i class="fa fa-check"></i><b>10.2.2</b> Two steps contributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="iBreakDown.html"><a href="iBreakDown.html#sequential-contributions"><i class="fa fa-check"></i><b>10.2.3</b> Sequential contributions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-titanic"><i class="fa fa-check"></i><b>10.3</b> Example: Titanic</a></li>
<li class="chapter" data-level="10.4" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-4"><i class="fa fa-check"></i><b>10.4</b> Pros and cons</a></li>
<li class="chapter" data-level="10.5" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>10.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>11</b> SHapley Additive exPlanations for Average Variable Attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="shapley.html"><a href="shapley.html#intuition-5"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="shapley.html"><a href="shapley.html#method-5"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="shapley.html"><a href="shapley.html#titanic"><i class="fa fa-check"></i><b>11.3</b> Titanic</a></li>
<li class="chapter" data-level="11.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-5"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>12</b> LIME for local model approximation</a><ul>
<li class="chapter" data-level="12.1" data-path="LIME.html"><a href="LIME.html#intuition-6"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="LIME.html"><a href="LIME.html#method-6"><i class="fa fa-check"></i><b>12.2</b> Method</a></li>
<li class="chapter" data-level="12.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire"><i class="fa fa-check"></i><b>12.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="12.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-6"><i class="fa fa-check"></i><b>12.4</b> Pros and cons</a></li>
<li class="chapter" data-level="12.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-5"><i class="fa fa-check"></i><b>12.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="12.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>12.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="12.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>12.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="12.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>12.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>13</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="13.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>13.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="champion-challenger-explainers.html"><a href="champion-challenger-explainers.html"><i class="fa fa-check"></i><b>14</b> Champion-Challenger explainers</a></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="15" data-path="introduction-4.html"><a href="introduction-4.html"><i class="fa fa-check"></i><b>15</b> Introduction</a><ul>
<li class="chapter" data-level="15.1" data-path="introduction-4.html"><a href="introduction-4.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>15.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="15.2" data-path="introduction-4.html"><a href="introduction-4.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>15.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>16</b> Feature Importance</a><ul>
<li class="chapter" data-level="16.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>16.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="16.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic-1"><i class="fa fa-check"></i><b>16.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="16.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>16.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="16.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>16.4</b> More models</a></li>
<li class="chapter" data-level="16.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>16.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>17</b> Feature effects</a><ul>
<li class="chapter" data-level="17.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>17.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>18</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="18.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>18.1</b> Definition</a></li>
<li class="chapter" data-level="18.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>18.2</b> Estimation</a></li>
<li class="chapter" data-level="18.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>18.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="18.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>18.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="18.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>18.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>19</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
<li class="chapter" data-level="19.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>19.2</b> Estimation</a></li>
<li class="chapter" data-level="19.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>19.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>20</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="20.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>20.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>21</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="22" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>22</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="23" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>23</b> Other topics</a></li>
<li class="chapter" data-level="24" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>24</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="25" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>25</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="26" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>26</b> Concept Drift</a><ul>
<li class="chapter" data-level="26.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-5"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>26.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="26.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>26.3</b> Code snippets</a></li>
<li class="chapter" data-level="26.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>26.4</b> Residual Drift</a></li>
<li class="chapter" data-level="26.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>26.5</b> Code snippets</a></li>
<li class="chapter" data-level="26.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>26.6</b> Model Drift</a></li>
<li class="chapter" data-level="26.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>26.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="27" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>27</b> Data Sets</a><ul>
<li class="chapter" data-level="27.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>27.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>28</b> Packages</a><ul>
<li class="chapter" data-level="28.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>28.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ceterisParibus" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Ceteris-paribus Profiles - a Tool for What-If Analysis</h1>
<div id="CPIntro" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p><em>Ceteris paribus</em> is a Latin phrase meaning “other things held constant” or “all else unchanged.” In this chapter, we introduce a technique for model exploration based on the Ceteris paribus principle. In particular, we examine the influence of each explanatory variable, asumming that effects of all other variables are unchanged. The main goal is to understand how changes in a single explanatory variable affects model predictions.</p>
<p>Explanation tools (explainers) presented in this chapter are linked to the second law introduced in Section <a href="index.html#three-single-laws">1.2</a>, i.e. the law of “Prediction’s speculation.” This is why the tools are also known as <em>What-If model analysis</em> or <em>Individual Conditional Expectations</em> <span class="citation">(Goldstein et al. <a href="#ref-ICEbox">2015</a><a href="#ref-ICEbox">a</a>)</span>. It turns out that it is easier to understand how a black-box model is working if we can explore the model by investigating the influence of explanatory variables separately, changing one at a time.</p>
</div>
<div id="CPIntuition" class="section level2">
<h2><span class="header-section-number">4.2</span> Intuition</h2>
<p>Panel A of Figure <a href="ceterisParibus.html#fig:modelResponseCurveLine">4.1</a> presents response (prediction) surface for the <code>titanic_lmr_v6</code> model for two explanatory variables, <em>age</em> and <em>class</em>, from the <em>titanic</em> dataset (see Section <a href="DataSetsIntro.html#TitanicDataset">2.1</a>). We are interested in the change of the model prediction induced by each of the variables. Toward this end, we may want to explore the curvature of the response surface around a single point with <em>age</em> equal to 47 and <em>class</em> equal to “1st,” indicated in the plot. Ceteris-paribus (CP) profiles are one-dimensional profiles that examine the curvature across each dimension, i.e., for each variable. Panel B of Figure <a href="ceterisParibus.html#fig:modelResponseCurveLine">4.1</a> presents the profiles corresponding to <em>age</em> and <em>class</em>. Note that, in the CP profile for <em>age</em>, the point of interest is indicated by the black dot. In essence, a CP profile shows a conditional expectation of the dependent variable (response) for the particular explanatory variable.</p>
<div class="figure" style="text-align: center"><span id="fig:modelResponseCurveLine"></span>
<img src="figure/profile_age_class.png" alt="(fig:modelResponseCurveLine) A) Model response (prediction) surface. Ceteris-paribus (CP) profiles marked with black curves help to understand the curvature of the surface while changing only a single explanatory variable. B) CP profiles for individual variables, age (continuous) and class (categorical)." width="70%" />
<p class="caption">
Figure 4.1: (fig:modelResponseCurveLine) A) Model response (prediction) surface. Ceteris-paribus (CP) profiles marked with black curves help to understand the curvature of the surface while changing only a single explanatory variable. B) CP profiles for individual variables, age (continuous) and class (categorical).
</p>
</div>
<p>CP technique is similar to the LIME method (see Chapter <a href="LIME.html#LIME">12</a>). LIME and CP profiles examine the curvature of a model response-surface. The difference between these two methods lies in the fact that LIME approximates the black-box model of interest locally with a simpler white-box model. Usually, the LIME model is sparse, i.e., contains fewer variables, and thus we have got to graphically investigate a smaller number of dimensions. On the other hand, the CP profiles present conditional predictions for every variable and, in most cases, are easier to intepret.</p>
</div>
<div id="CPMethod" class="section level2">
<h2><span class="header-section-number">4.3</span> Method</h2>
<p>In this section we introduce more formally one-dimensional CP profiles. <!-- We consider the case of a continuous dependent variable, but the profiles can be easily generalized for other types. --></p>
<p>In predictive modeling, we are interested a distribution of a dependent variable <span class="math inline">\(Y\)</span> given vector <span class="math inline">\(x^*\)</span> that contains the values of explanatory variables. In the ideal world we would like to know the conditional distribution of <span class="math inline">\(Y\)</span> given <span class="math inline">\(x^*\)</span>, <span class="math inline">\(Y | x^*\)</span>. In practical applications we usually do not predict the entire distribution, but just some of its characteristics like the expected (mean) value, a quantile, or variance. Without loss of generality we will assume that we model the expected value <span class="math inline">\(E_Y(Y | x^*)\)</span>.</p>
<p>Assume that we have got model <span class="math inline">\(f()\)</span>, for which <span class="math inline">\(f(x^*)\)</span> is an approximation of <span class="math inline">\(E_Y(Y | x^*)\)</span>, i.e., <span class="math inline">\(E_Y(Y | x^*) \approx f(x^*)\)</span>. Note that we do not assume that it is a “good” model, nor that the approximation is precise. We simply assume that we have got a model that is used to estimate the expected value and that to form predictions of the dependent variable. Our interest lies in the evalution of the quality of the predictions. If the model offers a “good” approximation of the expected value, it should be reflected in its satisfactory predictive performance.</p>
<p>We will use subscript <span class="math inline">\(x^*_i\)</span> to refer to the vector corresponding to the <span class="math inline">\(i\)</span>-th observation in a dataset. We will use superscript <span class="math inline">\(x^{*j}\)</span> to refer to the <span class="math inline">\(j\)</span>-th element of <span class="math inline">\(x^*\)</span>, i.e., the <span class="math inline">\(j\)</span>-th variable. Additionally, let <span class="math inline">\(x^{*-j}\)</span> denote a vector resultinig from removing the <span class="math inline">\(j\)</span>-th element from vector <span class="math inline">\(x^{*}\)</span>. Moreover, let <span class="math inline">\(x^{*|j}=z\)</span> denotes a vector in which the <span class="math inline">\(j\)</span>-th element is equal to <span class="math inline">\(z\)</span> (a scalar).</p>
<p>We define a one-dimensional CP profile for the model <span class="math inline">\(f()\)</span>, <span class="math inline">\(j\)</span>-th explanatory variable, and point <span class="math inline">\(x^*\)</span> as follows:</p>
<p><span class="math display">\[
CP^{f, j, x^*}(z) \equiv f(x^{*|j} = z).
\]</span>
That is, CP profile is a function that provides the dependence of the approximated expected value (prediction) of the model for <span class="math inline">\(Y\)</span> on the value of <span class="math inline">\(j\)</span>-th explanatory variable <span class="math inline">\(z\)</span>. Note that <span class="math inline">\(z\)</span> is taken to go through the range of values typical for the variable, while values of all other explanatory variables are kept fixed at the values given by <span class="math inline">\(x^*\)</span>.</p>
</div>
<div id="CPExample" class="section level2">
<h2><span class="header-section-number">4.4</span> Example: Titanic data</h2>
<p>For continuous explanatory variables, a natural way to represent the CP function is to use a profile plot similar to the ones presented in Figure <a href="ceterisParibus.html#fig:profileAgeRf">4.2</a>. In the figure, the dot on the curves marks an instance prediction, i.e., prediction <span class="math inline">\(f(x^*)\)</span> for a single observation <span class="math inline">\(x^*\)</span>. The curve itself shows how the prediction would change if the value of a particular explanatory variable changed.</p>
<p>Figure <a href="ceterisParibus.html#fig:profileAgeRf">4.2</a> presents CP profiles for the <em>age</em> variable in the logistic regression and random forest models for the Titanic dataset (see Section <a href="DataSetsIntro.html#HFDataset">2.3</a>). It is worth oberving that the profile for the logistic regression model is smooth, while for the random forest model it shows more variability. For this instance (observation), the prediction for both models would increase substantially if the value of the explanatory variable became lower than 20.</p>
<div class="figure" style="text-align: center"><span id="fig:profileAgeRf"></span>
<img src="figure/profile_age_rf.png" alt="(fig:profileAgeRf) Ceteris-paribus profiles for variable `age` for the logistic regression (`titanic_lmr_v6`) and random forest (`titanic_rf_v6` ) models that predict the probability of surviving based on the Titanic data" width="70%" />
<p class="caption">
Figure 4.2: (fig:profileAgeRf) Ceteris-paribus profiles for variable <code>age</code> for the logistic regression (<code>titanic_lmr_v6</code>) and random forest (<code>titanic_rf_v6</code> ) models that predict the probability of surviving based on the Titanic data
</p>
</div>
<p>For a categorical explanatory variable, a natural way to represent the CP function is to use a barplot similar to the ones presented in Figure <a href="ceterisParibus.html#fig:profileAgeRf2">4.3</a>. The barplots in Figure <a href="ceterisParibus.html#fig:profileAgeRf">4.2</a> present CP profiles for the <em>class</em> variable in the logistic regression and random forest models for the Titanic dataset (see Section <a href="DataSetsIntro.html#HFDataset">2.3</a>). For this instance (observation), the predicted probability for the logistic regression model would decrease substantially if the value of <em>class</em> changed to “2nd”. On the other hand, for the random forest model, the largest change would be marked if <em>class</em> changed to “restaurant staff”.</p>
<div class="figure" style="text-align: center"><span id="fig:profileAgeRf2"></span>
<img src="figure/profile_class_rf.png" alt="(fig:profileAgeRf2) Ceteris-paribus profiles for variable `class` for the logistic regression (`titanic_lmr_v6`) and random forest (`titanic_rf_v6` ) models that predict the probability of surviving based on the Titanic data" width="70%" />
<p class="caption">
Figure 4.3: (fig:profileAgeRf2) Ceteris-paribus profiles for variable <code>class</code> for the logistic regression (<code>titanic_lmr_v6</code>) and random forest (<code>titanic_rf_v6</code> ) models that predict the probability of surviving based on the Titanic data
</p>
</div>
<p>Usually, black-box models contain a large number of explanatory variables. However, CP profiles are legible even for tiny subplots, created with techniques like sparklines or small multiples <span class="citation">(Tufte <a href="#ref-Tufte1986">1986</a>)</span>. In this way we can display a large number of profiles at the same time keeping profiles for consecutive variables in separate panels, as shown in Figure <a href="ceterisParibus.html#fig:profileV4Rf">4.4</a> for the random forest model for the Titanic dataset. It helps if these panels are ordered so that the most important profiles are listed first. We discuss a method to assess the importance of CP profiles in the next chapter.</p>
<div class="figure" style="text-align: center"><span id="fig:profileV4Rf"></span>
<img src="figure/profile_v4_rf.png" alt="(fig:profileV4Rf) Ceteris-paribus profiles for all continuous explanatory variables for the random forest (`titanic_rf_v6`) model for the `titanic` dataset" width="70%" />
<p class="caption">
Figure 4.4: (fig:profileV4Rf) Ceteris-paribus profiles for all continuous explanatory variables for the random forest (<code>titanic_rf_v6</code>) model for the <code>titanic</code> dataset
</p>
</div>
</div>
<div id="CPProsCons" class="section level2">
<h2><span class="header-section-number">4.5</span> Pros and cons</h2>
<p>One-dimensional CP profiles, as presented in this chapter, offer a uniform, easy to comunicate and extendable approach to model exploration. Their graphical representation is easy to understand and explain. It is possible to show profiles for many variables or models in a single plot.</p>
<p>There are several issues related to the use of the CP profiles. If explanatory variables are correlated, then changing one variable implies a change in the other. In such case, the application of the <em>Ceteris paribus</em> principle may lead to unrealistic settings, as it is not possible to keep one variable fixed while varying the other one. A special case are interactions, which require the use of two-dimensional CP profiles that are more complex than one-dimensional ones. Also, in case of a model with hundreds or thousands of variables, the number of plots to inspect may be daunting. Finally, while barplots allow visualization of CP profiles for factors (categorical explanatory variables), their use becomes less trivial in case of factors with many nominal (unordered) categories (like, for example, a ZIP-code).</p>
</div>
<div id="CPR" class="section level2">
<h2><span class="header-section-number">4.6</span> Code snippets for R</h2>
<p>In this section we present key features of the R package <code>ingredients</code> <span class="citation">(Biecek <a href="#ref-ingredientsRPackage">2019</a>)</span> which is a part of <code>DALEXverse</code> and covers all methods presented in this chapter. More details and examples can be found at <code>https://modeloriented.github.io/ingredients/</code>.</p>
<p>Note that there are also other R packages that offer similar functionality, like <code>condvis</code> <span class="citation">(O’Connell, Hurley, and Domijan <a href="#ref-JSSv081i05">2017</a>)</span>, <code>pdp</code> <span class="citation">(Greenwell <a href="#ref-pdpRPackage">2017</a><a href="#ref-pdpRPackage">a</a>)</span>, <code>ICEbox</code> <span class="citation">(Goldstein et al. <a href="#ref-ICEboxRPackage">2015</a><a href="#ref-ICEboxRPackage">b</a>)</span>, <code>ALEPlot</code> <span class="citation">(Apley <a href="#ref-ALEPlotRPackage">2018</a><a href="#ref-ALEPlotRPackage">a</a>)</span>, <code>iml</code> <span class="citation">(Molnar, Bischl, and Casalicchio <a href="#ref-imlRPackage">2018</a><a href="#ref-imlRPackage">a</a>)</span>.</p>
<p>In this section, we use the random forest <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span> model <code>titanic_rf_v6</code> developed for the Titanic dataset (see Section <a href="DataSetsIntro.html#TitanicDataset">2.1</a>). In particular, we deal with a binary classification problem - we want to predict the probability of survival for a selected passenger.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb66-3" data-line-number="3"></a>
<a class="sourceLine" id="cb66-4" data-line-number="4">titanic &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/27e5c&quot;</span>)</a>
<a class="sourceLine" id="cb66-5" data-line-number="5">titanic_rf_v6 &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/31570&quot;</span>)</a></code></pre></div>
<p>CP profiles are calculated in four steps with the <code>ingredients</code> package.</p>
<p><strong>1. Create an explainer - wrapper around model and validation data.</strong></p>
<p>Model-objects created with different libraries may have different internal structures. Thus, first, we have got to create a wrapper around the model. Toward this end, we use the <code>explain()</code> function from the <code>DALEX</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a>)</span>. The function requires five arguments:</p>
<ul>
<li><code>model</code>, a model-object</li>
<li><code>data</code>, a validation data frame</li>
<li><code>y</code>, observed values of the dependent variable for the validation data</li>
<li><code>predict_function</code>, a function that returns prediction scores; if not specified, then a default <code>predict()</code> function is used</li>
<li><code>label</code>, a function that returns prediction scores; if not specified, then it is extracted from the <code>class(model)</code>.
In the example below we use the training data as the validation dataset.</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">explain_titanic_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(<span class="dt">model =</span> titanic_rf_v6, </a>
<a class="sourceLine" id="cb67-2" data-line-number="2">                              <span class="dt">data =</span> titanic[,<span class="op">-</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">                              <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> &quot;yes&quot;</span>, </a>
<a class="sourceLine" id="cb67-4" data-line-number="4">                              <span class="dt">label =</span> <span class="st">&quot;Random Forest v6&quot;</span>)</a></code></pre></div>
<p><strong>2. Define the instance (observation) of interest.</strong></p>
<p>CP profiles explore model around a single observation. In the exampe below, we use data frame <code>henry</code> created in Section @ref(predictions_titanic). It contains data for an 8-year-old boy who embarked in Belfast and travelled in the 2nd class with no parents nor siblings with a ticket costing 72 pounds. Then, we obtain the model prediction for this instance with the help of the `predict()’ function. In particular, we compute the probability for each category of the dependent binary variable.</p>
<p>[TOMASZ: IN THE DATA CHAPTER WE HAD DATA FRAME HENRY. SHOULD NOT WE RE-USE IT HERE?]</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">henry &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">            <span class="dt">class =</span> <span class="kw">factor</span>(<span class="st">&quot;2nd&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1st&quot;</span>, <span class="st">&quot;2nd&quot;</span>, <span class="st">&quot;3rd&quot;</span>, <span class="st">&quot;deck crew&quot;</span>, <span class="st">&quot;engineering crew&quot;</span>, <span class="st">&quot;restaurant staff&quot;</span>, <span class="st">&quot;victualling crew&quot;</span>)),</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">            <span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)),</a>
<a class="sourceLine" id="cb68-4" data-line-number="4">            <span class="dt">age =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb68-5" data-line-number="5">            <span class="dt">sibsp =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb68-6" data-line-number="6">            <span class="dt">parch =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb68-7" data-line-number="7">            <span class="dt">fare =</span> <span class="dv">72</span>,</a>
<a class="sourceLine" id="cb68-8" data-line-number="8">            <span class="dt">embarked =</span> <span class="kw">factor</span>(<span class="st">&quot;Belfast&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Belfast&quot;</span>,<span class="st">&quot;Cherbourg&quot;</span>,<span class="st">&quot;Queenstown&quot;</span>,<span class="st">&quot;Southampton&quot;</span>))</a>
<a class="sourceLine" id="cb68-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb68-10" data-line-number="10"></a>
<a class="sourceLine" id="cb68-11" data-line-number="11"><span class="kw">predict</span>(explain_titanic_rf, henry)</a></code></pre></div>
<pre><code>## [1] 0.34</code></pre>
<p><strong>3. Calculate CP profiles</strong></p>
<p>To obtain CP profiles, we use the <code>ceteris_paribus()</code> function. It requires the explainer-object and the instance data frame as arguments. By default, CP profiles are calculated for all numerical variables. To select a subset of variables, the <code>variables</code> argument can be used.</p>
<p>As a result, the function yields an object od the class <code>ceteris_paribus_explainer</code>. It is a data frame with model predictions.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">cp_titanic_rf &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explain_titanic_rf, henry, </a>
<a class="sourceLine" id="cb70-3" data-line-number="3">                            <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;fare&quot;</span>, <span class="st">&quot;class&quot;</span>, <span class="st">&quot;gender&quot;</span>))</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">cp_titanic_rf</a></code></pre></div>
<pre><code>## Top profiles    : 
##     class gender        age sibsp parch fare embarked _yhat_ _vname_ _ids_
## 1     2nd   male  0.1666667     0     0   72  Belfast  0.396     age     1
## 1.1   2nd   male  2.0000000     0     0   72  Belfast  0.420     age     1
## 1.2   2nd   male  4.0000000     0     0   72  Belfast  0.404     age     1
## 1.3   2nd   male  7.0000000     0     0   72  Belfast  0.350     age     1
## 1.4   2nd   male  9.0000000     0     0   72  Belfast  0.324     age     1
## 1.5   2nd   male 13.0000000     0     0   72  Belfast  0.182     age     1
##              _label_
## 1   Random Forest v6
## 1.1 Random Forest v6
## 1.2 Random Forest v6
## 1.3 Random Forest v6
## 1.4 Random Forest v6
## 1.5 Random Forest v6
## 
## 
## Top observations:
##   class gender age sibsp parch fare embarked _yhat_          _label_ _ids_
## 1   2nd   male   8     0     0   72  Belfast   0.34 Random Forest v6     1</code></pre>
<p><strong>4. Plot CP profiles.</strong></p>
<p>To obtain a graphical represenation of CP profiles, the generic <code>plot()</code> function can be applied to the data frame returend by the <code>ceteris_paribus()</code> function. It returns a <code>ggplot2</code> object that can be processed if needed.</p>
<p>The resulting plot can be enriched with additional data by applying functions <code>show_rugs</code> (adds rugs for the selected points), <code>show_observations</code> (adds observations), or <code>show_aggreagated_profiles</code> (see Chapter <a href="variableEngeneering.html#variableEngeneering">17</a>). All these functions can take additional arguments to modify size, color, or linetype.</p>
<div class="figure" style="text-align: center"><span id="fig:titanicCeterisProfile01"></span>
<img src="PM_VEE_files/figure-html/titanicCeterisProfile01-1.png" alt="Ceteris-paribus profiles for the `titanic_rf_v6` model." width="70%" />
<p class="caption">
Figure 4.5: Ceteris-paribus profiles for the <code>titanic_rf_v6</code> model.
</p>
</div>
<p>[TOMASZ: “HENRY” IS USED AS AN EXAMPLE IN THE “SNIPPETS” SECTION. HOWEVER, IN THE DATASET CHAPTER WE POSTED SOME QUESTIONS REGARDING PREDICTIONS FOR “HENRY”. THUS, WE SHOULD COMMENT ON THE USE OF THE TOOLS IN THAT CASE. TO ME, IT WOULD THEN BE LOGICAL TO DSICUSS “HENRY” IN THE “EXAMPLE” SECTION, RATHER THEN IN THE “SNIPPETS”.]</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ICEbox">
<p>Goldstein, Alex, Adam Kapelner, Justin Bleich, and Emil Pitkin. 2015a. “Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation.” <em>Journal of Computational and Graphical Statistics</em> 24 (1): 44–65. <a href="https://doi.org/10.1080/10618600.2014.907095">https://doi.org/10.1080/10618600.2014.907095</a>.</p>
</div>
<div id="ref-Tufte1986">
<p>Tufte, Edward R. 1986. <em>The Visual Display of Quantitative Information</em>. Cheshire, CT, USA: Graphics Press.</p>
</div>
<div id="ref-ingredientsRPackage">
<p>Biecek, Przemyslaw. 2019. <em>Ingredients: Effects and Importances of Model Ingredients</em>. <a href="https://ModelOriented.github.io/ingredients/">https://ModelOriented.github.io/ingredients/</a>.</p>
</div>
<div id="ref-JSSv081i05">
<p>O’Connell, Mark, Catherine Hurley, and Katarina Domijan. 2017. “Conditional Visualization for Statistical Models: An Introduction to the Condvis Package in R.” <em>Journal of Statistical Software, Articles</em> 81 (5): 1–20. <a href="https://doi.org/10.18637/jss.v081.i05">https://doi.org/10.18637/jss.v081.i05</a>.</p>
</div>
<div id="ref-pdpRPackage">
<p>Greenwell, Brandon M. 2017a. “Pdp: An R Package for Constructing Partial Dependence Plots.” <em>The R Journal</em> 9 (1): 421–36. <a href="https://journal.r-project.org/archive/2017/RJ-2017-016/index.html">https://journal.r-project.org/archive/2017/RJ-2017-016/index.html</a>.</p>
</div>
<div id="ref-ICEboxRPackage">
<p>Goldstein, Alex, Adam Kapelner, Justin Bleich, and Emil Pitkin. 2015b. “Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation.” <em>Journal of Computational and Graphical Statistics</em> 24 (1): 44–65. <a href="https://doi.org/10.1080/10618600.2014.907095">https://doi.org/10.1080/10618600.2014.907095</a>.</p>
</div>
<div id="ref-ALEPlotRPackage">
<p>Apley, Dan. 2018a. <em>ALEPlot: Accumulated Local Effects (Ale) Plots and Partial Dependence (Pd) Plots</em>. <a href="https://CRAN.R-project.org/package=ALEPlot">https://CRAN.R-project.org/package=ALEPlot</a>.</p>
</div>
<div id="ref-imlRPackage">
<p>Molnar, Christoph, Bernd Bischl, and Giuseppe Casalicchio. 2018a. “Iml: An R Package for Interpretable Machine Learning.” <em>JOSS</em> 3 (26). Journal of Open Source Software: 786. <a href="https://doi.org/10.21105/joss.00786">https://doi.org/10.21105/joss.00786</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
<div id="ref-R-DALEX">
<p>Biecek, Przemyslaw. 2018. <em>DALEX: Descriptive mAchine Learning Explanations</em>. <a href="https://pbiecek.github.io/DALEX/">https://pbiecek.github.io/DALEX/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PredictionExplainers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ceterisParibusOscillations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
