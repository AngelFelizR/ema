<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visualisation, Exploration and Explanation</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2018-10-01">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="PredictionExplainers.html">
<link rel="next" href="breakDown.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#white-box-models-vs-black-box-models"><i class="fa fa-check"></i><b>1.1</b> White-box models vs Black-box models</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#model-agnostic-vs-model-specific"><i class="fa fa-check"></i><b>1.2</b> Model agnostic vs Model specific</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-do-we-need-model-explainers"><i class="fa fa-check"></i><b>1.3</b> Why do we need model explainers?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-model-exploration-is-different-from-data-exploration"><i class="fa fa-check"></i><b>1.4</b> How model exploration is different from data exploration?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.5</b> Code snippets</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#glossary-notation"><i class="fa fa-check"></i><b>1.6</b> Glossary / Notation</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="prediction-level-explanations.html"><a href="prediction-level-explanations.html"><i class="fa fa-check"></i>Prediction level explanations</a></li>
<li class="chapter" data-level="2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#approaches-to-prediction-explanations"><i class="fa fa-check"></i><b>2.1</b> Approaches to prediction explanations</a></li>
<li class="chapter" data-level="2.2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#three-single-laws"><i class="fa fa-check"></i><b>2.2</b> A bit of philosophy: Three Laws for Prediction Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>3</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="3.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition"><i class="fa fa-check"></i><b>3.1</b> Intuition</a></li>
<li class="chapter" data-level="3.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>3.2</b> Method</a></li>
<li class="chapter" data-level="3.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>3.3</b> Example: Wine quality</a></li>
<li class="chapter" data-level="3.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons"><i class="fa fa-check"></i><b>3.4</b> Pros and Cons</a></li>
<li class="chapter" data-level="3.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>3.5</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>4</b> Sequential variable attributions</a><ul>
<li class="chapter" data-level="4.1" data-path="breakDown.html"><a href="breakDown.html#intuition-1"><i class="fa fa-check"></i><b>4.1</b> Intuition</a></li>
<li class="chapter" data-level="4.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>4.2</b> Method</a></li>
<li class="chapter" data-level="4.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>4.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="4.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-1"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html"><i class="fa fa-check"></i><b>5</b> Sequential variable attribution with interactions</a><ul>
<li class="chapter" data-level="5.1" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html#intuition-2"><i class="fa fa-check"></i><b>5.1</b> Intuition</a></li>
<li class="chapter" data-level="5.2" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html#method-2"><i class="fa fa-check"></i><b>5.2</b> Method</a></li>
<li class="chapter" data-level="5.3" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>5.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="5.4" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html#break-down-plots"><i class="fa fa-check"></i><b>5.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="5.5" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html#pros-and-cons-2"><i class="fa fa-check"></i><b>5.5</b> Pros and cons</a></li>
<li class="chapter" data-level="5.6" data-path="sequential-variable-attribution-with-interactions.html"><a href="sequential-variable-attribution-with-interactions.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>5.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>6</b> Average variable attributions</a><ul>
<li class="chapter" data-level="6.1" data-path="shapley.html"><a href="shapley.html#intuition-3"><i class="fa fa-check"></i><b>6.1</b> Intuition</a></li>
<li class="chapter" data-level="6.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>6.2</b> Method</a></li>
<li class="chapter" data-level="6.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>6.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="6.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-3"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>7</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="7.1" data-path="LIME.html"><a href="LIME.html#intuition-4"><i class="fa fa-check"></i><b>7.1</b> Intuition</a></li>
<li class="chapter" data-level="7.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>7.2</b> Method</a></li>
<li class="chapter" data-level="7.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>7.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="7.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-4"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>7.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="7.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>7.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="7.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>7.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>8</b> What-If analysis with the Ceteris Paribus Principle</a><ul>
<li class="chapter" data-level="8.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition-5"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#method-5"><i class="fa fa-check"></i><b>8.3</b> Method</a><ul>
<li class="chapter" data-level="8.3.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>8.3.1</b> 1D profiles</a></li>
<li class="chapter" data-level="8.3.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>8.3.2</b> Profile oscillations</a></li>
<li class="chapter" data-level="8.3.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>8.3.3</b> 2D profiles</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>8.4</b> Local model fidelity</a></li>
<li class="chapter" data-level="8.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#example"><i class="fa fa-check"></i><b>8.5</b> Example</a></li>
<li class="chapter" data-level="8.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons-5"><i class="fa fa-check"></i><b>8.6</b> Pros and cons</a></li>
<li class="chapter" data-level="8.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>8.7</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>9</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="9.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>9.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="10" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>10</b> Introduction</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction-2.html"><a href="introduction-2.html#a-bit-of-philosophy"><i class="fa fa-check"></i><b>10.1</b> A bit of philosophy</a></li>
<li class="chapter" data-level="10.2" data-path="introduction-2.html"><a href="introduction-2.html#example-price-prediction"><i class="fa fa-check"></i><b>10.2</b> Example: Price prediction</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="variable-importance.html"><a href="variable-importance.html"><i class="fa fa-check"></i><b>11</b> Variable Importance</a></li>
<li class="chapter" data-level="12" data-path="marginal-response.html"><a href="marginal-response.html"><i class="fa fa-check"></i><b>12</b> Marginal Response</a><ul>
<li class="chapter" data-level="12.1" data-path="marginal-response.html"><a href="marginal-response.html#partialDependence"><i class="fa fa-check"></i><b>12.1</b> Partial Dependency Plots</a></li>
<li class="chapter" data-level="12.2" data-path="marginal-response.html"><a href="marginal-response.html#merging-path-plots"><i class="fa fa-check"></i><b>12.2</b> Merging Path Plots</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>13</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="14" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>14</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="15" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>15</b> Other topics</a></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="16" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>16</b> Data Sets</a><ul>
<li class="chapter" data-level="16.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>16.1</b> Hire or Fire? HR in Call Center</a></li>
<li class="chapter" data-level="16.2" data-path="DataSets.html"><a href="DataSets.html#apartmentsDataset"><i class="fa fa-check"></i><b>16.2</b> How much does it cost? Price prediction for a square meter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisation, Exploration and Explanation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="variableAttributionMethods" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Variable attribution for linear models</h1>
<p>In this section we introduce the concept and the intuition behind additive decompositions of model predictions. The main goal for these tools is to help to understand how model output may be decomposed into parts, that can be attributed to input features.</p>
<p>Presented explainers are linked with the first law introduced in Section <a href="PredictionExplainers.html#three-single-laws">2.2</a>, i.e. law for prediction’s justifications. Note that there is a collection of tools for variable attribution. In this section we are focused on the general idea and examples for linear models. Model agnostic approaches will be presented in sections <a href="breakDown.html#breakDown">4</a> and <a href="shapley.html#shapley">6</a>.</p>
<p>Think of following use cases:</p>
<ul>
<li>Think about a model for heart attack. A patient wants to know which factors have highest impact on the final heart risk score.</li>
<li>Think about a model for apartment prices. An investor wants to know how much of the final price may be attributed to the location of an apartment.</li>
<li>Think about a model for credit scoring. A customer wants to know if factors like gender, age or number of kids influence model decisions.</li>
</ul>
<p>In every usecase one needs to attribute part of the model response to a single variable. This can be done directly for linear models, so in the section <a href="#VAlinMod"><strong>??</strong></a> we show how to do this for linar models and may be easily extended to additive models and generalized linear models. For other models it is not trivial how to do so, some approaches are be presented in next sections.</p>
<div id="intuition" class="section level2">
<h2><span class="header-section-number">3.1</span> Intuition</h2>
<p>Fiited linear model with coefficients <span class="math inline">\(\beta = (\beta_0, \beta_1, .., \beta_p)\)</span> has following form.</p>
<p><span class="math display">\[
f(x) = \beta_0 + x_1 \beta_1 + \ldots + x_p \beta_p.
\]</span>
In other words, model response is the sum of weighted elements of <span class="math inline">\(x = (x_1, x_2, \ldots, x_p)\)</span>.</p>
<p>From a global perspective of a model, we are usually interested in questions like, how good is the model (questions about <span class="math inline">\(R^2\)</span>), which variables are significant (tests for significance of <span class="math inline">\(\beta_i \neq 0\)</span>) or how accurate are model predictions (confidence intervals for predictions).</p>
<p>But in this chapter we are focued on a local perspective, i.e. for a single observation <span class="math inline">\(x^*\)</span> how to measure the contribution of a variable <span class="math inline">\(x_i\)</span> on model prediction <span class="math inline">\(f(x^*)\)</span>.</p>
<p>The contribution of a variable <span class="math inline">\(x_i\)</span> shall be related to <span class="math inline">\(x^*_i\beta_i\)</span> as variable <span class="math inline">\(x_i\)</span> occur only in this term. As we will see below, it is easier to interpret variable contribution if the <span class="math inline">\(x_i\)</span> is centered.</p>
<p>This lead for a intuitive formula for variable attribution for model <span class="math inline">\(f\)</span>, variable <span class="math inline">\(x_i\)</span> in the point <span class="math inline">\(x^*\)</span>
<span class="math display">\[
v(f, x^*, i) = \beta_i (x_i^* - \hat x_i).
\]</span></p>
</div>
<div id="method" class="section level2">
<h2><span class="header-section-number">3.2</span> Method</h2>
<p>We want to calculate <span class="math inline">\(v(f, x^*, i)\)</span>, which is the contribution of variable <span class="math inline">\(x_i\)</span> on prediction of model <span class="math inline">\(f()\)</span> in point <span class="math inline">\(x^*\)</span>.</p>
<p>Geneal approach for calculation of variable attributions would be to measure how much the expected model response would change after conditioning on <span class="math inline">\(x_i = x_i^*\)</span>.</p>
<p><span class="math display">\[
v(f, x^*, i) = E[f(x) | x_i = x_i^*] - E[f(x)]
\]</span></p>
<p>For linear models, if coordinates of <span class="math inline">\(x\)</span> are independent, this is equivalent of</p>
<p><span class="math display">\[
v(f, x^*, i) = f(x^*) - E[f(x)|x_{-i} = x^*_{-i}] = \beta_i x^*_i  - E \beta_i X_i.
\]</span>
Expected value can be estimated as averages, and this leads to<br />
<span class="math display">\[
v(f, x^*, i) = \beta_i x^*_i - \beta_i \bar x_i = \beta_i (x^*_i - \bar x_i)
\]</span></p>
<p>The logic behind the attribution is the following.
Contribution of variable <span class="math inline">\(x_i\)</span> is the difference between model response for value <span class="math inline">\(x_i^*\)</span> minus the average model response.</p>
<p>Note that the linear model ma be rewritten in a following way</p>
<p><span class="math display">\[
f(x) = baseline + (x_1 - \bar x_1) \beta_1 + ... + (x_p - \bar x_p) \beta_p
\]</span></p>
<p>where
<span class="math display">\[
baseline = \mu + \bar x_1 \beta_1 + ... + \bar x_p \beta_p.
\]</span></p>
<p>Here <span class="math inline">\(baseline\)</span> is an average model response and variable contributions show how prediction for particular <span class="math inline">\(x^*\)</span> is different from the average response.</p>
<p>** NOTE for careful readers **</p>
<p>There is a gap between expected value of <span class="math inline">\(X_i\)</span> and average calculated on some dataset <span class="math inline">\(\bar x_i\)</span>. The latter depends on the data used for calculation of averages. For the sake of simplicity we do not emphasize these differences. To live with this just assume that we have access to a very large validation data that allows us to calculate <span class="math inline">\(\bar x_i\)</span> very accurately.</p>
<p>Also we assumed that coordinated of <span class="math inline">\(x\)</span> are independent, which may not be the case. We will return to this problem later, during the discussion related to interactions.</p>
</div>
<div id="example-wine-quality" class="section level2">
<h2><span class="header-section-number">3.3</span> Example: Wine quality</h2>
<p>It may be a surprise, that the attribution for variable <span class="math inline">\(x_i\)</span> is not the <span class="math inline">\(\beta_i x_i\)</span>. To understand this, consider following example.</p>
<div class="figure" style="text-align: center"><span id="fig:attribution1"></span>
<img src="figure/attribution_1.png" alt="(fig:attribution1)Relation between wine quality and concentration of alcohol assessed with linear model" width="50%" />
<p class="caption">
Figure 3.1: (fig:attribution1)Relation between wine quality and concentration of alcohol assessed with linear model
</p>
</div>
<p>Figure <a href="variableAttributionMethods.html#fig:attribution1">3.1</a> shows the relation between alcohol and wine quality, based on the wine dataset <span class="citation">(Cortez et al. <a href="#ref-wine2009">2009</a>)</span>. The corresponding linear model is</p>
<p><span class="math display">\[
quality(alcohol) = 2.5820 + 0.3135 * alcohol
\]</span></p>
<p>The weakest wine in this dataset has 8% of alcohol, average alcohol concentration is 10.51, so the contribution of alcohol to the model prediction is <span class="math inline">\(0.3135 *(8-10.51) = -0.786885\)</span>. It means that low value of alcohol for this wine (8%) lower the prediction of quality by <span class="math inline">\(-0.786885\)</span>.</p>
<p>Note, that it would be confusing to use <span class="math inline">\(x_i\beta_i\)</span> as alcohol contribution on quality would be <span class="math inline">\(0.3135*8 = 2.508\)</span>. This would not reflect the intuition that for positive relation, the smaller is the alcohol concentration the lower should be the quality of wine.</p>
</div>
<div id="pros-and-cons" class="section level2">
<h2><span class="header-section-number">3.4</span> Pros and Cons</h2>
<p>Here we summarise pros and cons of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>Presented variable attribution for linear model is not an approximation, it is directly linked with the structure of a model.</li>
<li>It is easier to understand attributions that are not linked with scale nor location of <span class="math inline">\(x_i\)</span> as the standard <span class="math inline">\(\beta_i\)</span> are.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>It works only for linear models.</li>
<li>This do not reduce model complexity. Just present model coefficients in a different way.</li>
</ul>
</div>
<div id="code-snippets-1" class="section level2">
<h2><span class="header-section-number">3.5</span> Code snippets</h2>
<p>Variable attributions for linear models may be directly extracted from the <code>predict()</code> function for linear models.</p>
<p>In this section we will present an example for logistic regression based on the <code>HR</code> dataset. See the Section <a href="DataSets.html#HRdataset">16.1</a> for more details.</p>
<p>First we build a logistic regression model for binary variable <code>status == &quot;fired&quot;</code>. Here are fitted model coefficients.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">model_fired &lt;-<span class="st"> </span><span class="kw">glm</span>(status <span class="op">==</span><span class="st"> &quot;fired&quot;</span> <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> HR, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">coef</span>(model_fired)</a></code></pre></div>
<pre><code>##  (Intercept)   gendermale          age        hours   evaluation 
##  5.737945729 -0.066803609 -0.001503314 -0.102021120 -0.425793369 
##       salary 
## -0.015740080</code></pre>
<p>We want to calculate variable attributions for a particular point. Here we define this point.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">new_observation &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)),</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                      <span class="dt">age =</span> <span class="fl">57.7</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                      <span class="dt">hours =</span> <span class="fl">42.3</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                      <span class="dt">evaluation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                      <span class="dt">salary =</span> <span class="dv">2</span>)</a></code></pre></div>
<p>For linear and generalized linear models we may specify argument <code>type = &quot;terms&quot;</code> that extracts variable contributions.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">predict</span>(model_fired, new_observation, <span class="dt">type =</span> <span class="st">&quot;terms&quot;</span>)</a></code></pre></div>
<pre><code>##        gender         age     hours evaluation      salary
## 1 -0.03361889 -0.02660691 0.7555555  0.5547197 0.007287334
## attr(,&quot;constant&quot;)
## [1] -0.8714962</code></pre>
<p>Below we show how to do this with the <code>DALEX</code> package. Additionaly we may easily plot contributions.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">explainer_fired &lt;-<span class="st"> </span><span class="kw">explain</span>(model_fired,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                 <span class="dt">data =</span> HR,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                 <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;fired&quot;</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                 <span class="dt">label =</span> <span class="st">&quot;fired&quot;</span>)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">attribution &lt;-<span class="st"> </span><span class="kw">single_prediction</span>(explainer_fired, new_observation)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">attribution</a></code></pre></div>
<pre><code>##                   variable contribution variable_name variable_value
## 1              (Intercept) -0.871496150     Intercept              1
## hours         hours = 42.3  0.755555494         hours           42.3
## evaluation  evaluation = 2  0.554719716    evaluation              2
## gender       gender = male -0.033618893        gender           male
## age             age = 57.7 -0.026606908           age           57.7
## salary          salary = 2  0.007287334        salary              2
## 11         final_prognosis  0.385840593                             
##            cummulative sign position label
## 1           -0.8714962   -1        1 fired
## hours       -0.1159407    1        2 fired
## evaluation   0.4387791    1        3 fired
## gender       0.4051602   -1        4 fired
## age          0.3785533   -1        5 fired
## salary       0.3858406    1        6 fired
## 11           0.3858406    X        7 fired</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">plot</span>(attribution)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-wine2009">
<p>Cortez, Paulo, António Cerdeira, Fernando Almeida, Telmo Matos, and José Reis. 2009. “Modeling Wine Preferences by Data Mining from Physicochemical Properties.” <em>Decision Support Systems</em> 47 (4):547–53. <a href="https://doi.org/10.1016/j.dss.2009.05.016" class="uri">https://doi.org/10.1016/j.dss.2009.05.016</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PredictionExplainers.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="breakDown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
