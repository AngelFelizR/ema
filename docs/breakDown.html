<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-05-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="variableAttributionMethods.html">
<link rel="next" href="iBreakDown.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html"><i class="fa fa-check"></i><b>2</b> DIY with R</a><ul>
<li class="chapter" data-level="2.1" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-install-dependencies"><i class="fa fa-check"></i><b>2.1</b> How to install dependencies</a></li>
<li class="chapter" data-level="2.2" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-work-with-dalex"><i class="fa fa-check"></i><b>2.2</b> How to work with <code>DALEX</code></a></li>
<li class="chapter" data-level="2.3" data-path="RCodeSnippets.html"><a href="RCodeSnippets.html#how-to-work-with-archivist"><i class="fa fa-check"></i><b>2.3</b> How to work with <code>archivist</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="PythonCodeSnippets.html"><a href="PythonCodeSnippets.html"><i class="fa fa-check"></i><b>3</b> DIY with Python</a></li>
<li class="chapter" data-level="4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>4</b> Data Sets</a><ul>
<li class="chapter" data-level="4.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>4.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="4.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_titanic"><i class="fa fa-check"></i><b>4.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>4.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="4.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>4.1.3</b> Random forest</a></li>
<li class="chapter" data-level="4.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_gbm"><i class="fa fa-check"></i><b>4.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="4.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_titanic"><i class="fa fa-check"></i><b>4.1.5</b> Model predictions</a></li>
<li class="chapter" data-level="4.1.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ExplainersTitanicRCode"><i class="fa fa-check"></i><b>4.1.6</b> Explainers</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsTitanic"><i class="fa fa-check"></i><b>4.2</b> List of objects for the <code>titanic</code> example</a></li>
<li class="chapter" data-level="4.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>4.3</b> Apartment prices</a><ul>
<li class="chapter" data-level="4.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_apartments"><i class="fa fa-check"></i><b>4.3.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_lr"><i class="fa fa-check"></i><b>4.3.2</b> Linear regression</a></li>
<li class="chapter" data-level="4.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_rf"><i class="fa fa-check"></i><b>4.3.3</b> Random forest</a></li>
<li class="chapter" data-level="4.3.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_apartments"><i class="fa fa-check"></i><b>4.3.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsApartments"><i class="fa fa-check"></i><b>4.4</b> List of objects for the <code>apartments</code> example</a></li>
<li class="chapter" data-level="4.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>4.5</b> Hire or fire</a><ul>
<li class="chapter" data-level="4.5.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_HR"><i class="fa fa-check"></i><b>4.5.1</b> Data exploration</a></li>
<li class="chapter" data-level="4.5.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_mr"><i class="fa fa-check"></i><b>4.5.2</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="4.5.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_rf"><i class="fa fa-check"></i><b>4.5.3</b> Random forest</a></li>
<li class="chapter" data-level="4.5.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_HR"><i class="fa fa-check"></i><b>4.5.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModelsHR"><i class="fa fa-check"></i><b>4.6</b> List of objects for the <code>HR</code> example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="5" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>5</b> Introduction</a></li>
<li class="chapter" data-level="6" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>6</b> Ceteris-paribus Profiles - a Tool for What-If Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>6.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>6.5</b> Pros and cons</a></li>
<li class="chapter" data-level="6.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>6.6</b> Code snippets for R</a><ul>
<li class="chapter" data-level="6.6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#basic-usage-for-the-ceteris_paribus-function"><i class="fa fa-check"></i><b>6.6.1</b> Basic usage for the <code>ceteris_paribus</code> function</a></li>
<li class="chapter" data-level="6.6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#advanced-usage-for-the-ceteris_paribus-function"><i class="fa fa-check"></i><b>6.6.2</b> Advanced usage for the <code>ceteris_paribus</code> function</a></li>
<li class="chapter" data-level="6.6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#champion-challenger-analysis"><i class="fa fa-check"></i><b>6.6.3</b> Champion-challenger analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>7</b> Ceteris-paribus Oscillations - a Tool for Local Variable-importance</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>7.3</b> Method</a></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>7.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>7.5</b> Pros and cons</a></li>
<li class="chapter" data-level="7.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>7.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>8</b> Ceteris-paribus Two-dimensional Profiles - a Tool for Pairwise Interactions</a><ul>
<li class="chapter" data-level="8.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dIntro"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dIntuition"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dMethod"><i class="fa fa-check"></i><b>8.3</b> Method</a></li>
<li class="chapter" data-level="8.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dExample"><i class="fa fa-check"></i><b>8.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="8.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2dProsCons"><i class="fa fa-check"></i><b>8.5</b> Pros and cons</a></li>
<li class="chapter" data-level="8.6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#ceterisParibus2R"><i class="fa fa-check"></i><b>8.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>9</b> Local Diagnostics With Ceteris-paribus Profiles</a><ul>
<li class="chapter" data-level="9.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagIntro"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagIntuition"><i class="fa fa-check"></i><b>9.2</b> Intuition</a></li>
<li class="chapter" data-level="9.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagMethod"><i class="fa fa-check"></i><b>9.3</b> Method</a><ul>
<li class="chapter" data-level="9.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagNeighbors"><i class="fa fa-check"></i><b>9.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="9.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagProfiles"><i class="fa fa-check"></i><b>9.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="9.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagLFplot"><i class="fa fa-check"></i><b>9.3.3</b> Local fidelity plot</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagExample"><i class="fa fa-check"></i><b>9.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagProsCons"><i class="fa fa-check"></i><b>9.5</b> Pros and cons</a></li>
<li class="chapter" data-level="9.6" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#cPLocDiagR"><i class="fa fa-check"></i><b>9.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>10</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="10.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-1"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition"><i class="fa fa-check"></i><b>10.2</b> Intuition</a></li>
<li class="chapter" data-level="10.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>10.3</b> Method</a></li>
<li class="chapter" data-level="10.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>10.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="10.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons"><i class="fa fa-check"></i><b>10.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="10.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>10.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>11</b> BreakDown for Additive Variable Attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="breakDown.html"><a href="breakDown.html#intuition-1"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="breakDown.html"><a href="breakDown.html#example-titanic-data"><i class="fa fa-check"></i><b>11.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="11.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-1"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>12</b> iBreakDown for Variable Attributions with Interactions</a><ul>
<li class="chapter" data-level="12.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-2"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-2"><i class="fa fa-check"></i><b>12.2</b> Method</a><ul>
<li class="chapter" data-level="12.2.1" data-path="iBreakDown.html"><a href="iBreakDown.html#single-step-contributions"><i class="fa fa-check"></i><b>12.2.1</b> Single step contributions</a></li>
<li class="chapter" data-level="12.2.2" data-path="iBreakDown.html"><a href="iBreakDown.html#two-steps-contributions"><i class="fa fa-check"></i><b>12.2.2</b> Two steps contributions</a></li>
<li class="chapter" data-level="12.2.3" data-path="iBreakDown.html"><a href="iBreakDown.html#sequential-contributions"><i class="fa fa-check"></i><b>12.2.3</b> Sequential contributions</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-titanic"><i class="fa fa-check"></i><b>12.3</b> Example: Titanic</a></li>
<li class="chapter" data-level="12.4" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-2"><i class="fa fa-check"></i><b>12.4</b> Pros and cons</a></li>
<li class="chapter" data-level="12.5" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>12.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>13</b> SHapley Additive exPlanations (SHAP) and Average Variable Attributions</a><ul>
<li class="chapter" data-level="13.1" data-path="shapley.html"><a href="shapley.html#intuition-3"><i class="fa fa-check"></i><b>13.1</b> Intuition</a></li>
<li class="chapter" data-level="13.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>13.2</b> Method</a></li>
<li class="chapter" data-level="13.3" data-path="shapley.html"><a href="shapley.html#titanic"><i class="fa fa-check"></i><b>13.3</b> Titanic</a></li>
<li class="chapter" data-level="13.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-3"><i class="fa fa-check"></i><b>13.4</b> Pros and cons</a></li>
<li class="chapter" data-level="13.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>13.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>14</b> Local Interpretable Model-Agnostic Explanations (LIME)</a><ul>
<li class="chapter" data-level="14.1" data-path="LIME.html"><a href="LIME.html#intuition-4"><i class="fa fa-check"></i><b>14.1</b> Intuition</a></li>
<li class="chapter" data-level="14.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>14.2</b> Method</a></li>
<li class="chapter" data-level="14.3" data-path="LIME.html"><a href="LIME.html#pros-and-cons-4"><i class="fa fa-check"></i><b>14.3</b> Pros and cons</a></li>
<li class="chapter" data-level="14.4" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>14.4</b> Code snippets for R</a><ul>
<li class="chapter" data-level="14.4.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>14.4.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="14.4.2" data-path="LIME.html"><a href="LIME.html#the-localmodel-package"><i class="fa fa-check"></i><b>14.4.2</b> <strong>The localModel package</strong></a></li>
<li class="chapter" data-level="14.4.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>14.4.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="comparision-of-instance-level-explainers.html"><a href="comparision-of-instance-level-explainers.html"><i class="fa fa-check"></i><b>15</b> Comparision of instance level explainers</a><ul>
<li class="chapter" data-level="15.1" data-path="comparision-of-instance-level-explainers.html"><a href="comparision-of-instance-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>15.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="16" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>16</b> Introduction</a><ul>
<li class="chapter" data-level="16.1" data-path="introduction-2.html"><a href="introduction-2.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>16.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="16.2" data-path="introduction-2.html"><a href="introduction-2.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>16.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>17</b> Feature Importance</a><ul>
<li class="chapter" data-level="17.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>17.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="17.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic-1"><i class="fa fa-check"></i><b>17.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="17.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>17.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="17.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>17.4</b> More models</a></li>
<li class="chapter" data-level="17.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>17.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>18</b> Feature effects</a><ul>
<li class="chapter" data-level="18.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>18.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>19</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
<li class="chapter" data-level="19.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>19.2</b> Estimation</a></li>
<li class="chapter" data-level="19.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>19.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="19.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>19.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="19.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>19.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>20</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="20.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>20.1</b> Definition</a></li>
<li class="chapter" data-level="20.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>20.2</b> Estimation</a></li>
<li class="chapter" data-level="20.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>20.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>21</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="21.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>21.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>22</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="23" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>23</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="24" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>24</b> Other topics</a></li>
<li class="chapter" data-level="25" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>25</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="26" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>26</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="27" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>27</b> Concept Drift</a><ul>
<li class="chapter" data-level="27.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-3"><i class="fa fa-check"></i><b>27.1</b> Introduction</a></li>
<li class="chapter" data-level="27.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>27.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="27.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>27.3</b> Code snippets</a></li>
<li class="chapter" data-level="27.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>27.4</b> Residual Drift</a></li>
<li class="chapter" data-level="27.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>27.5</b> Code snippets</a></li>
<li class="chapter" data-level="27.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>27.6</b> Model Drift</a></li>
<li class="chapter" data-level="27.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>27.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="28" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>28</b> Data Sets</a><ul>
<li class="chapter" data-level="28.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>28.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>29</b> Packages</a><ul>
<li class="chapter" data-level="29.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>29.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="breakDown" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> BreakDown for Additive Variable Attributions</h1>
<p><strong>PBI: note that we are using completly different notations here and in the next chapter. Let’s keep only one, but which one?</strong></p>
<p>In the Section <a href="variableAttributionMethods.html#variableAttributionMethods">10</a> we introduced a method for calculation of variable attributions for linear models.
This method is accurate, based directly on the linear structure of the model. But for most popular machine learning models we cannot assume that they are linear nor even additive.</p>
<p>In the Section <a href="ceterisParibusOscillations.html#ceterisParibusOscillations">7</a> we introduced a method for calculation of local variable importance based on Ceteris Paribus Profiles. But the main disadvantage of this method is that importance scores do not sum up to final model predictions.</p>
<p>Break Down Plots solve problems with both these approaches. Note that the described method is also similar to the EXPLAIN algorithm introduced in <span class="citation">(Robnik-Šikonja and Kononenko <a href="#ref-explainPaper">2008</a>)</span> and implemented in <span class="citation">(Robnik-Sikonja <a href="#ref-explainPackage">2018</a>)</span> package.</p>
<div id="intuition-1" class="section level2">
<h2><span class="header-section-number">11.1</span> Intuition</h2>
<p>For any model we may repeat the intuition presented in the Section <a href="variableAttributionMethods.html#variableAttributionMethods">10</a> to calculate variable contribution as shifts in expected model response after conditioning over consecutive variables.
This intuition is presented in Figure <a href="breakDown.html#fig:BDPrice4">11.1</a>.</p>
<p>Panel A shows distribution of model responses. The row <code>all data</code> shows the model response of the validation dataset. The red dot stands for average model response and it is an estimate of expected model response <span class="math inline">\(E [f(x)]\)</span>.</p>
<p>Since we want to calculate effects of particular values of selected variables we then condition over these variables in a sequential manner.
The next row in panel A corresponds to average model prediction for observations with variable <code>class</code> fixed to value <code>1st</code>. The next for corresponds to average model prediction with variables <code>class</code> set to <code>1st</code> and <code>age</code> set to <code>0</code>, and so on. The last row corresponds to model response for <span class="math inline">\(x^*\)</span>.</p>
<p>Black lines in the panel A show how prediction for a single point changes after coordinate <span class="math inline">\(i\)</span> is replaced by the <span class="math inline">\(x^*_i\)</span>. But finally we are not interested in particular changes, not even in distributions but only in averages - expected model responses.</p>
<p>The most minimal form that shows important information is presented in the panel C.
Positive values are presented with green bars while negative differences are marked with red bar. They sum up to final model prediction, which is denoted by a violet bar in this example.</p>
<div class="figure" style="text-align: center"><span id="fig:BDPrice4"></span>
<img src="figure/break_down_distr.png" alt="(fig:BDPrice4) Break Down Plots show how variables move the model prediction from population average to the model prognosis for a single observation. A) The first row shows distribution of model predictions. Next rows show conditional distributions, every row a new variable is added to conditioning. The last row shows model prediction for a single point. Red dots stand for averages. B) Red dots stands for average conditional model response. C) Only variable contributions are presented, i.e. differences between consecutive conditional expectations. " width="80%" />
<p class="caption">
Figure 11.1: (fig:BDPrice4) Break Down Plots show how variables move the model prediction from population average to the model prognosis for a single observation. A) The first row shows distribution of model predictions. Next rows show conditional distributions, every row a new variable is added to conditioning. The last row shows model prediction for a single point. Red dots stand for averages. B) Red dots stands for average conditional model response. C) Only variable contributions are presented, i.e. differences between consecutive conditional expectations.
</p>
</div>
</div>
<div id="method-1" class="section level2">
<h2><span class="header-section-number">11.2</span> Method</h2>
<p>Again, as in previous chapter, let <span class="math inline">\(v(f, x^*, i)\)</span> stands for the contribution of variable <span class="math inline">\(x_i\)</span> to prediction of model <span class="math inline">\(f()\)</span> in point <span class="math inline">\(x^*\)</span>.</p>
<p>We expect that such contribution will sum up to the model prediction in a given point (property called <em>local accuracy</em>), so
<span class="math display">\[
f(x^*) = baseline + \sum_{i=1}^p v(f, x^*, i)
\]</span>
where <span class="math inline">\(baseline\)</span> stands for average model response.</p>
<p>Note that the equation above may be rewritten as</p>
<p><span class="math display">\[
E [f(X)|X_1 = x_1^*, \ldots, X+p = x_p^*] = E[f(X)] + \sum_{i=1}^p v(f, x^*, i)
\]</span>
what leads to quite natural proposition for <span class="math inline">\(v(f, x^*_i, i)\)</span>, such as</p>
<p><span class="math display">\[
v(f, x^*_i, i) = E [f(X) | X_1 = x_1^*, \ldots, X_i = x_i^*] - E [f(X) | X_1 = x_1^*, \ldots, X_{i-1} = x_{i-1}^*] 
\]</span>
In other words the contribution of variable <span class="math inline">\(i\)</span> is the difference between expected model response conditioned on first <span class="math inline">\(i\)</span> variables minus the model response conditioned on first <span class="math inline">\(i-1\)</span> variables.</p>
<p>Such proposition fulfills the <em>local accuracy</em> condition.</p>
<p>Unfortunately, for non-additive models, variable contributions depend on the ordering of variables. See for example Figure <a href="breakDown.html#fig:ordering">11.2</a>. In the first ordering the contribution of variable <code>age</code> is calculated as 0.01, while in the second the contribution is calculated as 0.13. Such differences are related to the lack of additivness of the model <span class="math inline">\(f()\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:ordering"></span>
<img src="figure/ordering.png" alt="(fig:ordering) Two different paths between average model prediction and the model prediction for a selected observation. Black dots stand for conditional average, red arrows stands for changes between conditional averages." width="100%" />
<p class="caption">
Figure 11.2: (fig:ordering) Two different paths between average model prediction and the model prediction for a selected observation. Black dots stand for conditional average, red arrows stands for changes between conditional averages.
</p>
</div>
<p>There are different attempts to solve the problem with the ordering.</p>
<p>A. choose an ordering in which variables with largest contributions are first. In this chapter we will describe a heuristic behind this approach.
B. identify interactions that causes difference in attributions for different orderings and show these interactions. In the chapter <a href="iBreakDown.html#iBreakDown">12</a> we will describe a heuristic behind this idea.
C. calculate average across all possible orderings. There is <span class="math inline">\(p!\)</span> possible orderings, be the may quite accurately approximate the average. This approach will be presented in the chapter <a href="shapley.html#shapley">13</a>.</p>
<p>So, let’s start with approach A.
The easiest way to solve this problem is to use two-step procedure. In the first step variables are ordered and in the second step the consecutive conditioning is applied to ordered variables.</p>
<p>First step of this algorithm is to determine the order of variables for conditioning.
It seems to be reasonable to include first variables that are likely to be most important, leaving the noise variables at the end.
This leads to order based on following scores</p>
<p><span class="math display">\[
score(f, x^*, i) = \left| E [f(X)] - E [f(X)|X_i = x^*_i] \right|
\]</span>
Note, that the absolute value is needed as variable contributions can be both positive and negative.</p>
<p>Once the ordering is determined in the second step variable contributions are calculated as</p>
<p><span class="math display">\[
v(f, x^*_i, i) = E [f(X) | X_{I \cup \{i\}} = x_{I \cup \{i\}}^*] - E [f(X) | X_{I} = x_{I}^*] 
\]</span>
where <span class="math inline">\(I\)</span> is the set of variables that have scores smaller than score for variable <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[
I = \{j: score(f, x^*, j) &lt; score(f, x^*, i)\}
\]</span></p>
<p>The time complexity of the first step id <span class="math inline">\(O(p)\)</span> where <span class="math inline">\(p\)</span> is the number of variables and the time complexity of the second step is also <span class="math inline">\(O(p)\)</span>.</p>
</div>
<div id="example-titanic-data" class="section level2">
<h2><span class="header-section-number">11.3</span> Example: Titanic data</h2>
<p>PBI: in this section, should we replicate figures and data already presented in Figure fig:BDPrice4 ?</p>
<p>Old:</p>
<p>Let us consider a random forest model created for HR data. The average model response is <span class="math inline">\(\bar f(x) = 0.385586\)</span>. For a selected observation <span class="math inline">\(x^*\)</span> the table below presents scores for particular variables.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Ei f(X)</th>
<th align="right">scorei</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hours</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="even">
<td align="left">salary</td>
<td align="right">0.225528</td>
<td align="right">0.160058</td>
</tr>
<tr class="odd">
<td align="left">evaluation</td>
<td align="right">0.430994</td>
<td align="right">0.045408</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.364258</td>
<td align="right">0.021328</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="right">0.391060</td>
<td align="right">0.005474</td>
</tr>
</tbody>
</table>
<p>Once we determine the order we can calculate sequential contributions</p>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">cumulative</th>
<th align="right">contribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.385586</td>
<td align="right">0.385586</td>
</tr>
<tr class="even">
<td align="left">* hours = 42</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="odd">
<td align="left">* salary = 2</td>
<td align="right">0.400206</td>
<td align="right">-0.215994</td>
</tr>
<tr class="even">
<td align="left">* evaluation = 2</td>
<td align="right">0.405776</td>
<td align="right">0.005570</td>
</tr>
<tr class="odd">
<td align="left">* age = 58</td>
<td align="right">0.497314</td>
<td align="right">0.091538</td>
</tr>
<tr class="even">
<td align="left">* gender = male</td>
<td align="right">0.778000</td>
<td align="right">0.280686</td>
</tr>
<tr class="odd">
<td align="left">final_prognosis</td>
<td align="right">0.778000</td>
<td align="right">0.778000</td>
</tr>
</tbody>
</table>
</div>
<div id="pros-and-cons-1" class="section level2">
<h2><span class="header-section-number">11.4</span> Pros and cons</h2>
<p>Break Down approach is model agnostic, can be applied to any predictive model that returns a single number. It leads to additive variable attribution. Below we summarize key strengths and weaknesses of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>Break Down Plots are easy to understand and decipher.</li>
<li>Break Down Plots are compact; many variables may be presented in a small space.</li>
<li>Break Down Plots are model agnostic yet they reduce to intuitive interpretation for linear Gaussian and generalized models.</li>
<li>Complexity of Break Down Algorithm is linear in respect to the number of variables.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>If the model is non-additive then showing only additive contributions may be misleading.</li>
<li>Selection of the ordering based on scores is subjective. Different orderings may lead to different contributions.</li>
<li>For large number of variables the Break Down Plot may be messy with many variables having small contributions.</li>
</ul>
</div>
<div id="code-snippets-for-r" class="section level2">
<h2><span class="header-section-number">11.5</span> Code snippets for R</h2>
<p>In this section we present key features of the <code>iBreakDown</code> package for R <span class="citation">(Gosiewska and Biecek <a href="#ref-iBreakDownRPackage">2019</a><a href="#ref-iBreakDownRPackage">a</a>)</span>. This package covers all features presented in this chapter. It is available on CRAN and GitHub. Find more examples at the website of this package <code>https://modeloriented.github.io/iBreakDown/</code>.</p>
<p><strong>Model preparation</strong></p>
<p>As in previous chapters we will use the random forest <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span> model <code>titanic_rf_v6</code> developed for the Titanic dataset (see Section <a href="DataSetsIntro.html#TitanicDataset">4.1</a>).
Using the same model will help us (1) to understand how the Break Down method works, (2) to compare these explanations against methods presented in previous chapters.</p>
<p>So let restore the <code>titanic_rf_v6</code> model.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb123-3" data-line-number="3"></a>
<a class="sourceLine" id="cb123-4" data-line-number="4">titanic &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/27e5c&quot;</span>)</a>
<a class="sourceLine" id="cb123-5" data-line-number="5">titanic_rf_v6 &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/31570&quot;</span>)</a></code></pre></div>
<p>Model exploration with the <code>iBreakDown</code> package is performed in three steps.</p>
<p><strong>1. Create an explainer - wrapper around model and validation data.</strong></p>
<p>Since all other functions work in a model agnostic fashion, first we need to define a wrapper around the model. Here we are using the <code>explain()</code> function from <code>DALEX</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a>)</span>.</p>
<p>This function was introduced in detailes in the <a href="#codeSnippetsCeterisParibus"><strong>??</strong></a> section.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" data-line-number="1">explain_titanic_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(<span class="dt">model =</span> titanic_rf_v6, </a>
<a class="sourceLine" id="cb124-2" data-line-number="2">                              <span class="dt">data =</span> titanic[,<span class="op">-</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb124-3" data-line-number="3">                              <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> &quot;yes&quot;</span>, </a>
<a class="sourceLine" id="cb124-4" data-line-number="4">                              <span class="dt">label =</span> <span class="st">&quot;Random Forest v6&quot;</span>)</a></code></pre></div>
<p><strong>2. Select an observation of interest.</strong></p>
<p>Break Down Plots decompose model prediction around a single observation. Let’s construct a data frame with corresponding values.</p>
<p>Here again we will use a data frame <code>johny_d</code> with a single row, that describes an 8-years old boy that travels in the first class without parents and siblings. Then, we obtain the model prediction for this instance with the help of the `predict()’ function.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">johny_d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">  <span class="dt">class =</span> <span class="kw">factor</span>(<span class="st">&quot;1st&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1st&quot;</span>, <span class="st">&quot;2nd&quot;</span>, <span class="st">&quot;3rd&quot;</span>, <span class="st">&quot;deck crew&quot;</span>, <span class="st">&quot;engineering crew&quot;</span>, </a>
<a class="sourceLine" id="cb125-3" data-line-number="3">                                  <span class="st">&quot;restaurant staff&quot;</span>, <span class="st">&quot;victualling crew&quot;</span>)),</a>
<a class="sourceLine" id="cb125-4" data-line-number="4">  <span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)),</a>
<a class="sourceLine" id="cb125-5" data-line-number="5">  <span class="dt">age =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb125-6" data-line-number="6">  <span class="dt">sibsp =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb125-7" data-line-number="7">  <span class="dt">parch =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb125-8" data-line-number="8">  <span class="dt">fare =</span> <span class="dv">72</span>,</a>
<a class="sourceLine" id="cb125-9" data-line-number="9">  <span class="dt">embarked =</span> <span class="kw">factor</span>(<span class="st">&quot;Southampton&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Belfast&quot;</span>, <span class="st">&quot;Cherbourg&quot;</span>, <span class="st">&quot;Queenstown&quot;</span>, <span class="st">&quot;Southampton&quot;</span>))</a>
<a class="sourceLine" id="cb125-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb125-11" data-line-number="11"></a>
<a class="sourceLine" id="cb125-12" data-line-number="12"><span class="kw">predict</span>(explain_titanic_rf, johny_d)</a></code></pre></div>
<pre><code>## [1] 0.422</code></pre>
<p><strong>3. Calculate Break Down decomposition</strong></p>
<p>The <code>iBreakDown::break_down()</code> function calculates Break Down contributions for a selected model around a selected observation.</p>
<p>The result from <code>break_down()</code> function is a data frame with additive attributions for selected observation.</p>
<p>The simplest use case is to set only the arguments - model explainers and observation of interest.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;iBreakDown&quot;</span>)</a>
<a class="sourceLine" id="cb127-2" data-line-number="2">bd_rf &lt;-<span class="st"> </span><span class="kw">break_down</span>(explain_titanic_rf,</a>
<a class="sourceLine" id="cb127-3" data-line-number="3">                 johny_d)</a>
<a class="sourceLine" id="cb127-4" data-line-number="4"></a>
<a class="sourceLine" id="cb127-5" data-line-number="5">bd_rf</a></code></pre></div>
<pre><code>##                                          contribution
## Random Forest v6: intercept                     0.235
## Random Forest v6: age = 8                       0.270
## Random Forest v6: class = 1st                   0.086
## Random Forest v6: fare = 72                    -0.046
## Random Forest v6: gender = male                -0.083
## Random Forest v6: embarked = Southampton       -0.003
## Random Forest v6: sibsp = 0                    -0.006
## Random Forest v6: parch = 0                    -0.030
## Random Forest v6: prediction                    0.422</code></pre>
<p>The generic <code>plot()</code> function creates a Break Down plots.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="kw">plot</span>(bd_rf) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p>The function <code>break_down()</code> can take more arguments. The most commonly used are:</p>
<ul>
<li><code>x</code> a wrapper over a model created with function <code>DALEX::explain()</code>,</li>
<li><code>new_observation</code> an observation to be explained is should be a data frame with structure that matches the training data,</li>
<li><code>order</code> if specified then it can be a vector of characters (column names) or integers (column indexes) that specify order of variable conditioning. If not specified (default) then a one-step heuristic is used to determine the order,</li>
<li><code>keep_distributions</code> logical value.<br />
if <code>TRUE</code>, then additional diagnostic information is about conditional distributions is stored and can be plotted with the generic <code>plot()</code> function.</li>
</ul>
<p>Let’s see these additional arguments in action.</p>
<p>First we will specify order. You can use integer indexes or variable names. Note that the second option is in most cases better because of higher readability. Additionally, to reduce clutter in the plot we set <code>max_features = 3</code> argument in the <code>plot()</code> function.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;iBreakDown&quot;</span>)</a>
<a class="sourceLine" id="cb130-2" data-line-number="2">bd_rf_order &lt;-<span class="st"> </span><span class="kw">break_down</span>(explain_titanic_rf,</a>
<a class="sourceLine" id="cb130-3" data-line-number="3">                 johny_d,</a>
<a class="sourceLine" id="cb130-4" data-line-number="4">                 <span class="dt">order =</span> <span class="kw">c</span>(<span class="st">&quot;class&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;fare&quot;</span>, <span class="st">&quot;parch&quot;</span>, <span class="st">&quot;sibsp&quot;</span>, <span class="st">&quot;embarked&quot;</span>))</a>
<a class="sourceLine" id="cb130-5" data-line-number="5"><span class="kw">plot</span>(bd_rf_order, <span class="dt">max_features =</span> <span class="dv">3</span>) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>The <code>plot_distributions = TRUE</code> argument of <code>break_down()</code> function enriches model response with additional information about conditional distribution.</p>
<p>It can be presented after setting <code>plot_distributions = TRUE</code> in the <code>plot()</code> function. Conditional distributions are presented as vioplots. Red dots stand for conditional average model response. Thin black lines between vioplots correspond to predictions for individual observations. With them we can trace how model predictions change after consecutive conditionings.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">bd_rf_distr &lt;-<span class="st"> </span><span class="kw">break_down</span>(explain_titanic_rf,</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">                 johny_d,</a>
<a class="sourceLine" id="cb131-3" data-line-number="3">                 <span class="dt">order =</span> <span class="kw">c</span>(<span class="st">&quot;class&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;fare&quot;</span>, <span class="st">&quot;parch&quot;</span>, <span class="st">&quot;sibsp&quot;</span>, <span class="st">&quot;embarked&quot;</span>),</a>
<a class="sourceLine" id="cb131-4" data-line-number="4">                 <span class="dt">keep_distributions =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb131-5" data-line-number="5"><span class="kw">plot</span>(bd_rf_distr, <span class="dt">plot_distributions =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-explainPaper">
<p>Robnik-Šikonja, Marco, and Igor Kononenko. 2008. “Explaining Classifications for Individual Instances.” <em>IEEE Transactions on Knowledge and Data Engineering</em> 20 (5): 589–600. <a href="https://doi.org/10.1109/TKDE.2007.190734">https://doi.org/10.1109/TKDE.2007.190734</a>.</p>
</div>
<div id="ref-explainPackage">
<p>Robnik-Sikonja, Marko. 2018. <em>ExplainPrediction: Explanation of Predictions for Classification and Regression Models</em>. <a href="https://CRAN.R-project.org/package=ExplainPrediction">https://CRAN.R-project.org/package=ExplainPrediction</a>.</p>
</div>
<div id="ref-iBreakDownRPackage">
<p>Gosiewska, Alicja, and Przemyslaw Biecek. 2019a. “iBreakDown: Uncertainty of Model Explanations for Non-additive Predictive Models.” <a href="https://arxiv.org/abs/1903.11420v1">https://arxiv.org/abs/1903.11420v1</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
<div id="ref-R-DALEX">
<p>Biecek, Przemyslaw. 2018. <em>DALEX: Descriptive mAchine Learning Explanations</em>. <a href="https://pbiecek.github.io/DALEX/">https://pbiecek.github.io/DALEX/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="variableAttributionMethods.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="iBreakDown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
