<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visualisation, Exploration and Explanation</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2018-09-25">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="variableAttributionMethods.html">
<link rel="next" href="sequential-attributions-with-interactions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#white-box-models-vs-black-box-models"><i class="fa fa-check"></i><b>1.1</b> White-box models vs Black-box models</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#model-agnostic-vs-model-specific"><i class="fa fa-check"></i><b>1.2</b> Model agnostic vs Model specific</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#why-do-we-need-model-explainers"><i class="fa fa-check"></i><b>1.3</b> Why do we need model explainers?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#how-model-exploration-is-different-from-data-exploration"><i class="fa fa-check"></i><b>1.4</b> How model exploration is different from data exploration?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.5</b> Code snippets</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#glossary-notation"><i class="fa fa-check"></i><b>1.6</b> Glossary / Notation</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="prediction-level-explanations.html"><a href="prediction-level-explanations.html"><i class="fa fa-check"></i>Prediction level explanations</a></li>
<li class="chapter" data-level="2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#approaches-to-prediction-explanations"><i class="fa fa-check"></i><b>2.1</b> Approaches to prediction explanations</a></li>
<li class="chapter" data-level="2.2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#three-single-laws"><i class="fa fa-check"></i><b>2.2</b> A bit of philosophy: Three Laws for Prediction Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>3</b> Introduction to variable attribution methods</a><ul>
<li class="chapter" data-level="3.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#VAlinMod"><i class="fa fa-check"></i><b>3.1</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="3.1.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#wine-quality-example"><i class="fa fa-check"></i><b>3.1.1</b> Wine quality example</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#modelAgnosticAttribution"><i class="fa fa-check"></i><b>3.2</b> Model agnostic approaches</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>4</b> Sequential Additive Attributions</a><ul>
<li class="chapter" data-level="4.1" data-path="breakDown.html"><a href="breakDown.html#the-algorithm"><i class="fa fa-check"></i><b>4.1</b> The Algorithm</a></li>
<li class="chapter" data-level="4.2" data-path="breakDown.html"><a href="breakDown.html#hr-dataset-hire-or-fire"><i class="fa fa-check"></i><b>4.2</b> HR dataset: Hire or Fire?</a></li>
<li class="chapter" data-level="4.3" data-path="breakDown.html"><a href="breakDown.html#break-down-plots"><i class="fa fa-check"></i><b>4.3</b> Break Down Plots</a></li>
<li class="chapter" data-level="4.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sequential-attributions-with-interactions.html"><a href="sequential-attributions-with-interactions.html"><i class="fa fa-check"></i><b>5</b> Sequential attributions with interactions</a><ul>
<li class="chapter" data-level="5.1" data-path="sequential-attributions-with-interactions.html"><a href="sequential-attributions-with-interactions.html#the-algorithm-1"><i class="fa fa-check"></i><b>5.1</b> The Algorithm</a></li>
<li class="chapter" data-level="5.2" data-path="sequential-attributions-with-interactions.html"><a href="sequential-attributions-with-interactions.html#hr-dataset-hire-or-fire-1"><i class="fa fa-check"></i><b>5.2</b> HR dataset: Hire or Fire?</a></li>
<li class="chapter" data-level="5.3" data-path="sequential-attributions-with-interactions.html"><a href="sequential-attributions-with-interactions.html#break-down-plots-1"><i class="fa fa-check"></i><b>5.3</b> Break Down Plots</a></li>
<li class="chapter" data-level="5.4" data-path="sequential-attributions-with-interactions.html"><a href="sequential-attributions-with-interactions.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="sequential-attributions-with-interactions.html"><a href="sequential-attributions-with-interactions.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>5.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>6</b> Average Additive Attributions</a><ul>
<li class="chapter" data-level="6.1" data-path="shapley.html"><a href="shapley.html#the-algorithm-2"><i class="fa fa-check"></i><b>6.1</b> The Algorithm</a></li>
<li class="chapter" data-level="6.2" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>6.2</b> Code snippets for R</a></li>
<li class="chapter" data-level="6.3" data-path="shapley.html"><a href="shapley.html#pros-and-cons-2"><i class="fa fa-check"></i><b>6.3</b> Pros and cons</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>7</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="7.1" data-path="LIME.html"><a href="LIME.html#the-algorithm-3"><i class="fa fa-check"></i><b>7.1</b> The Algorithm</a></li>
<li class="chapter" data-level="7.2" data-path="LIME.html"><a href="LIME.html#hr-dataset-hire-or-fire-2"><i class="fa fa-check"></i><b>7.2</b> HR dataset: Hire or Fire?</a></li>
<li class="chapter" data-level="7.3" data-path="LIME.html"><a href="LIME.html#pros-and-cons-3"><i class="fa fa-check"></i><b>7.3</b> Pros and cons</a></li>
<li class="chapter" data-level="7.4" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>7.4</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.4.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>7.4.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="7.4.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>7.4.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="7.4.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>7.4.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>8</b> What-If analysis with the Ceteris Paribus Principle</a><ul>
<li class="chapter" data-level="8.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>8.2</b> 1D profiles</a></li>
<li class="chapter" data-level="8.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>8.3</b> Profile oscillations</a></li>
<li class="chapter" data-level="8.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>8.4</b> 2D profiles</a></li>
<li class="chapter" data-level="8.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>8.5</b> Local model fidelity</a></li>
<li class="chapter" data-level="8.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons-4"><i class="fa fa-check"></i><b>8.6</b> Pros and cons</a></li>
<li class="chapter" data-level="8.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>8.7</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>9</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="9.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>9.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="10" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>10</b> Introduction</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction-2.html"><a href="introduction-2.html#a-bit-of-philosophy"><i class="fa fa-check"></i><b>10.1</b> A bit of philosophy</a></li>
<li class="chapter" data-level="10.2" data-path="introduction-2.html"><a href="introduction-2.html#example-price-prediction"><i class="fa fa-check"></i><b>10.2</b> Example: Price prediction</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="variable-importance.html"><a href="variable-importance.html"><i class="fa fa-check"></i><b>11</b> Variable Importance</a></li>
<li class="chapter" data-level="12" data-path="marginal-response.html"><a href="marginal-response.html"><i class="fa fa-check"></i><b>12</b> Marginal Response</a><ul>
<li class="chapter" data-level="12.1" data-path="marginal-response.html"><a href="marginal-response.html#partialDependence"><i class="fa fa-check"></i><b>12.1</b> Partial Dependency Plots</a></li>
<li class="chapter" data-level="12.2" data-path="marginal-response.html"><a href="marginal-response.html#merging-path-plots"><i class="fa fa-check"></i><b>12.2</b> Merging Path Plots</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>13</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="14" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>14</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="15" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>15</b> Other topics</a></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="16" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>16</b> Data Sets</a><ul>
<li class="chapter" data-level="16.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>16.1</b> Hire or Fire? HR in Call Center</a></li>
<li class="chapter" data-level="16.2" data-path="DataSets.html"><a href="DataSets.html#apartmentsDataset"><i class="fa fa-check"></i><b>16.2</b> How much does it cost? Price prediction for a square meter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisation, Exploration and Explanation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="breakDown" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Sequential Additive Attributions</h1>
<p>The approach for variable attribution presented in the Section <a href="variableAttributionMethods.html#modelAgnosticAttribution">3.2</a> has the property of <em>local accuracy</em>, but variable contributions depends on the variable ordering.</p>
<p>The Break Down method solves this problem by using two-step procedure. In the first step variables are ordered and in the second step the consecutive conditioning is applied to ordered variables.</p>
<div id="the-algorithm" class="section level2">
<h2><span class="header-section-number">4.1</span> The Algorithm</h2>
<p>First step of this algorithm is to determine the order of variables for conditioning.
It seems to be reasonable to include first variables that are likely to be most important, leaving the noise variables at the end.
This leads to order based on following scores</p>
<p><span class="math display">\[
score(f, x^*, i) = \left| E [f(X)] - E [f(X)|X_i = x^*_i] \right|
\]</span>
Note, that the absolute value is needed as variable contributions can be both positive and negative.</p>
<p>Once the ordering is determined in the second step variable contributions are calculated as</p>
<p><span class="math display">\[
v(f, x^*_i, i) = E [f(X) | X_{I \cup \{i\}} = x_{I \cup \{i\}}^*] - E [f(X) | X_{I} = x_{I}^*] 
\]</span>
where <span class="math inline">\(I\)</span> is the set of variables that have scores smaller than score for variable <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[
I = \{j: score(f, x^*, j) &lt; score(f, x^*, i)\}
\]</span></p>
<p>The time complexity of the first step id <span class="math inline">\(O(p)\)</span> where <span class="math inline">\(p\)</span> is the number of variables and the time complexity of the second step is also <span class="math inline">\(O(p)\)</span>.</p>
</div>
<div id="hr-dataset-hire-or-fire" class="section level2">
<h2><span class="header-section-number">4.2</span> HR dataset: Hire or Fire?</h2>
<p>Let us consider a random forest model created for HR data. The average model response is <span class="math inline">\(\bar f(x) = 0.385586\)</span>. For a selected observation <span class="math inline">\(x^*\)</span> the table below presents scores for particular variables.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Ei f(X)</th>
<th align="right">scorei</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hours</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="even">
<td align="left">salary</td>
<td align="right">0.225528</td>
<td align="right">0.160058</td>
</tr>
<tr class="odd">
<td align="left">evaluation</td>
<td align="right">0.430994</td>
<td align="right">0.045408</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.364258</td>
<td align="right">0.021328</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="right">0.391060</td>
<td align="right">0.005474</td>
</tr>
</tbody>
</table>
<p>Once we determine the order we can calculate sequential contributions</p>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">cumulative</th>
<th align="right">contribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.385586</td>
<td align="right">0.385586</td>
</tr>
<tr class="even">
<td align="left">* hours = 42</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="odd">
<td align="left">* salary = 2</td>
<td align="right">0.400206</td>
<td align="right">-0.215994</td>
</tr>
<tr class="even">
<td align="left">* evaluation = 2</td>
<td align="right">0.405776</td>
<td align="right">0.005570</td>
</tr>
<tr class="odd">
<td align="left">* age = 58</td>
<td align="right">0.497314</td>
<td align="right">0.091538</td>
</tr>
<tr class="even">
<td align="left">* gender = male</td>
<td align="right">0.778000</td>
<td align="right">0.280686</td>
</tr>
<tr class="odd">
<td align="left">final_prognosis</td>
<td align="right">0.778000</td>
<td align="right">0.778000</td>
</tr>
</tbody>
</table>
</div>
<div id="break-down-plots" class="section level2">
<h2><span class="header-section-number">4.3</span> Break Down Plots</h2>
<p>Once we calculated variable attributions we may plot them in an intuitive form.
This intuition behind Break Down Plots is described in Figure <a href="#BDPrice4"><strong>??</strong></a>.</p>
<p>The variable ordering determined in the first step of Break Down Algorithm is reflected by the ordering of variables in rows of the plot.</p>
<p>The last row of a plot shows the <span class="math inline">\(baseline\)</span>, i.e. an average model prediction. The next row corresponds to average model prediction for observations with variable <code>surface</code> fixed to value <code>35</code>. The next for corresponds to average model prediction with variables <code>surface</code> set to <code>35</code> and <code>floor</code> set to <code>1</code>, and so on. The first row corresponds to model response for <span class="math inline">\(x^*\)</span>.</p>
<p>In panels A and B violines show distribution of model predictions for selected points, while red dots stands for averages.</p>
<p>The most minimal form that shows important information is presented in the panel C.
Positive values are presented with green bars while negative differences are marked with yellow bar. They sum up to final model prediction, which is denoted by a grey bar in this example.</p>
<div class="figure" style="text-align: center"><span id="fig:BDPrice4"></span>
<img src="figure/bd_price_4.png" alt="(fig:BDPrice4) Break Down Plots show how variables move the model prediction from population average to the model prognosis for a single observation. A) The last row shows distribution of model predictions. Next rows show conditional distributions, every row a new variable is added to conditioning. The first row shows model prediction for a single point. Red dots stand for averages. B) Blue arrows shows how the average conditional response change, these values are variables contributions. C) Only variable contributions are presented. " width="70%" />
<p class="caption">
Figure 4.1: (fig:BDPrice4) Break Down Plots show how variables move the model prediction from population average to the model prognosis for a single observation. A) The last row shows distribution of model predictions. Next rows show conditional distributions, every row a new variable is added to conditioning. The first row shows model prediction for a single point. Red dots stand for averages. B) Blue arrows shows how the average conditional response change, these values are variables contributions. C) Only variable contributions are presented.
</p>
</div>
</div>
<div id="pros-and-cons" class="section level2">
<h2><span class="header-section-number">4.4</span> Pros and cons</h2>
<p>Break Down approach is model agnostic, can be applied to any predictive model that returns a single number. It leads to additive variable attribution. Below we summarize key strengths and weaknesses of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>Break Down Plots are easy to understand and decipher.</li>
<li>Break Down Plots are compact; many variables may be presented in a small space.</li>
<li>Break Down Plots are model agnostic yet they reduce to intuitive interpretation for linear Gaussian and generalized models.</li>
<li>Complexity of Break Down Algorithm is linear in respect to the number of variables.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>If the model is non-additive then showing only additive contributions may be misleading.</li>
<li>Selection of the ordering based on scores is subjective. Different orderings may lead to different contributions.</li>
<li>For large number of variables the Break Down Plot may be messy with many variables having small contributions.</li>
</ul>
</div>
<div id="code-snippets-for-r" class="section level2">
<h2><span class="header-section-number">4.5</span> Code snippets for R</h2>
<p>In this section we present key features of the <code>breakDown</code> package for R <span class="citation">(Biecek <a href="#ref-R-breakDown">2018</a><a href="#ref-R-breakDown">a</a>)</span>. This package covers all features presented in this chapter. It is available on CRAN and GitHub. Find more examples at the website of this package <code>https://pbiecek.github.io/breakDown/</code>.</p>
<p><strong>Model preparation</strong></p>
<p>In this section we will present an example based on the <code>HR</code> dataset and Random Forest model <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span>. See the Section <a href="DataSets.html#HRdataset">16.1</a> for more details.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">model</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = status ~ gender + age + hours + evaluation +      salary, data = HR) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 27.39%
## Confusion matrix:
##          fired   ok promoted class.error
## fired     2268  385      202   0.2056042
## ok         529 1255      437   0.4349392
## promoted   194  402     2175   0.2150848</code></pre>
<p>Model exploration with the <code>breakDown</code> package is performed in three steps.</p>
<p><strong>1. Create an explainer - wrapper around model and validation data.</strong></p>
<p>Since all other functions work in a model agnostic fashion, first we need to define a wrapper around the model. Here we are using the <code>explain()</code> function from <code>DALEX</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a><a href="#ref-R-DALEX">c</a>)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">explainer_rf_fired &lt;-<span class="st"> </span><span class="kw">explain</span>(model,</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">                 <span class="dt">data =</span> HR,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">                 <span class="dt">y =</span> HR<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;fired&quot;</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                 <span class="dt">predict_function =</span> <span class="cf">function</span>(m,x) <span class="kw">predict</span>(m,x, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)[,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                 <span class="dt">label =</span> <span class="st">&quot;fired&quot;</span>)</a></code></pre></div>
<p><strong>2. Select an observation of interest.</strong></p>
<p>Break Down Plots decompose model prediction around a single observation. Let’s construct a data frame with corresponding values.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">new_observation &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)),</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">                      <span class="dt">age =</span> <span class="fl">57.7</span>,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                      <span class="dt">hours =</span> <span class="fl">42.3</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                      <span class="dt">evaluation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                      <span class="dt">salary =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="kw">predict</span>(model, new_observation, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a></code></pre></div>
<pre><code>##   fired    ok promoted
## 1  0.81 0.188    0.002
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot; &quot;votes&quot;</code></pre>
<p><strong>3. Calculate Break Down decomposition</strong></p>
<p>The <code>break_down()</code> function calculates Break Down contributions for a selected model around a selected observation.</p>
<p>The result from <code>break_down()</code> function is a data frame with variable attributions.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;breakDown&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">bd_rf &lt;-<span class="st"> </span><span class="kw">break_down</span>(explainer_rf_fired,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                 new_observation,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                 <span class="dt">check_interactions =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                 <span class="dt">keep_distributions =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">bd_rf</a></code></pre></div>
<pre><code>##                  contribution
## (Intercept)             0.375
## * hours = 42            0.242
## * salary = 2           -0.204
## * evaluation = 2        0.014
## * age = 58              0.106
## * gender = male         0.277
## final_prognosis         0.810
## baseline:  0</code></pre>
<p>The generic <code>plot()</code> function creates a Break Down plots.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">plot</span>(bd_rf) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Add the <code>plot_distributions = TRUE</code> argument to enrich model response with additional information.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">plot</span>(bd_rf, <span class="dt">plot_distributions =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-breakDown">
<p>Biecek, Przemyslaw. 2018a. <em>BreakDown: Model Agnostic Explainers for Individual Predictions</em>. <a href="https://CRAN.R-project.org/package=breakDown" class="uri">https://CRAN.R-project.org/package=breakDown</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest" class="uri">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
<div id="ref-R-DALEX">
<p>Biecek, Przemyslaw. 2018c. <em>DALEX: Descriptive mAchine Learning Explanations</em>. <a href="https://pbiecek.github.io/DALEX/" class="uri">https://pbiecek.github.io/DALEX/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="variableAttributionMethods.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sequential-attributions-with-interactions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
