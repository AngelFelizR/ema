<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visualisation, Exploration and Explanation</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-03-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="variableAttributionMethods.html">
<link rel="next" href="variable-attribution-with-interactions.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.5</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.6</b> Code snippets</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.7</b> The structure of the book</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.8</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#what-are-the-chances-for-survival-on-the-titanic"><i class="fa fa-check"></i><b>2.1.1</b> What are the chances for survival on the Titanic?</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration"><i class="fa fa-check"></i><b>2.1.2</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#logistic-regression-is-always-a-good-choice"><i class="fa fa-check"></i><b>2.1.3</b> Logistic regression is always a good choice</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#random-forest-to-the-rescue"><i class="fa fa-check"></i><b>2.1.4</b> Random Forest to the rescue</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#gradient-boosting-for-interactions"><i class="fa fa-check"></i><b>2.1.5</b> Gradient boosting for interactions</a></li>
<li class="chapter" data-level="2.1.6" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model-predictions"><i class="fa fa-check"></i><b>2.1.6</b> Model predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>4</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="4.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>4.3</b> Method</a></li>
<li class="chapter" data-level="4.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>4.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="4.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons"><i class="fa fa-check"></i><b>4.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="4.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>4.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>5</b> Variable attributions</a><ul>
<li class="chapter" data-level="5.1" data-path="breakDown.html"><a href="breakDown.html#intuition-1"><i class="fa fa-check"></i><b>5.1</b> Intuition</a></li>
<li class="chapter" data-level="5.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>5.2</b> Method</a></li>
<li class="chapter" data-level="5.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>5.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="5.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>5.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html"><i class="fa fa-check"></i><b>6</b> Variable attribution with interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#intuition-2"><i class="fa fa-check"></i><b>6.1</b> Intuition</a></li>
<li class="chapter" data-level="6.2" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#method-2"><i class="fa fa-check"></i><b>6.2</b> Method</a></li>
<li class="chapter" data-level="6.3" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>6.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="6.4" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#break-down-plots"><i class="fa fa-check"></i><b>6.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="6.5" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#pros-and-cons-2"><i class="fa fa-check"></i><b>6.5</b> Pros and cons</a></li>
<li class="chapter" data-level="6.6" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>6.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>7</b> Average variable attributions</a><ul>
<li class="chapter" data-level="7.1" data-path="shapley.html"><a href="shapley.html#intuition-3"><i class="fa fa-check"></i><b>7.1</b> Intuition</a></li>
<li class="chapter" data-level="7.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>7.2</b> Method</a></li>
<li class="chapter" data-level="7.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>7.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="7.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-3"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>8</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="8.1" data-path="LIME.html"><a href="LIME.html#intuition-4"><i class="fa fa-check"></i><b>8.1</b> Intuition</a></li>
<li class="chapter" data-level="8.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>8.2</b> Method</a></li>
<li class="chapter" data-level="8.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>8.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="8.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-4"><i class="fa fa-check"></i><b>8.4</b> Pros and cons</a></li>
<li class="chapter" data-level="8.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>8.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="8.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>8.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="8.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>8.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="8.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>8.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>9</b> What-If analysis with the Ceteris Paribus Principle</a><ul>
<li class="chapter" data-level="9.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-2"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition-5"><i class="fa fa-check"></i><b>9.2</b> Intuition</a></li>
<li class="chapter" data-level="9.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#method-5"><i class="fa fa-check"></i><b>9.3</b> Method</a><ul>
<li class="chapter" data-level="9.3.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>9.3.1</b> 1D profiles</a></li>
<li class="chapter" data-level="9.3.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>9.3.2</b> Profile oscillations</a></li>
<li class="chapter" data-level="9.3.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>9.3.3</b> 2D profiles</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>9.4</b> Local model fidelity</a></li>
<li class="chapter" data-level="9.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#example"><i class="fa fa-check"></i><b>9.5</b> Example</a></li>
<li class="chapter" data-level="9.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons-5"><i class="fa fa-check"></i><b>9.6</b> Pros and cons</a></li>
<li class="chapter" data-level="9.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>9.7</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>10</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="10.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>10.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="11" data-path="introduction-3.html"><a href="introduction-3.html"><i class="fa fa-check"></i><b>11</b> Introduction</a><ul>
<li class="chapter" data-level="11.1" data-path="introduction-3.html"><a href="introduction-3.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>11.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="11.2" data-path="introduction-3.html"><a href="introduction-3.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>11.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>12</b> Feature Importance</a><ul>
<li class="chapter" data-level="12.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>12.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="12.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic"><i class="fa fa-check"></i><b>12.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="12.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>12.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="12.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>12.4</b> More models</a></li>
<li class="chapter" data-level="12.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>12.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>13</b> Feature effects</a><ul>
<li class="chapter" data-level="13.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#partialDependence"><i class="fa fa-check"></i><b>13.1</b> Partial Dependency Plots</a><ul>
<li class="chapter" data-level="13.1.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#interactions-and-partial-dependency-profiles"><i class="fa fa-check"></i><b>13.1.1</b> Interactions and Partial Dependency profiles</a></li>
<li class="chapter" data-level="13.1.2" data-path="variableEngeneering.html"><a href="variableEngeneering.html#groups-of-partial-dependency-profiles"><i class="fa fa-check"></i><b>13.1.2</b> Groups of Partial Dependency profiles</a></li>
<li class="chapter" data-level="13.1.3" data-path="variableEngeneering.html"><a href="variableEngeneering.html#model-comparisons-with-partial-dependency-plots"><i class="fa fa-check"></i><b>13.1.3</b> Model comparisons with Partial Dependency Plots</a></li>
<li class="chapter" data-level="13.1.4" data-path="variableEngeneering.html"><a href="variableEngeneering.html#correlation-between-features"><i class="fa fa-check"></i><b>13.1.4</b> Correlation between features</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="variableEngeneering.html"><a href="variableEngeneering.html#merging-path-plots"><i class="fa fa-check"></i><b>13.2</b> Merging Path Plots</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>14</b> Other topics</a></li>
<li class="chapter" data-level="15" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>15</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="16" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>16</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="17" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>17</b> Concept Drift</a><ul>
<li class="chapter" data-level="17.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-4"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>17.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="17.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>17.3</b> Code snippets</a></li>
<li class="chapter" data-level="17.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>17.4</b> Residual Drift</a></li>
<li class="chapter" data-level="17.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>17.5</b> Code snippets</a></li>
<li class="chapter" data-level="17.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>17.6</b> Model Drift</a></li>
<li class="chapter" data-level="17.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>17.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="18" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>18</b> Data Sets</a><ul>
<li class="chapter" data-level="18.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>18.1</b> Hire or Fire? HR in Call Center</a></li>
<li class="chapter" data-level="18.2" data-path="DataSets.html"><a href="DataSets.html#apartmentsDataset"><i class="fa fa-check"></i><b>18.2</b> How much does it cost? Price prediction for a square meter</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>19</b> Packages</a><ul>
<li class="chapter" data-level="19.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>19.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisation, Exploration and Explanation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="breakDown" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Variable attributions</h1>
<p>In the Section <a href="variableAttributionMethods.html#variableAttributionMethods">4</a> we introduced a method for calculation of variable attributions for linear models.
This method is accurate, based directly on the structure of the model. But for most popular machine learning models we cannot assume that they are linear nor even additive.</p>
<div id="intuition-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Intuition</h2>
<p>For any model we may repeat the intuition presented in Section <a href="variableAttributionMethods.html#variableAttributionMethods">4</a> to calculate variable contribution as shifts in expected model response after conditioning over consecutive variables.
This intuition is presented in Figure <a href="#BDPrice4"><strong>??</strong></a>.</p>
<p>Panel A shows distribution of model responses. The row <code>all data</code> shows the model response of the original dataset. The red dot stands for average is is an estimate of expencted model response <span class="math inline">\(E [f(x)]\)</span>.</p>
<p>Since we want to calculate effects of particular values of selected variables we then condition over these variables in a sequential manner.
The next row in panel A corresponds to average model prediction for observations with variable <code>surface</code> fixed to value <code>35</code>. The next for corresponds to average model prediction with variables <code>surface</code> set to <code>35</code> and <code>floor</code> set to <code>1</code>, and so on. The top row corresponds to model response for <span class="math inline">\(x^*\)</span>.</p>
<p>Black lines in the panel A show how prediction for a single point changes after coordinate <span class="math inline">\(i\)</span> is repaced by the <span class="math inline">\(x^*_i\)</span>. But finaly we are not interestes in particular changes, not even in distributions but only in averages - expected model responses.</p>
<p>The most minimal form that shows important information is presented in the panel C.
Positive values are presented with green bars while negative differences are marked with yellow bar. They sum up to final model prediction, which is denoted by a grey bar in this example.</p>
<div class="figure" style="text-align: center"><span id="fig:BDPrice4"></span>
<img src="figure/bd_price_4.png" alt="(fig:BDPrice4) Break Down Plots show how variables move the model prediction from population average to the model prognosis for a single observation. A) The last row shows distribution of model predictions. Next rows show conditional distributions, every row a new variable is added to conditioning. The first row shows model prediction for a single point. Red dots stand for averages. B) Blue arrows shows how the average conditional response change, these values are variables contributions. C) Only variable contributions are presented. " width="70%" />
<p class="caption">
Figure 5.1: (fig:BDPrice4) Break Down Plots show how variables move the model prediction from population average to the model prognosis for a single observation. A) The last row shows distribution of model predictions. Next rows show conditional distributions, every row a new variable is added to conditioning. The first row shows model prediction for a single point. Red dots stand for averages. B) Blue arrows shows how the average conditional response change, these values are variables contributions. C) Only variable contributions are presented.
</p>
</div>
</div>
<div id="method-1" class="section level2">
<h2><span class="header-section-number">5.2</span> Method</h2>
<p>Again, let <span class="math inline">\(v(f, x^*, i)\)</span> stands for the contribution of variable <span class="math inline">\(x_i\)</span> on prediction of model <span class="math inline">\(f()\)</span> in point <span class="math inline">\(x^*\)</span>.</p>
<p>We expect that such contribution will sum up to the model prediction in a given point (property called <em>local accuracy</em>), so
<span class="math display">\[
f(x^*) = baseline + \sum_{i=1}^p v(f, x^*, i)
\]</span>
where <span class="math inline">\(baseline\)</span> stands for average model response.</p>
<p>Note that the equation above may be rewritten as</p>
<p><span class="math display">\[
E [f(X)|X_1 = x_1^*, \ldots, X+p = x_p^*] = E[f(X)] + \sum_{i=1}^p v(f, x^*, i)
\]</span>
what leads to quite natural proposition for <span class="math inline">\(v(f, x^*_i, i)\)</span>, such as</p>
<p><span class="math display">\[
v(f, x^*_i, i) = E [f(X) | X_1 = x_1^*, \ldots, X_i = x_i^*] - E [f(X) | X_1 = x_1^*, \ldots, X_{i-1} = x_{i-1}^*] 
\]</span>
In other words the contribution of variable <span class="math inline">\(i\)</span> is the difference between expected model response conditioned on first <span class="math inline">\(i\)</span> variables minus the model response conditioned on first <span class="math inline">\(i-1\)</span> variables.</p>
<p>Such proposition fulfills the <em>local accuracy</em> condition, but unfortunatelly variable contributions depends on the ordering of variables.</p>
<div class="figure" style="text-align: center"><span id="fig:ordering"></span>
<img src="figure/ordering.png" alt="(fig:ordering) Two different paths between average model prediction and the model prediction for a selected observation. Black dots stand for conditional average, red arrows stands for changes between conditional averages." width="100%" />
<p class="caption">
Figure 5.2: (fig:ordering) Two different paths between average model prediction and the model prediction for a selected observation. Black dots stand for conditional average, red arrows stands for changes between conditional averages.
</p>
</div>
<p>See for example Figure <a href="breakDown.html#fig:ordering">5.2</a>. In the first ordering the contribution of variable <code>age</code> is calculated as 0.01, while in the second the contribution is calculated as 0.13. Such differences are related to the lack of additivness of the model <span class="math inline">\(f()\)</span>. Propositions presented in next two sections present different solutions for this problem.</p>
<p>The approach for variable attribution presented in the Section <a href="#modelAgnosticAttribution"><strong>??</strong></a> has the property of <em>local accuracy</em>, but variable contributions depends on the variable ordering.</p>
<p>The easiest way to solve this problem is to use two-step procedure. In the first step variables are ordered and in the second step the consecutive conditioning is applied to ordered variables.</p>
<p>First step of this algorithm is to determine the order of variables for conditioning.
It seems to be reasonable to include first variables that are likely to be most important, leaving the noise variables at the end.
This leads to order based on following scores</p>
<p><span class="math display">\[
score(f, x^*, i) = \left| E [f(X)] - E [f(X)|X_i = x^*_i] \right|
\]</span>
Note, that the absolute value is needed as variable contributions can be both positive and negative.</p>
<p>Once the ordering is determined in the second step variable contributions are calculated as</p>
<p><span class="math display">\[
v(f, x^*_i, i) = E [f(X) | X_{I \cup \{i\}} = x_{I \cup \{i\}}^*] - E [f(X) | X_{I} = x_{I}^*] 
\]</span>
where <span class="math inline">\(I\)</span> is the set of variables that have scores smaller than score for variable <span class="math inline">\(i\)</span>.</p>
<p><span class="math display">\[
I = \{j: score(f, x^*, j) &lt; score(f, x^*, i)\}
\]</span></p>
<p>The time complexity of the first step id <span class="math inline">\(O(p)\)</span> where <span class="math inline">\(p\)</span> is the number of variables and the time complexity of the second step is also <span class="math inline">\(O(p)\)</span>.</p>
</div>
<div id="example-hire-or-fire" class="section level2">
<h2><span class="header-section-number">5.3</span> Example: Hire or Fire?</h2>
<p>Let us consider a random forest model created for HR data. The average model response is <span class="math inline">\(\bar f(x) = 0.385586\)</span>. For a selected observation <span class="math inline">\(x^*\)</span> the table below presents scores for particular variables.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Ei f(X)</th>
<th align="right">scorei</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hours</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="even">
<td align="left">salary</td>
<td align="right">0.225528</td>
<td align="right">0.160058</td>
</tr>
<tr class="odd">
<td align="left">evaluation</td>
<td align="right">0.430994</td>
<td align="right">0.045408</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.364258</td>
<td align="right">0.021328</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="right">0.391060</td>
<td align="right">0.005474</td>
</tr>
</tbody>
</table>
<p>Once we determine the order we can calculate sequential contributions</p>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">cumulative</th>
<th align="right">contribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.385586</td>
<td align="right">0.385586</td>
</tr>
<tr class="even">
<td align="left">* hours = 42</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="odd">
<td align="left">* salary = 2</td>
<td align="right">0.400206</td>
<td align="right">-0.215994</td>
</tr>
<tr class="even">
<td align="left">* evaluation = 2</td>
<td align="right">0.405776</td>
<td align="right">0.005570</td>
</tr>
<tr class="odd">
<td align="left">* age = 58</td>
<td align="right">0.497314</td>
<td align="right">0.091538</td>
</tr>
<tr class="even">
<td align="left">* gender = male</td>
<td align="right">0.778000</td>
<td align="right">0.280686</td>
</tr>
<tr class="odd">
<td align="left">final_prognosis</td>
<td align="right">0.778000</td>
<td align="right">0.778000</td>
</tr>
</tbody>
</table>
</div>
<div id="pros-and-cons-1" class="section level2">
<h2><span class="header-section-number">5.4</span> Pros and cons</h2>
<p>Break Down approach is model agnostic, can be applied to any predictive model that returns a single number. It leads to additive variable attribution. Below we summarize key strengths and weaknesses of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>Break Down Plots are easy to understand and decipher.</li>
<li>Break Down Plots are compact; many variables may be presented in a small space.</li>
<li>Break Down Plots are model agnostic yet they reduce to intuitive interpretation for linear Gaussian and generalized models.</li>
<li>Complexity of Break Down Algorithm is linear in respect to the number of variables.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>If the model is non-additive then showing only additive contributions may be misleading.</li>
<li>Selection of the ordering based on scores is subjective. Different orderings may lead to different contributions.</li>
<li>For large number of variables the Break Down Plot may be messy with many variables having small contributions.</li>
</ul>
</div>
<div id="code-snippets-for-r" class="section level2">
<h2><span class="header-section-number">5.5</span> Code snippets for R</h2>
<p>In this section we present key features of the <code>breakDown2</code> package for R <span class="citation">(Biecek <a href="#ref-R-breakDown">2018</a><a href="#ref-R-breakDown">a</a>)</span>. This package covers all features presented in this chapter. It is available on CRAN and GitHub. Find more examples at the website of this package <code>https://pbiecek.github.io/breakDown2/</code>.</p>
<p><strong>Model preparation</strong></p>
<p>In this section we will present an example based on the <code>HR</code> dataset and Random Forest model <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span>. See the Section <a href="DataSets.html#HRdataset">18.1</a> for more details.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX2&quot;</span>)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">model</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = status ~ gender + age + hours + evaluation +      salary, data = HR) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 27.26%
## Confusion matrix:
##          fired   ok promoted class.error
## fired     2275  386      194   0.2031524
## ok         537 1246      438   0.4389914
## promoted   201  383     2187   0.2107542</code></pre>
<p>Model exploration with the <code>breakDown2</code> package is performed in three steps.</p>
<p><strong>1. Create an explainer - wrapper around model and validation data.</strong></p>
<p>Since all other functions work in a model agnostic fashion, first we need to define a wrapper around the model. Here we are using the <code>explain()</code> function from <code>DALEX2</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a><a href="#ref-R-DALEX">c</a>)</span>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">explainer_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(model,</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">                 <span class="dt">data =</span> HR,</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">                 <span class="dt">y =</span> HR<span class="op">$</span>status)</a></code></pre></div>
<p><strong>2. Select an observation of interest.</strong></p>
<p>Break Down Plots decompose model prediction around a single observation. Let’s construct a data frame with corresponding values.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">new_observation &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)),</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">                      <span class="dt">age =</span> <span class="fl">57.7</span>,</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">                      <span class="dt">hours =</span> <span class="fl">42.3</span>,</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">                      <span class="dt">evaluation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">                      <span class="dt">salary =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb42-6" data-line-number="6"></a>
<a class="sourceLine" id="cb42-7" data-line-number="7"><span class="kw">predict</span>(model, new_observation, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a></code></pre></div>
<pre><code>##   fired    ok promoted
## 1 0.762 0.236    0.002
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot; &quot;votes&quot;</code></pre>
<p><strong>3. Calculate Break Down decomposition</strong></p>
<p>The <code>local_attributions()</code> function calculates Break Down contributions for a selected model around a selected observation.</p>
<p>The result from <code>local_attributions()</code> function is a data frame with variable attributions.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;breakDown2&quot;</span>)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">bd_rf &lt;-<span class="st"> </span><span class="kw">local_attributions</span>(explainer_rf,</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">                 new_observation,</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">                 <span class="dt">keep_distributions =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb44-5" data-line-number="5"></a>
<a class="sourceLine" id="cb44-6" data-line-number="6">bd_rf</a></code></pre></div>
<pre><code>##                                         contribution
## randomForest.fired: baseline                   0.376
## randomForest.fired: * hours = 42               0.239
## randomForest.fired: * evaluation = 2           0.060
## randomForest.fired: * salary = 2              -0.253
## randomForest.fired: * age = 58                 0.086
## randomForest.fired: * gender = male            0.255
## randomForest.fired: prediction                 0.762
## randomForest.ok: baseline                      0.275
## randomForest.ok: * hours = 42                 -0.050
## randomForest.ok: * evaluation = 2              0.095
## randomForest.ok: * salary = 2                  0.252
## randomForest.ok: * age = 58                   -0.081
## randomForest.ok: * gender = male              -0.255
## randomForest.ok: prediction                    0.236
## randomForest.promoted: baseline                0.350
## randomForest.promoted: * hours = 42           -0.189
## randomForest.promoted: * evaluation = 2       -0.154
## randomForest.promoted: * salary = 2            0.001
## randomForest.promoted: * age = 58             -0.005
## randomForest.promoted: * gender = male         0.000
## randomForest.promoted: prediction              0.002
## baseline:  0</code></pre>
<p>The generic <code>plot()</code> function creates a Break Down plots.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">plot</span>(bd_rf) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Add the <code>plot_distributions = TRUE</code> argument to enrich model response with additional information.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">plot</span>(bd_rf, <span class="dt">plot_distributions =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-breakDown">
<p>Biecek, Przemyslaw. 2018a. <em>BreakDown: Model Agnostic Explainers for Individual Predictions</em>. <a href="https://CRAN.R-project.org/package=breakDown">https://CRAN.R-project.org/package=breakDown</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
<div id="ref-R-DALEX">
<p>Biecek, Przemyslaw. 2018c. <em>DALEX: Descriptive mAchine Learning Explanations</em>. <a href="https://pbiecek.github.io/DALEX/">https://pbiecek.github.io/DALEX/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="variableAttributionMethods.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variable-attribution-with-interactions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
