<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-04-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="modelAuditing.html">
<link rel="next" href="appendixes.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_titanic"><i class="fa fa-check"></i><b>2.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>2.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>2.1.3</b> Random forest</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_gbm"><i class="fa fa-check"></i><b>2.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_titanic"><i class="fa fa-check"></i><b>2.1.5</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>2.2</b> Apartment prices</a><ul>
<li class="chapter" data-level="2.2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_apartments"><i class="fa fa-check"></i><b>2.2.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_lr"><i class="fa fa-check"></i><b>2.2.2</b> Linear regression</a></li>
<li class="chapter" data-level="2.2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_rf"><i class="fa fa-check"></i><b>2.2.3</b> Random forest</a></li>
<li class="chapter" data-level="2.2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_apartments"><i class="fa fa-check"></i><b>2.2.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>2.3</b> Hire or fire</a><ul>
<li class="chapter" data-level="2.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#exploration_HR"><i class="fa fa-check"></i><b>2.3.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_mr"><i class="fa fa-check"></i><b>2.3.2</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="2.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_rf"><i class="fa fa-check"></i><b>2.3.3</b> Random forest</a></li>
<li class="chapter" data-level="2.3.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_HR"><i class="fa fa-check"></i><b>2.3.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModels"><i class="fa fa-check"></i><b>2.4</b> List of models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>4</b> Ceteris-paribus Profiles - a Tool for What-If Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>4.3</b> Method</a></li>
<li class="chapter" data-level="4.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>4.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="4.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>4.5</b> Pros and cons</a></li>
<li class="chapter" data-level="4.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>4.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>5</b> Ceteris Paribus Oscillations - a Tool for Local Variable-importance</a><ul>
<li class="chapter" data-level="5.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>5.2</b> Intuition</a></li>
<li class="chapter" data-level="5.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>5.3</b> Method</a></li>
<li class="chapter" data-level="5.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>5.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="5.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>5.5</b> Pros and cons</a></li>
<li class="chapter" data-level="5.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>5.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>6</b> Ceteris-Paribus 2D Profiles - a tool for pairwise interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#intuition"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#method"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#pros-and-cons"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#code-snippets-for-r"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>7</b> Local diagnostic with Ceteris-Paribus profiles</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#intuition-1"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#method-1"><i class="fa fa-check"></i><b>7.3</b> Method</a><ul>
<li class="chapter" data-level="7.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#nearest-neighbors"><i class="fa fa-check"></i><b>7.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="7.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#profiles-for-neighbors"><i class="fa fa-check"></i><b>7.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="7.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#residuals"><i class="fa fa-check"></i><b>7.3.3</b> Residuals</a></li>
<li class="chapter" data-level="7.3.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#local-fidelity-plot"><i class="fa fa-check"></i><b>7.3.4</b> Local Fidelity Plot</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#pros-and-cons-1"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#start-with-ceteris-paribus-profile"><i class="fa fa-check"></i><b>7.5.1</b> Start with Ceteris Paribus Profile</a></li>
<li class="chapter" data-level="7.5.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-profiles-for-neighbors"><i class="fa fa-check"></i><b>7.5.2</b> Add profiles for neighbors</a></li>
<li class="chapter" data-level="7.5.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-residuals-for-neighbors"><i class="fa fa-check"></i><b>7.5.3</b> Add residuals for neighbors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>8</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="8.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-2"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method-2"><i class="fa fa-check"></i><b>8.3</b> Method</a></li>
<li class="chapter" data-level="8.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>8.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="8.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-2"><i class="fa fa-check"></i><b>8.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="8.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>8.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>9</b> BreakDown for Additive Variable Attributions</a><ul>
<li class="chapter" data-level="9.1" data-path="breakDown.html"><a href="breakDown.html#intuition-3"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="breakDown.html"><a href="breakDown.html#method-3"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="breakDown.html"><a href="breakDown.html#example-titanic-data"><i class="fa fa-check"></i><b>9.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-3"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>10</b> iBreakDown for Variable Attributions with Interactions</a><ul>
<li class="chapter" data-level="10.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-4"><i class="fa fa-check"></i><b>10.1</b> Intuition</a></li>
<li class="chapter" data-level="10.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-4"><i class="fa fa-check"></i><b>10.2</b> Method</a><ul>
<li class="chapter" data-level="10.2.1" data-path="iBreakDown.html"><a href="iBreakDown.html#single-step-contributions"><i class="fa fa-check"></i><b>10.2.1</b> Single step contributions</a></li>
<li class="chapter" data-level="10.2.2" data-path="iBreakDown.html"><a href="iBreakDown.html#two-steps-contributions"><i class="fa fa-check"></i><b>10.2.2</b> Two steps contributions</a></li>
<li class="chapter" data-level="10.2.3" data-path="iBreakDown.html"><a href="iBreakDown.html#sequential-contributions"><i class="fa fa-check"></i><b>10.2.3</b> Sequential contributions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-titanic"><i class="fa fa-check"></i><b>10.3</b> Example: Titanic</a></li>
<li class="chapter" data-level="10.4" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-4"><i class="fa fa-check"></i><b>10.4</b> Pros and cons</a></li>
<li class="chapter" data-level="10.5" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>10.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>11</b> SHapley Additive exPlanations for Average Variable Attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="shapley.html"><a href="shapley.html#intuition-5"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="shapley.html"><a href="shapley.html#method-5"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="shapley.html"><a href="shapley.html#titanic"><i class="fa fa-check"></i><b>11.3</b> Titanic</a></li>
<li class="chapter" data-level="11.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-5"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>12</b> LIME for local model approximation</a><ul>
<li class="chapter" data-level="12.1" data-path="LIME.html"><a href="LIME.html#intuition-6"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="LIME.html"><a href="LIME.html#method-6"><i class="fa fa-check"></i><b>12.2</b> Method</a></li>
<li class="chapter" data-level="12.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire"><i class="fa fa-check"></i><b>12.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="12.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-6"><i class="fa fa-check"></i><b>12.4</b> Pros and cons</a></li>
<li class="chapter" data-level="12.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-5"><i class="fa fa-check"></i><b>12.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="12.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>12.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="12.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>12.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="12.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>12.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>13</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="13.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>13.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="champion-challenger-explainers.html"><a href="champion-challenger-explainers.html"><i class="fa fa-check"></i><b>14</b> Champion-Challenger explainers</a></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="15" data-path="introduction-4.html"><a href="introduction-4.html"><i class="fa fa-check"></i><b>15</b> Introduction</a><ul>
<li class="chapter" data-level="15.1" data-path="introduction-4.html"><a href="introduction-4.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>15.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="15.2" data-path="introduction-4.html"><a href="introduction-4.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>15.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>16</b> Feature Importance</a><ul>
<li class="chapter" data-level="16.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>16.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="16.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic-1"><i class="fa fa-check"></i><b>16.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="16.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>16.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="16.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>16.4</b> More models</a></li>
<li class="chapter" data-level="16.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>16.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>17</b> Feature effects</a><ul>
<li class="chapter" data-level="17.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>17.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>18</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="18.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>18.1</b> Definition</a></li>
<li class="chapter" data-level="18.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>18.2</b> Estimation</a></li>
<li class="chapter" data-level="18.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>18.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="18.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>18.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="18.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>18.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>19</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
<li class="chapter" data-level="19.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>19.2</b> Estimation</a></li>
<li class="chapter" data-level="19.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>19.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>20</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="20.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>20.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>21</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="22" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>22</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="23" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>23</b> Other topics</a></li>
<li class="chapter" data-level="24" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>24</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="25" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>25</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="26" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>26</b> Concept Drift</a><ul>
<li class="chapter" data-level="26.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-5"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>26.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="26.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>26.3</b> Code snippets</a></li>
<li class="chapter" data-level="26.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>26.4</b> Residual Drift</a></li>
<li class="chapter" data-level="26.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>26.5</b> Code snippets</a></li>
<li class="chapter" data-level="26.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>26.6</b> Model Drift</a></li>
<li class="chapter" data-level="26.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>26.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="27" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>27</b> Data Sets</a><ul>
<li class="chapter" data-level="27.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>27.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>28</b> Packages</a><ul>
<li class="chapter" data-level="28.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>28.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="concept-drift" class="section level1">
<h1><span class="header-section-number">Chapter 26</span> Concept Drift</h1>
<p>Machine learning models are often fitted and validated on historical data under silent assumption that data are stationary. The most popular techniques for validation (k-fold cross-validation, repeated cross-validation, and so on) test models on data with the same distribution as training data.</p>
<p>Yet, in many practical applications, deployed models are working in a changing environment. After some time, due to changes in the environment, model performance may degenerate, as model may be less reliable.</p>
<p>Concept drift refers to the change in the data distribution or in the relationships between variables over time. Think about model for energy consumption for a school, over time the school may be equipped with larger number of devices of with more power-efficient devices that may affect the model performance.</p>
<p>In this chapter we define basic ideas behind concept drift and propose some solutions.</p>
<div id="introduction-5" class="section level2">
<h2><span class="header-section-number">26.1</span> Introduction</h2>
<p>In general, concept drift means that some statistical properties of variables used in the model change over time. This may result in degenerated performance. Thus the early detection of concept drift is very important, as it is needed to adapt quickly to these changes.</p>
<p>The term <code>concept</code> usually refers to target variable, but generally, it can also refer to model input of relations between variables.</p>
<p>The most general formulation of a concept drift refers to changes in joint distribution of <span class="math inline">\(p(X, y)\)</span>. It is useful to define also following measures.</p>
<ul>
<li>Conditional Covariate Drift as change in <span class="math inline">\(p(X | y)\)</span></li>
<li>Conditional Class Drift as change in <span class="math inline">\(p(y | X)\)</span></li>
<li>Covariate Drift or Concept Shift as changes in <span class="math inline">\(p(X)\)</span></li>
</ul>
<p>Once the drift is detected one may re-fit the model on newer data or update the model.</p>
</div>
<div id="covariate-drift" class="section level2">
<h2><span class="header-section-number">26.2</span> Covariate Drift</h2>
<p>Covariate Drift is a change in distribution of input, change in the distribution of <span class="math inline">\(p(X)\)</span>. The input is a <span class="math inline">\(p\)</span>-dimensional vector with variables of possible mixed types and distributions.</p>
<p>Here we propose a simple one-dimensional method, that can be applied to each variable separately despite of its type. We do not rely on any formal statistical test, as the power of the test depends on sample size and for large samples the test will detect even small differences.</p>
<p>We also consider an use-case for two samples. One sample gathers historical ,,old’’ data, this may be data available during the model development (part of it may be used as training and part as test data). Second sample is the current ,,new’’ data, and we want to know is the distribution of <span class="math inline">\(X_{old}\)</span> differs from the distribution of <span class="math inline">\(X_{new}\)</span>.</p>
<p>There is a lot of distances between probability measures that can be used here (as for example Wasserstein, Total Variation and so on). We are using the Non-Intersection Distance due to its easy interpretation.</p>
<p>For categorical variables <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span> non-intersection distance is defined as
<span class="math display">\[
d(P,Q) = 1 - \sum_{i\in \mathcal X} \min(p_i, q_i)
\]</span>
where <span class="math inline">\(\mathcal X\)</span> is a set of all possible values while <span class="math inline">\(p_i\)</span> and <span class="math inline">\(q_i\)</span> are probabilities for these values in distribution <span class="math inline">\(P\)</span> and <span class="math inline">\(Q\)</span> respectively. An intuition behind this distance is that it’s amount of the distribution <span class="math inline">\(P\)</span> that is not shared with <span class="math inline">\(Q\)</span> (it’s symmetric). The smaller the value the closes are these distributions.</p>
<p>For continuous variables we discretize their distribution in the spirit of <span class="math inline">\(\chi^2\)</span> test.</p>
</div>
<div id="code-snippets-2" class="section level2">
<h2><span class="header-section-number">26.3</span> Code snippets</h2>
<p>Here we are going to use the <code>drifter</code> package that implements some tools for concept drift detection.</p>
<p>As an illustration we use two datasets from the <code>DALEX2</code> package, namely <code>apartments</code> (here we do not have drift) and <code>dragons</code> (here we do have drift).</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX2&quot;</span>)</a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;drifter&quot;</span>)</a>
<a class="sourceLine" id="cb166-3" data-line-number="3"></a>
<a class="sourceLine" id="cb166-4" data-line-number="4"><span class="co"># here we do not have any drift</span></a>
<a class="sourceLine" id="cb166-5" data-line-number="5"><span class="kw">head</span>(apartments, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   m2.price construction.year surface floor no.rooms    district
## 1     5897              1953      25     3        1 Srodmiescie
## 2     1818              1992     143     9        5     Bielany</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">calculate_covariate_drift</span>(apartments, apartments_test)</a>
<a class="sourceLine" id="cb168-2" data-line-number="2">d</a></code></pre></div>
<pre><code>##                   Variable  Shift
##   -------------------------------------
##                   m2.price    4.9  
##          construction.year    6.0  
##                    surface    6.8  
##                      floor    4.9  
##                   no.rooms    2.8  
##                   district    2.6</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="co"># here we do have drift</span></a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="kw">head</span>(dragons, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
##   number_of_lost_teeth life_length
## 1                   25    1368.433
## 2                   28    1377.047</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">calculate_covariate_drift</span>(dragons, dragons_test)</a>
<a class="sourceLine" id="cb172-2" data-line-number="2">d</a></code></pre></div>
<pre><code>##                   Variable  Shift
##   -------------------------------------
##              year_of_birth    8.9  
##                     height   15.3  .
##                     weight   14.7  .
##                      scars    4.6  
##                     colour   17.9  .
##          year_of_discovery   97.5  ***
##       number_of_lost_teeth    6.3  
##                life_length    8.6</code></pre>
</div>
<div id="residual-drift" class="section level2">
<h2><span class="header-section-number">26.4</span> Residual Drift</h2>
<p>Perhaps the most obvious negative effect of the concept drift is that the model performance degrades over time.</p>
<p>But this is also something that is straightforward to verify. One can calculate distribution of residuals on new data and compare this distribution with residuals obtained on old data.</p>
<p>Again, we have two samples, residuals calculated on the old dataset</p>
<p><span class="math display">\[
r_{old} = y_{old} - \hat y_{old} = y_{old} - f_{old}(X_{old})
\]</span>
versus residuals calculated on the new dataset
<span class="math display">\[
r_{new} = y_{new} - \hat y_{new} = y_{new} - f_{old}(X_{new})
\]</span></p>
<p>We can use any distance between distributions to compare <span class="math inline">\(r_{new}\)</span> and <span class="math inline">\(r_{old}\)</span>, for example the non-intersection distance.</p>
</div>
<div id="code-snippets-3" class="section level2">
<h2><span class="header-section-number">26.5</span> Code snippets</h2>
<p>Here we are going to use the <code>drifter</code> package.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX2&quot;</span>)</a>
<a class="sourceLine" id="cb174-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;drifter&quot;</span>)</a>
<a class="sourceLine" id="cb174-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;ranger&quot;</span>)</a>
<a class="sourceLine" id="cb174-4" data-line-number="4"></a>
<a class="sourceLine" id="cb174-5" data-line-number="5">data_old &lt;-<span class="st"> </span>apartments_test[<span class="dv">1</span><span class="op">:</span><span class="dv">4000</span>,]</a>
<a class="sourceLine" id="cb174-6" data-line-number="6">data_new &lt;-<span class="st"> </span>apartments_test[<span class="dv">4001</span><span class="op">:</span><span class="dv">8000</span>,]</a>
<a class="sourceLine" id="cb174-7" data-line-number="7"></a>
<a class="sourceLine" id="cb174-8" data-line-number="8">predict_function &lt;-<span class="st"> </span><span class="cf">function</span>(m,x,...) <span class="kw">predict</span>(m, x, ...)<span class="op">$</span>predictions</a>
<a class="sourceLine" id="cb174-9" data-line-number="9">model_old &lt;-<span class="st"> </span><span class="kw">ranger</span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> apartments)</a>
<a class="sourceLine" id="cb174-10" data-line-number="10"><span class="kw">calculate_residuals_drift</span>(model_old,</a>
<a class="sourceLine" id="cb174-11" data-line-number="11">                      data_old, data_new,</a>
<a class="sourceLine" id="cb174-12" data-line-number="12">                      data_old<span class="op">$</span>m2.price, </a>
<a class="sourceLine" id="cb174-13" data-line-number="13">                      data_new<span class="op">$</span>m2.price,</a>
<a class="sourceLine" id="cb174-14" data-line-number="14">                      <span class="dt">predict_function =</span> predict_function)</a></code></pre></div>
<pre><code>##                   Variable  Shift
##   -------------------------------------
##                  Residuals    3.9</code></pre>
</div>
<div id="model-drift" class="section level2">
<h2><span class="header-section-number">26.6</span> Model Drift</h2>
<p>Model Drift is a change in the relation between target variable and input variables, change in <span class="math inline">\(p(y|X)\)</span>. The input is a <span class="math inline">\(p\)</span>-dimensional vector with variables of possible mixed types and distributions.</p>
<p>Here we propose a simple one-dimensional method based on Partial Dependency Plots introduced in the Chapter <a href="#partialDependence"><strong>??</strong></a>. PDP profiles summaries marginal relation between <span class="math inline">\(\hat y\)</span> and variable <span class="math inline">\(x_i\)</span>. The idea behind concept drift is to compare two models, the old model <span class="math inline">\(f_{old}\)</span> and model refitted on the new data <span class="math inline">\(f_{new}\)</span> and compare these models through PDP profiles.</p>
<p>For each variable we can obtain scores for drift calculated as <span class="math inline">\(L_2\)</span> distance between PDP profiles for both models.</p>
<p><span class="math display">\[
drift_{i} = \frac 1 {|Z_i|}\int_{z\in Z_i} (PDP_i(f_{old}) - PDP_i(f_{new}))^2 dz
\]</span>
where <span class="math inline">\(Z_i\)</span> is the set of values for variable <span class="math inline">\(x_i\)</span> (for simplicity we assume that it’s an interval) while <span class="math inline">\(PDP_i(f_{new})\)</span> is the PDP profile for variable <span class="math inline">\(i\)</span> calculated for the model <span class="math inline">\(f_{new}\)</span>.</p>
</div>
<div id="code-snippets-4" class="section level2">
<h2><span class="header-section-number">26.7</span> Code snippets</h2>
<p>Here we are going to use the <code>drifter</code> package.
Instead of using <code>old</code> and <code>new</code> data here we compare model trained on data with males versus new dataset that contain data for females.</p>
<p>But, because of the interaction of gender and age, models created on these two datasets are different.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX2&quot;</span>)</a>
<a class="sourceLine" id="cb176-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;drifter&quot;</span>)</a>
<a class="sourceLine" id="cb176-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;ranger&quot;</span>)</a>
<a class="sourceLine" id="cb176-4" data-line-number="4"></a>
<a class="sourceLine" id="cb176-5" data-line-number="5">predict_function &lt;-<span class="st"> </span><span class="cf">function</span>(m,x,...) <span class="kw">predict</span>(m, x, ..., <span class="dt">probability=</span><span class="ot">TRUE</span>)<span class="op">$</span>predictions[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb176-6" data-line-number="6">data_old =<span class="st"> </span>HR[HR<span class="op">$</span>gender <span class="op">==</span><span class="st"> &quot;male&quot;</span>, <span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb176-7" data-line-number="7">data_new =<span class="st"> </span>HR[HR<span class="op">$</span>gender <span class="op">==</span><span class="st"> &quot;female&quot;</span>, <span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb176-8" data-line-number="8">model_old &lt;-<span class="st"> </span><span class="kw">ranger</span>(status <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data_old, <span class="dt">probability =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb176-9" data-line-number="9">model_new &lt;-<span class="st"> </span><span class="kw">ranger</span>(status <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data_new, <span class="dt">probability =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb176-10" data-line-number="10"><span class="kw">calculate_model_drift</span>(model_old, model_new,</a>
<a class="sourceLine" id="cb176-11" data-line-number="11">                 HR_test,</a>
<a class="sourceLine" id="cb176-12" data-line-number="12">                 HR_test<span class="op">$</span>status <span class="op">==</span><span class="st"> &quot;fired&quot;</span>,</a>
<a class="sourceLine" id="cb176-13" data-line-number="13">                 <span class="dt">max_obs =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb176-14" data-line-number="14">                 <span class="dt">predict_function =</span> predict_function)</a>
<a class="sourceLine" id="cb176-15" data-line-number="15"></a>
<a class="sourceLine" id="cb176-16" data-line-number="16"><span class="kw">library</span>(<span class="st">&quot;ceterisParibus2&quot;</span>)</a>
<a class="sourceLine" id="cb176-17" data-line-number="17">prof_old &lt;-<span class="st"> </span><span class="kw">individual_variable_profile</span>(model_old,</a>
<a class="sourceLine" id="cb176-18" data-line-number="18">                 <span class="dt">data =</span> data_new,</a>
<a class="sourceLine" id="cb176-19" data-line-number="19">                 <span class="dt">new_observation =</span> data_new[<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>,],</a>
<a class="sourceLine" id="cb176-20" data-line-number="20">                 <span class="dt">label =</span> <span class="st">&quot;model_old&quot;</span>,</a>
<a class="sourceLine" id="cb176-21" data-line-number="21">                 <span class="dt">predict_function =</span> predict_function)</a>
<a class="sourceLine" id="cb176-22" data-line-number="22">prof_new &lt;-<span class="st"> </span><span class="kw">individual_variable_profile</span>(model_new,</a>
<a class="sourceLine" id="cb176-23" data-line-number="23">                 <span class="dt">data =</span> data_new,</a>
<a class="sourceLine" id="cb176-24" data-line-number="24">                 <span class="dt">new_observation =</span> data_new[<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>,],</a>
<a class="sourceLine" id="cb176-25" data-line-number="25">                 <span class="dt">label =</span> <span class="st">&quot;model_new&quot;</span>,</a>
<a class="sourceLine" id="cb176-26" data-line-number="26">                 <span class="dt">predict_function =</span> predict_function)</a>
<a class="sourceLine" id="cb176-27" data-line-number="27"><span class="kw">plot</span>(prof_old, prof_new,</a>
<a class="sourceLine" id="cb176-28" data-line-number="28">     <span class="dt">variables =</span> <span class="st">&quot;age&quot;</span>, <span class="dt">aggregate_profiles =</span> mean,</a>
<a class="sourceLine" id="cb176-29" data-line-number="29">     <span class="dt">show_observations =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> <span class="st">&quot;_label_&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modelAuditing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendixes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
