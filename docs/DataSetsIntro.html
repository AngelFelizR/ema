<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-04-18">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="instance-level-explanation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration"><i class="fa fa-check"></i><b>2.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>2.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>2.1.3</b> Random forest</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#gradient-boosting"><i class="fa fa-check"></i><b>2.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_titanic"><i class="fa fa-check"></i><b>2.1.5</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>2.2</b> Apartment prices</a><ul>
<li class="chapter" data-level="2.2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration-1"><i class="fa fa-check"></i><b>2.2.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_lr"><i class="fa fa-check"></i><b>2.2.2</b> Linear regression</a></li>
<li class="chapter" data-level="2.2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_rf"><i class="fa fa-check"></i><b>2.2.3</b> Random forest</a></li>
<li class="chapter" data-level="2.2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_apartments"><i class="fa fa-check"></i><b>2.2.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>2.3</b> Hire or fire</a><ul>
<li class="chapter" data-level="2.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_mr"><i class="fa fa-check"></i><b>2.3.1</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="2.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_rf"><i class="fa fa-check"></i><b>2.3.2</b> Random forest</a></li>
<li class="chapter" data-level="2.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_HR"><i class="fa fa-check"></i><b>2.3.3</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModels"><i class="fa fa-check"></i><b>2.4</b> List of models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>4</b> Ceteris Paribus Profiles - a tool for What-If analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#method"><i class="fa fa-check"></i><b>4.3</b> Method</a></li>
<li class="chapter" data-level="4.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>5</b> Ceteris Paribus Oscillations - a tool for local variable importance</a><ul>
<li class="chapter" data-level="5.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#intuition-1"><i class="fa fa-check"></i><b>5.2</b> Intuition</a></li>
<li class="chapter" data-level="5.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#method-1"><i class="fa fa-check"></i><b>5.3</b> Method</a></li>
<li class="chapter" data-level="5.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>5.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>6</b> Ceteris-Paribus 2D Profiles - a tool for pairwise interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#intuition-2"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#method-2"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#pros-and-cons-2"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>7</b> Local diagnostic with Ceteris-Paribus profiles</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#intuition-3"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#method-3"><i class="fa fa-check"></i><b>7.3</b> Method</a><ul>
<li class="chapter" data-level="7.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#nearest-neighbors"><i class="fa fa-check"></i><b>7.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="7.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#profiles-for-neighbors"><i class="fa fa-check"></i><b>7.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="7.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#residuals"><i class="fa fa-check"></i><b>7.3.3</b> Residuals</a></li>
<li class="chapter" data-level="7.3.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#local-fidelity-plot"><i class="fa fa-check"></i><b>7.3.4</b> Local Fidelity Plot</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#pros-and-cons-3"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#start-with-ceteris-paribus-profile"><i class="fa fa-check"></i><b>7.5.1</b> Start with Ceteris Paribus Profile</a></li>
<li class="chapter" data-level="7.5.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-profiles-for-neighbors"><i class="fa fa-check"></i><b>7.5.2</b> Add profiles for neighbors</a></li>
<li class="chapter" data-level="7.5.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-residuals-for-neighbors"><i class="fa fa-check"></i><b>7.5.3</b> Add residuals for neighbors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>8</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="8.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-4"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method-4"><i class="fa fa-check"></i><b>8.3</b> Method</a></li>
<li class="chapter" data-level="8.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>8.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="8.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-4"><i class="fa fa-check"></i><b>8.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="8.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>8.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>9</b> Variable attributions</a><ul>
<li class="chapter" data-level="9.1" data-path="breakDown.html"><a href="breakDown.html#intuition-5"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="breakDown.html"><a href="breakDown.html#method-5"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>9.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="9.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-5"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>10</b> Variable attribution with interactions</a><ul>
<li class="chapter" data-level="10.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-6"><i class="fa fa-check"></i><b>10.1</b> Intuition</a></li>
<li class="chapter" data-level="10.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-6"><i class="fa fa-check"></i><b>10.2</b> Method</a></li>
<li class="chapter" data-level="10.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>10.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="10.4" data-path="iBreakDown.html"><a href="iBreakDown.html#break-down-plots"><i class="fa fa-check"></i><b>10.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="10.5" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-6"><i class="fa fa-check"></i><b>10.5</b> Pros and cons</a></li>
<li class="chapter" data-level="10.6" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-5"><i class="fa fa-check"></i><b>10.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>11</b> Average variable attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="shapley.html"><a href="shapley.html#intuition-7"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="shapley.html"><a href="shapley.html#method-7"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>11.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="11.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-7"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-6"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>12</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="12.1" data-path="LIME.html"><a href="LIME.html#intuition-8"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="LIME.html"><a href="LIME.html#method-8"><i class="fa fa-check"></i><b>12.2</b> Method</a></li>
<li class="chapter" data-level="12.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>12.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="12.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-8"><i class="fa fa-check"></i><b>12.4</b> Pros and cons</a></li>
<li class="chapter" data-level="12.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-7"><i class="fa fa-check"></i><b>12.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="12.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>12.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="12.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>12.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="12.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>12.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>13</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="13.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>13.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="14" data-path="introduction-6.html"><a href="introduction-6.html"><i class="fa fa-check"></i><b>14</b> Introduction</a><ul>
<li class="chapter" data-level="14.1" data-path="introduction-6.html"><a href="introduction-6.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>14.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="14.2" data-path="introduction-6.html"><a href="introduction-6.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>14.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>15</b> Feature Importance</a><ul>
<li class="chapter" data-level="15.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>15.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="15.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic"><i class="fa fa-check"></i><b>15.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="15.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>15.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="15.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>15.4</b> More models</a></li>
<li class="chapter" data-level="15.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>15.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>16</b> Feature effects</a><ul>
<li class="chapter" data-level="16.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>16.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>17</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="17.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>17.1</b> Definition</a></li>
<li class="chapter" data-level="17.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>17.2</b> Estimation</a></li>
<li class="chapter" data-level="17.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>17.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="17.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>17.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="17.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>17.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>18</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="18.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>18.1</b> Definition</a></li>
<li class="chapter" data-level="18.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>18.2</b> Estimation</a></li>
<li class="chapter" data-level="18.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>18.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>19</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>20</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="21" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>21</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="22" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>22</b> Other topics</a></li>
<li class="chapter" data-level="23" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>23</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="24" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>24</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="25" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>25</b> Concept Drift</a><ul>
<li class="chapter" data-level="25.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-7"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>25.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="25.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>25.3</b> Code snippets</a></li>
<li class="chapter" data-level="25.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>25.4</b> Residual Drift</a></li>
<li class="chapter" data-level="25.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>25.5</b> Code snippets</a></li>
<li class="chapter" data-level="25.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>25.6</b> Model Drift</a></li>
<li class="chapter" data-level="25.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>25.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="26" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>26</b> Data Sets</a><ul>
<li class="chapter" data-level="26.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>26.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>27</b> Packages</a><ul>
<li class="chapter" data-level="27.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>27.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="DataSetsIntro" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Data Sets</h1>
<p>We illustrate the techniques presented in this book by using three datasets:</p>
<ul>
<li><em>Sinking of the RMS Titanic</em></li>
<li><em>Apartment prices</em></li>
<li><em>Hire or Fire</em></li>
</ul>
<p>The first dataset will be used to illustrate the application of the techniques in the case of a predictive model for a binary dependent variable. The second one will provide an example for models for a continuous variable. Finally, the third dataset will be used for illustration of models for a categorical dependent variable.</p>
<p>In this chapter, we provide a short description of each of the datasets, together with results of exploratory analyses. We also introduce models that will be used for illustration purposes in subsequent chapters.</p>
<div id="TitanicDataset" class="section level2">
<h2><span class="header-section-number">2.1</span> Sinking of the RMS Titanic</h2>
<div class="figure">
<img src="figure/Titanic.jpg" alt="Titanic sinking by Willy Stöwer" />
<p class="caption">Titanic sinking by Willy Stöwer</p>
</div>
<p>Sinking of the RMS Titanic is one of the deadliest maritime disasters in history (during peacetime). Over 1500 people died as a consequence of collision with an iceberg. Projects like <em>Encyclopedia titanica</em> <code>https://www.encyclopedia-titanica.org/</code> are a source of rich and precise data about Titanic’s passengers. The data are available in a dataset included in the <code>stablelearner</code> package. The dataset, after some data cleaning and variable transformations, is also avaliable in the <code>DALEX</code> package. In particular, the `titanic’ data frame contains 2207 observations (for 1317 passengers and 890 crew members) and nine variables:</p>
<ul>
<li><em>gender</em>, person’s (passenger’s or crew member’s) gender, a factor (categorical variable) with two levels (categories)</li>
<li><em>age</em>, person’s age in years, a numerical variable; for adults, the age is given in (integer) years; for children younger than one year, the age is given as <span class="math inline">\(x/12\)</span>, where <span class="math inline">\(x\)</span> is the number of months of child’s age</li>
<li><em>class</em>, the class in which the passenger travelled, or the duty class of a crew member; a factor with seven levels</li>
<li><em>embarked</em>, the harbor in which the person embarked on the ship, a factor with four levels</li>
<li><em>country</em>, person’s home country, a factor with 48 levels</li>
<li><em>fare</em>, the price of the ticket (only available for passengers; 0 for crew members), a numerical variable</li>
<li><em>sibsp</em>, the number of siblings/spouses aboard the ship, a numerical variable</li>
<li><em>parch</em>, the number of parents/children aboard the ship, a numerical variable</li>
<li><em>survived</em>, a factor with two levels indicating whether the person survived or not</li>
</ul>
<p>Models considered for this dataset will use <em>survived</em> as the (binary) dependent variable.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">head</span>(titanic, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   gender age class    embarked       country  fare sibsp parch survived
## 1   male  42   3rd Southampton United States  7.11     0     0       no
## 2   male  13   3rd Southampton United States 20.05     0     2       no</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">str</span>(titanic)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    2207 obs. of  9 variables:
##  $ gender  : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 2 2 1 1 2 2 1 2 2 ...
##  $ age     : num  42 13 16 39 16 25 30 28 27 20 ...
##  $ class   : Factor w/ 7 levels &quot;1st&quot;,&quot;2nd&quot;,&quot;3rd&quot;,..: 3 3 3 3 3 3 2 2 3 3 ...
##  $ embarked: Factor w/ 4 levels &quot;Belfast&quot;,&quot;Cherbourg&quot;,..: 4 4 4 4 4 4 2 2 2 4 ...
##  $ country : Factor w/ 48 levels &quot;Argentina&quot;,&quot;Australia&quot;,..: 44 44 44 15 30 44 17 17 26 16 ...
##  $ fare    : num  7.11 20.05 20.05 20.05 7.13 ...
##  $ sibsp   : num  0 0 1 1 0 0 1 1 0 0 ...
##  $ parch   : num  0 2 1 1 0 0 0 0 0 0 ...
##  $ survived: Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 1 1 1 2 2 2 1 2 2 2 ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">levels</span>(titanic<span class="op">$</span>class)</a></code></pre></div>
<pre><code>## [1] &quot;1st&quot;              &quot;2nd&quot;              &quot;3rd&quot;             
## [4] &quot;deck crew&quot;        &quot;engineering crew&quot; &quot;restaurant staff&quot;
## [7] &quot;victualling crew&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">levels</span>(titanic<span class="op">$</span>embarked)</a></code></pre></div>
<pre><code>## [1] &quot;Belfast&quot;     &quot;Cherbourg&quot;   &quot;Queenstown&quot;  &quot;Southampton&quot;</code></pre>
<div id="data-exploration" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Data exploration</h3>
<p>It is always advisable to explore data before modelling. However, as this book is focused on model exploration, we will limit the data exploration part.</p>
<p>Before exploring the data, we first do some pre-processing. In particular, the value of variables <em>age</em>, <em>country</em>, <em>sibsp</em>, <em>parch</em>, and <em>fare</em> is missing for a limited number of observations (2, 81, 10, 10, and 26, respectively). Analyzing data with missing values is a topic on its own (Little and Rubin 1987; Schafer 1997; Molenberghs and Kenward 2007). An often-used approach is to impute the missing values. Toward this end, multiple imputation should be considered (Schafer 1997; Molenberghs and Kenward 2007; van Buuren 2012). However, given the limited number of missing values and the intended illustrative use of the dataset, we will limit ourselves to, admittedly inferior, single imputation. In particular, we replace the missing <em>age</em> values by the mean of the observed ones, i.e., 30. Missing <em>country</em> will be coded by “X”. For <em>sibsp</em> and <em>parch</em>, we replace the missing values by the most frequently observed value, i.e., 0. Finally, for <em>fare</em>, we use average fare in a give class, 0 for crew, 89 for 1st, 22 for 2nd and 13 for the third class respectively.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># missing age is replaced by average (30)</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">titanic<span class="op">$</span>age[<span class="kw">is.na</span>(titanic<span class="op">$</span>age)] =<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co"># missing country is replaced by &quot;X&quot;</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">titanic<span class="op">$</span>country &lt;-<span class="st"> </span><span class="kw">as.character</span>(titanic<span class="op">$</span>country)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">titanic<span class="op">$</span>country[<span class="kw">is.na</span>(titanic<span class="op">$</span>country)] =<span class="st"> &quot;X&quot;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">titanic<span class="op">$</span>country &lt;-<span class="st"> </span><span class="kw">factor</span>(titanic<span class="op">$</span>country)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"># missing fare is replaced by class average</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">titanic<span class="op">$</span>fare[<span class="kw">is.na</span>(titanic<span class="op">$</span>fare) <span class="op">&amp;</span><span class="st"> </span>titanic<span class="op">$</span>class <span class="op">==</span><span class="st"> &quot;1st&quot;</span>] =<span class="st"> </span><span class="dv">89</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">titanic<span class="op">$</span>fare[<span class="kw">is.na</span>(titanic<span class="op">$</span>fare) <span class="op">&amp;</span><span class="st"> </span>titanic<span class="op">$</span>class <span class="op">==</span><span class="st"> &quot;2nd&quot;</span>] =<span class="st"> </span><span class="dv">22</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">titanic<span class="op">$</span>fare[<span class="kw">is.na</span>(titanic<span class="op">$</span>fare) <span class="op">&amp;</span><span class="st"> </span>titanic<span class="op">$</span>class <span class="op">==</span><span class="st"> &quot;3rd&quot;</span>] =<span class="st"> </span><span class="dv">13</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co"># missing sibsp, parch are replaced by 0</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">titanic<span class="op">$</span>sibsp[<span class="kw">is.na</span>(titanic<span class="op">$</span>sibsp)] =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13">titanic<span class="op">$</span>parch[<span class="kw">is.na</span>(titanic<span class="op">$</span>parch)] =<span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<p>After imputing the missing values, we investigate the association between survival status and the other variables. Figures @ref(titanic_exploration_gender)-@ref(fig:titanic_exploration_fare) present graphically the proportion non- and survivors for different levels of the other variables. The height of the bars (on the y-axis) reflects the marginal distribution (proportions) of the observed levels of the variable. On the other hand, the width of the bars (on the x-axis) provides the information about the proportion of non- and survivors. Note that, to construct the graphs for <em>age</em> and <em>fare</em>, we categorized the range of the observed values.</p>
<p>Figures <a href="DataSetsIntro.html#fig:titanicExplorationGender">2.1</a> and <a href="DataSetsIntro.html#fig:titanicExplorationAge">2.2</a> indicate that the proportion of survivors was larger for females and children below 5 years of age. This is most likely the result of the “women and children first” principle that is often evoked in situations that require evacuation of persons whose life is in danger. The principle can, perhaps, partially explain the trend seen in Figures <a href="DataSetsIntro.html#fig:titanicExplorationParch">2.7</a> and <a href="DataSetsIntro.html#fig:titanicExplorationSibsp">2.8</a>, i.e., a higher proportion of survivors among those with 1-3 parents/children and 1-2 siblings/spouses aboard. Figure <a href="DataSetsIntro.html#fig:titanicExplorationClass">2.3</a> indicates that passengers travelling in the first and second class had a higher chance of survival, perhaps due to the proximity of the location of their cabins to the deck. Interestingly, the proportion of survivors among crew deck was similar to the proportion of the first-class passengers. Figure <a href="DataSetsIntro.html#fig:titanicExplorationFare">2.6</a> shows that the proportion of survivors increased with the fare, which is consistent with the fact that the proportion was higher for passengers travelling in the first and second class. Finally, Figures <a href="DataSetsIntro.html#fig:titanicExplorationEmbarked">2.4</a> and <a href="DataSetsIntro.html#fig:titanicExplorationCountry">2.5</a> do not suggest any noteworthy trends.</p>
<div class="figure" style="text-align: center"><span id="fig:titanicExplorationGender"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationGender-1.png" alt="Survival in different genders for the titanic data." width="70%" />
<p class="caption">
Figure 2.1: Survival in different genders for the titanic data.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:titanicExplorationAge"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationAge-1.png" alt="Survival in different age groups for the titanic data." width="70%" />
<p class="caption">
Figure 2.2: Survival in different age groups for the titanic data.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:titanicExplorationClass"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationClass-1.png" alt="Survival for different classes in the titanic data." width="70%" />
<p class="caption">
Figure 2.3: Survival for different classes in the titanic data.
</p>
</div>
<div class="figure"><span id="fig:titanicExplorationEmbarked"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationEmbarked-1.png" alt="Survival for different port of embarking in the titanic data." width="576" />
<p class="caption">
Figure 2.4: Survival for different port of embarking in the titanic data.
</p>
</div>
<div class="figure"><span id="fig:titanicExplorationCountry"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationCountry-1.png" alt="Survival for different countries in the titanic data." width="576" />
<p class="caption">
Figure 2.5: Survival for different countries in the titanic data.
</p>
</div>
<div class="figure"><span id="fig:titanicExplorationFare"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationFare-1.png" alt="Survival as a function of fare in the titanic data." width="576" />
<p class="caption">
Figure 2.6: Survival as a function of fare in the titanic data.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:titanicExplorationParch"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationParch-1.png" alt="Survival in different numbers of parents/children for the titanic data." width="70%" />
<p class="caption">
Figure 2.7: Survival in different numbers of parents/children for the titanic data.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:titanicExplorationSibsp"></span>
<img src="PM_VEE_files/figure-html/titanicExplorationSibsp-1.png" alt="Survival in different numbers of siblings/spouses for the titanic data." width="70%" />
<p class="caption">
Figure 2.8: Survival in different numbers of siblings/spouses for the titanic data.
</p>
</div>
</div>
<div id="model_titanic_lmr" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Logistic regression</h3>
<p>The dependent variable of interest, <em>survival</em>, is binary. Thus, a natural choice to build a predictive model is logistic regression. We do not consider country as an explanatory variable. As there is no reason to expect a linear relationship between age and odds of survival, we use linear tail-restricted cubic splines, available in the <code>rcs()</code> function of the <code>rms</code> package <span class="citation">(Harrell Jr <a href="#ref-rms">2018</a>)</span>, to model the effect of age. We also do not expect linear relation for the <code>fare</code> variable, but because of it’s skewness we have not used splines for this variable. The results of the model are stored in model-object <code>titanic_lmr_v6</code>, which will be used in subsequent chapters.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;rms&quot;</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1313</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">titanic_lmr_v6 &lt;-<span class="st"> </span><span class="kw">lrm</span>(survived <span class="op">==</span><span class="st"> &quot;yes&quot;</span> <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span><span class="kw">rcs</span>(age) <span class="op">+</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">                   </span>parch <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span><span class="st"> </span>embarked, titanic)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">titanic_lmr_v6</a></code></pre></div>
<pre><code>## Logistic Regression Model
##  
##  lrm(formula = survived == &quot;yes&quot; ~ gender + rcs(age) + class + 
##      sibsp + parch + fare + embarked, data = titanic)
##  
##                         Model Likelihood     Discrimination    Rank Discrim.    
##                            Ratio Test           Indexes           Indexes       
##  Obs           2207    LR chi2     752.06    R2       0.404    C       0.817    
##   FALSE        1496    d.f.            17    g        1.647    Dxy     0.635    
##   TRUE          711    Pr(&gt; chi2) &lt;0.0001    gr       5.191    gamma   0.636    
##  max |deriv| 0.0001                          gp       0.282    tau-a   0.277    
##                                              Brier    0.146                     
##  
##                         Coef    S.E.   Wald Z Pr(&gt;|Z|)
##  Intercept               4.5746 0.5480   8.35 &lt;0.0001 
##  gender=male            -2.7687 0.1586 -17.45 &lt;0.0001 
##  age                    -0.1180 0.0221  -5.35 &lt;0.0001 
##  age&#39;                    0.6313 0.1628   3.88 0.0001  
##  age&#39;&#39;                  -2.6583 0.7840  -3.39 0.0007  
##  age&#39;&#39;&#39;                  2.8977 1.0130   2.86 0.0042  
##  class=2nd              -1.1390 0.2501  -4.56 &lt;0.0001 
##  class=3rd              -2.0627 0.2490  -8.28 &lt;0.0001 
##  class=deck crew         1.0672 0.3498   3.05 0.0023  
##  class=engineering crew -0.9702 0.2648  -3.66 0.0002  
##  class=restaurant staff -3.1712 0.6583  -4.82 &lt;0.0001 
##  class=victualling crew -1.0877 0.2596  -4.19 &lt;0.0001 
##  sibsp                  -0.4504 0.1006  -4.48 &lt;0.0001 
##  parch                  -0.0871 0.0987  -0.88 0.3776  
##  fare                    0.0014 0.0020   0.70 0.4842  
##  embarked=Cherbourg      0.7881 0.2836   2.78 0.0055  
##  embarked=Queenstown     0.2745 0.3409   0.80 0.4208  
##  embarked=Southampton    0.2343 0.2119   1.11 0.2689  
## </code></pre>
</div>
<div id="model_titanic_rf" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Random forest</h3>
<p>As an alternative to a logistic regression model, we consider a random forest model. Random forest is known for good predictive performance, is able to grasp low-level variable interactions, and is quite stable [TOMASZ: REFERENCE?]. To fit the model, we apply the <code>randomForest()</code> function, with default settings, from the package with the same name <span class="citation">(Liaw and Wiener <a href="#ref-randomForestRNews">2002</a>)</span>.</p>
<p>In the first instance, we fit a model with the same set of explanatory variables as the logistic regression model. The results of the model are stored in model-object <code>titanic_rf_v6</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1313</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">titanic_rf_v6 &lt;-<span class="st"> </span><span class="kw">randomForest</span>(survived <span class="op">~</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span><span class="st"> </span>parch <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span><span class="st"> </span>embarked, </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">                           <span class="dt">data =</span> titanic)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">titanic_rf_v6</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = survived ~ class + gender + age + sibsp +      parch + fare + embarked, data = titanic) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 18.62%
## Confusion matrix:
##       no yes class.error
## no  1393 103  0.06885027
## yes  308 403  0.43319269</code></pre>
<p>For comparison purposes, we also consider a model with only three explanatory variables: <em>class</em>, <em>gender</em>, and <em>age</em>. The results of the model are stored in model-object <code>titanic_rf_v3</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">titanic_rf_v3 &lt;-<span class="st"> </span><span class="kw">randomForest</span>(survived <span class="op">~</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age, <span class="dt">data =</span> titanic)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">titanic_rf_v3</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = survived ~ class + gender + age, data = titanic) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 1
## 
##         OOB estimate of  error rate: 21.02%
## Confusion matrix:
##       no yes class.error
## no  1367 129  0.08622995
## yes  335 376  0.47116737</code></pre>
</div>
<div id="gradient-boosting" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Gradient boosting</h3>
<p>Finally, we consider the gradient-boosting model. The model is known for being able to grasp deep interactions between variables. [TOMASZ: WHAT ARE “DEEP INTERACTIONS”? REFERENCE?] We use the same set of explanatory variables as for the logistic regression model. To fit the gradient-boosting model, we use the function <code>gbm()</code> from the <code>gbm</code> package <span class="citation">(Ridgeway <a href="#ref-gbm">2017</a>)</span>. The results of the model are stored in model-object <code>titanic_gbm_v6</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;gbm&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1313</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">titanic_gbm_v6 &lt;-<span class="st"> </span><span class="kw">gbm</span>(survived <span class="op">==</span><span class="st"> &quot;yes&quot;</span> <span class="op">~</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span><span class="st"> </span>parch <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span><span class="st"> </span>embarked, </a>
<a class="sourceLine" id="cb16-5" data-line-number="5">                      <span class="dt">data =</span> titanic, <span class="dt">n.trees =</span> <span class="dv">15000</span>)</a></code></pre></div>
<pre><code>## Distribution not specified, assuming bernoulli ...</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">titanic_gbm_v6</a></code></pre></div>
<pre><code>## gbm(formula = survived == &quot;yes&quot; ~ class + gender + age + sibsp + 
##     parch + fare + embarked, data = titanic, n.trees = 15000)
## A gradient boosted model with bernoulli loss function.
## 15000 iterations were performed.
## There were 7 predictors of which 7 had non-zero influence.</code></pre>
</div>
<div id="predictions_titanic" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Model predictions</h3>
<p>Let us now compare predictions that are obtained from the three different models. In particular, we will compute the predicted probability of survival for an 8-year-old boy who embarked in Belfast and travelled in the 2nd class with no parents nor siblings with a ticket costing 72 pounds. First, we create a data frame <code>henry</code> that contains the data describing the passenger.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">henry &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">            <span class="dt">class =</span> <span class="kw">factor</span>(<span class="st">&quot;2nd&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1st&quot;</span>, <span class="st">&quot;2nd&quot;</span>, <span class="st">&quot;3rd&quot;</span>, <span class="st">&quot;deck crew&quot;</span>, <span class="st">&quot;engineering crew&quot;</span>, <span class="st">&quot;restaurant staff&quot;</span>, <span class="st">&quot;victualling crew&quot;</span>)),</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">            <span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)),</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">            <span class="dt">age =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">            <span class="dt">sibsp =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">            <span class="dt">parch =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">            <span class="dt">fare =</span> <span class="dv">72</span>,</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">            <span class="dt">embarked =</span> <span class="kw">factor</span>(<span class="st">&quot;Belfast&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Belfast&quot;</span>,<span class="st">&quot;Cherbourg&quot;</span>,<span class="st">&quot;Queenstown&quot;</span>,<span class="st">&quot;Southampton&quot;</span>))</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">)</a></code></pre></div>
<p>Subsequently, we use the generic function <code>predict()</code> to get the predicted probability of survival for the logistic regression model.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">(<span class="dt">pred_lmr =</span> <span class="kw">predict</span>(titanic_lmr_v6, henry, <span class="dt">type =</span> <span class="st">&quot;fitted&quot;</span>))</a></code></pre></div>
<pre><code>##         1 
## 0.4556319</code></pre>
<p>The predicted probability is equal to 0.46.</p>
<p>We do the same for the random forest and gradient boosting models.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">(<span class="dt">pred_rf =</span> <span class="kw">predict</span>(titanic_rf_v6, henry, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>))</a></code></pre></div>
<pre><code>##     no  yes
## 1 0.66 0.34
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot; &quot;votes&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">(<span class="dt">pred_gbm =</span> <span class="kw">predict</span>(titanic_gbm_v6, henry, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>, <span class="dt">n.trees =</span> <span class="dv">15000</span>))</a></code></pre></div>
<pre><code>## [1] 0.4169878</code></pre>
<p>As a result, we obtain the predicted probabilities of 0.34 and 0.42, respectively.</p>
<p>The models lead to different probabilities. Thus, it might be of interest to understand the reason for the differences, as it could help us to decide which of the predictions we might want to trust.</p>
</div>
</div>
<div id="ApartmentDataset" class="section level2">
<h2><span class="header-section-number">2.2</span> Apartment prices</h2>
<div class="figure">
<img src="figure/am1974_flicker.jpg" alt="Warsaw skyscrapers by Artur Malinowski Flicker" />
<p class="caption">Warsaw skyscrapers by Artur Malinowski Flicker</p>
</div>
<p>Predicting house prices is a common exercise used in machine-learning courses. Various datasets for house prices are available at websites like Kaggle (<a href="https://www.kaggle.com" class="uri">https://www.kaggle.com</a>) or UCI Machine Learning Repository (<a href="https://archive.ics.uci.edu" class="uri">https://archive.ics.uci.edu</a>).</p>
<p>In this book we will work with an interesting version of this problem. The <code>apartments</code> dataset is an artificial dataset created to match key characteristics of real apartments in Warszawa, the capital of Poland. However, the dataset is created in a way that two very different models, namely linear regression and random forest, have almost exactly the same accuracy. The natural question is which model should we choose? We will show that the model-explanation tools provide important insight into the key model characteristics and are helpful in model selection.</p>
<p>The dataset is available in the <code>DALEX</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a><a href="#ref-R-DALEX">b</a>)</span>. It contains 1000 observations (apartments) and six variables:</p>
<ul>
<li><em>m2.price</em>, apatments price per meter-squared (in EUR), a numerical variable</li>
<li><em>construction.year</em>, the year of construction of the block of flats in which the apartment is located, a numerical variable</li>
<li><em>surface</em>, apartment’s total surface in squared meters, a numerical variable</li>
<li><em>floor</em>, the floor at which the apartment is located (ground floor taken to be the first floor), a numerical integer variable with values from 1 to 10</li>
<li><em>no.rooms</em>, the total number of rooms, a numerical variable with values from 1 to 6</li>
<li><em>distric</em>, a factor with 10 levels indicating tha distric of Warszawa where the apartment is located</li>
</ul>
<p>Models considered for this dataset will use <em>m2.price</em> as the (continuous) dependent variable.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">head</span>(apartments, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##   m2.price construction.year surface floor no.rooms    district
## 1     5897              1953      25     3        1 Srodmiescie
## 2     1818              1992     143     9        5     Bielany</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">str</span>(apartments)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  6 variables:
##  $ m2.price         : num  5897 1818 3643 3517 3013 ...
##  $ construction.year: num  1953 1992 1937 1995 1992 ...
##  $ surface          : num  25 143 56 93 144 61 127 105 145 112 ...
##  $ floor            : int  3 9 1 7 6 6 8 8 6 9 ...
##  $ no.rooms         : num  1 5 2 3 5 2 5 4 6 4 ...
##  $ district         : Factor w/ 10 levels &quot;Bemowo&quot;,&quot;Bielany&quot;,..: 6 2 5 4 3 6 3 7 6 6 ...</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">table</span>(apartments<span class="op">$</span>floor)</a></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6   7   8   9  10 
##  90 116  87  86  95 104 103 103 108 108</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">table</span>(apartments<span class="op">$</span>no.rooms)</a></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6 
##  99 202 231 223 198  47</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">levels</span>(apartments<span class="op">$</span>district)</a></code></pre></div>
<pre><code>##  [1] &quot;Bemowo&quot;      &quot;Bielany&quot;     &quot;Mokotow&quot;     &quot;Ochota&quot;      &quot;Praga&quot;      
##  [6] &quot;Srodmiescie&quot; &quot;Ursus&quot;       &quot;Ursynow&quot;     &quot;Wola&quot;        &quot;Zoliborz&quot;</code></pre>
<p>Model predictions will be obtained for a set of six apartments included in data frame <code>apartments_test</code>, also included in the <code>DALEX</code> package.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">head</span>(apartments_test)</a></code></pre></div>
<pre><code>##      m2.price construction.year surface floor no.rooms    district
## 1001     4644              1976     131     3        5 Srodmiescie
## 1002     3082              1978     112     9        4     Mokotow
## 1003     2498              1958     100     7        4     Bielany
## 1004     2735              1951     112     3        5        Wola
## 1005     2781              1978     102     4        4      Bemowo
## 1006     2936              2001     116     7        4      Bemowo</code></pre>
<div id="data-exploration-1" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Data exploration</h3>
<p>Note that this is artificial dataset created to explain some differences between random forest and linear regression. So the data is more clean than a usual dataset. Nerveless let do some exploration.</p>
<p>Distribution of square meter is slightly skewed.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_exploration_mi2-1.png" alt="(fig:appartments_exploration_mi2) Survival for different countries in the titanic data." width="576" />
<p class="caption">
(#fig:appartments_exploration_mi2)(fig:appartments_exploration_mi2) Survival for different countries in the titanic data.
</p>
</div>
<p>There is some nonlinear (if any) relation between construction year and price.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_mi2_construction-1.png" alt="(fig:appartments_mi2_construction) Construction year vs price per sq meter" width="384" />
<p class="caption">
(#fig:appartments_mi2_construction)(fig:appartments_mi2_construction) Construction year vs price per sq meter
</p>
</div>
<p>There is a sharp linear relation between surface and price.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_mi2_surface-1.png" alt="(fig:appartments_mi2_surface) Surface vs price per sq meter" width="384" />
<p class="caption">
(#fig:appartments_mi2_surface)(fig:appartments_mi2_surface) Surface vs price per sq meter
</p>
</div>
<p>There is a close to linear relation between floor and price.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_mi2_floor-1.png" alt="(fig:appartments_mi2_floor) Floor vs price per sq meter" width="384" />
<p class="caption">
(#fig:appartments_mi2_floor)(fig:appartments_mi2_floor) Floor vs price per sq meter
</p>
</div>
<p>There is a close to linear relation between no of rooms and price. But please note that surface and number of rooms are correlated.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_mi2_norooms-1.png" alt="(fig:appartments_mi2_norooms) No rooms vs price per sq meter" width="384" />
<p class="caption">
(#fig:appartments_mi2_norooms)(fig:appartments_mi2_norooms) No rooms vs price per sq meter
</p>
</div>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_surface_norooms-1.png" alt="(fig:appartments_surface_norooms) No rooms vs surface" width="384" />
<p class="caption">
(#fig:appartments_surface_norooms)(fig:appartments_surface_norooms) No rooms vs surface
</p>
</div>
<p>Prices are different in different districts. Highest are in the Downtown.</p>
<div class="figure">
<img src="PM_VEE_files/figure-html/appartments_mi2_district-1.png" alt="(fig:appartments_mi2_district) District vs price per sq meter" width="576" />
<p class="caption">
(#fig:appartments_mi2_district)(fig:appartments_mi2_district) District vs price per sq meter
</p>
</div>
</div>
<div id="model_apartments_lr" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Linear regression</h3>
<p>The dependent variable of interest, <em>m2.price</em>, is continuous. Thus, a natural choice to build a predictive model is linear regression. We treat all the other variables in the <code>apartments</code> data frame as explanatory and include them in the model. The results of the model are stored in model-object <code>apartments_lm_v5</code>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">apartments_lm_v5 &lt;-<span class="st"> </span><span class="kw">lm</span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> apartments)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">apartments_lm_v5</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = m2.price ~ ., data = apartments)
## 
## Coefficients:
##         (Intercept)    construction.year              surface  
##            5003.248               -0.229              -10.238  
##               floor             no.rooms      districtBielany  
##             -99.482              -37.730               34.106  
##       districtPraga      districtUrsynow       districtBemowo  
##             -20.214               -1.974               16.891  
##       districtUrsus     districtZoliborz      districtMokotow  
##              46.833              906.865              935.271  
##      districtOchota  districtSrodmiescie  
##             943.145             2097.502</code></pre>
</div>
<div id="model_apartments_rf" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Random forest</h3>
<p>As an alternative to linear regression, we consider a random forest model. To fit the model, we apply the <code>randomForest()</code> function, with default settings, from the package with the same name <span class="citation">(Liaw and Wiener <a href="#ref-randomForestRNews">2002</a>)</span>.<br />
The results of the model are stored in model-object <code>apartments_rf_v5</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">72</span>)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">apartments_rf_v5 &lt;-<span class="st"> </span><span class="kw">randomForest</span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> apartments)</a>
<a class="sourceLine" id="cb41-4" data-line-number="4">apartments_rf_v5</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = m2.price ~ ., data = apartments) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 1
## 
##           Mean of squared residuals: 79789.39
##                     % Var explained: 90.28</code></pre>
</div>
<div id="predictions_apartments" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Model predictions</h3>
<p>By aplying the <code>predict()</code> function to model-object <code>apartments_lm_v5</code> with <code>apartments_test</code> as the data frame for which predictions are to be computed, we obtain the predicted prices for the testing set of six apartments for the linear regression model. Subsequently, we compute the mean squared difference between the predicted and actual prices for the test apartments. We repeat the same steps for the random forest model.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">predicted_apartments_lm &lt;-<span class="st"> </span><span class="kw">predict</span>(apartments_lm_v5, apartments_test)</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">rmsd_lm &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((predicted_apartments_lm <span class="op">-</span><span class="st"> </span>apartments_test<span class="op">$</span>m2.price)<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">rmsd_lm</a></code></pre></div>
<pre><code>## [1] 283.0865</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">predicted_apartments_rf &lt;-<span class="st"> </span><span class="kw">predict</span>(apartments_rf_v5, apartments_test)</a>
<a class="sourceLine" id="cb45-3" data-line-number="3">rmsd_rf &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>((predicted_apartments_rf <span class="op">-</span><span class="st"> </span>apartments_test<span class="op">$</span>m2.price)<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb45-4" data-line-number="4">rmsd_rf</a></code></pre></div>
<pre><code>## [1] 795.2587</code></pre>
<p>For the random forest model, the square-root of the mean squared difference is equal to 795.3. It is only minimally smaller than the value of 283.1, obtained for the linear regression model. Thus, the question we may face is: should we choose the model complex, but flexible random-forest model, or the simpler and easier to interpret linear model? In the subsequent chapters we will try to provide an answer to this question.</p>
</div>
</div>
<div id="HFDataset" class="section level2">
<h2><span class="header-section-number">2.3</span> Hire or fire</h2>
<p>Predictive models can be used to support decisions. For instance, they could be used in a human-resources department to decide whether, for instance, promote an employee. An advantage of using a model for this purpose would be the objectivity of the decision, which would not be subject to personal preferences of a manager. However, in such a situation, one would most likely want to understand what influences the model’s prediction.</p>
<p>To illustrate such a situation, we will use the <code>HR</code> dataset that is available in the <code>DALEX</code> package <span class="citation">(Biecek <a href="#ref-R-DALEX">2018</a><a href="#ref-R-DALEX">b</a>)</span>. It is an artificial set of data from a human-resources department of a call center. It contains 7847 observations (employees of the call center) and six variables:</p>
<ul>
<li><em>gender</em>, person’s gender, a factor with two levels</li>
<li><em>age</em>, person’s age in years, a numerical variable</li>
<li><em>hours</em>, average number of working hours per week, a numerical variable</li>
<li><em>evaluation</em>, the last evaluation score, a numerical variable with values 2 (fail), 3 (satisfactory), 4 (good), and 5 (veru good)</li>
<li><em>salary</em>, the salary level, a numerical variable with values from 0 (lowest) to 5 (highest)</li>
<li><em>status</em>, a factor with three indicating whether the employee was fired, retained, or promoted</li>
</ul>
<p>Models considered for this dataset will use <em>status</em> as the (categorical) dependent variable.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw">head</span>(HR, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>##   gender      age    hours evaluation salary status
## 1   male 32.58267 41.88626          3      1  fired
## 2 female 41.21104 36.34339          2      5  fired
## 3   male 37.70516 36.81718          3      0  fired
## 4 female 30.06051 38.96032          3      2  fired</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">str</span>(HR)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    7847 obs. of  6 variables:
##  $ gender    : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 2 1 2 1 2 2 1 2 1 1 ...
##  $ age       : num  32.6 41.2 37.7 30.1 21.1 ...
##  $ hours     : num  41.9 36.3 36.8 39 62.2 ...
##  $ evaluation: num  3 2 3 3 5 2 4 2 2 4 ...
##  $ salary    : num  1 5 0 2 3 0 0 4 4 4 ...
##  $ status    : Factor w/ 3 levels &quot;fired&quot;,&quot;ok&quot;,&quot;promoted&quot;: 1 1 1 1 3 1 3 2 1 3 ...</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">table</span>(HR<span class="op">$</span>evaluation)</a></code></pre></div>
<pre><code>## 
##    2    3    4    5 
## 2371 2272 1661 1543</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">table</span>(HR<span class="op">$</span>salary)</a></code></pre></div>
<pre><code>## 
##    0    1    2    3    4    5 
## 1105 1417 1461 1508 1316 1040</code></pre>
<p>See Figures <a href="DataSetsIntro.html#fig:HRExplorationAge">2.9</a>-<a href="DataSetsIntro.html#fig:HRExplorationEvaluation">2.11</a> for some exploratory analysis.</p>
<p>Young female and old male are being fired more frequently.</p>
<div class="figure" style="text-align: center"><span id="fig:HRExplorationAge"></span>
<img src="PM_VEE_files/figure-html/HRExplorationAge-1.png" alt="HR status for age groups and gender." width="70%" />
<p class="caption">
Figure 2.9: HR status for age groups and gender.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:HRExplorationSalary"></span>
<img src="PM_VEE_files/figure-html/HRExplorationSalary-1.png" alt="HR status for salary groups." width="70%" />
<p class="caption">
Figure 2.10: HR status for salary groups.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:HRExplorationEvaluation"></span>
<img src="PM_VEE_files/figure-html/HRExplorationEvaluation-1.png" alt="HR status for evaluation groups." width="70%" />
<p class="caption">
Figure 2.11: HR status for evaluation groups.
</p>
</div>
<div id="model_HR_mr" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Multinomial logistic regression</h3>
<p>The dependent variable of interest, <em>status</em>, is categorical with three categories. Thus, a simple choice is to consider a multinomial logistic regression model <span class="citation">(Venables and Ripley <a href="#ref-Venables2010">2010</a>)</span>. We fit the model with the help of function <code>multinom</code> from package <code>nnet</code>. The function fits multinomial log-linear models by using the neural-networks approach.We chose this model to have a complex model that is smooth in contrary to random forest that relies on binary splits for continuous variables. We treat all variables other than <code>status</code> in the <code>HR</code> data frame as explanatory and include them in the model. The results of the model are stored in model-object <code>HR_glm_v5</code>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;nnet&quot;</span>)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1313</span>)</a>
<a class="sourceLine" id="cb55-3" data-line-number="3"></a>
<a class="sourceLine" id="cb55-4" data-line-number="4">HR_glm_v5 &lt;-<span class="st"> </span><span class="kw">multinom</span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a></code></pre></div>
<pre><code>## # weights:  21 (12 variable)
## initial  value 8620.810629 
## iter  10 value 7002.127738
## iter  20 value 6239.478146
## iter  20 value 6239.478126
## iter  20 value 6239.478124
## final  value 6239.478124 
## converged</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">HR_glm_v5</a></code></pre></div>
<pre><code>## Call:
## multinom(formula = status ~ gender + age + hours + evaluation + 
##     salary, data = HR)
## 
## Coefficients:
##          (Intercept) gendermale         age      hours  evaluation
## ok         -3.199741 0.05185293 0.001003521 0.06628055 -0.03734345
## promoted  -12.677639 0.11838037 0.003436872 0.16253343  1.26109093
##              salary
## ok       0.01680039
## promoted 0.01507927
## 
## Residual Deviance: 12478.96 
## AIC: 12502.96</code></pre>
</div>
<div id="model_HR_rf" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Random forest</h3>
<p>As an alternative to multinomial logisitc regression, we consider a random forest model. To fit the model, we apply the <code>randomForest()</code> function, with default settings, from the package with the same name <span class="citation">(Liaw and Wiener <a href="#ref-randomForestRNews">2002</a>)</span>.
The results of the model are stored in model-object <code>HR_rf_v5</code>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1313</span>)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3"></a>
<a class="sourceLine" id="cb59-4" data-line-number="4">HR_rf_v5 &lt;-<span class="st"> </span><span class="kw">randomForest</span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a>
<a class="sourceLine" id="cb59-5" data-line-number="5">HR_rf_v5</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = status ~ gender + age + hours + evaluation +      salary, data = HR) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 27.46%
## Confusion matrix:
##          fired   ok promoted class.error
## fired     2270  388      197   0.2049037
## ok         530 1243      448   0.4403422
## promoted   202  390     2179   0.2136413</code></pre>
</div>
<div id="predictions_HR" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Model predictions</h3>
<p>As in previous chapters, we will see how to use models that we have just created.
As s test case we will use a single employee of the call center, let’s name him Dilbert.</p>
<p>Dilbert is a male few years before 60. Working around 40h per week, poor evaluation and average salary.
What are his chances for promotion or survival?</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">dilbert &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)),</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">                <span class="dt">age =</span> <span class="fl">57.7</span>,</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">                <span class="dt">hours =</span> <span class="fl">42.3</span>,</a>
<a class="sourceLine" id="cb61-4" data-line-number="4">                <span class="dt">evaluation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">                <span class="dt">salary =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb61-6" data-line-number="6"></a>
<a class="sourceLine" id="cb61-7" data-line-number="7"><span class="kw">predict</span>(HR_rf_v5, dilbert, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a></code></pre></div>
<pre><code>##   fired    ok promoted
## 1 0.778 0.218    0.004
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot; &quot;votes&quot;</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">predict</span>(HR_glm_v5, dilbert, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a></code></pre></div>
<pre><code>##      fired         ok   promoted 
## 0.56369601 0.40630786 0.02999612</code></pre>
<p>As you see, they are not that high. It’s likely that Dilbert will be fired in the next year. But why? We will try to answer this question in next chapters.</p>
</div>
</div>
<div id="ListOfModels" class="section level2">
<h2><span class="header-section-number">2.4</span> List of models</h2>
<p>In the previous sections we have built several predictive models for different data sets. The models will be used in the rest of the book to illustrate the model explanation methods and tools.</p>
<p>For the ease of reference, we summarize the models in the table below. The binary model-objects can be downloaded by using the attached <code>archivist</code> hooks <span class="citation">(Biecek and Kosinski <a href="#ref-archivist">2017</a>)</span>. By calling a function specified in the last column you will recreate a selected model in your local R environment.</p>
<table>
<colgroup>
<col width="23%" />
<col width="28%" />
<col width="16%" />
<col width="20%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th>Model name</th>
<th>Model generator</th>
<th>Dataset</th>
<th>Variables</th>
<th>Link to the model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>titanic_lmr_v6</code></td>
<td><code>rms:: lmr</code></td>
<td><code>DALEX:: titanic</code></td>
<td>gender, age, class, sibsp, parch, fare, embarked</td>
<td><code>archivist:: aread(&quot;pbiecek/models/ceb40&quot;)</code></td>
</tr>
<tr class="even">
<td><code>titanic_rf_v6</code></td>
<td><code>randomForest:: randomForest</code></td>
<td><code>DALEX:: titanic</code></td>
<td>gender, age, class, sibsp, parch, fare, embarked</td>
<td><code>archivist:: aread(&quot;pbiecek/models/31570&quot;)</code></td>
</tr>
<tr class="odd">
<td><code>titanic_rf_v3</code></td>
<td><code>randomForest:: randomForest</code></td>
<td><code>DALEX:: titanic</code></td>
<td>gender, age, class</td>
<td><code>archivist:: aread(&quot;pbiecek/models/855c1&quot;)</code></td>
</tr>
<tr class="even">
<td><code>titanic_gbm_v6</code></td>
<td><code>gbm:: gbm</code></td>
<td><code>DALEX:: titanic</code></td>
<td>gender, age, class, sibsp, parch, fare, embarked</td>
<td><code>archivist:: aread(&quot;pbiecek/models/24e72&quot;)</code></td>
</tr>
<tr class="odd">
<td><code>apartments_lm_v5</code></td>
<td><code>stats:: lm</code></td>
<td><code>DALEX:: apartments</code></td>
<td>construction .year, surface, floor, no.rooms, district</td>
<td><code>archivist:: aread(&quot;pbiecek/models/55f19&quot;)</code></td>
</tr>
<tr class="even">
<td><code>apartments_rf_v5</code></td>
<td><code>randomForest:: randomForest</code></td>
<td><code>DALEX:: apartments</code></td>
<td>construction .year, surface, floor, no.rooms, district</td>
<td><code>archivist:: aread(&quot;pbiecek/models/fe7a5&quot;)</code></td>
</tr>
<tr class="odd">
<td><code>HR_rf_v5</code></td>
<td><code>randomForest:: randomForest</code></td>
<td><code>DALEX:: HR</code></td>
<td>gender, age, hours, evaluation, salary</td>
<td><code>archivist:: aread(&quot;pbiecek/models/1ecfd&quot;)</code></td>
</tr>
<tr class="even">
<td><code>HR_glm_v5</code></td>
<td><code>stats:: glm</code></td>
<td><code>DALEX:: HR</code></td>
<td>gender, age, hours, evaluation, salary</td>
<td><code>archivist:: aread(&quot;pbiecek/models/f0244&quot;)</code></td>
</tr>
</tbody>
</table>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-rms">
<p>Harrell Jr, Frank E. 2018. <em>Rms: Regression Modeling Strategies</em>. <a href="https://CRAN.R-project.org/package=rms">https://CRAN.R-project.org/package=rms</a>.</p>
</div>
<div id="ref-randomForestRNews">
<p>Liaw, Andy, and Matthew Wiener. 2002. “Classification and Regression by randomForest.” <em>R News</em> 2 (3): 18–22. <a href="https://CRAN.R-project.org/doc/Rnews/">https://CRAN.R-project.org/doc/Rnews/</a>.</p>
</div>
<div id="ref-gbm">
<p>Ridgeway, Greg. 2017. <em>Gbm: Generalized Boosted Regression Models</em>. <a href="https://CRAN.R-project.org/package=gbm">https://CRAN.R-project.org/package=gbm</a>.</p>
</div>
<div id="ref-R-DALEX">
<p>Biecek, Przemyslaw. 2018b. <em>DALEX: Descriptive mAchine Learning Explanations</em>. <a href="https://pbiecek.github.io/DALEX/">https://pbiecek.github.io/DALEX/</a>.</p>
</div>
<div id="ref-Venables2010">
<p>Venables, W. N., and B. D. Ripley. 2010. <em>Modern Applied Statistics with S</em>. Springer Publishing Company, Incorporated.</p>
</div>
<div id="ref-archivist">
<p>Biecek, Przemyslaw, and Marcin Kosinski. 2017. “archivist: An R Package for Managing, Recording and Restoring Data Analysis Results.” <em>Journal of Statistical Software</em> 82 (11): 1–28. <a href="https://doi.org/10.18637/jss.v082.i11">https://doi.org/10.18637/jss.v082.i11</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="instance-level-explanation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
