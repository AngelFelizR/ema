<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visualisation, Exploration and Explanation</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visualisation, Exploration and Explanation" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-02-18">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="breakDown.html">
<link rel="next" href="shapley.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.2</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#how-model-exploration-is-different-from-data-exploration"><i class="fa fa-check"></i><b>1.3</b> How model exploration is different from data exploration?</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.4</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#why-do-we-need-model-explainers"><i class="fa fa-check"></i><b>1.5</b> Why do we need model explainers?</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-lifecycle"><i class="fa fa-check"></i><b>1.6</b> Model lifecycle</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#glossary-notation"><i class="fa fa-check"></i><b>1.8</b> Glossary / Notation</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.9</b> The structure of the book</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.10</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.11" data-path="index.html"><a href="index.html#model-lifecycle-1"><i class="fa fa-check"></i><b>1.11</b> Model lifecycle</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="prediction-level-explanations.html"><a href="prediction-level-explanations.html"><i class="fa fa-check"></i>Prediction level explanations</a></li>
<li class="chapter" data-level="2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#approaches-to-prediction-explanations"><i class="fa fa-check"></i><b>2.1</b> Approaches to prediction explanations</a></li>
<li class="chapter" data-level="2.2" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html#three-single-laws"><i class="fa fa-check"></i><b>2.2</b> A bit of philosophy: Three Laws for Prediction Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>3</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="3.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition"><i class="fa fa-check"></i><b>3.1</b> Intuition</a></li>
<li class="chapter" data-level="3.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method"><i class="fa fa-check"></i><b>3.2</b> Method</a></li>
<li class="chapter" data-level="3.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>3.3</b> Example: Wine quality</a></li>
<li class="chapter" data-level="3.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons"><i class="fa fa-check"></i><b>3.4</b> Pros and Cons</a></li>
<li class="chapter" data-level="3.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>3.5</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>4</b> Variable attributions</a><ul>
<li class="chapter" data-level="4.1" data-path="breakDown.html"><a href="breakDown.html#intuition-1"><i class="fa fa-check"></i><b>4.1</b> Intuition</a></li>
<li class="chapter" data-level="4.2" data-path="breakDown.html"><a href="breakDown.html#method-1"><i class="fa fa-check"></i><b>4.2</b> Method</a></li>
<li class="chapter" data-level="4.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>4.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="4.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-1"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html"><i class="fa fa-check"></i><b>5</b> Variable attribution with interactions</a><ul>
<li class="chapter" data-level="5.1" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#intuition-2"><i class="fa fa-check"></i><b>5.1</b> Intuition</a></li>
<li class="chapter" data-level="5.2" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#method-2"><i class="fa fa-check"></i><b>5.2</b> Method</a></li>
<li class="chapter" data-level="5.3" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>5.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="5.4" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#break-down-plots"><i class="fa fa-check"></i><b>5.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="5.5" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#pros-and-cons-2"><i class="fa fa-check"></i><b>5.5</b> Pros and cons</a></li>
<li class="chapter" data-level="5.6" data-path="variable-attribution-with-interactions.html"><a href="variable-attribution-with-interactions.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>5.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>6</b> Average variable attributions</a><ul>
<li class="chapter" data-level="6.1" data-path="shapley.html"><a href="shapley.html#intuition-3"><i class="fa fa-check"></i><b>6.1</b> Intuition</a></li>
<li class="chapter" data-level="6.2" data-path="shapley.html"><a href="shapley.html#method-3"><i class="fa fa-check"></i><b>6.2</b> Method</a></li>
<li class="chapter" data-level="6.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>6.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="6.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-3"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>7</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="7.1" data-path="LIME.html"><a href="LIME.html#intuition-4"><i class="fa fa-check"></i><b>7.1</b> Intuition</a></li>
<li class="chapter" data-level="7.2" data-path="LIME.html"><a href="LIME.html#method-4"><i class="fa fa-check"></i><b>7.2</b> Method</a></li>
<li class="chapter" data-level="7.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>7.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="7.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-4"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>7.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="7.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>7.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="7.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>7.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>8</b> What-If analysis with the Ceteris Paribus Principle</a><ul>
<li class="chapter" data-level="8.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition-5"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#method-5"><i class="fa fa-check"></i><b>8.3</b> Method</a><ul>
<li class="chapter" data-level="8.3.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#ceterisParibus1d"><i class="fa fa-check"></i><b>8.3.1</b> 1D profiles</a></li>
<li class="chapter" data-level="8.3.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#oscillations"><i class="fa fa-check"></i><b>8.3.2</b> Profile oscillations</a></li>
<li class="chapter" data-level="8.3.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#d-profiles"><i class="fa fa-check"></i><b>8.3.3</b> 2D profiles</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#local-model-fidelity"><i class="fa fa-check"></i><b>8.4</b> Local model fidelity</a></li>
<li class="chapter" data-level="8.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#example"><i class="fa fa-check"></i><b>8.5</b> Example</a></li>
<li class="chapter" data-level="8.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons-5"><i class="fa fa-check"></i><b>8.6</b> Pros and cons</a></li>
<li class="chapter" data-level="8.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>8.7</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>9</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="9.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>9.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="10" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i><b>10</b> Introduction</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction-2.html"><a href="introduction-2.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>10.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="10.2" data-path="introduction-2.html"><a href="introduction-2.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>10.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>11</b> Feature Importance</a><ul>
<li class="chapter" data-level="11.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>11.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="11.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic"><i class="fa fa-check"></i><b>11.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="11.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>11.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="11.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>11.4</b> More models</a></li>
<li class="chapter" data-level="11.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>11.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>12</b> Feature effects</a><ul>
<li class="chapter" data-level="12.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#partialDependence"><i class="fa fa-check"></i><b>12.1</b> Partial Dependency Plots</a><ul>
<li class="chapter" data-level="12.1.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#interactions-and-partial-dependency-profiles"><i class="fa fa-check"></i><b>12.1.1</b> Interactions and Partial Dependency profiles</a></li>
<li class="chapter" data-level="12.1.2" data-path="variableEngeneering.html"><a href="variableEngeneering.html#groups-of-partial-dependency-profiles"><i class="fa fa-check"></i><b>12.1.2</b> Groups of Partial Dependency profiles</a></li>
<li class="chapter" data-level="12.1.3" data-path="variableEngeneering.html"><a href="variableEngeneering.html#model-comparisons-with-partial-dependency-plots"><i class="fa fa-check"></i><b>12.1.3</b> Model comparisons with Partial Dependency Plots</a></li>
<li class="chapter" data-level="12.1.4" data-path="variableEngeneering.html"><a href="variableEngeneering.html#correlation-between-features"><i class="fa fa-check"></i><b>12.1.4</b> Correlation between features</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="variableEngeneering.html"><a href="variableEngeneering.html#merging-path-plots"><i class="fa fa-check"></i><b>12.2</b> Merging Path Plots</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>13</b> Other topics</a></li>
<li class="chapter" data-level="14" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>14</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="15" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>15</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="16" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>16</b> Concept Drift</a><ul>
<li class="chapter" data-level="16.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-3"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>16.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="16.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>16.3</b> Code snippets</a></li>
<li class="chapter" data-level="16.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>16.4</b> Residual Drift</a></li>
<li class="chapter" data-level="16.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>16.5</b> Code snippets</a></li>
<li class="chapter" data-level="16.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>16.6</b> Model Drift</a></li>
<li class="chapter" data-level="16.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>16.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="17" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>17</b> Data Sets</a><ul>
<li class="chapter" data-level="17.1" data-path="DataSets.html"><a href="DataSets.html#TitanicDataset"><i class="fa fa-check"></i><b>17.1</b> Predict survival on the Titanic</a><ul>
<li class="chapter" data-level="17.1.1" data-path="DataSets.html"><a href="DataSets.html#random-forest"><i class="fa fa-check"></i><b>17.1.1</b> Random Forest</a></li>
<li class="chapter" data-level="17.1.2" data-path="DataSets.html"><a href="DataSets.html#logistic-regression"><i class="fa fa-check"></i><b>17.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="17.1.3" data-path="DataSets.html"><a href="DataSets.html#splines-with-rms"><i class="fa fa-check"></i><b>17.1.3</b> Splines with RMS</a></li>
<li class="chapter" data-level="17.1.4" data-path="DataSets.html"><a href="DataSets.html#gradient-boosting"><i class="fa fa-check"></i><b>17.1.4</b> Gradient boosting</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>17.2</b> Hire or Fire? HR in Call Center</a></li>
<li class="chapter" data-level="17.3" data-path="DataSets.html"><a href="DataSets.html#apartmentsDataset"><i class="fa fa-check"></i><b>17.3</b> How much does it cost? Price prediction for a square meter</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>18</b> Packages</a><ul>
<li class="chapter" data-level="18.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>18.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visualisation, Exploration and Explanation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="variable-attribution-with-interactions" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Variable attribution with interactions</h1>
<p>In the Section <a href="breakDown.html#breakDown">4</a> we presented model agnostic approach for additive decomposition of a model prediction for a single observation.</p>
<p>For non-additive models the variables contributions depend on values of other variables.</p>
<p>In this section we present an algorithm that identifies interactions between pairs of variables and include such interactions in variable decomposition plots. Here we present an algorithm for pairs of variables, but it can be easily generalized to larger number of variables.</p>
<div id="intuition-2" class="section level2">
<h2><span class="header-section-number">5.1</span> Intuition</h2>
<p>The key idea here is to identify interactions between variables.
This can be done in two steps.</p>
<ol style="list-style-type: decimal">
<li>First we determine variable contributions for each variable independently.</li>
<li>Second, we calculate effect for pair of variables. If this effect is different than the sum of consecutive variables then it may be an interaction.</li>
</ol>
<p>TODO: easy example for interaction</p>
</div>
<div id="method-2" class="section level2">
<h2><span class="header-section-number">5.2</span> Method</h2>
<p>This algorithm is also composed out of two steps. In the first step variables and pairs of variables are ordered in terms of their importance, while in the second step the consecutive conditioning is applied to ordered variables.</p>
<p>To determine an importance of variables and pairs of variables following scores are being calculated.</p>
<p>For a single variable</p>
<p><span class="math display">\[
score_1(f, x^*, i) = \left| E [f(X)|X_i = x^*_i]  - E [f(X)]\right|
\]</span>
For pairs of variables</p>
<p><span class="math display">\[
score_2(f, x^*, (i,j)) = \left| E [f(X)|X_i = x^*_i, X_j = x^*_j] - E [f(X)|X_i = x^*_i] - E [f(X)| X_j = x^*_j]+ E [f(X)] \right|
\]</span>
Note that this is equivalent to</p>
<p><span class="math display">\[
score_2(f, x^*, (i,j)) = \left| E [f(X)|X_i = x^*_i, X_j = x^*_j] - score_1 (f, x^*, i) - score_1 (f, x^*, j) + baseline \right|
\]</span>
In other words the <span class="math inline">\(score_1(f, x^*, i)\)</span> measures how much the average model response changes if variable <span class="math inline">\(x_i\)</span> is set to <span class="math inline">\(x_i^*\)</span>, which is some index of local variable importance. On the other hand the <span class="math inline">\(score_2(f, x^*, (i,j))\)</span> measures how much the change is different than additive composition of changes for <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_j\)</span>, which is some index of local interaction importance.</p>
<p>Note, that for additive models <span class="math inline">\(score_2(f, x^*, (i,j))\)</span> shall be close to zero. So the larger is this value the larger deviation from additivness.</p>
<p>The second step of the algorithm is the sequential conditioning. In this version in every new step we condition on a single variable of pair of variables in an order determined by <span class="math inline">\(score_1\)</span> and <span class="math inline">\(score_2\)</span>.</p>
<p>The complexity of the first step id <span class="math inline">\(O(p^2)\)</span> where <span class="math inline">\(p\)</span> stands for the number of variables. The complexity of the second step is <span class="math inline">\(O(p)\)</span>.</p>
</div>
<div id="example-hire-or-fire-1" class="section level2">
<h2><span class="header-section-number">5.3</span> Example: Hire or Fire?</h2>
<p>Again, let us consider a HR dataset.
The table below shows <span class="math inline">\(score_1\)</span> and <span class="math inline">\(score_2\)</span> calculated for consecutive variables.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Ei f(X)</th>
<th align="right">score1</th>
<th align="right">score2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">hours</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">salary</td>
<td align="right">0.225528</td>
<td align="right">-0.160058</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">age:gender</td>
<td align="right">0.516392</td>
<td align="right"></td>
<td align="right">0.146660</td>
</tr>
<tr class="even">
<td align="left">salary:age</td>
<td align="right">0.266226</td>
<td align="right"></td>
<td align="right">0.062026</td>
</tr>
<tr class="odd">
<td align="left">salary:hours</td>
<td align="right">0.400206</td>
<td align="right"></td>
<td align="right">-0.055936</td>
</tr>
<tr class="even">
<td align="left">evaluation</td>
<td align="right">0.430994</td>
<td align="right">0.045408</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">hours:age</td>
<td align="right">0.635662</td>
<td align="right"></td>
<td align="right">0.040790</td>
</tr>
<tr class="even">
<td align="left">salary:evaluation</td>
<td align="right">0.238126</td>
<td align="right"></td>
<td align="right">-0.032810</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.364258</td>
<td align="right">-0.021328</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">evaluation:hours</td>
<td align="right">0.677798</td>
<td align="right"></td>
<td align="right">0.016190</td>
</tr>
<tr class="odd">
<td align="left">salary:gender</td>
<td align="right">0.223292</td>
<td align="right"></td>
<td align="right">-0.007710</td>
</tr>
<tr class="even">
<td align="left">evaluation:age</td>
<td align="right">0.415688</td>
<td align="right"></td>
<td align="right">0.006022</td>
</tr>
<tr class="odd">
<td align="left">gender</td>
<td align="right">0.391060</td>
<td align="right">0.005474</td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">hours:gender</td>
<td align="right">0.626478</td>
<td align="right"></td>
<td align="right">0.004804</td>
</tr>
<tr class="odd">
<td align="left">evaluation:gender</td>
<td align="right">0.433814</td>
<td align="right"></td>
<td align="right">-0.002654</td>
</tr>
</tbody>
</table>
<p>Once we determined the order, we can calculate sequential conditionings. In the first step we condition over variable <code>hours</code>, then over <code>salary</code>. The third position is occupied by interaction between <code>age:gender</code> thus we add both variables to the conditioning</p>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">cumulative</th>
<th align="right">contribution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">0.385586</td>
<td align="right">0.385586</td>
</tr>
<tr class="even">
<td align="left">* hours = 42</td>
<td align="right">0.616200</td>
<td align="right">0.230614</td>
</tr>
<tr class="odd">
<td align="left">* salary = 2</td>
<td align="right">0.400206</td>
<td align="right">-0.215994</td>
</tr>
<tr class="even">
<td align="left">* age:gender = 58:male</td>
<td align="right">0.796856</td>
<td align="right">0.396650</td>
</tr>
<tr class="odd">
<td align="left">* evaluation = 2</td>
<td align="right">0.778000</td>
<td align="right">-0.018856</td>
</tr>
<tr class="even">
<td align="left">final_prognosis</td>
<td align="right">0.778000</td>
<td align="right">0.778000</td>
</tr>
</tbody>
</table>
</div>
<div id="break-down-plots" class="section level2">
<h2><span class="header-section-number">5.4</span> Break Down Plots</h2>
<p>Break Down Plots for interactions are similar in structure as plots for single variables. The only difference is that in some rows pair of variable is listed in a single row. See an example in Figure <a href="#BDPrice4"><strong>??</strong></a>.</p>
<div class="figure" style="text-align: center"><span id="fig:bdInter1"></span>
<img src="figure/bd_inter_1.png" alt="(fig:bdInter1) Break Down Plot for variable attrbution with interactions " width="70%" />
<p class="caption">
Figure 5.1: (fig:bdInter1) Break Down Plot for variable attrbution with interactions
</p>
</div>
</div>
<div id="pros-and-cons-2" class="section level2">
<h2><span class="header-section-number">5.5</span> Pros and cons</h2>
<p>Break Down for interactions shares many features of Break Down for single variables. Below we summarize unique strengths and weaknesses of this approach.</p>
<p><strong>Pros</strong></p>
<ul>
<li>If interactions are present in the model, then additive contributions may be misleading. In such case the identification of interactions leads to better explanations.</li>
<li>Complexity of Break Down Algorithm is quadratic, what is not that bad if number of features is small or moderate.</li>
</ul>
<p><strong>Cons</strong></p>
<ul>
<li>For large number of variables, the consideration of all interactions is both time consuming and sensitive to noise as the number of <span class="math inline">\(score_2\)</span> scores grow faster than number of <span class="math inline">\(score_1\)</span>.</li>
</ul>
</div>
<div id="code-snippets-for-r-1" class="section level2">
<h2><span class="header-section-number">5.6</span> Code snippets for R</h2>
<p>The algorithm for Break Down for Interactions is also implemented in the <code>local_interactions</code> function from <code>breakDown2</code> package.</p>
<p><strong>Model preparation</strong></p>
<p>First a model needs to be trained.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX2&quot;</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(status <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>hours <span class="op">+</span><span class="st"> </span>evaluation <span class="op">+</span><span class="st"> </span>salary, <span class="dt">data =</span> HR)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">model</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = status ~ gender + age + hours + evaluation +      salary, data = HR) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##         OOB estimate of  error rate: 27.41%
## Confusion matrix:
##          fired   ok promoted class.error
## fired     2279  381      195   0.2017513
## ok         541 1242      438   0.4407924
## promoted   207  389     2175   0.2150848</code></pre>
<p>Model exploration with the <code>breakDown2</code> package is performed in three steps.</p>
<p><strong>1. Create an explainer - wrapper around model and validation data.</strong></p>
<p>Since all other functions work in a model agnostic fashion, first we need to define a wrapper around the model. Here we are using the <code>explain()</code> function from <code>DALEX</code> package.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">explainer_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(model,</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">                 <span class="dt">data =</span> HR,</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">                 <span class="dt">y =</span> HR<span class="op">$</span>status)</a></code></pre></div>
<p><strong>2. Select an observation of interest.</strong></p>
<p>Break Down Plots decompose model prediction around a single observation. Let’s construct a data frame with corresponding values.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">new_observation &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)),</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">                      <span class="dt">age =</span> <span class="fl">57.7</span>,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">                      <span class="dt">hours =</span> <span class="fl">42.3</span>,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">                      <span class="dt">evaluation =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">                      <span class="dt">salary =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="kw">predict</span>(model, new_observation, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a></code></pre></div>
<pre><code>##   fired    ok promoted
## 1 0.814 0.182    0.004
## attr(,&quot;class&quot;)
## [1] &quot;matrix&quot; &quot;votes&quot;</code></pre>
<p><strong>3. Calculate Break Down decomposition</strong></p>
<p>The <code>local_interactions()</code> function calculates Break Down contributions for a selected model around a selected observation.</p>
<p>The result from <code>local_interactions()</code> function is a data frame with variable attributions.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;breakDown2&quot;</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">bd_rf &lt;-<span class="st"> </span><span class="kw">local_interactions</span>(explainer_rf,</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">                 new_observation)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">bd_rf</a></code></pre></div>
<pre><code>##                                               contribution
## randomForest.fired: baseline                         0.377
## randomForest.fired: * hours = 42                     0.240
## randomForest.fired: * salary = 2                    -0.207
## randomForest.fired: * age:gender = 58:male           0.412
## randomForest.fired: * evaluation = 2                -0.007
## randomForest.fired: prediction                       0.814
## randomForest.ok: baseline                            0.274
## randomForest.ok: * evaluation = 2                    0.136
## randomForest.ok: * salary = 2                        0.154
## randomForest.ok: * age:gender = 58:male             -0.284
## randomForest.ok: * hours = 42                       -0.098
## randomForest.ok: prediction                          0.182
## randomForest.promoted: baseline                      0.349
## randomForest.promoted: * hours = 42                 -0.190
## randomForest.promoted: * evaluation = 2             -0.154
## randomForest.promoted: * age:gender = 58:male       -0.003
## randomForest.promoted: * salary = 2                  0.002
## randomForest.promoted: prediction                    0.004
## baseline:  0</code></pre>
<p>The generic <code>plot()</code> function creates a Break Down plots.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">plot</span>(bd_rf) </a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="breakDown.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="shapley.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
