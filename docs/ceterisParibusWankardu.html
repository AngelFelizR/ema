<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Predictive Models: Visual Exploration, Explanation and Debugging</title>
  <meta name="description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  <meta name="github-repo" content="pbiecek/PM_VEE" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Predictive Models: Visual Exploration, Explanation and Debugging" />
  
  <meta name="twitter:description" content="This book introduces key concepts for exploration, explanation and visualization of complex predictive models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski">


<meta name="date" content="2019-04-18">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="ceterisParibus2d.html">
<link rel="next" href="variableAttributionMethods.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/PM_VEE/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Predictive Models:<br/> Visualisation, Exploration and Explanation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#terminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#white-box-models-vs.black-box-models"><i class="fa fa-check"></i><b>1.4</b> White-box models vs. black-box models</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#model-visualization-exploration-and-explanation"><i class="fa fa-check"></i><b>1.5</b> Model visualization, exploration, and explanation</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#model-agnostic-vs.model-specific-approach"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic vs. model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#code-snippets"><i class="fa fa-check"></i><b>1.7</b> Code snippets</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#the-structure-of-the-book"><i class="fa fa-check"></i><b>1.8</b> The structure of the book</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html"><i class="fa fa-check"></i><b>2</b> Data Sets</a><ul>
<li class="chapter" data-level="2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>2.1</b> Sinking of the RMS Titanic</a><ul>
<li class="chapter" data-level="2.1.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration"><i class="fa fa-check"></i><b>2.1.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.1.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_lmr"><i class="fa fa-check"></i><b>2.1.2</b> Logistic regression</a></li>
<li class="chapter" data-level="2.1.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_titanic_rf"><i class="fa fa-check"></i><b>2.1.3</b> Random forest</a></li>
<li class="chapter" data-level="2.1.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#gradient-boosting"><i class="fa fa-check"></i><b>2.1.4</b> Gradient boosting</a></li>
<li class="chapter" data-level="2.1.5" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_titanic"><i class="fa fa-check"></i><b>2.1.5</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>2.2</b> Apartment prices</a><ul>
<li class="chapter" data-level="2.2.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#data-exploration-1"><i class="fa fa-check"></i><b>2.2.1</b> Data exploration</a></li>
<li class="chapter" data-level="2.2.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_lr"><i class="fa fa-check"></i><b>2.2.2</b> Linear regression</a></li>
<li class="chapter" data-level="2.2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_apartments_rf"><i class="fa fa-check"></i><b>2.2.3</b> Random forest</a></li>
<li class="chapter" data-level="2.2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_apartments"><i class="fa fa-check"></i><b>2.2.4</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#HFDataset"><i class="fa fa-check"></i><b>2.3</b> Hire or fire</a><ul>
<li class="chapter" data-level="2.3.1" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_mr"><i class="fa fa-check"></i><b>2.3.1</b> Multinomial logistic regression</a></li>
<li class="chapter" data-level="2.3.2" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#model_HR_rf"><i class="fa fa-check"></i><b>2.3.2</b> Random forest</a></li>
<li class="chapter" data-level="2.3.3" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#predictions_HR"><i class="fa fa-check"></i><b>2.3.3</b> Model predictions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="DataSetsIntro.html"><a href="DataSetsIntro.html#ListOfModels"><i class="fa fa-check"></i><b>2.4</b> List of models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instance-level-explanation.html"><a href="instance-level-explanation.html"><i class="fa fa-check"></i>Instance-level explanation</a></li>
<li class="chapter" data-level="3" data-path="PredictionExplainers.html"><a href="PredictionExplainers.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>4</b> Ceteris Paribus Profiles - a tool for What-If analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#intuition"><i class="fa fa-check"></i><b>4.2</b> Intuition</a></li>
<li class="chapter" data-level="4.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#method"><i class="fa fa-check"></i><b>4.3</b> Method</a></li>
<li class="chapter" data-level="4.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#pros-and-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#code-snippets-for-r"><i class="fa fa-check"></i><b>4.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>5</b> Ceteris Paribus Oscillations - a tool for local variable importance</a><ul>
<li class="chapter" data-level="5.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#intuition-1"><i class="fa fa-check"></i><b>5.2</b> Intuition</a></li>
<li class="chapter" data-level="5.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#method-1"><i class="fa fa-check"></i><b>5.3</b> Method</a></li>
<li class="chapter" data-level="5.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#pros-and-cons-1"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>5.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html"><i class="fa fa-check"></i><b>6</b> Ceteris-Paribus 2D Profiles - a tool for pairwise interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#intuition-2"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#method-2"><i class="fa fa-check"></i><b>6.3</b> Method</a></li>
<li class="chapter" data-level="6.4" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#pros-and-cons-2"><i class="fa fa-check"></i><b>6.4</b> Pros and cons</a></li>
<li class="chapter" data-level="6.5" data-path="ceterisParibus2d.html"><a href="ceterisParibus2d.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>6.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html"><i class="fa fa-check"></i><b>7</b> Local diagnostic with Ceteris-Paribus profiles</a><ul>
<li class="chapter" data-level="7.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#intuition-3"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#method-3"><i class="fa fa-check"></i><b>7.3</b> Method</a><ul>
<li class="chapter" data-level="7.3.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#nearest-neighbors"><i class="fa fa-check"></i><b>7.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="7.3.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#profiles-for-neighbors"><i class="fa fa-check"></i><b>7.3.2</b> Profiles for neighbors</a></li>
<li class="chapter" data-level="7.3.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#residuals"><i class="fa fa-check"></i><b>7.3.3</b> Residuals</a></li>
<li class="chapter" data-level="7.3.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#local-fidelity-plot"><i class="fa fa-check"></i><b>7.3.4</b> Local Fidelity Plot</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#pros-and-cons-3"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="7.5.1" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#start-with-ceteris-paribus-profile"><i class="fa fa-check"></i><b>7.5.1</b> Start with Ceteris Paribus Profile</a></li>
<li class="chapter" data-level="7.5.2" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-profiles-for-neighbors"><i class="fa fa-check"></i><b>7.5.2</b> Add profiles for neighbors</a></li>
<li class="chapter" data-level="7.5.3" data-path="ceterisParibusWankardu.html"><a href="ceterisParibusWankardu.html#add-residuals-for-neighbors"><i class="fa fa-check"></i><b>7.5.3</b> Add residuals for neighbors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html"><i class="fa fa-check"></i><b>8</b> Variable attribution for linear models</a><ul>
<li class="chapter" data-level="8.1" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#intuition-4"><i class="fa fa-check"></i><b>8.2</b> Intuition</a></li>
<li class="chapter" data-level="8.3" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#method-4"><i class="fa fa-check"></i><b>8.3</b> Method</a></li>
<li class="chapter" data-level="8.4" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#example-wine-quality"><i class="fa fa-check"></i><b>8.4</b> Example: Wine quality</a></li>
<li class="chapter" data-level="8.5" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#pros-and-cons-4"><i class="fa fa-check"></i><b>8.5</b> Pros and Cons</a></li>
<li class="chapter" data-level="8.6" data-path="variableAttributionMethods.html"><a href="variableAttributionMethods.html#code-snippets-1"><i class="fa fa-check"></i><b>8.6</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>9</b> Variable attributions</a><ul>
<li class="chapter" data-level="9.1" data-path="breakDown.html"><a href="breakDown.html#intuition-5"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="breakDown.html"><a href="breakDown.html#method-5"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="breakDown.html"><a href="breakDown.html#example-hire-or-fire"><i class="fa fa-check"></i><b>9.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="9.4" data-path="breakDown.html"><a href="breakDown.html#pros-and-cons-5"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="breakDown.html"><a href="breakDown.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>10</b> Variable attribution with interactions</a><ul>
<li class="chapter" data-level="10.1" data-path="iBreakDown.html"><a href="iBreakDown.html#intuition-6"><i class="fa fa-check"></i><b>10.1</b> Intuition</a></li>
<li class="chapter" data-level="10.2" data-path="iBreakDown.html"><a href="iBreakDown.html#method-6"><i class="fa fa-check"></i><b>10.2</b> Method</a></li>
<li class="chapter" data-level="10.3" data-path="iBreakDown.html"><a href="iBreakDown.html#example-hire-or-fire-1"><i class="fa fa-check"></i><b>10.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="10.4" data-path="iBreakDown.html"><a href="iBreakDown.html#break-down-plots"><i class="fa fa-check"></i><b>10.4</b> Break Down Plots</a></li>
<li class="chapter" data-level="10.5" data-path="iBreakDown.html"><a href="iBreakDown.html#pros-and-cons-6"><i class="fa fa-check"></i><b>10.5</b> Pros and cons</a></li>
<li class="chapter" data-level="10.6" data-path="iBreakDown.html"><a href="iBreakDown.html#code-snippets-for-r-5"><i class="fa fa-check"></i><b>10.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>11</b> Average variable attributions</a><ul>
<li class="chapter" data-level="11.1" data-path="shapley.html"><a href="shapley.html#intuition-7"><i class="fa fa-check"></i><b>11.1</b> Intuition</a></li>
<li class="chapter" data-level="11.2" data-path="shapley.html"><a href="shapley.html#method-7"><i class="fa fa-check"></i><b>11.2</b> Method</a></li>
<li class="chapter" data-level="11.3" data-path="shapley.html"><a href="shapley.html#example-hire-or-fire-2"><i class="fa fa-check"></i><b>11.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="11.4" data-path="shapley.html"><a href="shapley.html#pros-and-cons-7"><i class="fa fa-check"></i><b>11.4</b> Pros and cons</a></li>
<li class="chapter" data-level="11.5" data-path="shapley.html"><a href="shapley.html#code-snippets-for-r-6"><i class="fa fa-check"></i><b>11.5</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>12</b> Local approximations with white-box model</a><ul>
<li class="chapter" data-level="12.1" data-path="LIME.html"><a href="LIME.html#intuition-8"><i class="fa fa-check"></i><b>12.1</b> Intuition</a></li>
<li class="chapter" data-level="12.2" data-path="LIME.html"><a href="LIME.html#method-8"><i class="fa fa-check"></i><b>12.2</b> Method</a></li>
<li class="chapter" data-level="12.3" data-path="LIME.html"><a href="LIME.html#example-hire-or-fire-3"><i class="fa fa-check"></i><b>12.3</b> Example: Hire or Fire?</a></li>
<li class="chapter" data-level="12.4" data-path="LIME.html"><a href="LIME.html#pros-and-cons-8"><i class="fa fa-check"></i><b>12.4</b> Pros and cons</a></li>
<li class="chapter" data-level="12.5" data-path="LIME.html"><a href="LIME.html#code-snippets-for-r-7"><i class="fa fa-check"></i><b>12.5</b> Code snippets for R</a><ul>
<li class="chapter" data-level="12.5.1" data-path="LIME.html"><a href="LIME.html#the-lime-pacakge"><i class="fa fa-check"></i><b>12.5.1</b> <strong>The lime pacakge</strong></a></li>
<li class="chapter" data-level="12.5.2" data-path="LIME.html"><a href="LIME.html#the-live-package"><i class="fa fa-check"></i><b>12.5.2</b> <strong>The live package</strong></a></li>
<li class="chapter" data-level="12.5.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>12.5.3</b> <strong>The iml package</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html"><i class="fa fa-check"></i><b>13</b> Comparision of prediction level explainers</a><ul>
<li class="chapter" data-level="13.1" data-path="comparision-of-prediction-level-explainers.html"><a href="comparision-of-prediction-level-explainers.html#when-to-use"><i class="fa fa-check"></i><b>13.1</b> When to use?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="model-level-explanations.html"><a href="model-level-explanations.html"><i class="fa fa-check"></i>Model level explanations</a></li>
<li class="chapter" data-level="14" data-path="introduction-6.html"><a href="introduction-6.html"><i class="fa fa-check"></i><b>14</b> Introduction</a><ul>
<li class="chapter" data-level="14.1" data-path="introduction-6.html"><a href="introduction-6.html#approaches-to-model-explanations"><i class="fa fa-check"></i><b>14.1</b> Approaches to model explanations</a></li>
<li class="chapter" data-level="14.2" data-path="introduction-6.html"><a href="introduction-6.html#a-bit-of-philosophy-three-laws-for-model-level-explanations"><i class="fa fa-check"></i><b>14.2</b> A bit of philosophy: Three Laws for Model Level Explanations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="variableImportance.html"><a href="variableImportance.html"><i class="fa fa-check"></i><b>15</b> Feature Importance</a><ul>
<li class="chapter" data-level="15.1" data-path="variableImportance.html"><a href="variableImportance.html#permutation-based-feature-importance"><i class="fa fa-check"></i><b>15.1</b> Permutation Based Feature Importance</a></li>
<li class="chapter" data-level="15.2" data-path="variableImportance.html"><a href="variableImportance.html#example-titanic"><i class="fa fa-check"></i><b>15.2</b> Example: Titanic</a></li>
<li class="chapter" data-level="15.3" data-path="variableImportance.html"><a href="variableImportance.html#example-price-prediction"><i class="fa fa-check"></i><b>15.3</b> Example: Price prediction</a></li>
<li class="chapter" data-level="15.4" data-path="variableImportance.html"><a href="variableImportance.html#more-models"><i class="fa fa-check"></i><b>15.4</b> More models</a></li>
<li class="chapter" data-level="15.5" data-path="variableImportance.html"><a href="variableImportance.html#level-frequency"><i class="fa fa-check"></i><b>15.5</b> Level frequency</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="variableEngeneering.html"><a href="variableEngeneering.html"><i class="fa fa-check"></i><b>16</b> Feature effects</a><ul>
<li class="chapter" data-level="16.1" data-path="variableEngeneering.html"><a href="variableEngeneering.html#global-level-vs-instance-level-explanations"><i class="fa fa-check"></i><b>16.1</b> Global level vs instance level explanations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>17</b> Partial Dependency Profiles</a><ul>
<li class="chapter" data-level="17.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#definition"><i class="fa fa-check"></i><b>17.1</b> Definition</a></li>
<li class="chapter" data-level="17.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#estimation"><i class="fa fa-check"></i><b>17.2</b> Estimation</a></li>
<li class="chapter" data-level="17.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependency-profiles"><i class="fa fa-check"></i><b>17.3</b> Clustered Partial Dependency Profiles</a></li>
<li class="chapter" data-level="17.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependency-profiles"><i class="fa fa-check"></i><b>17.4</b> Grouped Partial Dependency Profiles</a></li>
<li class="chapter" data-level="17.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-model-comparisons"><i class="fa fa-check"></i><b>17.5</b> Contrastive Model Comparisons</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html"><i class="fa fa-check"></i><b>18</b> Conditional Dependency Profiles</a><ul>
<li class="chapter" data-level="18.1" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#definition-1"><i class="fa fa-check"></i><b>18.1</b> Definition</a></li>
<li class="chapter" data-level="18.2" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#estimation-1"><i class="fa fa-check"></i><b>18.2</b> Estimation</a></li>
<li class="chapter" data-level="18.3" data-path="conditionalProfiles.html"><a href="conditionalProfiles.html#example"><i class="fa fa-check"></i><b>18.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>19</b> Accumulated Local Profiles</a><ul>
<li class="chapter" data-level="19.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#definition-2"><i class="fa fa-check"></i><b>19.1</b> Definition</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><a href="how-pd-cd-and-al-profiles-are-different-and-which-to-choose.html"><i class="fa fa-check"></i><b>20</b> How PD, CD and AL Profiles are different and which to choose</a></li>
<li class="chapter" data-level="21" data-path="factorMerger.html"><a href="factorMerger.html"><i class="fa fa-check"></i><b>21</b> Merging Path Plots and Others</a></li>
<li class="chapter" data-level="22" data-path="other-topics.html"><a href="other-topics.html"><i class="fa fa-check"></i><b>22</b> Other topics</a></li>
<li class="chapter" data-level="23" data-path="modelComparisons.html"><a href="modelComparisons.html"><i class="fa fa-check"></i><b>23</b> Performance Diagnostic</a></li>
<li class="chapter" data-level="24" data-path="modelAuditing.html"><a href="modelAuditing.html"><i class="fa fa-check"></i><b>24</b> Residual Diagnostic</a></li>
<li class="chapter" data-level="25" data-path="concept-drift.html"><a href="concept-drift.html"><i class="fa fa-check"></i><b>25</b> Concept Drift</a><ul>
<li class="chapter" data-level="25.1" data-path="concept-drift.html"><a href="concept-drift.html#introduction-7"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="concept-drift.html"><a href="concept-drift.html#covariate-drift"><i class="fa fa-check"></i><b>25.2</b> Covariate Drift</a></li>
<li class="chapter" data-level="25.3" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-2"><i class="fa fa-check"></i><b>25.3</b> Code snippets</a></li>
<li class="chapter" data-level="25.4" data-path="concept-drift.html"><a href="concept-drift.html#residual-drift"><i class="fa fa-check"></i><b>25.4</b> Residual Drift</a></li>
<li class="chapter" data-level="25.5" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-3"><i class="fa fa-check"></i><b>25.5</b> Code snippets</a></li>
<li class="chapter" data-level="25.6" data-path="concept-drift.html"><a href="concept-drift.html#model-drift"><i class="fa fa-check"></i><b>25.6</b> Model Drift</a></li>
<li class="chapter" data-level="25.7" data-path="concept-drift.html"><a href="concept-drift.html#code-snippets-4"><i class="fa fa-check"></i><b>25.7</b> Code snippets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendixes.html"><a href="appendixes.html"><i class="fa fa-check"></i>Appendixes</a></li>
<li class="chapter" data-level="26" data-path="DataSets.html"><a href="DataSets.html"><i class="fa fa-check"></i><b>26</b> Data Sets</a><ul>
<li class="chapter" data-level="26.1" data-path="DataSets.html"><a href="DataSets.html#HRdataset"><i class="fa fa-check"></i><b>26.1</b> Hire or Fire? HR in Call Center</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="Packages.html"><a href="Packages.html"><i class="fa fa-check"></i><b>27</b> Packages</a><ul>
<li class="chapter" data-level="27.1" data-path="Packages.html"><a href="Packages.html#arguments"><i class="fa fa-check"></i><b>27.1</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/pbiecek/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predictive Models: Visual Exploration, Explanation and Debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ceterisParibusWankardu" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Local diagnostic with Ceteris-Paribus profiles</h1>
<div id="introduction-4" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<p>What do you think, is it possible that model is good on average but terrible for some observations?</p>
<p>I think that most of us would agree. But how we can check if a single prediction is ,,unlucky’’? In this chapter we present two techniques for local model diagnostic that are based on Ceteris Paribus Profiles.</p>
<p>It may happen that global performance of the model is good, while for some particular observations the fit is very bad. Local fidelity helps to understand how good is the model fit at a particular observation. In this section we show how to use Ceteris Paribus profiles to validate local model fidelity.</p>
<p>The idea behind fidelity plots is to select a number of observatons (“neighbors”) from the validation dataset that are closest to the observation of interest. Then for the selected observations we plot CP profiles and check how stable they are. Additionally, if we know true values of the dependent variable for the selected neighbours, we may add residuals to the plot to evaluate the local fit of the model.</p>
</div>
<div id="intuition-3" class="section level2">
<h2><span class="header-section-number">7.2</span> Intuition</h2>
<p>We want to diagnose model behavior around a single instance prediction.</p>
<p>One approach to local model validation is to examine how model behaves for points from training data.
See for example profiles presented in Figure <a href="ceterisParibusWankardu.html#fig:profileWith10NN">7.1</a>. Ceteris Paribus Profiles are almost parallel and close to each other what suggests that model is stable around the point of interest.</p>
<p>It looks like small changes in the model input (represented by nearest neighbors) do not influence model response in an unpredicted way.</p>
<div class="figure" style="text-align: center"><span id="fig:profileWith10NN"></span>
<img src="figure/example_cp.png" alt="(fig:profileWith10NN) Ceteris-paribus profiles for a selected instance (dark violet line) and 10 nearest neighbors (light grey lines). Note that these profiles are almost parallel and close to each other what suggests the stability of the model. This example is based on the `titanic_rf_b6` model and the `titanic` dataset" width="50%" />
<p class="caption">
Figure 7.1: (fig:profileWith10NN) Ceteris-paribus profiles for a selected instance (dark violet line) and 10 nearest neighbors (light grey lines). Note that these profiles are almost parallel and close to each other what suggests the stability of the model. This example is based on the <code>titanic_rf_b6</code> model and the <code>titanic</code> dataset
</p>
</div>
<p>Once we consider nearest neighbors we can also look closer on the model fit around a specific point of interest.
See for example the Figure <a href="ceterisParibusWankardu.html#fig:profileBack2BackHist">7.2</a>. The back-to-back histogram shows distribution of residuals for the whole validation data and selected neighbors.</p>
<p>Distribution of residuals for the whole validation dataset is rather symmetric and centered around 0. Residuals for neighbors are centered on 500, what means that the average model bias around the point of interest is close to 500.</p>
<p>In the figure we showed an example in which residuals for nearest neighbors are larger than average residuals. Thus the local model fit is smaller than the global model fit.</p>
<div class="figure" style="text-align: center"><span id="fig:profileBack2BackHist"></span>
<img src="figure/bb_hist.png" alt="(fig:profileBack2BackHist) Back-to-back histograms for residuals calculated with the `apartments_rf_v5` model on `apartments` data. Upper panel correspond to residuals calculated for all observations in the validation dataset while the bottom panel correspond to residuals calculated for nearest neighbors. Their residuals are higher than average model residuals." width="70%" />
<p class="caption">
Figure 7.2: (fig:profileBack2BackHist) Back-to-back histograms for residuals calculated with the <code>apartments_rf_v5</code> model on <code>apartments</code> data. Upper panel correspond to residuals calculated for all observations in the validation dataset while the bottom panel correspond to residuals calculated for nearest neighbors. Their residuals are higher than average model residuals.
</p>
</div>
</div>
<div id="method-3" class="section level2">
<h2><span class="header-section-number">7.3</span> Method</h2>
<p>Local diagnostic is based on three elements.</p>
<ul>
<li>identification of nearest neighbors,</li>
<li>calculation and visualization of Ceteris Paribus profiles for selected neighbors,</li>
<li>analysis of residuals for nearest neighbors.</li>
</ul>
<p>Let us discuss them point by point.</p>
<div id="nearest-neighbors" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Nearest neighbors</h3>
<p>How many nearest neighbors shall we choose and what metric can we use?</p>
<p>Answer for both questions is of course <em>it depends</em>.</p>
<ul>
<li>The smaller the number of neighbors is the more local is the analysis. But very small numbers lead to larger variability of the diagnosis. The default value in the <code>select_neighbours()</code> function is <code>n = 20</code>.</li>
<li>The distance measure if very important. The higher the dimension the more crucial is this choice. For tabular data we additionally need to face a problem of different distributions of different features. The default choice in the <code>select_neighbours()</code> function is to use <code>distance = gower_dist()</code> function from the <code>gower</code> package <span class="citation">(van der Loo <a href="#ref-gowerRPackage">2017</a>)</span>. The Gower distance is an average from normalized distances <span class="math inline">\(d_k()\)</span> calculated for particular features.</li>
</ul>
<p><span class="math display">\[
d_{gower}(x^i, x^j) = \frac 1p \sum_{k=1}^p d_k(x_k^i, x_k^j).
\]</span>
* Distance can be calculated based on selected variables. In the <code>select_neighbours()</code> function one can specify them in the <code>variables</code> argument.</p>
</div>
<div id="profiles-for-neighbors" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Profiles for neighbors</h3>
<p>Once nearest neighbors are identified we can compare Ceteris Paribus profiles for selected variables.</p>
<p>If the number of features is large, then we can easily end up with bunch of very similar small plots with spaghetti profiles. Better strategy would be to focus only on profiles for the k-most important features. In this chapter we show profiles only for a single variable. This makes examples easier to read without reducing the generality.</p>
<p>For better readability we show only profiles for continuous variables.</p>
</div>
<div id="residuals" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Residuals</h3>
<p>Ceteris Paribus profiles that assess model stability. In addition we can add examination of the local residuals that assess local model fit.</p>
<p>Residuals for observation <span class="math inline">\(x^i\)</span> are here defined as the difference between the observed <span class="math inline">\(y^i\)</span> and predicted <span class="math inline">\(x^i\)</span>, that is</p>
<p><span class="math display">\[
r^i = y^i - f(x^i).
\]</span></p>
</div>
<div id="local-fidelity-plot" class="section level3">
<h3><span class="header-section-number">7.3.4</span> Local Fidelity Plot</h3>
<p>Both residuals and Ceteris Paribus Profiles for nearest neighbors can be presented in a single plot, called Local Fidelity Plot. See an example in the Figure <a href="ceterisParibusWankardu.html#fig:localFidelityPlots">7.3</a>.</p>
<p>Such plots are complex as they convey lots of information. Yet it is not that hard to learn how to read this information.</p>
<p>The Figure <a href="ceterisParibusWankardu.html#fig:localFidelityPlots">7.3</a> shows meaning of every element of the plot. For a single instance, here the passenger Johnny D, we can read how large are residuals for its neighbor, whatever residuals are biased or symmetric, if Ceteris Profiles are stable and parallel.</p>
<div class="figure" style="text-align: center"><span id="fig:localFidelityPlots"></span>
<img src="figure/localFidelityPlots.png" alt="(fig:localFidelityPlots) Elements of Local Fidelity Plots. Vertical intervals correspond to residuals, the smaller the more accurate is the model. Residuals are color coded, so we can easier recognized if they are biased or not, here there are balanced. Ceteris Paribus Profiles for neighbors are marked with grey lines. Stable model will have profiles close to each other; additive model will have parallel lines." width="70%" />
<p class="caption">
Figure 7.3: (fig:localFidelityPlots) Elements of Local Fidelity Plots. Vertical intervals correspond to residuals, the smaller the more accurate is the model. Residuals are color coded, so we can easier recognized if they are biased or not, here there are balanced. Ceteris Paribus Profiles for neighbors are marked with grey lines. Stable model will have profiles close to each other; additive model will have parallel lines.
</p>
</div>
</div>
</div>
<div id="pros-and-cons-3" class="section level2">
<h2><span class="header-section-number">7.4</span> Pros and cons</h2>
<p>Local diagnostic plots may be very helpful to validate if</p>
<ul>
<li>model is additive locally (CP profiles are parallel),</li>
<li>model is stable locally (CP profiles are close to each other),</li>
<li>local fit is good (residuals are small and symmetric).</li>
</ul>
<p>The drawback is that such plots are quite complex and lack objective measures for quality of fit. As most diagnostic tools it’s suited for exploratory analysis.</p>
</div>
<div id="code-snippets-for-r-3" class="section level2">
<h2><span class="header-section-number">7.5</span> Code snippets for R</h2>
<p>In this section we show how to use an R package <code>ingredients</code> <span class="citation">(<span class="citeproc-not-found" data-reference-id="R-ingredients"><strong>???</strong></span>)</span> for the Local Fidelity Plots. More details and examples can be found at <code>https://modeloriented.github.io/ingredients/</code>.</p>
<p>In this section we use a random forest <span class="citation">(Breiman et al. <a href="#ref-R-randomForest">2018</a>)</span> model <code>titanic_rf_v6</code> developed for the Titanic dataset (see Section @ref{model_titanic_rf}). In particular, we deal with a binary classification problem - we want to predict the probability of survival for a selected passenger.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">titanic &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/27e5c&quot;</span>)</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">titanic_rf_v6 &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/31570&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</a>
<a class="sourceLine" id="cb84-3" data-line-number="3">explain_titanic_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(<span class="dt">model =</span> titanic_rf_v6, </a>
<a class="sourceLine" id="cb84-4" data-line-number="4">                              <span class="dt">data =</span> titanic[,<span class="op">-</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb84-5" data-line-number="5">                              <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> &quot;yes&quot;</span>, </a>
<a class="sourceLine" id="cb84-6" data-line-number="6">                              <span class="dt">label =</span> <span class="st">&quot;Random Forest v6&quot;</span>)</a></code></pre></div>
<p>Local diagnostic is specified for an instance. Let us define a new observation - 8 years old Johnny D, male passenger of the 1st class.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">johny_d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">  <span class="dt">class =</span> <span class="kw">factor</span>(<span class="st">&quot;1st&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;1st&quot;</span>, <span class="st">&quot;2nd&quot;</span>, <span class="st">&quot;3rd&quot;</span>, <span class="st">&quot;deck crew&quot;</span>, <span class="st">&quot;engineering crew&quot;</span>, </a>
<a class="sourceLine" id="cb85-3" data-line-number="3">                                  <span class="st">&quot;restaurant staff&quot;</span>, <span class="st">&quot;victualling crew&quot;</span>)),</a>
<a class="sourceLine" id="cb85-4" data-line-number="4">  <span class="dt">gender =</span> <span class="kw">factor</span>(<span class="st">&quot;male&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)),</a>
<a class="sourceLine" id="cb85-5" data-line-number="5">  <span class="dt">age =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb85-6" data-line-number="6">  <span class="dt">sibsp =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb85-7" data-line-number="7">  <span class="dt">parch =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb85-8" data-line-number="8">  <span class="dt">fare =</span> <span class="dv">72</span>,</a>
<a class="sourceLine" id="cb85-9" data-line-number="9">  <span class="dt">embarked =</span> <span class="kw">factor</span>(<span class="st">&quot;Southampton&quot;</span>, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Belfast&quot;</span>, <span class="st">&quot;Cherbourg&quot;</span>, <span class="st">&quot;Queenstown&quot;</span>, <span class="st">&quot;Southampton&quot;</span>))</a>
<a class="sourceLine" id="cb85-10" data-line-number="10">)</a></code></pre></div>
<div id="start-with-ceteris-paribus-profile" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Start with Ceteris Paribus Profile</h3>
<p>First we will plot a Ceteri Paribus Profiles for the observation of interese.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ingredients&quot;</span>)</a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</a>
<a class="sourceLine" id="cb86-3" data-line-number="3"></a>
<a class="sourceLine" id="cb86-4" data-line-number="4">cp_johny &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explain_titanic_rf, johny_d, <span class="dt">variable_splits =</span> <span class="kw">list</span>(<span class="dt">age =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">70</span>))</a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="kw">plot</span>(cp_johny) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-6" data-line-number="6"><span class="st">  </span><span class="kw">show_observations</span>(cp_johny, <span class="dt">variables =</span> <span class="st">&quot;age&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb86-7" data-line-number="7"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Ceteris Paribus Profile for Johnny D&quot;</span>,<span class="st">&quot;Calculated for titanic_rf_v6 model&quot;</span>)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/titanicCeterisParibus03-1.png" width="672" /></p>
<p>In the model chances of survival diminish with age. Johnny D is lucky to have chances higher than 50%.</p>
</div>
<div id="add-profiles-for-neighbors" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Add profiles for neighbors</h3>
<p>Second we need to identify neighbors and plot their profiles.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">johny_neighbors &lt;-<span class="st"> </span><span class="kw">select_neighbours</span>(titanic, johny_d, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;class&quot;</span>, <span class="st">&quot;gender&quot;</span>))</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"></a>
<a class="sourceLine" id="cb87-3" data-line-number="3">cp_johny_neighbors &lt;-<span class="st"> </span><span class="kw">ceteris_paribus</span>(explain_titanic_rf, johny_neighbors, </a>
<a class="sourceLine" id="cb87-4" data-line-number="4">                                      <span class="dt">y =</span> johny_neighbors<span class="op">$</span>survived <span class="op">==</span><span class="st"> &quot;yes&quot;</span>,</a>
<a class="sourceLine" id="cb87-5" data-line-number="5">                                      <span class="dt">variable_splits =</span> <span class="kw">list</span>(<span class="dt">age =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">70</span>))</a>
<a class="sourceLine" id="cb87-6" data-line-number="6"></a>
<a class="sourceLine" id="cb87-7" data-line-number="7"><span class="kw">plot</span>(cp_johny) <span class="op">+</span></a>
<a class="sourceLine" id="cb87-8" data-line-number="8"><span class="st">  </span><span class="kw">show_profiles</span>(cp_johny_neighbors, <span class="dt">color =</span> <span class="st">&#39;#ceced9&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-9" data-line-number="9"><span class="st">  </span><span class="kw">show_observations</span>(cp_johny, <span class="dt">variables =</span> <span class="st">&quot;age&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb87-10" data-line-number="10"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Ceteris Paribus Profile for Johnny D and neighbors&quot;</span>,<span class="st">&quot;Calculated for titanic_rf_v6 model&quot;</span>)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/titanicCeterisParibus04-1.png" width="672" /></p>
<p>Almost all profiles behave in a similar way. The relation between age and model response is on average decreasing for almost every neighbor.</p>
</div>
<div id="add-residuals-for-neighbors" class="section level3">
<h3><span class="header-section-number">7.5.3</span> Add residuals for neighbors</h3>
<p>And the last step is to add lines for residuals.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="kw">plot</span>(cp_johny) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="st">  </span><span class="kw">show_profiles</span>(cp_johny_neighbors, <span class="dt">color =</span> <span class="st">&#39;#ceced9&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb88-3" data-line-number="3"><span class="st">  </span><span class="kw">show_observations</span>(cp_johny, <span class="dt">variables =</span> <span class="st">&quot;age&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="st">  </span><span class="kw">show_residuals</span>(cp_johny_neighbors, <span class="dt">variables =</span> <span class="st">&quot;age&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Local Fidelity Plot for Johnny D&quot;</span>,<span class="st">&quot;Calculated for titanic_rf_v6 model&quot;</span>)</a></code></pre></div>
<p><img src="PM_VEE_files/figure-html/titanicCeterisParibus05-1.png" width="672" /></p>
<p>Added residuals works increase the trust in this model. Neighbors that in fact died have lower profiles while neighbors that survived have predictions higher than 50%.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-gowerRPackage">
<p>van der Loo, Mark. 2017. <em>Gower: Gower’s Distance</em>. <a href="https://CRAN.R-project.org/package=gower">https://CRAN.R-project.org/package=gower</a>.</p>
</div>
<div id="ref-R-randomForest">
<p>Breiman, Leo, Adele Cutler, Andy Liaw, and Matthew Wiener. 2018. <em>RandomForest: Breiman and Cutler’s Random Forests for Classification and Regression</em>. <a href="https://CRAN.R-project.org/package=randomForest">https://CRAN.R-project.org/package=randomForest</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ceterisParibus2d.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variableAttributionMethods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["PM_VEE.pdf", "PM_VEE.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
