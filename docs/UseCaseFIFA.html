<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>21 FIFA 19 | Explanatory Model Analysis</title>
  <meta name="description" content="This book introduces unified language for exploration, explanation and examination of predictive machine learning models." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="21 FIFA 19 | Explanatory Model Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="figure/front4.png" />
  <meta property="og:description" content="This book introduces unified language for exploration, explanation and examination of predictive machine learning models." />
  <meta name="github-repo" content="pbiecek/ema" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="21 FIFA 19 | Explanatory Model Analysis" />
  
  <meta name="twitter:description" content="This book introduces unified language for exploration, explanation and examination of predictive machine learning models." />
  <meta name="twitter:image" content="figure/front4.png" />

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski" />


<meta name="date" content="2020-08-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="summaryModelLevel.html"/>
<link rel="next" href="reproducibility.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/ema/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>
<style>
.figure {
   padding:40px 0px;
}
</style>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><span style="font-size: large">Explanatory Model Analysis</span><br/>Explore, Explain, and Examine<br/>Predictive Models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.1</b> The aim of the book</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#three-single-laws"><i class="fa fa-check"></i><b>1.2</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#teminology"><i class="fa fa-check"></i><b>1.3</b> Terminology</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#glassblack"><i class="fa fa-check"></i><b>1.4</b> Black-box models and glass-box models</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#agnosticspecific"><i class="fa fa-check"></i><b>1.5</b> Model-agnostic and model-specific approach</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#bookstructure"><i class="fa fa-check"></i><b>1.6</b> The structure of the book</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#whatisinthebook"><i class="fa fa-check"></i><b>1.7</b> What is included in this book and what is not</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#thanksto"><i class="fa fa-check"></i><b>1.8</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html"><i class="fa fa-check"></i><b>2</b> Model Development</a>
<ul>
<li class="chapter" data-level="2.1" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#MDPIntro"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#MDPprocess"><i class="fa fa-check"></i><b>2.2</b> Model-development process</a></li>
<li class="chapter" data-level="2.3" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#notation"><i class="fa fa-check"></i><b>2.3</b> Notation</a></li>
<li class="chapter" data-level="2.4" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#dataunderstanding"><i class="fa fa-check"></i><b>2.4</b> Data understanding</a></li>
<li class="chapter" data-level="2.5" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#fitting"><i class="fa fa-check"></i><b>2.5</b> Model assembly (fitting)</a></li>
<li class="chapter" data-level="2.6" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#validation"><i class="fa fa-check"></i><b>2.6</b> Model audit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="do-it-yourself.html"><a href="do-it-yourself.html"><i class="fa fa-check"></i><b>3</b> Do-it-yourself</a>
<ul>
<li class="chapter" data-level="3.1" data-path="do-it-yourself.html"><a href="do-it-yourself.html#doItYourselfWithR"><i class="fa fa-check"></i><b>3.1</b> Do-it-yourself with R</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="do-it-yourself.html"><a href="do-it-yourself.html#what-to-install"><i class="fa fa-check"></i><b>3.1.1</b> What to install?</a></li>
<li class="chapter" data-level="3.1.2" data-path="do-it-yourself.html"><a href="do-it-yourself.html#infoDALEX"><i class="fa fa-check"></i><b>3.1.2</b> How to work with <code>DALEX</code>?</a></li>
<li class="chapter" data-level="3.1.3" data-path="do-it-yourself.html"><a href="do-it-yourself.html#how-to-work-with-archivist"><i class="fa fa-check"></i><b>3.1.3</b> How to work with <code>archivist</code>?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="do-it-yourself.html"><a href="do-it-yourself.html#doItYourselfWithPython"><i class="fa fa-check"></i><b>3.2</b> Do-it-yourself with Python</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="do-it-yourself.html"><a href="do-it-yourself.html#what-to-install-1"><i class="fa fa-check"></i><b>3.2.1</b> What to install?</a></li>
<li class="chapter" data-level="3.2.2" data-path="do-it-yourself.html"><a href="do-it-yourself.html#infoDALEXpy"><i class="fa fa-check"></i><b>3.2.2</b> How to work with <code>dalex</code>?</a></li>
<li class="chapter" data-level="3.2.3" data-path="do-it-yourself.html"><a href="do-it-yourself.html#code-snippets-for-python"><i class="fa fa-check"></i><b>3.2.3</b> Code snippets for Python</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html"><i class="fa fa-check"></i><b>4</b> Datasets and models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>4.1</b> Sinking of the RMS Titanic</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#exploration-titanic"><i class="fa fa-check"></i><b>4.1.1</b> Data exploration</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#models-for-rms-titanic-snippets-for-r"><i class="fa fa-check"></i><b>4.2</b> Models for RMS Titanic, snippets for R</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-lmr"><i class="fa fa-check"></i><b>4.2.1</b> Logistic regression model</a></li>
<li class="chapter" data-level="4.2.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-rf"><i class="fa fa-check"></i><b>4.2.2</b> Random forest model</a></li>
<li class="chapter" data-level="4.2.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-gbm"><i class="fa fa-check"></i><b>4.2.3</b> Gradient boosting model</a></li>
<li class="chapter" data-level="4.2.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-svm"><i class="fa fa-check"></i><b>4.2.4</b> Support vector machine model</a></li>
<li class="chapter" data-level="4.2.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictions-titanic"><i class="fa fa-check"></i><b>4.2.5</b> Models’ predictions</a></li>
<li class="chapter" data-level="4.2.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersTitanicRCode"><i class="fa fa-check"></i><b>4.2.6</b> Models’ explainers</a></li>
<li class="chapter" data-level="4.2.7" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ListOfModelsTitanic"><i class="fa fa-check"></i><b>4.2.7</b> List of model-objects</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#models-for-rms-titanic-snippets-for-python"><i class="fa fa-check"></i><b>4.3</b> Models for RMS Titanic, snippets for Python</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-lr"><i class="fa fa-check"></i><b>4.3.1</b> Logistic regression model</a></li>
<li class="chapter" data-level="4.3.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-rf"><i class="fa fa-check"></i><b>4.3.2</b> Random forest model</a></li>
<li class="chapter" data-level="4.3.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-gbm"><i class="fa fa-check"></i><b>4.3.3</b> Gradient boosting model</a></li>
<li class="chapter" data-level="4.3.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-svm"><i class="fa fa-check"></i><b>4.3.4</b> Support vector machine model</a></li>
<li class="chapter" data-level="4.3.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictions-titanic-python"><i class="fa fa-check"></i><b>4.3.5</b> Models’ predictions</a></li>
<li class="chapter" data-level="4.3.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersTitanicPythonCode"><i class="fa fa-check"></i><b>4.3.6</b> Models’ explainers</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>4.4</b> Apartment prices</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#exploration-apartments"><i class="fa fa-check"></i><b>4.4.1</b> Data exploration</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#models-for-apartment-prices-snippets-for-r"><i class="fa fa-check"></i><b>4.5</b> Models for Apartment prices, snippets for R</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-lr"><i class="fa fa-check"></i><b>4.5.1</b> Linear regression model</a></li>
<li class="chapter" data-level="4.5.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-rf"><i class="fa fa-check"></i><b>4.5.2</b> Random forest model</a></li>
<li class="chapter" data-level="4.5.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-svm"><i class="fa fa-check"></i><b>4.5.3</b> Support vector machine model</a></li>
<li class="chapter" data-level="4.5.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictionsApartments"><i class="fa fa-check"></i><b>4.5.4</b> Models’ predictions</a></li>
<li class="chapter" data-level="4.5.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersApartmentsRCode"><i class="fa fa-check"></i><b>4.5.5</b> Models’ explainers</a></li>
<li class="chapter" data-level="4.5.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ListOfModelsApartments"><i class="fa fa-check"></i><b>4.5.6</b> List of model-objects</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#models-for-apartment-prices-snippets-for-python"><i class="fa fa-check"></i><b>4.6</b> Models for Apartment prices, snippets for Python</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-python-lr"><i class="fa fa-check"></i><b>4.6.1</b> Linear regression model</a></li>
<li class="chapter" data-level="4.6.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-python-rf"><i class="fa fa-check"></i><b>4.6.2</b> Random forest model</a></li>
<li class="chapter" data-level="4.6.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-python-svm"><i class="fa fa-check"></i><b>4.6.3</b> Support vector machine model</a></li>
<li class="chapter" data-level="4.6.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictions-apartments-python"><i class="fa fa-check"></i><b>4.6.4</b> Models’ predictions</a></li>
<li class="chapter" data-level="4.6.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersApartmentsPythonCode"><i class="fa fa-check"></i><b>4.6.5</b> Models’ explainers</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Instance Level</b></span></li>
<li class="chapter" data-level="5" data-path="InstanceLevelExploration.html"><a href="InstanceLevelExploration.html"><i class="fa fa-check"></i><b>5</b> Introduction to Instance-level Exploration</a></li>
<li class="chapter" data-level="6" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>6</b> Break-down Plots for Additive Attributions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="breakDown.html"><a href="breakDown.html#BDIntroduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="breakDown.html"><a href="breakDown.html#BDIntuition"><i class="fa fa-check"></i><b>6.2</b> Intuition</a></li>
<li class="chapter" data-level="6.3" data-path="breakDown.html"><a href="breakDown.html#BDMethod"><i class="fa fa-check"></i><b>6.3</b> Method</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="breakDown.html"><a href="breakDown.html#BDMethodLin"><i class="fa fa-check"></i><b>6.3.1</b> Break-down for linear models</a></li>
<li class="chapter" data-level="6.3.2" data-path="breakDown.html"><a href="breakDown.html#BDMethodGen"><i class="fa fa-check"></i><b>6.3.2</b> Break-down for a general case</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="breakDown.html"><a href="breakDown.html#BDExample"><i class="fa fa-check"></i><b>6.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="6.5" data-path="breakDown.html"><a href="breakDown.html#BDProsCons"><i class="fa fa-check"></i><b>6.5</b> Pros and cons</a></li>
<li class="chapter" data-level="6.6" data-path="breakDown.html"><a href="breakDown.html#BDR"><i class="fa fa-check"></i><b>6.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="breakDown.html"><a href="breakDown.html#basic-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>6.6.1</b> Basic use of the <code>predict_parts()</code> function</a></li>
<li class="chapter" data-level="6.6.2" data-path="breakDown.html"><a href="breakDown.html#advanced-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>6.6.2</b> Advanced use of the <code>predict_parts()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="breakDown.html"><a href="breakDown.html#BDPython"><i class="fa fa-check"></i><b>6.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>7</b> Break-down Plots for Interactions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDIntuition"><i class="fa fa-check"></i><b>7.1</b> Intuition</a></li>
<li class="chapter" data-level="7.2" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDMethod"><i class="fa fa-check"></i><b>7.2</b> Method</a></li>
<li class="chapter" data-level="7.3" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDExample"><i class="fa fa-check"></i><b>7.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="7.4" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDProsCons"><i class="fa fa-check"></i><b>7.4</b> Pros and cons</a></li>
<li class="chapter" data-level="7.5" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDRcode"><i class="fa fa-check"></i><b>7.5</b> Code snippets for R</a></li>
<li class="chapter" data-level="7.6" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDPythonCode"><i class="fa fa-check"></i><b>7.6</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>8</b> Shapley Additive Explanations (SHAP) for Average Attributions</a>
<ul>
<li class="chapter" data-level="8.1" data-path="shapley.html"><a href="shapley.html#SHAPIntuition"><i class="fa fa-check"></i><b>8.1</b> Intuition</a></li>
<li class="chapter" data-level="8.2" data-path="shapley.html"><a href="shapley.html#SHAPMethod"><i class="fa fa-check"></i><b>8.2</b> Method</a></li>
<li class="chapter" data-level="8.3" data-path="shapley.html"><a href="shapley.html#SHAPExample"><i class="fa fa-check"></i><b>8.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="8.4" data-path="shapley.html"><a href="shapley.html#SHAProsCons"><i class="fa fa-check"></i><b>8.4</b> Pros and cons</a></li>
<li class="chapter" data-level="8.5" data-path="shapley.html"><a href="shapley.html#SHAPRcode"><i class="fa fa-check"></i><b>8.5</b> Code snippets for R</a></li>
<li class="chapter" data-level="8.6" data-path="shapley.html"><a href="shapley.html#SHAPPythonCode"><i class="fa fa-check"></i><b>8.6</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>9</b> Local Interpretable Model-agnostic Explanations (LIME)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="LIME.html"><a href="LIME.html#LIMEIntroduction"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="LIME.html"><a href="LIME.html#LIMEIntuition"><i class="fa fa-check"></i><b>9.2</b> Intuition</a></li>
<li class="chapter" data-level="9.3" data-path="LIME.html"><a href="LIME.html#LIMEMethod"><i class="fa fa-check"></i><b>9.3</b> Method</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="LIME.html"><a href="LIME.html#LIMErepr"><i class="fa fa-check"></i><b>9.3.1</b> Interpretable data representation</a></li>
<li class="chapter" data-level="9.3.2" data-path="LIME.html"><a href="LIME.html#LIMEsample"><i class="fa fa-check"></i><b>9.3.2</b> Sampling around the instance of interest</a></li>
<li class="chapter" data-level="9.3.3" data-path="LIME.html"><a href="LIME.html#LIMEglas"><i class="fa fa-check"></i><b>9.3.3</b> Fitting the glass-box model</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="LIME.html"><a href="LIME.html#LIMEExample"><i class="fa fa-check"></i><b>9.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.5" data-path="LIME.html"><a href="LIME.html#LIMEProsCons"><i class="fa fa-check"></i><b>9.5</b> Pros and cons</a></li>
<li class="chapter" data-level="9.6" data-path="LIME.html"><a href="LIME.html#LIMERcode"><i class="fa fa-check"></i><b>9.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="LIME.html"><a href="LIME.html#LIMERcodelime"><i class="fa fa-check"></i><b>9.6.1</b> The <code>lime</code> package</a></li>
<li class="chapter" data-level="9.6.2" data-path="LIME.html"><a href="LIME.html#LIMERcodelocMod"><i class="fa fa-check"></i><b>9.6.2</b> The <code>localModel</code> package</a></li>
<li class="chapter" data-level="9.6.3" data-path="LIME.html"><a href="LIME.html#LIMERcodeiml"><i class="fa fa-check"></i><b>9.6.3</b> The <code>iml</code> package</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="LIME.html"><a href="LIME.html#LIMEPythoncode"><i class="fa fa-check"></i><b>9.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>10</b> Ceteris-paribus Profiles</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>10.2</b> Intuition</a></li>
<li class="chapter" data-level="10.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>10.3</b> Method</a></li>
<li class="chapter" data-level="10.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>10.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="10.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>10.5</b> Pros and cons</a></li>
<li class="chapter" data-level="10.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>10.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#basic-use-of-the-predict_profile-function"><i class="fa fa-check"></i><b>10.6.1</b> Basic use of the <code>predict_profile()</code> function</a></li>
<li class="chapter" data-level="10.6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#advanced-use-of-the-predict_profile-function"><i class="fa fa-check"></i><b>10.6.2</b> Advanced use of the <code>predict_profile()</code> function</a></li>
<li class="chapter" data-level="10.6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#comparison-of-models-champion-challenger"><i class="fa fa-check"></i><b>10.6.3</b> Comparison of models (champion-challenger)</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPPython"><i class="fa fa-check"></i><b>10.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>11</b> Ceteris-paribus Oscillations</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>11.2</b> Intuition</a></li>
<li class="chapter" data-level="11.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>11.3</b> Method</a></li>
<li class="chapter" data-level="11.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>11.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="11.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>11.5</b> Pros and cons</a></li>
<li class="chapter" data-level="11.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>11.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="breakDown.html"><a href="breakDown.html#basic-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>11.6.1</b> Basic use of the <code>predict_parts()</code> function</a></li>
<li class="chapter" data-level="11.6.2" data-path="breakDown.html"><a href="breakDown.html#advanced-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>11.6.2</b> Advanced use of the <code>predict_parts()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscPython"><i class="fa fa-check"></i><b>11.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="localDiagnostics.html"><a href="localDiagnostics.html"><i class="fa fa-check"></i><b>12</b> Local-diagnostics Plots</a>
<ul>
<li class="chapter" data-level="12.1" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagIntro"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagIntuition"><i class="fa fa-check"></i><b>12.2</b> Intuition</a></li>
<li class="chapter" data-level="12.3" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagMethod"><i class="fa fa-check"></i><b>12.3</b> Method</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagneighbours"><i class="fa fa-check"></i><b>12.3.1</b> Nearest neighbours</a></li>
<li class="chapter" data-level="12.3.2" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagLFplot"><i class="fa fa-check"></i><b>12.3.2</b> Local-fidelity plot</a></li>
<li class="chapter" data-level="12.3.3" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagProfiles"><i class="fa fa-check"></i><b>12.3.3</b> Local-stability plot</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagExample"><i class="fa fa-check"></i><b>12.4</b> Example: Titanic</a></li>
<li class="chapter" data-level="12.5" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagProsCons"><i class="fa fa-check"></i><b>12.5</b> Pros and cons</a></li>
<li class="chapter" data-level="12.6" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagR"><i class="fa fa-check"></i><b>12.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="12.7" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagPython"><i class="fa fa-check"></i><b>12.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html"><i class="fa fa-check"></i><b>13</b> Summary of Instance-level Exploration</a>
<ul>
<li class="chapter" data-level="13.1" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#summaryInstanceLevelIntro"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#number-of-explanatory-variables-in-the-model"><i class="fa fa-check"></i><b>13.2</b> Number of explanatory variables in the model</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#low-to-medium-number-of-explanatory-variables"><i class="fa fa-check"></i><b>13.2.1</b> Low to medium number of explanatory variables</a></li>
<li class="chapter" data-level="13.2.2" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#medium-to-a-large-number-of-explanatory-variables"><i class="fa fa-check"></i><b>13.2.2</b> Medium to a large number of explanatory variables</a></li>
<li class="chapter" data-level="13.2.3" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#very-large-number-of-explanatory-variables"><i class="fa fa-check"></i><b>13.2.3</b> Very large number of explanatory variables</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#correlated-explanatory-variables"><i class="fa fa-check"></i><b>13.3</b> Correlated explanatory variables</a></li>
<li class="chapter" data-level="13.4" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#models-with-interactions"><i class="fa fa-check"></i><b>13.4</b> Models with interactions</a></li>
<li class="chapter" data-level="13.5" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#sparse-explanations"><i class="fa fa-check"></i><b>13.5</b> Sparse explanations</a></li>
<li class="chapter" data-level="13.6" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#additional-uses-of-model-exploration-and-explanation"><i class="fa fa-check"></i><b>13.6</b> Additional uses of model exploration and explanation</a></li>
<li class="chapter" data-level="13.7" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#comparison-of-models-champion-challenger-analysis"><i class="fa fa-check"></i><b>13.7</b> Comparison of models (champion-challenger analysis)</a></li>
</ul></li>
<li class="part"><span><b>III Dataset Level</b></span></li>
<li class="chapter" data-level="14" data-path="modelLevelExploration.html"><a href="modelLevelExploration.html"><i class="fa fa-check"></i><b>14</b> Introduction to Dataset-level Exploration</a></li>
<li class="chapter" data-level="15" data-path="modelPerformance.html"><a href="modelPerformance.html"><i class="fa fa-check"></i><b>15</b> Model-performance Measures</a>
<ul>
<li class="chapter" data-level="15.1" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceIntro"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceIntuition"><i class="fa fa-check"></i><b>15.2</b> Intuition</a></li>
<li class="chapter" data-level="15.3" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethod"><i class="fa fa-check"></i><b>15.3</b> Method</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodCont"><i class="fa fa-check"></i><b>15.3.1</b> Continuous dependent variable</a></li>
<li class="chapter" data-level="15.3.2" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodBin"><i class="fa fa-check"></i><b>15.3.2</b> Binary dependent variable</a></li>
<li class="chapter" data-level="15.3.3" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodCateg"><i class="fa fa-check"></i><b>15.3.3</b> Categorical dependent variable</a></li>
<li class="chapter" data-level="15.3.4" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodCount"><i class="fa fa-check"></i><b>15.3.4</b> Count dependent variable</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="modelPerformance.html"><a href="modelPerformance.html#example"><i class="fa fa-check"></i><b>15.4</b> Example</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceApartments"><i class="fa fa-check"></i><b>15.4.1</b> Apartment prices</a></li>
<li class="chapter" data-level="15.4.2" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceTitanic"><i class="fa fa-check"></i><b>15.4.2</b> Titanic data</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceProsCons"><i class="fa fa-check"></i><b>15.5</b> Pros and cons</a></li>
<li class="chapter" data-level="15.6" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceR"><i class="fa fa-check"></i><b>15.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="15.7" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformancePython"><i class="fa fa-check"></i><b>15.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="featureImportance.html"><a href="featureImportance.html"><i class="fa fa-check"></i><b>16</b> Variable-importance Measures</a>
<ul>
<li class="chapter" data-level="16.1" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceIntro"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceIntuition"><i class="fa fa-check"></i><b>16.2</b> Intuition</a></li>
<li class="chapter" data-level="16.3" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceMethod"><i class="fa fa-check"></i><b>16.3</b> Method</a></li>
<li class="chapter" data-level="16.4" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceTitanic"><i class="fa fa-check"></i><b>16.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="16.5" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceProsCons"><i class="fa fa-check"></i><b>16.5</b> Pros and cons</a></li>
<li class="chapter" data-level="16.6" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceR"><i class="fa fa-check"></i><b>16.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="16.7" data-path="featureImportance.html"><a href="featureImportance.html#featureImportancePython"><i class="fa fa-check"></i><b>16.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>17</b> Partial-dependence Profiles</a>
<ul>
<li class="chapter" data-level="17.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPIntro"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPIntuition"><i class="fa fa-check"></i><b>17.2</b> Intuition</a></li>
<li class="chapter" data-level="17.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPMethod"><i class="fa fa-check"></i><b>17.3</b> Method</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPs"><i class="fa fa-check"></i><b>17.3.1</b> Partial-dependence profiles</a></li>
<li class="chapter" data-level="17.3.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clusteredPDPs"><i class="fa fa-check"></i><b>17.3.2</b> Clustered partial-dependence profiles</a></li>
<li class="chapter" data-level="17.3.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#groupedPDPs"><i class="fa fa-check"></i><b>17.3.3</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="17.3.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastivePDPs"><i class="fa fa-check"></i><b>17.3.4</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPExample"><i class="fa fa-check"></i><b>17.4</b> Example: apartment-prices data</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#partial-dependence-profiles"><i class="fa fa-check"></i><b>17.4.1</b> Partial-dependence profiles</a></li>
<li class="chapter" data-level="17.4.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependence-profiles"><i class="fa fa-check"></i><b>17.4.2</b> Clustered partial-dependence profiles</a></li>
<li class="chapter" data-level="17.4.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependence-profiles"><i class="fa fa-check"></i><b>17.4.3</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="17.4.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-partial-dependence-profiles"><i class="fa fa-check"></i><b>17.4.4</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPProsCons"><i class="fa fa-check"></i><b>17.5</b> Pros and cons</a></li>
<li class="chapter" data-level="17.6" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPR"><i class="fa fa-check"></i><b>17.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#partial-dependence-profiles-1"><i class="fa fa-check"></i><b>17.6.1</b> Partial-dependence profiles</a></li>
<li class="chapter" data-level="17.6.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependence-profiles-1"><i class="fa fa-check"></i><b>17.6.2</b> Clustered partial-dependence profiles</a></li>
<li class="chapter" data-level="17.6.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependence-profiles-1"><i class="fa fa-check"></i><b>17.6.3</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="17.6.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-partial-dependence-profiles-1"><i class="fa fa-check"></i><b>17.6.4</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPPython"><i class="fa fa-check"></i><b>17.7</b> Code snippets for Python</a>
<ul>
<li class="chapter" data-level="17.7.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependence-profiles-2"><i class="fa fa-check"></i><b>17.7.1</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="17.7.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-partial-dependence-profiles-2"><i class="fa fa-check"></i><b>17.7.2</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>18</b> Local-dependence and Accumulated-local Profiles</a>
<ul>
<li class="chapter" data-level="18.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPIntro"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPIntuition"><i class="fa fa-check"></i><b>18.2</b> Intuition</a></li>
<li class="chapter" data-level="18.3" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPMethod"><i class="fa fa-check"></i><b>18.3</b> Method</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#local-dependence-profile"><i class="fa fa-check"></i><b>18.3.1</b> Local-dependence profile</a></li>
<li class="chapter" data-level="18.3.2" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#accumulated-local-profile"><i class="fa fa-check"></i><b>18.3.2</b> Accumulated-local profile</a></li>
<li class="chapter" data-level="18.3.3" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#dependence-profiles-for-a-model-with-interaction-and-correlated-explanatory-variables-an-example"><i class="fa fa-check"></i><b>18.3.3</b> Dependence profiles for a model with interaction and correlated explanatory variables: an example</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#CDPExample"><i class="fa fa-check"></i><b>18.4</b> Example: apartment-prices data</a></li>
<li class="chapter" data-level="18.5" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPProsCons"><i class="fa fa-check"></i><b>18.5</b> Pros and cons</a></li>
<li class="chapter" data-level="18.6" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPR"><i class="fa fa-check"></i><b>18.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="18.7" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPPython"><i class="fa fa-check"></i><b>18.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html"><i class="fa fa-check"></i><b>19</b> Residual-diagnostics Plots</a>
<ul>
<li class="chapter" data-level="19.1" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#IntroResidualDiagnostic"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#IntuitionResidualDiagnostic"><i class="fa fa-check"></i><b>19.2</b> Intuition</a></li>
<li class="chapter" data-level="19.3" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#MethodResidualDiagnostic"><i class="fa fa-check"></i><b>19.3</b> Method</a></li>
<li class="chapter" data-level="19.4" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#ExampleResidualDiagnostic"><i class="fa fa-check"></i><b>19.4</b> Example: apartment-prices data</a></li>
<li class="chapter" data-level="19.5" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#ProsConsResidualDiagnostic"><i class="fa fa-check"></i><b>19.5</b> Pros and cons</a></li>
<li class="chapter" data-level="19.6" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#RcodeResidualDiagnostic"><i class="fa fa-check"></i><b>19.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="19.7" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#PythoncodeResidualDiagnostic"><i class="fa fa-check"></i><b>19.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="summaryModelLevel.html"><a href="summaryModelLevel.html"><i class="fa fa-check"></i><b>20</b> Summary of Dataset-level Exploration</a>
<ul>
<li class="chapter" data-level="20.1" data-path="summaryModelLevel.html"><a href="summaryModelLevel.html#summaryModelLevelIntro"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="summaryModelLevel.html"><a href="summaryModelLevel.html#exploration-on-trainingtesting-data"><i class="fa fa-check"></i><b>20.2</b> Exploration on training/testing data</a></li>
<li class="chapter" data-level="20.3" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#correlated-explanatory-variables"><i class="fa fa-check"></i><b>20.3</b> Correlated explanatory variables</a></li>
<li class="chapter" data-level="20.4" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#comparison-of-models-champion-challenger-analysis"><i class="fa fa-check"></i><b>20.4</b> Comparison of models (champion-challenger analysis)</a></li>
</ul></li>
<li class="part"><span><b>IV Use-cases</b></span></li>
<li class="chapter" data-level="21" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html"><i class="fa fa-check"></i><b>21</b> FIFA 19</a>
<ul>
<li class="chapter" data-level="21.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAintro"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAdataprep"><i class="fa fa-check"></i><b>21.2</b> Data preparation</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r"><i class="fa fa-check"></i><b>21.2.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="21.2.2" data-path="do-it-yourself.html"><a href="do-it-yourself.html#code-snippets-for-python"><i class="fa fa-check"></i><b>21.2.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAdataunderst"><i class="fa fa-check"></i><b>21.3</b> Data understanding</a></li>
<li class="chapter" data-level="21.4" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAmodelassembly"><i class="fa fa-check"></i><b>21.4</b> Model assembly</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>21.4.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="21.4.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-1"><i class="fa fa-check"></i><b>21.4.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAmodelaudit"><i class="fa fa-check"></i><b>21.5</b> Model audit</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>21.5.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="21.5.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-2"><i class="fa fa-check"></i><b>21.5.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="21.6" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAmodelunderst"><i class="fa fa-check"></i><b>21.6</b> Model understanding (dataset-level explanations)</a>
<ul>
<li class="chapter" data-level="21.6.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>21.6.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="21.6.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-3"><i class="fa fa-check"></i><b>21.6.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="21.7" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAinstanceunderst"><i class="fa fa-check"></i><b>21.7</b> Instance-level explanations</a>
<ul>
<li class="chapter" data-level="21.7.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFALewy"><i class="fa fa-check"></i><b>21.7.1</b> Robert Lewandowski</a></li>
<li class="chapter" data-level="21.7.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>21.7.2</b> Code snippets for R</a></li>
<li class="chapter" data-level="21.7.3" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-4"><i class="fa fa-check"></i><b>21.7.3</b> Code snippets for Python</a></li>
<li class="chapter" data-level="21.7.4" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFACR7"><i class="fa fa-check"></i><b>21.7.4</b> CR7</a></li>
<li class="chapter" data-level="21.7.5" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFASzczesny"><i class="fa fa-check"></i><b>21.7.5</b> Wojciech Szczęsny</a></li>
<li class="chapter" data-level="21.7.6" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAMessi"><i class="fa fa-check"></i><b>21.7.6</b> Lionel Messi</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>22</b> Reproducibility</a>
<ul>
<li class="chapter" data-level="22.1" data-path="reproducibility.html"><a href="reproducibility.html#package-versions-for-r"><i class="fa fa-check"></i><b>22.1</b> Package versions for R</a></li>
<li class="chapter" data-level="22.2" data-path="reproducibility.html"><a href="reproducibility.html#package-versions-for-python"><i class="fa fa-check"></i><b>22.2</b> Package versions for Python</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/ModelOriented/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Explanatory Model Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="UseCaseFIFA" class="section level1" number="21">
<h1><span class="header-section-number">21</span> FIFA 19</h1>
<div id="FIFAintro" class="section level2" number="21.1">
<h2><span class="header-section-number">21.1</span> Introduction</h2>
<p>In the previous chapters, we introduced a range of methods for the exploration of predictive models. Different methods were discussed in separate chapters, and while illustrated, they were not directly compared. Thus, in this chapter, we apply the methods to one dataset in order to present their relative merits. In particular, we present an example of a full process of a model development along the lines introduced in Chapter <a href="modelDevelopmentProcess.html#modelDevelopmentProcess">2</a>. This will allow us to show how one can combine results from different methods.</p>
<!----
The main goal of this chapter is to show how different techniques complement each other. Some phases, like data preparation, are simplified in order to leave space for the method for visual exploration and explanation of predictive models.
---->
<p>The Fédération Internationale de Football Association (FIFA) is a governing body of football (sometimes, especially in the USA, called soccer). FIFA is also a series of video games developed by EA Sports which faithfully reproduces the characteristics of real players. FIFA ratings of football players from the video game can be found at <code>https://sofifa.com/</code>. Data from this website for 2019 were scrapped and made available at the Kaggle webpage <code>https://www.kaggle.com/karangadiya/fifa19</code>.</p>
<p>We will use the data to build a predictive model for the evaluation of a player’s value. Subsequently, we will use the model exploration and explanation methods to better understand the model’s performance, as well as which variables and how to influence a player’s value.</p>
</div>
<div id="FIFAdataprep" class="section level2" number="21.2">
<h2><span class="header-section-number">21.2</span> Data preparation</h2>
<p>The original dataset contains 89 variables that describe 16,924 players. The variables include information such as age, nationality, club, wage, etc. In what follows, we focus on 45 variables that are included in data frame <code>fifa</code> included in the <code>DALEX</code> package for R and Python. The variables from this dataset set are listed in Table <a href="UseCaseFIFA.html#tab:FIFAvariables">21.1</a>.</p>
<table>
<caption><span id="tab:FIFAvariables">Table 21.1: </span> Variables in the FIFA 19 dataset.</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Weak.Foot</td>
<td align="left">FKAccuracy</td>
<td align="left">Jumping</td>
<td align="left">Composure</td>
</tr>
<tr class="even">
<td align="left">Club</td>
<td align="left">Skill.Moves</td>
<td align="left">LongPassing</td>
<td align="left">Stamina</td>
<td align="left">Marking</td>
</tr>
<tr class="odd">
<td align="left">Position</td>
<td align="left">Crossing</td>
<td align="left">BallControl</td>
<td align="left">Strength</td>
<td align="left">StandingTackle</td>
</tr>
<tr class="even">
<td align="left">Value.EUR</td>
<td align="left">Finishing</td>
<td align="left">Acceleration</td>
<td align="left">LongShots</td>
<td align="left">SlidingTackle</td>
</tr>
<tr class="odd">
<td align="left">Age</td>
<td align="left">HeadingAccuracy</td>
<td align="left">SprintSpeed</td>
<td align="left">Aggression</td>
<td align="left">GKDiving</td>
</tr>
<tr class="even">
<td align="left">Overall</td>
<td align="left">ShortPassing</td>
<td align="left">Agility</td>
<td align="left">Interceptions</td>
<td align="left">GKHandling</td>
</tr>
<tr class="odd">
<td align="left">Special</td>
<td align="left">Volleys</td>
<td align="left">Reactions</td>
<td align="left">Positioning</td>
<td align="left">GKKicking</td>
</tr>
<tr class="even">
<td align="left">Preferred.Foot</td>
<td align="left">Dribbling</td>
<td align="left">Balance</td>
<td align="left">Vision</td>
<td align="left">GKPositioning</td>
</tr>
<tr class="odd">
<td align="left">Reputation</td>
<td align="left">Curve</td>
<td align="left">ShotPower</td>
<td align="left">Penalties</td>
<td align="left">GKReflexes</td>
</tr>
</tbody>
</table>
<p>In particular, variable <code>Value.EUR</code> contains the player’s value in millions of EUR. This will be our dependent variable.</p>
<p>The distribution of the variable is heavily skewed to the right. In particular, the quartiles are equal to 325,000 EUR, 725,000 EUR, and 2,534,478 EUR. There are three players with a value higher than 100 millions of Euro.</p>
<p>Thus, in our analyses, we will consider a logarithmically-transformed player’s value. Figure <a href="UseCaseFIFA.html#fig:distFIFA19Value">21.1</a> presents the empirical cumulative-distribution function and histogram for the transformed value. They indicate that the transformation makes the distribution less skewed.</p>

<div class="figure" style="text-align: center"><span id="fig:distFIFA19Value"></span>
<img src="ema_files/figure-html/distFIFA19Value-1.png" alt="The empirical cumulative-distribution function and histogram for the log\(_{10}\)-transformed players’ values." width="90%" />
<p class="caption">
Figure 21.1: The empirical cumulative-distribution function and histogram for the log<span class="math inline">\(_{10}\)</span>-transformed players’ values.
</p>
</div>
<p>Additionally, we take a closer look at four characteristics that will be considered as explanatory variables later in this chapter. These are: <code>Age</code>, <code>Reactions</code> (a movement skill), <code>BallControl</code> (a general skill), and <code>Dribbling</code> (a general skill).</p>
<p>Figure <a href="UseCaseFIFA.html#fig:distFIFA19histograms">21.2</a> presents histograms of the values of the four variables. From the plot for <code>Age</code> we can conclude that most of the players are between 20 and 30 years of age (median age: 25). Variable <code>Reactions</code> has an approximately symmetric distribution, with quartiles equal to 56, 62, and 68. Histograms of <code>BallControl</code> and <code>Dribbling</code> indicate, interestingly, bimodal distributions. The smaller modes are due to goalkeepers.</p>

<div class="figure" style="text-align: center"><span id="fig:distFIFA19histograms"></span>
<img src="ema_files/figure-html/distFIFA19histograms-1.png" alt="Histograms for selected characteristics of players." width="90%" />
<p class="caption">
Figure 21.2: Histograms for selected characteristics of players.
</p>
</div>
<div id="code-snippets-for-r" class="section level3" number="21.2.1">
<h3><span class="header-section-number">21.2.1</span> Code snippets for R</h3>
<p>The subset of 5,000 most valuable players from the FIFA 19 data is available in the <code>fifa</code> data frame in the <code>DALEX</code> package.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="UseCaseFIFA.html#cb244-1"></a><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</span>
<span id="cb244-2"><a href="UseCaseFIFA.html#cb244-2"></a><span class="kw">head</span>(fifa)</span></code></pre></div>
</div>
<div id="code-snippets-for-python" class="section level3" number="21.2.2">
<h3><span class="header-section-number">21.2.2</span> Code snippets for Python</h3>
<p>The subset of 5,000 most valuable players from FIFA 19 data can be loaded to Python with <code>dalex.datasets.load_fifa()</code> method.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb245-1"><a href="UseCaseFIFA.html#cb245-1"></a><span class="im">import</span> dalex <span class="im">as</span> dx</span>
<span id="cb245-2"><a href="UseCaseFIFA.html#cb245-2"></a>fifa <span class="op">=</span> dx.datasets.load_fifa()</span></code></pre></div>
</div>
</div>
<div id="FIFAdataunderst" class="section level2" number="21.3">
<h2><span class="header-section-number">21.3</span> Data understanding</h2>
<p>We will investigate the relationship between the four selected characteristics and the (logarithmically-transformed) player’s value. Toward this aim, we use the scatter plots shown in Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter">21.3</a>. Each plot includes a smoothed curve capturing the trend.</p>
<p>For <code>Age</code>, the relationship is not monotonic. There seems to be an optimal age, between 25 and 30 years, at which the player’s value reaches the maximum. On the other hand, the value of youngest and oldest players is about 10 times lower, as compared to the maximum.</p>
<p>For variables <code>BallControl</code> and <code>Dribbling</code>, the relationship is not monotonic. In general, the larger value of these coefficients, the large value of a player. However, there are “local” maxima for players with low scores for <code>BallControl</code> and <code>Dribbling</code>. As it was suggested earlier, these are probably goalkeepers.</p>
<p>For <code>Reactions</code>, the association with the player’s value is monotonic, with increasing values of the variable leading to increasing values of players.</p>

<div class="figure" style="text-align: center"><span id="fig:distFIFA19scatter"></span>
<img src="ema_files/figure-html/distFIFA19scatter-1.png" alt="Scatter plots illustrating the relationship between the (logarithmically-transformed) player’s value and selected characteristics." width="90%" />
<p class="caption">
Figure 21.3: Scatter plots illustrating the relationship between the (logarithmically-transformed) player’s value and selected characteristics.
</p>
</div>
<p>Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter2">21.4</a> presents the scatter-plot matrix for the four selected variables. It indicates that all variables are positively correlated, though with different strength. In particular, <code>BallControl</code> and <code>Dribbling</code> are strongly correlated, with the estimated correlation coefficient larger than 0.9. <code>Reactions</code> is moderately correlated with the other three variables. Finally, there is a moderate correlation between <code>Age</code> and <code>Reactions</code>, but not much correlation with <code>BallControl</code> and <code>Dribbling</code>.</p>

<div class="figure" style="text-align: center"><span id="fig:distFIFA19scatter2"></span>
<img src="ema_files/figure-html/distFIFA19scatter2-1.png" alt="Scatter-plot matrix illustrating the relationship between selected characteristics of players." width="90%" />
<p class="caption">
Figure 21.4: Scatter-plot matrix illustrating the relationship between selected characteristics of players.
</p>
</div>
</div>
<div id="FIFAmodelassembly" class="section level2" number="21.4">
<h2><span class="header-section-number">21.4</span> Model assembly</h2>
<p>In this section, we develop a model for players’ values. We consider all variables other than <code>Name</code>, <code>Club</code>, <code>Position</code>, <code>Value.EUR</code>, <code>Overall</code>, and <code>Special</code> (see Section <a href="UseCaseFIFA.html#FIFAdataprep">21.2</a>) as explanatory variables. The base-10 logarithm of the player’s value is the dependent variable. <!--The data to be analyzed are stored in data frame `fifa19small_red`, as indicated in the code below. --></p>
<p>Given different possible forms of relationship between the (logarithmically-transformed) player’s value and explanatory variables (as seen, for example, in Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter">21.3</a>), we build four different, flexible models to check whether they are capable of capturing the various relationships. In particular, we consider the following models:</p>
<ul>
<li>a boosting model with 250 trees of 1-level depth, as implemented in package <code>gbm</code> <span class="citation">(Ridgeway <a href="#ref-gbm" role="doc-biblioref">2017</a>)</span>,</li>
<li>a boosting model with 250 trees of 4-levels depth (this model should be able to catch interactions between variables),</li>
<li>a random forest model with 250 trees, as implemented in package <code>ranger</code> <span class="citation">(Wright and Ziegler <a href="#ref-rangerRpackage" role="doc-biblioref">2017</a>)</span>,</li>
<li>a linear model with a spline-transformation of explanatory variables, as implemented in package <code>rms</code> <span class="citation">(Harrell Jr <a href="#ref-rms" role="doc-biblioref">2018</a>)</span>.</li>
</ul>
<p>These models will be explored in detail in the following sections.</p>
<div id="code-snippets-for-r-1" class="section level3" number="21.4.1">
<h3><span class="header-section-number">21.4.1</span> Code snippets for R</h3>
<p>In this section, we show R-code snippets used to develop the gradient boosting model. Other models were built in a similar way.</p>
<p>The code below fits the model to the data. The dependent variable <code>LogValue</code> contains the base-10 logarithm of <code>Value.EUR</code>, i.e., of the player’s value.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="UseCaseFIFA.html#cb246-1"></a>fifa<span class="op">$</span>LogValue &lt;-<span class="st"> </span><span class="kw">log10</span>(fifa<span class="op">$</span>Value.EUR)</span>
<span id="cb246-2"><a href="UseCaseFIFA.html#cb246-2"></a>fifa_small &lt;-<span class="st"> </span>fifa[,<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>)]</span>
<span id="cb246-3"><a href="UseCaseFIFA.html#cb246-3"></a></span>
<span id="cb246-4"><a href="UseCaseFIFA.html#cb246-4"></a>fifa_gbm_deep &lt;-<span class="st"> </span><span class="kw">gbm</span>(LogValue<span class="op">~</span>., <span class="dt">data =</span> fifa_small, <span class="dt">n.trees =</span> <span class="dv">250</span>,</span>
<span id="cb246-5"><a href="UseCaseFIFA.html#cb246-5"></a>        <span class="dt">interaction.depth =</span> <span class="dv">4</span>, <span class="dt">distribution =</span> <span class="st">&quot;gaussian&quot;</span>)</span></code></pre></div>
<p>For model-exploration purposes, we have got to create an explainer-object with the help of the <code>DALEX::explain()</code> function (see Section <a href="dataSetsIntro.html#ExplainersTitanicRCode">4.2.6</a>). The code below is used for the gradient boosting model. Note that the model was fitted to the logarithmically-transformed player’s value. However, it is more natural to interpret the predictions on the original scale. This is why, in the provided syntax, we apply the <code>predict_function</code> argument to specify a user-defined function to obtain predictions on the original scale, in Euro. Additionally, we use the <code>data</code> and <code>y</code> arguments to indicate the data frame with explanatory variables and the values of the dependent variable, for which predictions are to be obtained. Finally, the model receives its own <code>label</code>.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="UseCaseFIFA.html#cb247-1"></a><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</span>
<span id="cb247-2"><a href="UseCaseFIFA.html#cb247-2"></a>fifa_gbm_exp_deep &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw">explain</span>(fifa_gbm_deep, </span>
<span id="cb247-3"><a href="UseCaseFIFA.html#cb247-3"></a>        <span class="dt">data =</span> fifa_small, <span class="dt">y =</span> <span class="dv">10</span><span class="op">^</span>fifa_small<span class="op">$</span>LogValue, </span>
<span id="cb247-4"><a href="UseCaseFIFA.html#cb247-4"></a>        <span class="dt">predict_function =</span> <span class="cf">function</span>(m,x) <span class="dv">10</span><span class="op">^</span><span class="kw">predict</span>(m, x, <span class="dt">n.trees =</span> <span class="dv">250</span>),</span>
<span id="cb247-5"><a href="UseCaseFIFA.html#cb247-5"></a>        <span class="dt">label =</span> <span class="st">&quot;GBM deep&quot;</span>)</span></code></pre></div>
</div>
<div id="code-snippets-for-python-1" class="section level3" number="21.4.2">
<h3><span class="header-section-number">21.4.2</span> Code snippets for Python</h3>
<p>In this section, we show Python-code snippets used to develop the gradient boosting model. Other models were built in a similar way.</p>
<p>The code below fits the model to the data. The dependent variable <code>ylog</code> contains the logarithm of <code>value_eur</code>, i.e., of the player’s value.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb248-1"><a href="UseCaseFIFA.html#cb248-1"></a><span class="im">from</span> lightgbm <span class="im">import</span> LGBMRegressor</span>
<span id="cb248-2"><a href="UseCaseFIFA.html#cb248-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb248-3"><a href="UseCaseFIFA.html#cb248-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb248-4"><a href="UseCaseFIFA.html#cb248-4"></a></span>
<span id="cb248-5"><a href="UseCaseFIFA.html#cb248-5"></a>X <span class="op">=</span> fifa.drop([<span class="st">&quot;nationality&quot;</span>, <span class="st">&quot;overall&quot;</span>, <span class="st">&quot;potential&quot;</span>, </span>
<span id="cb248-6"><a href="UseCaseFIFA.html#cb248-6"></a>     <span class="st">&quot;value_eur&quot;</span>, <span class="st">&quot;wage_eur&quot;</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb248-7"><a href="UseCaseFIFA.html#cb248-7"></a>y <span class="op">=</span> fifa[<span class="st">&#39;value_eur&#39;</span>]</span>
<span id="cb248-8"><a href="UseCaseFIFA.html#cb248-8"></a>ylog <span class="op">=</span> np.log(y)</span>
<span id="cb248-9"><a href="UseCaseFIFA.html#cb248-9"></a></span>
<span id="cb248-10"><a href="UseCaseFIFA.html#cb248-10"></a>X_train, X_test, ylog_train, ylog_test, y_train, y_test <span class="op">=</span></span>
<span id="cb248-11"><a href="UseCaseFIFA.html#cb248-11"></a>     train_test_split(X, ylog, y, test_size <span class="op">=</span> <span class="fl">0.25</span>, random_state <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb248-12"><a href="UseCaseFIFA.html#cb248-12"></a>gbm_model <span class="op">=</span> LGBMRegressor()</span>
<span id="cb248-13"><a href="UseCaseFIFA.html#cb248-13"></a>gbm_model.fit(X_train, ylog_train, verbose <span class="op">=</span> <span class="va">False</span>)</span></code></pre></div>
<p>For model-exploration purposes, we have to create the explainer-object with the help the <code>Explainer()</code> constructor from the <code>dalex</code> library (see Section <a href="dataSetsIntro.html#ExplainersTitanicPythonCode">4.3.6</a>). The code is provided below. Note that the model was fitted to the logarithmically-transformed player’s value. However, it is more natural to interpret the predictions on the original scale. This is why, in the provided syntax, we apply the <code>predict_function</code> argument to specify a user-defined function to obtain predictions on the original scale, in Euro. Additionally, we use the <code>X</code> and <code>y</code> arguments to indicate the data frame with explanatory variables and the values of the dependent variable, for which predictions are to be obtained. Finally, the model receives its own <code>label</code>.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb249-1"><a href="UseCaseFIFA.html#cb249-1"></a><span class="kw">def</span> predict_function(model, data):</span>
<span id="cb249-2"><a href="UseCaseFIFA.html#cb249-2"></a>    <span class="cf">return</span> np.exp(model.predict(data))</span>
<span id="cb249-3"><a href="UseCaseFIFA.html#cb249-3"></a>    </span>
<span id="cb249-4"><a href="UseCaseFIFA.html#cb249-4"></a>fifa_gbm_exp <span class="op">=</span> dx.Explainer(gbm_model, X_test, y_test, </span>
<span id="cb249-5"><a href="UseCaseFIFA.html#cb249-5"></a>    predict_function <span class="op">=</span> predict_function, label <span class="op">=</span> <span class="st">&#39;gbm&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="FIFAmodelaudit" class="section level2" number="21.5">
<h2><span class="header-section-number">21.5</span> Model audit</h2>
<p>Having developed the four candidate models, we may want to evaluate their performance. Toward this aim, we can use the measures discussed in Section <a href="modelPerformance.html#modelPerformanceMethodCont">15.3.1</a>. The computed values are presented in Table <a href="UseCaseFIFA.html#tab:modelPerformanceFIFA">21.2</a>. On average, the values of the root-mean-squared-error (RMSE) and mean-absolute-deviation (MAD) are the smallest for the random forest model.</p>
<table>
<caption><span id="tab:modelPerformanceFIFA">Table 21.2: </span> Model-performance measures for the four models for the FIFA 19 data.</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">MSE</th>
<th align="right">RMSE</th>
<th align="right">R2</th>
<th align="right">MAD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GBM shallow</td>
<td align="right">8.990694e+12</td>
<td align="right">2998449</td>
<td align="right">0.7300429</td>
<td align="right">183682.91</td>
</tr>
<tr class="even">
<td>GBM deep</td>
<td align="right">2.211439e+12</td>
<td align="right">1487091</td>
<td align="right">0.9335987</td>
<td align="right">118425.56</td>
</tr>
<tr class="odd">
<td>RF</td>
<td align="right">1.141176e+12</td>
<td align="right">1068258</td>
<td align="right">0.9657347</td>
<td align="right">50693.24</td>
</tr>
<tr class="even">
<td>RM</td>
<td align="right">2.191297e+13</td>
<td align="right">4681129</td>
<td align="right">0.3420350</td>
<td align="right">148187.06</td>
</tr>
</tbody>
</table>
<!----
Figure \@ref(fig:modelPerformanceBoxplot) compares distributions of absolute model residuals. Crosses corresponds to average, which correspond to RMSE. On average, smallest residuals are for the Random Forest model.

(ref:modelPerformanceBoxplotDesc) Distribution of absolute values of residuals. The means are indicated by dots.
---->
<p>In addition to computing measures of the overall performance of the model, we should conduct a more detailed examination of both overall- and instance-specific performance. Toward this aim, we can apply residual diagnostics, as discussed in Chapter <a href="residualDiagnostic.html#residualDiagnostic">19</a>.</p>
<p>For instance, we can create a plot comparing the predicted (fitted) and observed values of the dependent variable.</p>

<div class="figure" style="text-align: center"><span id="fig:modelPerformanceScatterplot"></span>
<img src="ema_files/figure-html/modelPerformanceScatterplot-1.png" alt="Observed and predicted (fitted) player’s values for the four models for the FIFA 19 data." width="90%" />
<p class="caption">
Figure 21.5: Observed and predicted (fitted) player’s values for the four models for the FIFA 19 data.
</p>
</div>
<p>The resulting plot is shown in Figure <a href="UseCaseFIFA.html#fig:modelPerformanceScatterplot">21.5</a>. It indicates that predictions are closest to the observed values of the dependent variable for the random forest model. It is worth noting that the smoothed trend for the model is close to a straight line, but with a slope smaller than 1. This implies the random forest model underestimates the actual value of the most expensive players, while it overestimates the value for the least expensive ones. A similar pattern can be observed for the gradient boosting models. This “shrinking to the mean” is typical for this type of models.</p>
<div id="code-snippets-for-r-2" class="section level3" number="21.5.1">
<h3><span class="header-section-number">21.5.1</span> Code snippets for R</h3>
<p>In this section, we show R-code snippets for model audit for the gradient boosting model. For other models a similar syntax was used.</p>
<p>The <code>model_performance()</code> function (see Section <a href="modelPerformance.html#modelPerformanceR">15.6</a>) is used to calculate the values of RMSE, MSE, R<span class="math inline">\(^2\)</span>, and MAD for the model.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="UseCaseFIFA.html#cb250-1"></a><span class="kw">model_performance</span>(fifa_gbm_exp_deep)</span></code></pre></div>
<p>The <code>model_diagnostics()</code> function (see Section <a href="residualDiagnostic.html#RcodeResidualDiagnostic">19.6</a>) is used to create residual-diagnostics plots. Results of this function can be visualised with the generic <code>plot()</code> function. In the code below, additional arguments are used to improve the outlook and interpretability of both axes.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="UseCaseFIFA.html#cb251-1"></a>fifa_md_gbm_deep &lt;-<span class="st"> </span><span class="kw">model_diagnostics</span>(fifa_gbm_exp_deep)</span>
<span id="cb251-2"><a href="UseCaseFIFA.html#cb251-2"></a><span class="kw">plot</span>(fifa_md_gbm_deep, </span>
<span id="cb251-3"><a href="UseCaseFIFA.html#cb251-3"></a>     <span class="dt">variable =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">yvariable =</span> <span class="st">&quot;y_hat&quot;</span>) <span class="op">+</span></span>
<span id="cb251-4"><a href="UseCaseFIFA.html#cb251-4"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Value in Euro&quot;</span>, <span class="dt">trans =</span> <span class="st">&quot;log10&quot;</span>, </span>
<span id="cb251-5"><a href="UseCaseFIFA.html#cb251-5"></a>                      <span class="dt">labels =</span> <span class="kw">dollar_format</span>(<span class="dt">suffix =</span> <span class="st">&quot;€&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb251-6"><a href="UseCaseFIFA.html#cb251-6"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Predicted value in Euro&quot;</span>, <span class="dt">trans =</span> <span class="st">&quot;log10&quot;</span>, </span>
<span id="cb251-7"><a href="UseCaseFIFA.html#cb251-7"></a>                     <span class="dt">labels =</span> <span class="kw">dollar_format</span>(<span class="dt">suffix =</span> <span class="st">&quot;€&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb251-8"><a href="UseCaseFIFA.html#cb251-8"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb251-9"><a href="UseCaseFIFA.html#cb251-9"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Predicted and observed player&#39;s values&quot;</span>, <span class="st">&quot;&quot;</span>) </span></code></pre></div>
</div>
<div id="code-snippets-for-python-2" class="section level3" number="21.5.2">
<h3><span class="header-section-number">21.5.2</span> Code snippets for Python</h3>
<p>In this section, we show Python-code snippets used to perform residual diagnostic for trained the gradient boosting model. Other models were tested in a similar way.</p>
<p>The <code>fifa_gbm_exp.model_diagnostics()</code> function (see Section <a href="residualDiagnostic.html#PythoncodeResidualDiagnostic">19.7</a>) is used to calculate the residuals and absolute residuals.
Results of this function can be visualised with the <code>plot()</code> function. The code below produce diagnostic plots similar to these presented in figure <a href="UseCaseFIFA.html#fig:modelPerformanceScatterplot">21.5</a>.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb252-1"><a href="UseCaseFIFA.html#cb252-1"></a>fifa_md_gbm <span class="op">=</span> fifa_gbm_exp.model_diagnostics()</span>
<span id="cb252-2"><a href="UseCaseFIFA.html#cb252-2"></a>fifa_md_gbm.plot(variable <span class="op">=</span> <span class="st">&quot;y&quot;</span>, yvariable <span class="op">=</span> <span class="st">&quot;y_hat&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="FIFAmodelunderst" class="section level2" number="21.6">
<h2><span class="header-section-number">21.6</span> Model understanding (dataset-level explanations)</h2>
<p>All four developed models involve many explanatory variables. It is of interest to understand which of the variables exercises the largest influence of models’ predictions. Toward this aim, we can apply the permutation-based variable-importance measure discussed in Chapter <a href="featureImportance.html#featureImportance">16</a>. Subsequently, we can construct a plot of the obtained mean (over the default 10 permutations) variable-importance measures. Note that we consider only the top 20 variables.</p>

<div class="figure" style="text-align: center"><span id="fig:featureImportancePlot"></span>
<img src="ema_files/figure-html/featureImportancePlot-1.png" alt="Mean variable-importance calculated using 10 permutations for the four models for the FIFA 19 data." width="100%" />
<p class="caption">
Figure 21.6: Mean variable-importance calculated using 10 permutations for the four models for the FIFA 19 data.
</p>
</div>
<p>The resulting plot is shown in Figure <a href="UseCaseFIFA.html#fig:featureImportancePlot">21.6</a>. The bar for each explanatory variable starts at the RMSE value of a particular model and ends at the (mean) RMSE calculated for data with permuted values of the variable.</p>
<p>Figure <a href="UseCaseFIFA.html#fig:featureImportancePlot">21.6</a> indicates that, for the gradient-booting and random forest models, the two explanatory variables with the largest values of the importance measure are <code>Reactions</code> or <code>BallControl</code>. The importance of other variables varies depending on the model. Interestingly, in the linear-regression model, the highest importance is given to goal-keeping skills.</p>
<p>We may also want to take a look at the partial-dependence (PD) profiles discussed in Chapter <a href="partialDependenceProfiles.html#partialDependenceProfiles">17</a>. Recall that they illustrate how does the expected value of a model’s predictions behave as a function of an explanatory variable. To create the profiles, we apply function <code>model_profile()</code> from the <code>DALEX</code> package (see Section <a href="partialDependenceProfiles.html#PDPR">17.6</a>). We focus on variables <code>Reactions</code>, <code>BallControl</code>, and <code>Dribbling</code> that were important in the random forest model (see Figure <a href="UseCaseFIFA.html#fig:featureImportancePlot">21.6</a>). We also consider <code>Age</code>, as it had some effect in the gradient boosting models. Subsequently, we can construct a plot of contrastive PD profiles (see Section <a href="partialDependenceProfiles.html#contrastivePDPs">17.3.4</a>) that is shown in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFApdPlot">21.7</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFApdPlot"></span>
<img src="ema_files/figure-html/usecaseFIFApdPlot-1.png" alt="Contrastive partial-dependence profiles for the four models and selected explanatory variables for the FIFA 19 data." width="90%" />
<p class="caption">
Figure 21.7: Contrastive partial-dependence profiles for the four models and selected explanatory variables for the FIFA 19 data.
</p>
</div>
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFApdPlot">21.7</a> indicates that the shape of the PD profiles for <code>Reactions</code>, <code>BallControl</code>, and <code>Dribbling</code> is, in general, similar for all the models and implies an increasing predicted player’s value for an increasing (at least, after passing some threshold) value of the explanatory variable. However, for <code>Age</code>, the shape is different and suggests a decreasing player’s value after the age of about 25 years. It is worth noting that the range of expected model’s predictions is, in general, the smallest for the random forest model. Also, the three tree-based models tend to stabilize the predictions at the ends of the explanatory-variable ranges.</p>
<p>The most interesting difference between the conclusions drawn from Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter">21.3</a> and those obtained from Figure <a href="UseCaseFIFA.html#fig:usecaseFIFApdPlot">21.7</a> is observed for variable <code>Age</code>. In particular, Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter">21.3</a> suggests that the relationship between player’s age and value is non-monotonic, while Figure <a href="UseCaseFIFA.html#fig:usecaseFIFApdPlot">21.7</a> suggests a non-increasing relationship. How can we explain this difference? A possible explanation is as follows. The youngest players have lower values, not because of their age, but because of their lower skills, which are correlated (as seen from the scatter-plot matrix in Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter2">21.4</a>) with young age. The simple data exploration analysis, presented in the upper-left panel of Figure <a href="UseCaseFIFA.html#fig:distFIFA19scatter">21.3</a>, cannot separate the effects of age and skills. As a result, the analysis suggests a decrease in player’s value for the youngest players. In models, however, the effect of age is estimated while adjusting for the effect of skills. After this adjustment, the effect takes the form of a non-increasing pattern, as shown by the PD profiles for <code>Age</code> in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFApdPlot">21.7</a>.</p>
<p>This example indicates that <em>exploration of models may provide more insight than exploration of raw data</em>. In exploratory data analysis, the effect of variable <code>Age</code> was confounded by the effect of skill-related variables. By using a model, the confounding has been removed.</p>
<div id="code-snippets-for-r-3" class="section level3" number="21.6.1">
<h3><span class="header-section-number">21.6.1</span> Code snippets for R</h3>
<p>In this section, we show R-code snippets for dataset-level exploration for the gradient boosting model. For other models a similar syntax was used.</p>
<p>The <code>model_parts()</code> function from the <code>DALEX</code> package (see Section <a href="featureImportance.html#featureImportanceR">16.6</a>) is used to calculate the permutation-based variable-importance measure. The generic <code>plot()</code> function is applied to graphically present the computed values of the measure. The <code>max_vars</code> argument is used to limit the number of presented variables up to 20.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="UseCaseFIFA.html#cb253-1"></a>fifa_mp_gbm_deep &lt;-<span class="st"> </span><span class="kw">model_parts</span>(fifa_gbm_exp_deep)</span>
<span id="cb253-2"><a href="UseCaseFIFA.html#cb253-2"></a><span class="kw">plot</span>(fifa_mp_gbm_deep, <span class="dt">max_vars =</span> <span class="dv">20</span>, </span>
<span id="cb253-3"><a href="UseCaseFIFA.html#cb253-3"></a>     <span class="dt">bar_width =</span> <span class="dv">4</span>, <span class="dt">show_boxplots =</span> <span class="ot">FALSE</span>) </span></code></pre></div>
<p>The <code>model_profile()</code> function from the <code>DALEX</code> package (see Section <a href="partialDependenceProfiles.html#PDPR">17.6</a>) is used to calculate PD profiles. The generic <code>plot()</code> function is used to graphically present the profiles for selected variables.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="UseCaseFIFA.html#cb254-1"></a>selected_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Reactions&quot;</span>, <span class="st">&quot;BallControl&quot;</span>, <span class="st">&quot;Dribbling&quot;</span>, <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb254-2"><a href="UseCaseFIFA.html#cb254-2"></a>fifa19_pd_deep &lt;-<span class="st"> </span><span class="kw">model_profile</span>(fifa_gbm_exp_deep, </span>
<span id="cb254-3"><a href="UseCaseFIFA.html#cb254-3"></a>                             <span class="dt">variables =</span> selected_variables)</span>
<span id="cb254-4"><a href="UseCaseFIFA.html#cb254-4"></a><span class="kw">plot</span>(fifa19_pd_deep)</span></code></pre></div>
</div>
<div id="code-snippets-for-python-3" class="section level3" number="21.6.2">
<h3><span class="header-section-number">21.6.2</span> Code snippets for Python</h3>
<p>In this section, we show Python code snippets for dataset-level exploration for the gradient boosting model. For other models a similar syntax was used.</p>
<p>The <code>model_parts()</code> method from the <code>dalex</code> library (see Section <a href="featureImportance.html#featureImportancePython">16.7</a>) is used to calculate the permutation-based variable-importance measure. The <code>plot()</code> method is applied to graphically present the computed values of the measure.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb255-1"><a href="UseCaseFIFA.html#cb255-1"></a>fifa_mp_gbm <span class="op">=</span> fifa_gbm_exp.model_parts()</span>
<span id="cb255-2"><a href="UseCaseFIFA.html#cb255-2"></a>fifa_mp_gbm.plot(max_vars <span class="op">=</span> <span class="dv">20</span>)</span></code></pre></div>
<p>The <code>model_profile()</code> method from the <code>dalex</code> library (see Section <a href="partialDependenceProfiles.html#PDPPython">17.7</a>) is used to calculate PD profiles. The <code>plot()</code> method is used to graphically present the computed profiles.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb256-1"><a href="UseCaseFIFA.html#cb256-1"></a>fifa_mp_gbm <span class="op">=</span> fifa_gbm_exp.model_profile()</span>
<span id="cb256-2"><a href="UseCaseFIFA.html#cb256-2"></a></span>
<span id="cb256-3"><a href="UseCaseFIFA.html#cb256-3"></a>fifa_mp_gbm.plot(variables <span class="op">=</span> [<span class="st">&#39;movement_reactions&#39;</span>,</span>
<span id="cb256-4"><a href="UseCaseFIFA.html#cb256-4"></a>    <span class="st">&#39;skill_ball_control&#39;</span>, <span class="st">&#39;skill_dribbling&#39;</span>, <span class="st">&#39;age&#39;</span>])</span></code></pre></div>
<p>In order to calculated other types of profiles, just change the <code>type</code> argument.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb257-1"><a href="UseCaseFIFA.html#cb257-1"></a>fifa_mp_gbm <span class="op">=</span> fifa_gbm_exp.model_profile(<span class="bu">type</span> <span class="op">=</span> <span class="st">&#39;accumulated&#39;</span>)</span>
<span id="cb257-2"><a href="UseCaseFIFA.html#cb257-2"></a></span>
<span id="cb257-3"><a href="UseCaseFIFA.html#cb257-3"></a>fifa_mp_gbm.plot(variables <span class="op">=</span> [<span class="st">&#39;movement_reactions&#39;</span>,</span>
<span id="cb257-4"><a href="UseCaseFIFA.html#cb257-4"></a>    <span class="st">&#39;skill_ball_control&#39;</span>, <span class="st">&#39;skill_dribbling&#39;</span>, <span class="st">&#39;age&#39;</span>])</span></code></pre></div>
</div>
</div>
<div id="FIFAinstanceunderst" class="section level2" number="21.7">
<h2><span class="header-section-number">21.7</span> Instance-level explanations</h2>
<p>After evaluation of the models at the dataset-level, we may want to focus on particular instances.</p>
<div id="FIFALewy" class="section level3" number="21.7.1">
<h3><span class="header-section-number">21.7.1</span> Robert Lewandowski</h3>
<p>As a first example, we take a look at the value of <em>Robert Lewandowski</em>, for an obvious reason. Table <a href="UseCaseFIFA.html#tab:RobertLewandowski">21.3</a> presents his characteristics, as included in the analyzed dataset. Robert Lewandowski is a striker.</p>
<table>
<caption><span id="tab:RobertLewandowski">Table 21.3: </span> Characteristics of Robert Lewandowski.</caption>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age</td>
<td align="right">29</td>
<td align="left">Dribbling</td>
<td align="right">85</td>
<td align="left">ShotPower</td>
<td align="right">88</td>
<td align="left">Composure</td>
<td align="right">86</td>
</tr>
<tr class="even">
<td align="left">Preferred.Foot</td>
<td align="right">2</td>
<td align="left">Curve</td>
<td align="right">77</td>
<td align="left">Jumping</td>
<td align="right">84</td>
<td align="left">Marking</td>
<td align="right">34</td>
</tr>
<tr class="odd">
<td align="left">Reputation</td>
<td align="right">4</td>
<td align="left">FKAccuracy</td>
<td align="right">86</td>
<td align="left">Stamina</td>
<td align="right">78</td>
<td align="left">StandingTackle</td>
<td align="right">42</td>
</tr>
<tr class="even">
<td align="left">Weak.Foot</td>
<td align="right">4</td>
<td align="left">LongPassing</td>
<td align="right">65</td>
<td align="left">Strength</td>
<td align="right">84</td>
<td align="left">SlidingTackle</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">Skill.Moves</td>
<td align="right">4</td>
<td align="left">BallControl</td>
<td align="right">89</td>
<td align="left">LongShots</td>
<td align="right">84</td>
<td align="left">GKDiving</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">Crossing</td>
<td align="right">62</td>
<td align="left">Acceleration</td>
<td align="right">77</td>
<td align="left">Aggression</td>
<td align="right">80</td>
<td align="left">GKHandling</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Finishing</td>
<td align="right">91</td>
<td align="left">SprintSpeed</td>
<td align="right">78</td>
<td align="left">Interceptions</td>
<td align="right">39</td>
<td align="left">GKKicking</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">HeadingAccuracy</td>
<td align="right">85</td>
<td align="left">Agility</td>
<td align="right">78</td>
<td align="left">Positioning</td>
<td align="right">91</td>
<td align="left">GKPositioning</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">ShortPassing</td>
<td align="right">83</td>
<td align="left">Reactions</td>
<td align="right">90</td>
<td align="left">Vision</td>
<td align="right">77</td>
<td align="left">GKReflexes</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">Volleys</td>
<td align="right">89</td>
<td align="left">Balance</td>
<td align="right">78</td>
<td align="left">Penalties</td>
<td align="right">88</td>
<td align="left">LogValue</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p>First, we take a look at variable attributions, discussed in Chapter <a href="breakDown.html#breakDown">6</a>. Recall that they decompose model’s prediction into parts that can be attributed to different explanatory variables. The attributions can be presented in a break-down (BD) plot. For brevity, we only consider the random forest model. The resulting BD plot is shown in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAbreakDownPlot">21.8</a>.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAbreakDownPlot"></span>
<img src="ema_files/figure-html/usecaseFIFAbreakDownPlot-1.png" alt="Break-down plot for Robert Lewandowski for the random forest model." width="100%" />
<p class="caption">
Figure 21.8: Break-down plot for Robert Lewandowski for the random forest model.
</p>
</div>
<!----
fifa_bd_gbm <- variable_attribution(fifa_gbm_exp_shallow, 
                                    new_observation = fifa19small["R. Lewandowski",])
pl1 <- plot(fifa_bd_gbm) +
  scale_y_continuous("Predicted value in Euro", labels = dollar_format(suffix = "€", prefix = "")) + 
  ggtitle("Break-down plot for Robert Lewandowski")
pl1 + pl2
--->
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAbreakDownPlot">21.8</a> suggests that the explanatory variables with the largest effect are <code>Composure</code>, <code>Volleys</code>, <code>LongShots</code>, and <code>Stamina</code>. However, in Chapter <a href="breakDown.html#breakDown">6</a> it was mentioned that variable attributions may depend on the order of explanatory covariates that are used in calculations. Thus, in Chapter <a href="shapley.html#shapley">8</a> we introduced Shapley values, based on the idea of averaging the attributions over many orderings. Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapPlot">21.9</a> presents the means of the Shapley values computed by using 25 random orderings for the random forest model.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAshapPlot"></span>
<img src="ema_files/figure-html/usecaseFIFAshapPlot-1.png" alt="Shapley values for Robert Lewandowski for the random forest model." width="100%" />
<p class="caption">
Figure 21.9: Shapley values for Robert Lewandowski for the random forest model.
</p>
</div>
<!---
fifa_pg <- predict_parts(fifa_gbm_exp_shallow, new_observation = fifa19small["R. Lewandowski",],
                         type = "shap")
plot(fifa_pg, show_boxplots = FALSE) +
  scale_y_continuous("Estimated value in Euro", labels = dollar_format(suffix = "€", prefix = "")) + 
  ggtitle("SHAP values plot for Robert Lewandowski (GBM model)")
--->
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapPlot">21.9</a> indicates that the five explanatory variables with the largest Shapley values are <code>BallControl</code>, <code>Dribbling</code>, <code>Reactions</code>, <code>ShortPassing</code>, and <code>Positioning</code>. This makes sense, as Robert Lewandowski is a striker.</p>
<p>In Chapter <a href="ceterisParibus.html#ceterisParibus">10</a>, we introduced ceteris-paribus (CP) profiles. They capture the effect of a selected explanatory variable in terms of changes in a model’s prediction induced by changes in the variable’s values. Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusPlot">21.10</a> presents the profiles for variables <code>Age</code>, <code>Reactions</code>, <code>BallControl</code>, and <code>Dribbling</code> for the random forest model.</p>
<p><!--The profiles can be obtained with the help of function `predict_profiles()`  package (see Section \@ref(CPR)). We first have got to compute and store the values of the profiles for the selected variables. In the code below we use argument `variable_splits` to provide the values, at which the profiles are to be computed. -->
<!---
fifa_cp_shallow <- predict_profile(fifa_gbm_exp_shallow,
                           new_observation = fifa19small_red["R. Lewandowski",], variables = selected_variables,
                           variable_splits = selected_splits)

fifa_cp_deep <- predict_profile(fifa_gbm_exp_deep,
                           new_observation = fifa19small_red["R. Lewandowski",], variables = selected_variables,
                           variable_splits = selected_splits)

fifa_cp_rf <- predict_profile(fifa_rf_exp,
                           new_observation = fifa19small_red["R. Lewandowski",], variables = selected_variables,
                           variable_splits = selected_splits)

fifa_cp_rm <- predict_profile(fifa_rm_exp,
                           new_observation = fifa19small_red["R. Lewandowski",], variables = selected_variables,
                           variable_splits = selected_splits)

plot(fifa_cp_shallow, fifa_cp_deep, fifa_cp_rf, fifa_cp_rm, color = "_label_", variables = c("Age", "Reactions", "BallControl", "Dribbling")) + 
  scale_y_continuous("Estimated value in Euro", trans = "log10", labels = dollar_format(suffix = "€", prefix = "")) 

---></p>
<!--
Subsequently, we plot the profiles with the help of the `plot()`function. 
-->

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAceterisParibusPlot"></span>
<img src="ema_files/figure-html/usecaseFIFAceterisParibusPlot-1.png" alt="Ceteris-paribus profiles for Robert Lewandowski for four selected variables and the random forest model." width="90%" />
<p class="caption">
Figure 21.10: Ceteris-paribus profiles for Robert Lewandowski for four selected variables and the random forest model.
</p>
</div>
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusPlot">21.10</a> suggests that, among the four variables, <code>BallControl</code> and <code>Reactions</code> lead to the largest changes of predictions for this instance. For all four variables, the profiles flatten at the left- and right-hand-side edges. The predicted value of Robert Lewandowski reaches or is very close to the maximum for all four profiles. It is interesting to note that, for <code>Age</code>, the predicted value is located at the border of the age region at which the profile suggests a sharp drop in player’s value.</p>
<p>As it was argued in Chapter <a href="localDiagnostics.html#localDiagnostics">12</a>, it is worthwhile to check how does the model behave for observations similar to the instance of interest. Towards this aim, we may want to compare the distribution of residuals for “neighbors” of Robert Lewandowski. Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusNeighboursPlot">21.11</a> presents the histogram of residuals for all data and the 30 neighbors of Robert Lewandowski.</p>
<!-- Function `individual_diagnostics()` from the `DALEX` package provides the necessary functionality. First, we use it to select 30 closest neighbours and conduct the necessary computations for them. -->

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAceterisParibusNeighboursPlot"></span>
<img src="ema_files/figure-html/usecaseFIFAceterisParibusNeighboursPlot-1.png" alt="Distribution of residuals for the random forest model for all players and for 30 neighbors of Robert Lewandowski." width="90%" />
<p class="caption">
Figure 21.11: Distribution of residuals for the random forest model for all players and for 30 neighbors of Robert Lewandowski.
</p>
</div>
<p>Clearly, the neighbors of Robert Lewandowski include some of the most expensive players. Therefore, as compared to the overall distribution, the distribution of residuals for the neighbors, presented in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusNeighboursPlot">21.11</a>, is skewed to the right and its mean is larger than the overall mean. Thus, the model underestimates the actual value of the most expensive players. This was also noted based on the plot in the bottom-left panel of Figure <a href="UseCaseFIFA.html#fig:modelPerformanceScatterplot">21.5</a>.</p>
<p>We can also look at the local-stability plot, i.e., the plot that includes CP profiles for the nearest neighbors and the corresponding residuals (see Chapter <a href="localDiagnostics.html#localDiagnostics">12</a>). In Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusNeighboursAgeRFPlot">21.12</a>, we present the plot for <code>Age</code>.</p>
<!-- Thus, we use argument `variables = "Age"` in the call to function `individual_diagnostics()`.   -->
<!--Then we apply function `plot()` to obtain the desired plot.-->

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAceterisParibusNeighboursAgeRFPlot"></span>
<img src="ema_files/figure-html/usecaseFIFAceterisParibusNeighboursAgeRFPlot-1.png" alt="Local-stability plot for Age for 30 neighbors of Robert Lewandowski and the random forest model." width="90%" />
<p class="caption">
Figure 21.12: Local-stability plot for <code>Age</code> for 30 neighbors of Robert Lewandowski and the random forest model.
</p>
</div>
<p>The CP profiles in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusNeighboursAgeRFPlot">21.12</a> are almost parallel, but span quite a wide range of the predicted player’s values. Thus, one could conclude that the predictions for the most expensive players are not very stable. Also, the plot includes more positive residuals (indicated in the plot by green vertical intervals) than negative ones (indicated by red vertical intervals). This confirms the conclusion drawn from Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusNeighboursPlot">21.11</a> that the values of the most expensive players are underestimated by the model.</p>
</div>
<div id="code-snippets-for-r-4" class="section level3" number="21.7.2">
<h3><span class="header-section-number">21.7.2</span> Code snippets for R</h3>
<p>In this section, we show R-code snippets for instance-level exploration for the gradient boosting model. For other models a similar syntax was used.</p>
<p>The <code>predict_parts()</code> function from the <code>DALEX</code> package (see Chapters <a href="breakDown.html#breakDown">6</a>-<a href="shapley.html#shapley">8</a>) is used to calculate variable attributions. Note that we apply the <code>type = "break_down"</code> argument to prepare BD plots. The generic <code>plot()</code> function is used to graphically present the plots.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="UseCaseFIFA.html#cb258-1"></a>fifa_bd_gbm &lt;-<span class="st"> </span><span class="kw">predict_parts</span>(fifa_gbm_exp, </span>
<span id="cb258-2"><a href="UseCaseFIFA.html#cb258-2"></a>                   <span class="dt">new_observation =</span> fifa[<span class="st">&quot;R. Lewandowski&quot;</span>,],</span>
<span id="cb258-3"><a href="UseCaseFIFA.html#cb258-3"></a>                   <span class="dt">type =</span> <span class="st">&quot;break_down&quot;</span>)</span>
<span id="cb258-4"><a href="UseCaseFIFA.html#cb258-4"></a><span class="kw">plot</span>(fifa_bd_gbm) <span class="op">+</span></span>
<span id="cb258-5"><a href="UseCaseFIFA.html#cb258-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Predicted value in Euro&quot;</span>, </span>
<span id="cb258-6"><a href="UseCaseFIFA.html#cb258-6"></a>                  <span class="dt">labels =</span> <span class="kw">dollar_format</span>(<span class="dt">suffix =</span> <span class="st">&quot;€&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb258-7"><a href="UseCaseFIFA.html#cb258-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Break-down plot for Robert Lewandowski&quot;</span>,<span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p>Shapley values are computed by applying the <code>type = "shap"</code> argument.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="UseCaseFIFA.html#cb259-1"></a>fifa_shap_gbm &lt;-<span class="st"> </span><span class="kw">predict_parts</span>(fifa_gbm_exp, </span>
<span id="cb259-2"><a href="UseCaseFIFA.html#cb259-2"></a>                     <span class="dt">new_observation =</span> fifa[<span class="st">&quot;R. Lewandowski&quot;</span>,], </span>
<span id="cb259-3"><a href="UseCaseFIFA.html#cb259-3"></a>                     <span class="dt">type =</span> <span class="st">&quot;shap&quot;</span>)</span>
<span id="cb259-4"><a href="UseCaseFIFA.html#cb259-4"></a><span class="kw">plot</span>(fifa_shap_gbm, <span class="dt">show_boxplots =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb259-5"><a href="UseCaseFIFA.html#cb259-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Estimated value in Euro&quot;</span>, </span>
<span id="cb259-6"><a href="UseCaseFIFA.html#cb259-6"></a>                   <span class="dt">labels =</span> <span class="kw">dollar_format</span>(<span class="dt">suffix =</span> <span class="st">&quot;€&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb259-7"><a href="UseCaseFIFA.html#cb259-7"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Shapley values for Robert Lewandowski&quot;</span>,<span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p>The <code>predict_profile()</code> function from the <code>DALEX</code> package (see Section <a href="ceterisParibus.html#CPR">10.6</a>) is used to calculate the CP profiles. The generic <code>plot()</code> function is applied to graphically present the profiles.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="UseCaseFIFA.html#cb260-1"></a>selected_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Reactions&quot;</span>, <span class="st">&quot;BallControl&quot;</span>, <span class="st">&quot;Dribbling&quot;</span>, <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb260-2"><a href="UseCaseFIFA.html#cb260-2"></a>fifa_cp_gbm &lt;-<span class="st"> </span><span class="kw">predict_profile</span>(fifa_gbm_exp,</span>
<span id="cb260-3"><a href="UseCaseFIFA.html#cb260-3"></a>                   <span class="dt">new_observation =</span> fifa[<span class="st">&quot;R. Lewandowski&quot;</span>,], </span>
<span id="cb260-4"><a href="UseCaseFIFA.html#cb260-4"></a>                         <span class="dt">variables =</span> selected_variables)</span>
<span id="cb260-5"><a href="UseCaseFIFA.html#cb260-5"></a><span class="kw">plot</span>(fifa_cp_gbm, <span class="dt">variables =</span> selected_variables)</span></code></pre></div>
<p>Finally, the <code>predict_diagnostics()</code> function (see Section <a href="localDiagnostics.html#cPLocDiagR">12.6</a>) allows calculating local-stability plots. The generic <code>plot()</code> function can be used to plot these profiles for selected variables.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="UseCaseFIFA.html#cb261-1"></a>id_gbm &lt;-<span class="st"> </span><span class="kw">predict_diagnostics</span>(fifa_gbm_exp, </span>
<span id="cb261-2"><a href="UseCaseFIFA.html#cb261-2"></a>                         fifa[<span class="st">&quot;R. Lewandowski&quot;</span>,],</span>
<span id="cb261-3"><a href="UseCaseFIFA.html#cb261-3"></a>                         <span class="dt">neighbors =</span> <span class="dv">30</span>)</span>
<span id="cb261-4"><a href="UseCaseFIFA.html#cb261-4"></a><span class="kw">plot</span>(id_gbm) <span class="op">+</span><span class="st">  </span></span>
<span id="cb261-5"><a href="UseCaseFIFA.html#cb261-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Estimated value in Euro&quot;</span>, <span class="dt">trans =</span> <span class="st">&quot;log10&quot;</span>, </span>
<span id="cb261-6"><a href="UseCaseFIFA.html#cb261-6"></a>                     <span class="dt">labels =</span> <span class="kw">dollar_format</span>(<span class="dt">suffix =</span> <span class="st">&quot;€&quot;</span>, <span class="dt">prefix =</span> <span class="st">&quot;&quot;</span>)) </span></code></pre></div>
</div>
<div id="code-snippets-for-python-4" class="section level3" number="21.7.3">
<h3><span class="header-section-number">21.7.3</span> Code snippets for Python</h3>
<p>In this section, we show Python-code snippets for instance-level exploration for the gradient boosting model. For other models a similar syntax was used.</p>
<p>First, we need to select instance of interest. In this example we will use <em>Cristiano Ronaldo</em>.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb262-1"><a href="UseCaseFIFA.html#cb262-1"></a>cr7 <span class="op">=</span> X.loc[<span class="st">&#39;Cristiano Ronaldo&#39;</span>,]</span></code></pre></div>
<p>The <code>predict_parts()</code> method from the <code>dalex</code> library (see Sections <a href="breakDown.html#BDPython">6.7</a> and <a href="shapley.html#SHAPPythonCode">8.6</a>) can be used to calculate calculate variable attributions. The <code>plot()</code> method with <code>max_vars</code> argument is applied to graphically present the corresponding BD plot for up to 20 variables.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb263-1"><a href="UseCaseFIFA.html#cb263-1"></a>fifa_pp_gbm <span class="op">=</span> fifa_gbm_exp.predict_parts(cr7, <span class="bu">type</span><span class="op">=</span><span class="st">&#39;break_down&#39;</span>)</span>
<span id="cb263-2"><a href="UseCaseFIFA.html#cb263-2"></a>fifa_pp_gbm.plot(max_vars <span class="op">=</span> <span class="dv">20</span>)</span></code></pre></div>
<p>To calculate Shapley values, the <code>predict_parts()</code> method should be applied with the <code>type='shap'</code> argument (see Section <a href="shapley.html#SHAPPythonCode">8.6</a>).</p>
<p>The <code>predict_profile()</code> method from the <code>dalex</code> library (see Section <a href="ceterisParibus.html#CPPython">10.7</a> allows calculation of the CP profiles. The <code>plot()</code> method with the <code>variables</code> argument plots the profiles for selected variables.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb264-1"><a href="UseCaseFIFA.html#cb264-1"></a>fifa_mp_gbm <span class="op">=</span> fifa_gbm_exp.predict_profile(cr7)</span>
<span id="cb264-2"><a href="UseCaseFIFA.html#cb264-2"></a></span>
<span id="cb264-3"><a href="UseCaseFIFA.html#cb264-3"></a>fifa_mp_gbm.plot(variables <span class="op">=</span>  [<span class="st">&#39;movement_reactions&#39;</span>,</span>
<span id="cb264-4"><a href="UseCaseFIFA.html#cb264-4"></a>    <span class="st">&#39;skill_ball_control&#39;</span>, <span class="st">&#39;skill_dribbling&#39;</span>, <span class="st">&#39;age&#39;</span>])</span></code></pre></div>
</div>
<div id="FIFACR7" class="section level3" number="21.7.4">
<h3><span class="header-section-number">21.7.4</span> CR7</h3>
<p>As a second example, we present explanations for the random forest-model’s prediction for <em>Cristiano Ronaldo</em> (CR7). Table <a href="UseCaseFIFA.html#tab:CR7">21.4</a> presents his characteristics, as included in the analyzed dataset. Note that Cristiano Ronaldo, as Robert Lewandowski, is also a striker. It might be thus of interest to compare the characteristics contributing to the model’s predictions for the two players.</p>
<table>
<caption><span id="tab:CR7">Table 21.4: </span> Characteristics of Cristiano Ronaldo.</caption>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age</td>
<td align="right">33</td>
<td align="left">Dribbling</td>
<td align="right">88</td>
<td align="left">ShotPower</td>
<td align="right">95</td>
<td align="left">Composure</td>
<td align="right">95</td>
</tr>
<tr class="even">
<td align="left">Preferred.Foot</td>
<td align="right">2</td>
<td align="left">Curve</td>
<td align="right">81</td>
<td align="left">Jumping</td>
<td align="right">95</td>
<td align="left">Marking</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">Reputation</td>
<td align="right">5</td>
<td align="left">FKAccuracy</td>
<td align="right">76</td>
<td align="left">Stamina</td>
<td align="right">88</td>
<td align="left">StandingTackle</td>
<td align="right">31</td>
</tr>
<tr class="even">
<td align="left">Weak.Foot</td>
<td align="right">4</td>
<td align="left">LongPassing</td>
<td align="right">77</td>
<td align="left">Strength</td>
<td align="right">79</td>
<td align="left">SlidingTackle</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">Skill.Moves</td>
<td align="right">5</td>
<td align="left">BallControl</td>
<td align="right">94</td>
<td align="left">LongShots</td>
<td align="right">93</td>
<td align="left">GKDiving</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">Crossing</td>
<td align="right">84</td>
<td align="left">Acceleration</td>
<td align="right">89</td>
<td align="left">Aggression</td>
<td align="right">63</td>
<td align="left">GKHandling</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Finishing</td>
<td align="right">94</td>
<td align="left">SprintSpeed</td>
<td align="right">91</td>
<td align="left">Interceptions</td>
<td align="right">29</td>
<td align="left">GKKicking</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">HeadingAccuracy</td>
<td align="right">89</td>
<td align="left">Agility</td>
<td align="right">87</td>
<td align="left">Positioning</td>
<td align="right">95</td>
<td align="left">GKPositioning</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">ShortPassing</td>
<td align="right">81</td>
<td align="left">Reactions</td>
<td align="right">96</td>
<td align="left">Vision</td>
<td align="right">82</td>
<td align="left">GKReflexes</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">Volleys</td>
<td align="right">87</td>
<td align="left">Balance</td>
<td align="right">70</td>
<td align="left">Penalties</td>
<td align="right">85</td>
<td align="left">LogValue</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p>The BD plot for Cristiano Ronaldo is presented in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAbreakDownCR7Plot">21.13</a>. It suggests that the explanatory variables with the largest effect are <code>ShotPower</code>, <code>LongShots</code>, <code>Volleys</code>, and <code>Vision</code>.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAbreakDownCR7Plot"></span>
<img src="ema_files/figure-html/usecaseFIFAbreakDownCR7Plot-1.png" alt="Break-down plot for Cristiano Ronaldo for the random forest model." width="100%" />
<p class="caption">
Figure 21.13: Break-down plot for Cristiano Ronaldo for the random forest model.
</p>
</div>
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapCR7Plot">21.14</a> presents Shapley values for Cristiano Ronaldo. It indicates that the four explanatory variables with the largest values are <code>Reactions</code>, <code>Dribbling</code>, <code>BallControl</code>, and <code>ShortPassing</code>. These are the same variables as for Robert Lewandowski, though in a different order. Interestingly, the plot for Cristiano Ronaldo includes variable <code>Age</code>, for which Shapley value is negative. It suggests that CR7’s age has got a negative effect on the model’s prediction.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAshapCR7Plot"></span>
<img src="ema_files/figure-html/usecaseFIFAshapCR7Plot-1.png" alt="Shapley values for Cristiano Ronaldo for the random forest model." width="100%" />
<p class="caption">
Figure 21.14: Shapley values for Cristiano Ronaldo for the random forest model.
</p>
</div>
<p>Finally, Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusCR7Plot">21.15</a> presents CP profiles for <code>Age</code>, <code>Reactions</code>, <code>Dribbling</code>, and <code>BallControl</code>.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAceterisParibusCR7Plot"></span>
<img src="ema_files/figure-html/usecaseFIFAceterisParibusCR7Plot-1.png" alt="Ceteris-paribus profiles for Cristiano Ronaldo for four selected variables and the random forest model." width="90%" />
<p class="caption">
Figure 21.15: Ceteris-paribus profiles for Cristiano Ronaldo for four selected variables and the random forest model.
</p>
</div>
<p>The profiles are similar to those presented in Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAceterisParibusPlot">21.10</a> for Robert Lewandowski. An interesting difference is that, for <code>Age</code>, the predicted value for Cristiano Ronaldo is located within the region of age, linked with a sharp drop in player’s value. This is in accordance with the observation, made based on Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapCR7Plot">21.14</a>, that CR7’s age has got a negative effect on the model’s prediction.</p>
</div>
<div id="FIFASzczesny" class="section level3" number="21.7.5">
<h3><span class="header-section-number">21.7.5</span> Wojciech Szczęsny</h3>
<p>One might be interested in the characteristics influencing the random forest model’s predictions for players other than strikers. To address the question, we present explanations for <em>Wojciech Szczęsny</em>, a goalkeeper. Table <a href="UseCaseFIFA.html#tab:WS">21.5</a> presents his characteristics, as included in the analyzed dataset.</p>
<table>
<caption><span id="tab:WS">Table 21.5: </span> Characteristics of Wojciech Szczęsny.</caption>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
<th align="left">variable</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Age</td>
<td align="right">28</td>
<td align="left">Dribbling</td>
<td align="right">11</td>
<td align="left">ShotPower</td>
<td align="right">15</td>
<td align="left">Composure</td>
<td align="right">65</td>
</tr>
<tr class="even">
<td align="left">Preferred.Foot</td>
<td align="right">2</td>
<td align="left">Curve</td>
<td align="right">16</td>
<td align="left">Jumping</td>
<td align="right">71</td>
<td align="left">Marking</td>
<td align="right">20</td>
</tr>
<tr class="odd">
<td align="left">Reputation</td>
<td align="right">3</td>
<td align="left">FKAccuracy</td>
<td align="right">14</td>
<td align="left">Stamina</td>
<td align="right">45</td>
<td align="left">StandingTackle</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">Weak.Foot</td>
<td align="right">3</td>
<td align="left">LongPassing</td>
<td align="right">36</td>
<td align="left">Strength</td>
<td align="right">65</td>
<td align="left">SlidingTackle</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">Skill.Moves</td>
<td align="right">1</td>
<td align="left">BallControl</td>
<td align="right">22</td>
<td align="left">LongShots</td>
<td align="right">14</td>
<td align="left">GKDiving</td>
<td align="right">85</td>
</tr>
<tr class="even">
<td align="left">Crossing</td>
<td align="right">12</td>
<td align="left">Acceleration</td>
<td align="right">51</td>
<td align="left">Aggression</td>
<td align="right">40</td>
<td align="left">GKHandling</td>
<td align="right">81</td>
</tr>
<tr class="odd">
<td align="left">Finishing</td>
<td align="right">12</td>
<td align="left">SprintSpeed</td>
<td align="right">47</td>
<td align="left">Interceptions</td>
<td align="right">15</td>
<td align="left">GKKicking</td>
<td align="right">71</td>
</tr>
<tr class="even">
<td align="left">HeadingAccuracy</td>
<td align="right">16</td>
<td align="left">Agility</td>
<td align="right">55</td>
<td align="left">Positioning</td>
<td align="right">14</td>
<td align="left">GKPositioning</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">ShortPassing</td>
<td align="right">32</td>
<td align="left">Reactions</td>
<td align="right">82</td>
<td align="left">Vision</td>
<td align="right">48</td>
<td align="left">GKReflexes</td>
<td align="right">87</td>
</tr>
<tr class="even">
<td align="left">Volleys</td>
<td align="right">14</td>
<td align="left">Balance</td>
<td align="right">51</td>
<td align="left">Penalties</td>
<td align="right">18</td>
<td align="left">LogValue</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAbreakDownWS">21.16</a> shows the BD plot. We can see that the most important contributions come from the explanatory variables related to goalkeeping skills like <code>GKPositioning</code>, <code>GKHandling</code>, and <code>GKReflexes</code>. Interestingly, field-player skills like <code>BallControl</code> or <code>Dribbling</code> have a negative effect.</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAbreakDownWS"></span>
<img src="ema_files/figure-html/usecaseFIFAbreakDownWS-1.png" alt="Break-down plot for Wojciech Szczęsny for the random forest model." width="100%" />
<p class="caption">
Figure 21.16: Break-down plot for Wojciech Szczęsny for the random forest model.
</p>
</div>
<p>Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapWS">21.17</a> presents Shapley values (over 25 random orderings of explanatory variables). The plot confirms that the most important contributions to the prediction for Wojciech Szczęsny are due to goalkeeping skills like <code>GKDiving</code>, <code>GKPositioning</code>, <code>GKReflexes</code>, and <code>GKHandling</code>. Interestingly, <code>Reactions</code> is also important, as it was the case for Robert Lewandowski (see Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapPlot">21.9</a>) and Cristiano Ronaldo (see Figure <a href="UseCaseFIFA.html#fig:usecaseFIFAshapCR7Plot">21.14</a>).</p>

<div class="figure" style="text-align: center"><span id="fig:usecaseFIFAshapWS"></span>
<img src="ema_files/figure-html/usecaseFIFAshapWS-1.png" alt="Shapley values for Wojciech Szczęsny for the random forest model." width="100%" />
<p class="caption">
Figure 21.17: Shapley values for Wojciech Szczęsny for the random forest model.
</p>
</div>
<!---
{r usecaseFIFAbreakDownWSPlot, warning=FALSE, message=FALSE, echo=TRUE, eval = FALSE, fig.width=12, fig.height=6, fig.cap='(ref:usecaseFIFAbreakDownWSPlotDesc)', out.width = '100%', fig.align='center'}
pl1 <- plot(fifa_bd_gbm) +
  scale_y_continuous("Estimated value in Euro", labels=dollar_format(suffix="€",prefix="")) + 
  ggtitle("Break Down plot for Wojciech Szczęsny (GBM model)")

pl2 <- plot(fifa_bd_rf) +
  scale_y_continuous("Estimated value in Euro", labels=dollar_format(suffix="€", prefix="")) + 
  ggtitle("Break Down plot for Wojciech Szczęsny (RF model)")

pl1 + pl2
--->
</div>
<div id="FIFAMessi" class="section level3" number="21.7.6">
<h3><span class="header-section-number">21.7.6</span> Lionel Messi</h3>
<p>This instance might be THE choice for some of the readers. However, we have decided to leave explanation of the models’ predictions in this case as an exercise to the interested readers.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-rms">
<p>Harrell Jr, Frank E. 2018. <em>Rms: Regression Modeling Strategies</em>. <a href="https://CRAN.R-project.org/package=rms">https://CRAN.R-project.org/package=rms</a>.</p>
</div>
<div id="ref-gbm">
<p>Ridgeway, Greg. 2017. <em>Gbm: Generalized Boosted Regression Models</em>. <a href="https://CRAN.R-project.org/package=gbm">https://CRAN.R-project.org/package=gbm</a>.</p>
</div>
<div id="ref-rangerRpackage">
<p>Wright, Marvin N., and Andreas Ziegler. 2017. “ranger: A Fast Implementation of Random Forests for High Dimensional Data in C++ and R.” <em>Journal of Statistical Software</em> 77 (1): 1–17. <a href="https://doi.org/10.18637/jss.v077.i01">https://doi.org/10.18637/jss.v077.i01</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="summaryModelLevel.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reproducibility.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ema.pdf", "ema.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
