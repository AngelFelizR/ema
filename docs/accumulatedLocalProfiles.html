<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>19 Local-dependence and Accumulated-dependence Profiles | Explanatory Model Analysis</title>
  <meta name="description" content="This book introduces unified language for exploration, explanation and examination of predictive machine learning models." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="19 Local-dependence and Accumulated-dependence Profiles | Explanatory Model Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book introduces unified language for exploration, explanation and examination of predictive machine learning models." />
  <meta name="github-repo" content="pbiecek/ema" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="19 Local-dependence and Accumulated-dependence Profiles | Explanatory Model Analysis" />
  
  <meta name="twitter:description" content="This book introduces unified language for exploration, explanation and examination of predictive machine learning models." />
  

<meta name="author" content="Przemyslaw Biecek and Tomasz Burzykowski" />


<meta name="date" content="2020-07-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="partialDependenceProfiles.html"/>
<link rel="next" href="residualDiagnostic.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-5650686-15', 'https://pbiecek.github.io/ema/', {
  'anonymizeIp': true
  , 'storage': 'none'
  , 'clientId': window.localStorage.getItem('ga_clientId')
});
ga(function(tracker) {
  window.localStorage.setItem('ga_clientId', tracker.get('clientId'));
});
ga('send', 'pageview');
</script>
<style>
.figure {
   padding:40px 0px;
}
</style>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><span style="font-size: large">Explanatory Model Analysis</span><br/>Explore, Explain and Examine<br/>Predictive Models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#notes-to-readers"><i class="fa fa-check"></i><b>1.1</b> Notes to readers</a></li>
<li class="chapter" data-level="1.2" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#the-aim-of-the-book"><i class="fa fa-check"></i><b>1.2</b> The aim of the book</a></li>
<li class="chapter" data-level="1.3" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#three-single-laws"><i class="fa fa-check"></i><b>1.3</b> A bit of philosophy: three laws of model explanation</a></li>
<li class="chapter" data-level="1.4" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#teminology"><i class="fa fa-check"></i><b>1.4</b> Terminology</a></li>
<li class="chapter" data-level="1.5" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#glassblack"><i class="fa fa-check"></i><b>1.5</b> Black-box models and glass-box models</a></li>
<li class="chapter" data-level="1.6" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#agnosticspecific"><i class="fa fa-check"></i><b>1.6</b> Model-agnostic and model-specific approach</a></li>
<li class="chapter" data-level="1.7" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#bookstructure"><i class="fa fa-check"></i><b>1.7</b> The structure of the book</a></li>
<li class="chapter" data-level="1.8" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#whatisinthebook"><i class="fa fa-check"></i><b>1.8</b> What is included in this book and what is not</a></li>
<li class="chapter" data-level="1.9" data-path="ChapIntroduction.html"><a href="ChapIntroduction.html#thanksto"><i class="fa fa-check"></i><b>1.9</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html"><i class="fa fa-check"></i><b>2</b> Model Development</a>
<ul>
<li class="chapter" data-level="2.1" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#MDPIntro"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#MDPprocess"><i class="fa fa-check"></i><b>2.2</b> Model-development process</a></li>
<li class="chapter" data-level="2.3" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#notation"><i class="fa fa-check"></i><b>2.3</b> Notation</a></li>
<li class="chapter" data-level="2.4" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#dataunderstanding"><i class="fa fa-check"></i><b>2.4</b> Data understanding</a></li>
<li class="chapter" data-level="2.5" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#fitting"><i class="fa fa-check"></i><b>2.5</b> Model assembly (fitting)</a></li>
<li class="chapter" data-level="2.6" data-path="modelDevelopmentProcess.html"><a href="modelDevelopmentProcess.html#validation"><i class="fa fa-check"></i><b>2.6</b> Model audit</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="doItYourselfWithR.html"><a href="doItYourselfWithR.html"><i class="fa fa-check"></i><b>3</b> Do-it-yourself with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="doItYourselfWithR.html"><a href="doItYourselfWithR.html#what-to-install"><i class="fa fa-check"></i><b>3.1</b> What to install?</a></li>
<li class="chapter" data-level="3.2" data-path="doItYourselfWithR.html"><a href="doItYourselfWithR.html#infoDALEX"><i class="fa fa-check"></i><b>3.2</b> How to work with <code>DALEX</code>?</a></li>
<li class="chapter" data-level="3.3" data-path="doItYourselfWithR.html"><a href="doItYourselfWithR.html#how-to-work-with-archivist"><i class="fa fa-check"></i><b>3.3</b> How to work with <code>archivist</code>?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doItYourselfWithPython.html"><a href="doItYourselfWithPython.html"><i class="fa fa-check"></i><b>4</b> Do-it-yourself with Python</a>
<ul>
<li class="chapter" data-level="4.1" data-path="doItYourselfWithR.html"><a href="doItYourselfWithR.html#what-to-install"><i class="fa fa-check"></i><b>4.1</b> What to install?</a></li>
<li class="chapter" data-level="4.2" data-path="doItYourselfWithPython.html"><a href="doItYourselfWithPython.html#infoDALEXpy"><i class="fa fa-check"></i><b>4.2</b> How to work with <code>dalex</code>?</a></li>
<li class="chapter" data-level="4.3" data-path="doItYourselfWithPython.html"><a href="doItYourselfWithPython.html#code-snippets-for-python"><i class="fa fa-check"></i><b>4.3</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html"><i class="fa fa-check"></i><b>5</b> Datasets and models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#TitanicDataset"><i class="fa fa-check"></i><b>5.1</b> Sinking of the RMS Titanic</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#exploration-titanic"><i class="fa fa-check"></i><b>5.1.1</b> Data exploration</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#r-classification-models-for-titanic"><i class="fa fa-check"></i><b>5.2</b> R classification models for Titanic</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-lmr"><i class="fa fa-check"></i><b>5.2.1</b> Logistic-regression model</a></li>
<li class="chapter" data-level="5.2.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-rf"><i class="fa fa-check"></i><b>5.2.2</b> Random-forest model</a></li>
<li class="chapter" data-level="5.2.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-gbm"><i class="fa fa-check"></i><b>5.2.3</b> Gradient-boosting model</a></li>
<li class="chapter" data-level="5.2.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-svm"><i class="fa fa-check"></i><b>5.2.4</b> Support Vector Machine model for Classification</a></li>
<li class="chapter" data-level="5.2.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictions-titanic"><i class="fa fa-check"></i><b>5.2.5</b> Models’ predictions</a></li>
<li class="chapter" data-level="5.2.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersTitanicRCode"><i class="fa fa-check"></i><b>5.2.6</b> Models’ explainers</a></li>
<li class="chapter" data-level="5.2.7" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ListOfModelsTitanic"><i class="fa fa-check"></i><b>5.2.7</b> List of objects for the Titanic example</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#python-classification-models-for-titanic"><i class="fa fa-check"></i><b>5.3</b> Python classification models for Titanic</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-lr"><i class="fa fa-check"></i><b>5.3.1</b> Logistic-regression model</a></li>
<li class="chapter" data-level="5.3.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-rf"><i class="fa fa-check"></i><b>5.3.2</b> Random-forest model</a></li>
<li class="chapter" data-level="5.3.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-gbm"><i class="fa fa-check"></i><b>5.3.3</b> Gradient-boosting model</a></li>
<li class="chapter" data-level="5.3.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-titanic-python-svm"><i class="fa fa-check"></i><b>5.3.4</b> Support Vector Machine model for Classification</a></li>
<li class="chapter" data-level="5.3.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictions-titanic-python"><i class="fa fa-check"></i><b>5.3.5</b> Models’ predictions</a></li>
<li class="chapter" data-level="5.3.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersTitanicPythonCode"><i class="fa fa-check"></i><b>5.3.6</b> Models’ explainers</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ApartmentDataset"><i class="fa fa-check"></i><b>5.4</b> Apartment prices</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#exploration-apartments"><i class="fa fa-check"></i><b>5.4.1</b> Data exploration</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#r-regression-model-for-apartment-prices"><i class="fa fa-check"></i><b>5.5</b> R regression model for Apartment prices</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-lr"><i class="fa fa-check"></i><b>5.5.1</b> Linear-regression model</a></li>
<li class="chapter" data-level="5.5.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-rf"><i class="fa fa-check"></i><b>5.5.2</b> Random-forest model</a></li>
<li class="chapter" data-level="5.5.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-svm"><i class="fa fa-check"></i><b>5.5.3</b> Support Vector Machine model for Regression</a></li>
<li class="chapter" data-level="5.5.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictionsApartments"><i class="fa fa-check"></i><b>5.5.4</b> Models’ predictions</a></li>
<li class="chapter" data-level="5.5.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersApartmentsRCode"><i class="fa fa-check"></i><b>5.5.5</b> Models’ explainers</a></li>
<li class="chapter" data-level="5.5.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ListOfModelsApartments"><i class="fa fa-check"></i><b>5.5.6</b> List of objects for the Apartment prices example</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#python-regression-models-for-apartment-prices"><i class="fa fa-check"></i><b>5.6</b> Python regression models for Apartment prices</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-python-lr"><i class="fa fa-check"></i><b>5.6.1</b> Linear-regression model</a></li>
<li class="chapter" data-level="5.6.2" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-python-rf"><i class="fa fa-check"></i><b>5.6.2</b> Random-forest model</a></li>
<li class="chapter" data-level="5.6.3" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#model-Apartments-python-svm"><i class="fa fa-check"></i><b>5.6.3</b> Support Vector Machine model for Regression</a></li>
<li class="chapter" data-level="5.6.4" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#predictions-apartments-python"><i class="fa fa-check"></i><b>5.6.4</b> Models’ predictions</a></li>
<li class="chapter" data-level="5.6.5" data-path="dataSetsIntro.html"><a href="dataSetsIntro.html#ExplainersApartmentsPythonCode"><i class="fa fa-check"></i><b>5.6.5</b> Models’ explainers</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Instance Level</b></span></li>
<li class="chapter" data-level="6" data-path="InstanceLevelExploration.html"><a href="InstanceLevelExploration.html"><i class="fa fa-check"></i><b>6</b> Introduction to Instance-level Exploration</a></li>
<li class="chapter" data-level="7" data-path="breakDown.html"><a href="breakDown.html"><i class="fa fa-check"></i><b>7</b> Break-down Plots for Additive Attributions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="breakDown.html"><a href="breakDown.html#BDIntroduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="breakDown.html"><a href="breakDown.html#BDIntuition"><i class="fa fa-check"></i><b>7.2</b> Intuition</a></li>
<li class="chapter" data-level="7.3" data-path="breakDown.html"><a href="breakDown.html#BDMethod"><i class="fa fa-check"></i><b>7.3</b> Method</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="breakDown.html"><a href="breakDown.html#BDMethodLin"><i class="fa fa-check"></i><b>7.3.1</b> Break-down for linear models</a></li>
<li class="chapter" data-level="7.3.2" data-path="breakDown.html"><a href="breakDown.html#BDMethodGen"><i class="fa fa-check"></i><b>7.3.2</b> Break-down for a general case</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="breakDown.html"><a href="breakDown.html#BDExample"><i class="fa fa-check"></i><b>7.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="7.5" data-path="breakDown.html"><a href="breakDown.html#BDProsCons"><i class="fa fa-check"></i><b>7.5</b> Pros and cons</a></li>
<li class="chapter" data-level="7.6" data-path="breakDown.html"><a href="breakDown.html#BDR"><i class="fa fa-check"></i><b>7.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="breakDown.html"><a href="breakDown.html#basic-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>7.6.1</b> Basic use of the <code>predict_parts()</code> function</a></li>
<li class="chapter" data-level="7.6.2" data-path="breakDown.html"><a href="breakDown.html#advanced-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>7.6.2</b> Advanced use of the <code>predict_parts()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="breakDown.html"><a href="breakDown.html#BDPython"><i class="fa fa-check"></i><b>7.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="iBreakDown.html"><a href="iBreakDown.html"><i class="fa fa-check"></i><b>8</b> Break-down Plots for Interactions (iBreak-down Plots)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDIntuition"><i class="fa fa-check"></i><b>8.1</b> Intuition</a></li>
<li class="chapter" data-level="8.2" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDMethod"><i class="fa fa-check"></i><b>8.2</b> Method</a></li>
<li class="chapter" data-level="8.3" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDExample"><i class="fa fa-check"></i><b>8.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="8.4" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDProsCons"><i class="fa fa-check"></i><b>8.4</b> Pros and cons</a></li>
<li class="chapter" data-level="8.5" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDRcode"><i class="fa fa-check"></i><b>8.5</b> Code snippets for R</a></li>
<li class="chapter" data-level="8.6" data-path="iBreakDown.html"><a href="iBreakDown.html#iBDPythonCode"><i class="fa fa-check"></i><b>8.6</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="shapley.html"><a href="shapley.html"><i class="fa fa-check"></i><b>9</b> Shapley Additive Explanations (SHAP) and Average Variable Attributions</a>
<ul>
<li class="chapter" data-level="9.1" data-path="shapley.html"><a href="shapley.html#SHAPIntuition"><i class="fa fa-check"></i><b>9.1</b> Intuition</a></li>
<li class="chapter" data-level="9.2" data-path="shapley.html"><a href="shapley.html#SHAPMethod"><i class="fa fa-check"></i><b>9.2</b> Method</a></li>
<li class="chapter" data-level="9.3" data-path="shapley.html"><a href="shapley.html#SHAPExample"><i class="fa fa-check"></i><b>9.3</b> Example: Titanic data</a></li>
<li class="chapter" data-level="9.4" data-path="shapley.html"><a href="shapley.html#SHAProsCons"><i class="fa fa-check"></i><b>9.4</b> Pros and cons</a></li>
<li class="chapter" data-level="9.5" data-path="shapley.html"><a href="shapley.html#SHAPRcode"><i class="fa fa-check"></i><b>9.5</b> Code snippets for R</a></li>
<li class="chapter" data-level="9.6" data-path="shapley.html"><a href="shapley.html#SHAPPythonCode"><i class="fa fa-check"></i><b>9.6</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="LIME.html"><a href="LIME.html"><i class="fa fa-check"></i><b>10</b> Local Interpretable Model-agnostic Explanations (LIME)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="LIME.html"><a href="LIME.html#LIMEIntroduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="LIME.html"><a href="LIME.html#LIMEIntuition"><i class="fa fa-check"></i><b>10.2</b> Intuition</a></li>
<li class="chapter" data-level="10.3" data-path="LIME.html"><a href="LIME.html#LIMEMethod"><i class="fa fa-check"></i><b>10.3</b> Method</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="LIME.html"><a href="LIME.html#LIMErepr"><i class="fa fa-check"></i><b>10.3.1</b> Interpretable data representation</a></li>
<li class="chapter" data-level="10.3.2" data-path="LIME.html"><a href="LIME.html#LIMEsample"><i class="fa fa-check"></i><b>10.3.2</b> Sampling around the instance of interest</a></li>
<li class="chapter" data-level="10.3.3" data-path="LIME.html"><a href="LIME.html#LIMEglas"><i class="fa fa-check"></i><b>10.3.3</b> Fitting the glass-box model</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="LIME.html"><a href="LIME.html#LIMEExample"><i class="fa fa-check"></i><b>10.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="10.5" data-path="LIME.html"><a href="LIME.html#LIMEProsCons"><i class="fa fa-check"></i><b>10.5</b> Pros and cons</a></li>
<li class="chapter" data-level="10.6" data-path="LIME.html"><a href="LIME.html#LIMERcode"><i class="fa fa-check"></i><b>10.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="LIME.html"><a href="LIME.html#the-lime-package"><i class="fa fa-check"></i><b>10.6.1</b> The <code>lime</code> package</a></li>
<li class="chapter" data-level="10.6.2" data-path="LIME.html"><a href="LIME.html#the-localmodel-package"><i class="fa fa-check"></i><b>10.6.2</b> The <code>localModel</code> package</a></li>
<li class="chapter" data-level="10.6.3" data-path="LIME.html"><a href="LIME.html#the-iml-package"><i class="fa fa-check"></i><b>10.6.3</b> The <code>iml</code> package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ceterisParibus.html"><a href="ceterisParibus.html"><i class="fa fa-check"></i><b>11</b> Ceteris-paribus Profiles</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntro"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPIntuition"><i class="fa fa-check"></i><b>11.2</b> Intuition</a></li>
<li class="chapter" data-level="11.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPMethod"><i class="fa fa-check"></i><b>11.3</b> Method</a></li>
<li class="chapter" data-level="11.4" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPExample"><i class="fa fa-check"></i><b>11.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="11.5" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPProsCons"><i class="fa fa-check"></i><b>11.5</b> Pros and cons</a></li>
<li class="chapter" data-level="11.6" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPR"><i class="fa fa-check"></i><b>11.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="ceterisParibus.html"><a href="ceterisParibus.html#basic-use-of-the-predict_profile-function"><i class="fa fa-check"></i><b>11.6.1</b> Basic use of the <code>predict_profile()</code> function</a></li>
<li class="chapter" data-level="11.6.2" data-path="ceterisParibus.html"><a href="ceterisParibus.html#advanced-use-of-the-predict_profile-function"><i class="fa fa-check"></i><b>11.6.2</b> Advanced use of the <code>predict_profile()</code> function</a></li>
<li class="chapter" data-level="11.6.3" data-path="ceterisParibus.html"><a href="ceterisParibus.html#comparison-of-models-challenger-champion-analysis"><i class="fa fa-check"></i><b>11.6.3</b> Comparison of models (challenger-champion analysis)</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="ceterisParibus.html"><a href="ceterisParibus.html#CPPython"><i class="fa fa-check"></i><b>11.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html"><i class="fa fa-check"></i><b>12</b> Ceteris-paribus Oscillations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntro"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscIntuition"><i class="fa fa-check"></i><b>12.2</b> Intuition</a></li>
<li class="chapter" data-level="12.3" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscMethod"><i class="fa fa-check"></i><b>12.3</b> Method</a></li>
<li class="chapter" data-level="12.4" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscExample"><i class="fa fa-check"></i><b>12.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="12.5" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscProsCons"><i class="fa fa-check"></i><b>12.5</b> Pros and cons</a></li>
<li class="chapter" data-level="12.6" data-path="ceterisParibusOscillations.html"><a href="ceterisParibusOscillations.html#CPOscR"><i class="fa fa-check"></i><b>12.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="breakDown.html"><a href="breakDown.html#basic-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>12.6.1</b> Basic use of the <code>predict_parts()</code> function</a></li>
<li class="chapter" data-level="12.6.2" data-path="breakDown.html"><a href="breakDown.html#advanced-use-of-the-predict_parts-function"><i class="fa fa-check"></i><b>12.6.2</b> Advanced use of the <code>predict_parts()</code> function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="localDiagnostics.html"><a href="localDiagnostics.html"><i class="fa fa-check"></i><b>13</b> Local-diagnostics Plots</a>
<ul>
<li class="chapter" data-level="13.1" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagIntro"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagIntuition"><i class="fa fa-check"></i><b>13.2</b> Intuition</a></li>
<li class="chapter" data-level="13.3" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagMethod"><i class="fa fa-check"></i><b>13.3</b> Method</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagNeighbors"><i class="fa fa-check"></i><b>13.3.1</b> Nearest neighbors</a></li>
<li class="chapter" data-level="13.3.2" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagLFplot"><i class="fa fa-check"></i><b>13.3.2</b> Local-fidelity plot</a></li>
<li class="chapter" data-level="13.3.3" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagProfiles"><i class="fa fa-check"></i><b>13.3.3</b> Local-stability plot</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagExample"><i class="fa fa-check"></i><b>13.4</b> Example: Titanic</a></li>
<li class="chapter" data-level="13.5" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagProsCons"><i class="fa fa-check"></i><b>13.5</b> Pros and cons</a></li>
<li class="chapter" data-level="13.6" data-path="localDiagnostics.html"><a href="localDiagnostics.html#cPLocDiagR"><i class="fa fa-check"></i><b>13.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html"><i class="fa fa-check"></i><b>14</b> Summary of Instance-level Exploration</a>
<ul>
<li class="chapter" data-level="14.1" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#summaryInstanceLevelIntro"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#number-of-explanatory-variables-in-the-model"><i class="fa fa-check"></i><b>14.2</b> Number of explanatory variables in the model</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#low-to-medium-number-of-explanatory-variables"><i class="fa fa-check"></i><b>14.2.1</b> Low to medium number of explanatory variables</a></li>
<li class="chapter" data-level="14.2.2" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#medium-to-a-large-number-of-explanatory-variables"><i class="fa fa-check"></i><b>14.2.2</b> Medium to a large number of explanatory variables</a></li>
<li class="chapter" data-level="14.2.3" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#very-large-number-of-explanatory-variables"><i class="fa fa-check"></i><b>14.2.3</b> Very large number of explanatory variables</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#correlated-explanatory-variables"><i class="fa fa-check"></i><b>14.3</b> Correlated explanatory variables</a></li>
<li class="chapter" data-level="14.4" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#models-with-interactions"><i class="fa fa-check"></i><b>14.4</b> Models with interactions</a></li>
<li class="chapter" data-level="14.5" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#sparse-explanations"><i class="fa fa-check"></i><b>14.5</b> Sparse explanations</a></li>
<li class="chapter" data-level="14.6" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#additional-uses-of-model-exploration-and-explanation"><i class="fa fa-check"></i><b>14.6</b> Additional uses of model exploration and explanation</a></li>
<li class="chapter" data-level="14.7" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#comparison-of-models-champion-challenger-analysis"><i class="fa fa-check"></i><b>14.7</b> Comparison of models (champion-challenger analysis)</a></li>
</ul></li>
<li class="part"><span><b>III Dataset Level</b></span></li>
<li class="chapter" data-level="15" data-path="modelLevelExploration.html"><a href="modelLevelExploration.html"><i class="fa fa-check"></i><b>15</b> Introduction to Dataset-level Exploration</a></li>
<li class="chapter" data-level="16" data-path="modelPerformance.html"><a href="modelPerformance.html"><i class="fa fa-check"></i><b>16</b> Model-performance Measures</a>
<ul>
<li class="chapter" data-level="16.1" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceIntro"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceIntuition"><i class="fa fa-check"></i><b>16.2</b> Intuition</a></li>
<li class="chapter" data-level="16.3" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethod"><i class="fa fa-check"></i><b>16.3</b> Method</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodCont"><i class="fa fa-check"></i><b>16.3.1</b> Continuous dependent variable</a></li>
<li class="chapter" data-level="16.3.2" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodBin"><i class="fa fa-check"></i><b>16.3.2</b> Binary dependent variable</a></li>
<li class="chapter" data-level="16.3.3" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodCateg"><i class="fa fa-check"></i><b>16.3.3</b> Categorical dependent variable</a></li>
<li class="chapter" data-level="16.3.4" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceMethodCount"><i class="fa fa-check"></i><b>16.3.4</b> Count dependent variable</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="modelPerformance.html"><a href="modelPerformance.html#example"><i class="fa fa-check"></i><b>16.4</b> Example</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceApartments"><i class="fa fa-check"></i><b>16.4.1</b> Apartment prices</a></li>
<li class="chapter" data-level="16.4.2" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceTitanic"><i class="fa fa-check"></i><b>16.4.2</b> Titanic data</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceProsCons"><i class="fa fa-check"></i><b>16.5</b> Pros and cons</a></li>
<li class="chapter" data-level="16.6" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformanceR"><i class="fa fa-check"></i><b>16.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="16.7" data-path="modelPerformance.html"><a href="modelPerformance.html#modelPerformancePython"><i class="fa fa-check"></i><b>16.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="featureImportance.html"><a href="featureImportance.html"><i class="fa fa-check"></i><b>17</b> Variable-importance Measures</a>
<ul>
<li class="chapter" data-level="17.1" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceIntro"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceIntuition"><i class="fa fa-check"></i><b>17.2</b> Intuition</a></li>
<li class="chapter" data-level="17.3" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceMethod"><i class="fa fa-check"></i><b>17.3</b> Method</a></li>
<li class="chapter" data-level="17.4" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceTitanic"><i class="fa fa-check"></i><b>17.4</b> Example: Titanic data</a></li>
<li class="chapter" data-level="17.5" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceProsCons"><i class="fa fa-check"></i><b>17.5</b> Pros and cons</a></li>
<li class="chapter" data-level="17.6" data-path="featureImportance.html"><a href="featureImportance.html#featureImportanceR"><i class="fa fa-check"></i><b>17.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="17.7" data-path="featureImportance.html"><a href="featureImportance.html#featureImportancePython"><i class="fa fa-check"></i><b>17.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html"><i class="fa fa-check"></i><b>18</b> Partial-dependence Profiles</a>
<ul>
<li class="chapter" data-level="18.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPIntro"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPIntuition"><i class="fa fa-check"></i><b>18.2</b> Intuition</a></li>
<li class="chapter" data-level="18.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPMethod"><i class="fa fa-check"></i><b>18.3</b> Method</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPs"><i class="fa fa-check"></i><b>18.3.1</b> Partial-dependence profiles</a></li>
<li class="chapter" data-level="18.3.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clusteredPDPs"><i class="fa fa-check"></i><b>18.3.2</b> Clustered partial-dependence profiles</a></li>
<li class="chapter" data-level="18.3.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#groupedPDPs"><i class="fa fa-check"></i><b>18.3.3</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="18.3.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastivePDPs"><i class="fa fa-check"></i><b>18.3.4</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPExample"><i class="fa fa-check"></i><b>18.4</b> Example: apartment-prices data</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#partial-dependence-profiles"><i class="fa fa-check"></i><b>18.4.1</b> Partial-dependence profiles</a></li>
<li class="chapter" data-level="18.4.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependence-profiles"><i class="fa fa-check"></i><b>18.4.2</b> Clustered partial-dependence profiles</a></li>
<li class="chapter" data-level="18.4.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependence-profiles"><i class="fa fa-check"></i><b>18.4.3</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="18.4.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-partial-dependence-profiles"><i class="fa fa-check"></i><b>18.4.4</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPProsCons"><i class="fa fa-check"></i><b>18.5</b> Pros and cons</a></li>
<li class="chapter" data-level="18.6" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPR"><i class="fa fa-check"></i><b>18.6</b> Code snippets for R</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#partial-dependence-profiles-1"><i class="fa fa-check"></i><b>18.6.1</b> Partial-dependence profiles</a></li>
<li class="chapter" data-level="18.6.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#clustered-partial-dependence-profiles-1"><i class="fa fa-check"></i><b>18.6.2</b> Clustered partial-dependence profiles</a></li>
<li class="chapter" data-level="18.6.3" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependence-profiles-1"><i class="fa fa-check"></i><b>18.6.3</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="18.6.4" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-partial-dependence-profiles-1"><i class="fa fa-check"></i><b>18.6.4</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#PDPPython"><i class="fa fa-check"></i><b>18.7</b> Code snippets for Python</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#grouped-partial-dependence-profiles-2"><i class="fa fa-check"></i><b>18.7.1</b> Grouped partial-dependence profiles</a></li>
<li class="chapter" data-level="18.7.2" data-path="partialDependenceProfiles.html"><a href="partialDependenceProfiles.html#contrastive-partial-dependence-profiles-2"><i class="fa fa-check"></i><b>18.7.2</b> Contrastive partial-dependence profiles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html"><i class="fa fa-check"></i><b>19</b> Local-dependence and Accumulated-dependence Profiles</a>
<ul>
<li class="chapter" data-level="19.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPIntro"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPIntuition"><i class="fa fa-check"></i><b>19.2</b> Intuition</a></li>
<li class="chapter" data-level="19.3" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPMethod"><i class="fa fa-check"></i><b>19.3</b> Method</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#local-dependence-profile"><i class="fa fa-check"></i><b>19.3.1</b> Local-dependence profile</a></li>
<li class="chapter" data-level="19.3.2" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#accumulated-local-profile"><i class="fa fa-check"></i><b>19.3.2</b> Accumulated local profile</a></li>
<li class="chapter" data-level="19.3.3" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#dependence-profiles-for-a-toy-example"><i class="fa fa-check"></i><b>19.3.3</b> Dependence profiles for a toy example</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#CDPExample"><i class="fa fa-check"></i><b>19.4</b> Example: apartment-prices data</a></li>
<li class="chapter" data-level="19.5" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPProsCons"><i class="fa fa-check"></i><b>19.5</b> Pros and cons</a></li>
<li class="chapter" data-level="19.6" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPR"><i class="fa fa-check"></i><b>19.6</b> Code snippets for R</a></li>
<li class="chapter" data-level="19.7" data-path="accumulatedLocalProfiles.html"><a href="accumulatedLocalProfiles.html#ALPPython"><i class="fa fa-check"></i><b>19.7</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html"><i class="fa fa-check"></i><b>20</b> Residual Diagnostics</a>
<ul>
<li class="chapter" data-level="20.1" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#IntroResidualDiagnostic"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#IntuitionResidualDiagnostic"><i class="fa fa-check"></i><b>20.2</b> Intuition</a></li>
<li class="chapter" data-level="20.3" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#MethodResidualDiagnostic"><i class="fa fa-check"></i><b>20.3</b> Method</a></li>
<li class="chapter" data-level="20.4" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#ExampleResidualDiagnostic"><i class="fa fa-check"></i><b>20.4</b> Example: apartment-prices data</a></li>
<li class="chapter" data-level="20.5" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#ProsConsResidualDiagnostic"><i class="fa fa-check"></i><b>20.5</b> Pros and cons</a></li>
<li class="chapter" data-level="20.6" data-path="residualDiagnostic.html"><a href="residualDiagnostic.html#RcodeResidualDiagnostic"><i class="fa fa-check"></i><b>20.6</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="summaryModelLevel.html"><a href="summaryModelLevel.html"><i class="fa fa-check"></i><b>21</b> Summary of Model-level Exploration</a>
<ul>
<li class="chapter" data-level="21.1" data-path="summaryModelLevel.html"><a href="summaryModelLevel.html#summaryModelLevelIntro"><i class="fa fa-check"></i><b>21.1</b> Introduction</a></li>
<li class="chapter" data-level="21.2" data-path="summaryModelLevel.html"><a href="summaryModelLevel.html#exploration-on-trainingtesting-data"><i class="fa fa-check"></i><b>21.2</b> Exploration on training/testing data</a></li>
<li class="chapter" data-level="21.3" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#correlated-explanatory-variables"><i class="fa fa-check"></i><b>21.3</b> Correlated explanatory variables</a></li>
<li class="chapter" data-level="21.4" data-path="summaryInstanceLevel.html"><a href="summaryInstanceLevel.html#comparison-of-models-champion-challenger-analysis"><i class="fa fa-check"></i><b>21.4</b> Comparison of models (champion-challenger analysis)</a></li>
</ul></li>
<li class="part"><span><b>IV Use-cases</b></span></li>
<li class="chapter" data-level="22" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html"><i class="fa fa-check"></i><b>22</b> FIFA 19</a>
<ul>
<li class="chapter" data-level="22.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAintro"><i class="fa fa-check"></i><b>22.1</b> Introduction</a></li>
<li class="chapter" data-level="22.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAdataprep"><i class="fa fa-check"></i><b>22.2</b> Data preparation</a>
<ul>
<li class="chapter" data-level="22.2.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r"><i class="fa fa-check"></i><b>22.2.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="22.2.2" data-path="doItYourselfWithPython.html"><a href="doItYourselfWithPython.html#code-snippets-for-python"><i class="fa fa-check"></i><b>22.2.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAdataunderst"><i class="fa fa-check"></i><b>22.3</b> Data understanding</a></li>
<li class="chapter" data-level="22.4" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAmodelassembly"><i class="fa fa-check"></i><b>22.4</b> Model assembly</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-1"><i class="fa fa-check"></i><b>22.4.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="22.4.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-1"><i class="fa fa-check"></i><b>22.4.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAmodelaudit"><i class="fa fa-check"></i><b>22.5</b> Model audit</a>
<ul>
<li class="chapter" data-level="22.5.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-2"><i class="fa fa-check"></i><b>22.5.1</b> Code snippets for R</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAmodelunderst"><i class="fa fa-check"></i><b>22.6</b> Model understanding (dataset-level explanation)</a>
<ul>
<li class="chapter" data-level="22.6.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-3"><i class="fa fa-check"></i><b>22.6.1</b> Code snippets for R</a></li>
<li class="chapter" data-level="22.6.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-2"><i class="fa fa-check"></i><b>22.6.2</b> Code snippets for Python</a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAinstanceunderst"><i class="fa fa-check"></i><b>22.7</b> Instance-level explanation</a>
<ul>
<li class="chapter" data-level="22.7.1" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFALewy"><i class="fa fa-check"></i><b>22.7.1</b> Robert Lewandowski</a></li>
<li class="chapter" data-level="22.7.2" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-r-4"><i class="fa fa-check"></i><b>22.7.2</b> Code snippets for R</a></li>
<li class="chapter" data-level="22.7.3" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#code-snippets-for-python-3"><i class="fa fa-check"></i><b>22.7.3</b> Code snippets for Python</a></li>
<li class="chapter" data-level="22.7.4" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFACR7"><i class="fa fa-check"></i><b>22.7.4</b> CR7</a></li>
<li class="chapter" data-level="22.7.5" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFASzczesny"><i class="fa fa-check"></i><b>22.7.5</b> Wojciech Szczęsny</a></li>
<li class="chapter" data-level="22.7.6" data-path="UseCaseFIFA.html"><a href="UseCaseFIFA.html#FIFAMessi"><i class="fa fa-check"></i><b>22.7.6</b> Lionel Messi</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-info.html"><a href="session-info.html"><i class="fa fa-check"></i>Session Info</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/ModelOriented/DALEX" target="blank">DALEX website</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Explanatory Model Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="accumulatedLocalProfiles" class="section level1" number="19">
<h1><span class="header-section-number">19</span> Local-dependence and Accumulated-dependence Profiles</h1>
<div id="ALPIntro" class="section level2" number="19.1">
<h2><span class="header-section-number">19.1</span> Introduction</h2>
<p>Partial-dependence (PD) profiles, introduced in the previous chapter, are easy to explain and interpret, especially given their estimation as the mean of ceteris-paribus (CP) profiles. However, as it was mentioned in Section <a href="partialDependenceProfiles.html#PDPProsCons">18.5</a>, the profiles may be misleading if, for instance, explanatory variables are correlated. In many applications, this is the case. For example, in the apartment-prices dataset (see Section <a href="dataSetsIntro.html#ApartmentDataset">5.4</a>), one can expect that variables <em>surface</em> and <em>number of rooms</em> may be positively correlated, because apartments with a larger number of rooms usually also have a larger surface. Thus, in ceteris-paribus profiles, it is not realistic to consider, for instance, an apartment with five rooms and a surface of 20 square meters. Similarly, in the Titanic dataset, a positive association can be expected for the values of variables <em>fare</em> and <em>class</em>, as tickets in the higher classes are more expensive than in the lower classes.</p>
<p>In this chapter, we present accumulated-dependence profiles that address this issue. As they are related to local-dependence profiles, we introduce the latter first. Both approaches were proposed by <span class="citation">Apley (<a href="#ref-ALEPlotRPackage" role="doc-biblioref">2018</a>)</span>.</p>
</div>
<div id="ALPIntuition" class="section level2" number="19.2">
<h2><span class="header-section-number">19.2</span> Intuition</h2>
<!--
The general idea behind LD profiles is to use the conditional distribution of the instead of marginal distribution to accommodate for the dependency between $x^j$ and $x^{-j}$.
The general idea behind Accumulated Local Profiles is to accumulate local changes in model response affected by single feature $x^j$.

The intuition behind Partial Dependency profiles and their extensions is presented in Figure \@ref(fig:accumulatedLocalEffects).
-->
<p>Let us consider the following simple linear model with two explanatory variables:</p>
<p><span class="math display" id="eq:simpleModel">\[\begin{equation}
Y = X^1 +  X^2 + \varepsilon = f(X^1, X^2) + \varepsilon,
\tag{19.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\varepsilon \sim N(0,0.1^2)\)</span>.</p>
<p>For this model, the effect of <span class="math inline">\(X^1\)</span> for any value of <span class="math inline">\(X^2\)</span> is linear, i.e., it can be described by a straight line with the intercept equal to 0 and the slope equal to 1.</p>
<p>Assume that observations of explanatory variables <span class="math inline">\(X^1\)</span> ad <span class="math inline">\(X^2\)</span> are uniformly distributed over the unit square, as illustrated in the left-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr1">19.1</a> for a set of 1000 observations. The right-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr1">19.1</a> presents the scatter plot of the observed values of <span class="math inline">\(Y\)</span> in a function of <span class="math inline">\(X^1\)</span>. The plot for <span class="math inline">\(X^2\)</span> is, essentially, the same and we do not show it.</p>

<div class="figure" style="text-align: center"><span id="fig:PDPcorr1"></span>
<img src="ema_files/figure-html/PDPcorr1-1.png" alt="Observations of two explanatory variables uniformly distributed over the unit square (left-hand-side panel) and the scatter plot of the observed values of the dependent variable \(Y\) in a function of \(X^1\) (right-hand-side panel)." width="90%" />
<p class="caption">
Figure 19.1: Observations of two explanatory variables uniformly distributed over the unit square (left-hand-side panel) and the scatter plot of the observed values of the dependent variable <span class="math inline">\(Y\)</span> in a function of <span class="math inline">\(X^1\)</span> (right-hand-side panel).
</p>
</div>
<p>In view of the plot shown in the right-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr1">19.1</a>, we could consider using a simple linear model with <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span> as explanatory variables. Assume, however, that we would like to analyze the data without postulating any particular parametric form of the effect of the variables. A naïve way would be to split the observed range of each of the two variables into, for instance, five intervals (as illustrated in the left-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr1">19.1</a>), and estimate the means of observed values of <span class="math inline">\(Y\)</span> for the resulting 25 groups of observations. The table below provides the sample means (with rows and columns defined by the ranges of possible values of, respectively, <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span>).</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">(0,0.2]</th>
<th align="right">(0.2,0.4]</th>
<th align="right">(0.4,0.6]</th>
<th align="right">(0.6,0.8]</th>
<th align="right">(0.8,1]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(0,0.2]</td>
<td align="right">0.19</td>
<td align="right">0.42</td>
<td align="right">0.63</td>
<td align="right">0.80</td>
<td align="right">0.99</td>
</tr>
<tr class="even">
<td>(0.2,0.4]</td>
<td align="right">0.39</td>
<td align="right">0.59</td>
<td align="right">0.81</td>
<td align="right">1.01</td>
<td align="right">1.19</td>
</tr>
<tr class="odd">
<td>(0.4,0.6]</td>
<td align="right">0.59</td>
<td align="right">0.81</td>
<td align="right">0.98</td>
<td align="right">1.20</td>
<td align="right">1.44</td>
</tr>
<tr class="even">
<td>(0.6,0.8]</td>
<td align="right">0.76</td>
<td align="right">1.00</td>
<td align="right">1.20</td>
<td align="right">1.40</td>
<td align="right">1.58</td>
</tr>
<tr class="odd">
<td>(0.8,1]</td>
<td align="right">1.01</td>
<td align="right">1.22</td>
<td align="right">1.38</td>
<td align="right">1.58</td>
<td align="right">1.77</td>
</tr>
</tbody>
</table>
<p>The means are based on the following numbers of observations:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">(0,0.2]</th>
<th align="right">(0.2,0.4]</th>
<th align="right">(0.4,0.6]</th>
<th align="right">(0.6,0.8]</th>
<th align="right">(0.8,1]</th>
<th align="right">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(0,0.2]</td>
<td align="right">51</td>
<td align="right">39</td>
<td align="right">31</td>
<td align="right">43</td>
<td align="right">43</td>
<td align="right">207</td>
</tr>
<tr class="even">
<td>(0.2,0.4]</td>
<td align="right">39</td>
<td align="right">40</td>
<td align="right">35</td>
<td align="right">53</td>
<td align="right">42</td>
<td align="right">209</td>
</tr>
<tr class="odd">
<td>(0.4,0.6]</td>
<td align="right">28</td>
<td align="right">42</td>
<td align="right">35</td>
<td align="right">49</td>
<td align="right">40</td>
<td align="right">194</td>
</tr>
<tr class="even">
<td>(0.6,0.8]</td>
<td align="right">37</td>
<td align="right">30</td>
<td align="right">36</td>
<td align="right">55</td>
<td align="right">45</td>
<td align="right">203</td>
</tr>
<tr class="odd">
<td>(0.8,1]</td>
<td align="right">43</td>
<td align="right">46</td>
<td align="right">36</td>
<td align="right">28</td>
<td align="right">34</td>
<td align="right">187</td>
</tr>
<tr class="even">
<td>total</td>
<td align="right">198</td>
<td align="right">197</td>
<td align="right">173</td>
<td align="right">228</td>
<td align="right">204</td>
<td align="right">1000</td>
</tr>
</tbody>
</table>
<!---
Table: (\#tab:FullData) Sample means $ys$

|X1 |(0,0.2] | (0.2,0.4] | (0.4,0.6] | (0.6,0.8] | (0.8,1] |
|---|--------|-----------|-----------|-----------|---------|
(0,0.2]   |   0.19  |    0.40   |   0.60  |    0.80 |   0.99 |
(0.2,0.4] |   0.40  |    0.59   |   0.81  |    1.00 |   1.21 |
(0.4,0.6] |   0.60  |    0.80   |   0.99  |    1.19 |   1.41 |
(0.6,0.8] |   0.79  |    0.99   |   1.20  |    1.41 |   1.58 |
(0.8,1]   |   0.99  |    1.21   |   1.40  |    1.62 |   1.79 |


Table: (\#tab:FullData) Sample means $yx$

|X1 |(0,0.2] | (0.2,0.4] | (0.4,0.6] | (0.6,0.8] | (0.8,1] |
|---|--------|-----------|-----------|-----------|---------|
(0,0.2]   |   0.19  |    0.45   |   0.68  |    0.80 |   1.00 |
(0.2,0.4] |   0.38  |    0.57   |   0.81  |    1.02 |   1.16 |
(0.4,0.6] |   0.57  |    0.82   |   0.97  |    1.22 |   1.50 |
(0.6,0.8] |   0.71  |    1.02   |   1.20  |    1.40 |   1.58 |
(0.8,1]   |   1.04  |    1.23   |   1.35  |    1.54 |   1.75 |
--->
<p>By using this simple approach, we can compute the PD profile for <span class="math inline">\(X^1\)</span>. Consider <span class="math inline">\(X^1=z\)</span>. To apply the estimator defined in <a href="partialDependenceProfiles.html#eq:PDPest">(18.2)</a>, we need the predicted values <span class="math inline">\(\hat{f}(z,x^2_i)\)</span> for any observed value of <span class="math inline">\(x^2_i \in [0,1]\)</span>. As our observations are uncorrelated and fill-in the unit-square, we can use the suitable mean values for that purpose. In particular, for <span class="math inline">\(z \in [0,0.2]\)</span>, we get</p>
<p><span class="math display" id="eq:fullDataPD">\[\begin{eqnarray}
\hat g_{PD}^{1}(z) &amp;=&amp; \frac{1}{1000}\sum_{i}\hat{f}(z,x^2_i) = \\
&amp;=&amp; (198\times 0.19+197\times 0.42+ 173\times 0.63 + 228\times 0.80 + 204\times 1.00)/1000 = \\
&amp;=&amp; 0.6.
\tag{19.2}
\end{eqnarray}\]</span></p>
<p>By following the same principle, for <span class="math inline">\(z \in (0.2,0.4]\)</span>, <span class="math inline">\((0.4,0.6]\)</span>, <span class="math inline">\((0.6,0.8]\)</span>, and <span class="math inline">\((0.8,1]\)</span> we get the values of 0.8, 1, 1.2, and 1.4. Thus, overall, we obtain a piecewise-constant profile with values that capture the (correct) linear effect of <span class="math inline">\(X^1\)</span> in model <a href="accumulatedLocalProfiles.html#eq:simpleModel">(19.1)</a>. In fact, by using, for instance, midpoints of the intervals for <span class="math inline">\(z\)</span>, i.e., 0.1, 0.3, 0.5, 0.7, and 0.9, we could describe the profile by the linear function <span class="math inline">\(0.5+z\)</span>.</p>
<p>Assume now that we are given the data only from the regions on the diagonal of the unit square, as illustrated in the left-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr2">19.2</a>. In that case, the observed values of <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span> are strongly correlated, with the estimated value of Pearson’s correlation coefficient equal to 0.96. The right-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr2">19.2</a> presents the scatter plot of the observed values of <span class="math inline">\(Y\)</span> in the function of <span class="math inline">\(X^1\)</span>.</p>

<div class="figure" style="text-align: center"><span id="fig:PDPcorr2"></span>
<img src="ema_files/figure-html/PDPcorr2-1.png" alt="Correlated observations of two explanatory variables (left-hand-side panel) and the scatter plot of the observed values of the dependent variable \(Y\) in the function of \(X^1\) (right-hand-side panel)." width="90%" />
<p class="caption">
Figure 19.2: Correlated observations of two explanatory variables (left-hand-side panel) and the scatter plot of the observed values of the dependent variable <span class="math inline">\(Y\)</span> in the function of <span class="math inline">\(X^1\)</span> (right-hand-side panel).
</p>
</div>
<p>Now, the “naïve” modelling approach would amount to using only five sample means, as in the table below.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">(0,0.2]</th>
<th align="right">(0.2,0.4]</th>
<th align="right">(0.4,0.6]</th>
<th align="right">(0.6,0.8]</th>
<th align="right">(0.8,1]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(0,0.2]</td>
<td align="right">0.19</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>(0.2,0.4]</td>
<td align="right">NA</td>
<td align="right">0.59</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>(0.4,0.6]</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.98</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td>(0.6,0.8]</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.4</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td>(0.8,1]</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.77</td>
</tr>
</tbody>
</table>
<p>When computing the PD profile for <span class="math inline">\(X^1\)</span>, we now encounter the issue related to the fact that, for instance, for <span class="math inline">\(z \in [0,0.2]\)</span>, we have not got any observations and, hence, any sample mean for <span class="math inline">\(x^2_i&gt;0.2\)</span>. To overcome this issue, we could extrapolate the predictions (i.e., mean values) obtained for other intervals of <span class="math inline">\(z\)</span>. That is, we could assume that, for <span class="math inline">\(x^2_i \in (0.2,0.4]\)</span>, the prediction is equal to 0.59, for <span class="math inline">\(x^2_i \in (0.4,0.6]\)</span> it is equal to 0.98, and so on. This leads to the following value of the PD profile for <span class="math inline">\(z \in [0,0.2]\)</span>:</p>
<p><span class="math display">\[\begin{eqnarray*}
\hat g_{PD}^{1}(z) &amp;=&amp; \frac{1}{207}\sum_{i}\hat{f}(z,x^2_i) = \\
&amp;=&amp; \frac{1}{1000}(198\times 0.19+197\times 0.59+ 173\times 0.99 + 228\times 1.40 + 204\times 1.77)=1.  
\end{eqnarray*}\]</span></p>
<p>This is a larger value than 0.6 computed in <a href="accumulatedLocalProfiles.html#eq:fullDataPD">(19.2)</a> for the uncorrelated data. The reason is the extrapolation: for instance, for <span class="math inline">\(z \in [0,0.2]\)</span> and <span class="math inline">\(x^2_i \in (0.6,0.8]\)</span>, we use 1.40 as the predicted value of <span class="math inline">\(Y\)</span>. However, we have seen that the sample mean for those observations is equal to 0.80.</p>
<p>In fact, by using the same extrapolation principle, we get <span class="math inline">\(\hat g_{PD}^{1}(z) = 1\)</span> also for <span class="math inline">\(z \in (0.2,0.4]\)</span>, <span class="math inline">\((0.4,0.6]\)</span>, <span class="math inline">\((0.6,0.8]\)</span>, and <span class="math inline">\((0.8,1]\)</span>. Thus, the obtained profile indicates no effect of <span class="math inline">\(X^1\)</span>, which clearly a wrong conclusion.</p>
<p>While the modelling approach presented in the example above may seem to be simplistic, it does illustrate the issue that would also appear for other flexible modelling methods like, for instance, regression trees. In particular, the left-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr3">19.3</a> presents a regression tree fitted to the data shown in Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr2">19.2</a> by using function <code>tree()</code> from the R package <code>tree</code>. The right-hand-side panel of Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr3">19.3</a> presents the corresponding split of the observations. According to the model, the predicted value of <span class="math inline">\(Y\)</span> for the observations in the region <span class="math inline">\(x^1 \in [0,0.2]\)</span> and <span class="math inline">\(x^2 \in [0.8,1]\)</span> would be equal to 1.74. This extrapolation implies a substantial overestimation, as the true expected value of <span class="math inline">\(Y\)</span> in the region is equal to 1. Note that the latter is well estimated by the sample mean equal to 0.99 in the case of the uncorrelated data shown in Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr1">19.1</a>.</p>
<p>The PD profile for <span class="math inline">\(X^1\)</span> for the regression tree would be equal to 0.2, 0.8, and 1.5 for <span class="math inline">\(z \in [0,0.2]\)</span>, <span class="math inline">\((0.2,0.6]\)</span>, and <span class="math inline">\((0.6,1]\)</span>, respectively. It does show an effect of <span class="math inline">\(X^1\)</span>, but the obtained values deviate from linearity. For instance, by using midpoints of the intervals for <span class="math inline">\(z\)</span>, i.e., 0.1, 0.4, and 0.8 we could (approximately) describe the profile by the linear function <span class="math inline">\(2z\)</span>, i.e., with a slope larger than 1.</p>

<div class="figure" style="text-align: center"><span id="fig:PDPcorr3"></span>
<img src="ema_files/figure-html/PDPcorr3-1.png" alt="Results of fitting of a regression tree to the data shown in Figure 19.2 (left-hand-side panel) and the corresponding split of the observations of the two explanatory variables (right-hand-side panel)." width="90%" />
<p class="caption">
Figure 19.3: Results of fitting of a regression tree to the data shown in Figure <a href="accumulatedLocalProfiles.html#fig:PDPcorr2">19.2</a> (left-hand-side panel) and the corresponding split of the observations of the two explanatory variables (right-hand-side panel).
</p>
</div>
<!---
Moreover, assume that explanatory variables $X^1$ and $X^2$ are uniformly distributed over the interval $[-1,1]$ and are perfectly correlated, i.e., $X^2 = X^1$. Suppose that we have got the following dataset with 8 observations:

| i     | 1  |     2 |     3 |     4 |     5 |     6 |     7 |  8  |
|-------|----|-------|-------|-------|-------|-------|-------|-----|
| $X^1$ | -1 | -0.71 | -0.43 | -0.14 |  0.14 |  0.43 |  0.71 |  1  |
| $X^2$ | -1 | -0.71 | -0.43 | -0.14 |  0.14 |  0.43 |  0.71 |  1  |
| $f(x^1,x^2)$   | 0  | -0.2059 | -0.2451 | -0.1204 |  0.1596 |  0.6149 |  1.2141 |  2  |

Note that, for both $X^1$ and $X^2$, the sum of all observed values is equal to 0. 

The top part of panel A in Figure \@ref(fig:accumulatedLocalEffects) [TOMASZ: REMOVE THE CURRENT PANEL A. RENAME THE REMAINING ONES.] shows CP profiles for $X^1$ for model \@ref(eq:trickyModel) calculated for the eight observations. The bottom part of the panel presents the corresponding estimate of the PD profile for $X^1$, i.e., the average of the CP profiles. The profile suggests no effect of $X^1$, which is clearly a misleading conclusion.

To understand the reason, let's use definition \@ref(eq:CPPdef) and obtain an explicit expression of the CP profile for $X^1$ for model \@ref(eq:trickyModel):

\begin{equation}
h^{(x^1 + 1) \cdot x^2 , 1}_{(x^1,x^2)}(z) = f(z,x^2) = (z+1)\cdot x^2.
(\#eq:CPtrickyModel)
\end{equation}

Thus, the CP profile is a straight line with the slope equal to the value of variable $X^2$. Hence, for instance, the CP profile for observation with $(x^1,x^2)=(-1,-1)$ is a straight line with the slope equal to -1.  

On the other hand, the PD profile for $X^j$ is estimated, as indicated in \@ref(eq:PDPest), by taking the mean of the CP profiles given by \@ref(eq:CPtrickyModel):

\begin{equation}
\hat g_{PD}^{(x^1 + 1)\cdot x^2, 1}(z) =  \frac{1}{8} \sum_{i=1}^{8} (z+1)\cdot x_{i}^2 = \frac{z+1}{8}  \sum_{i=1}^{8} x_{i}^2 = 0.
(\#eq:PDtrickyModel)
\end{equation}

As a result, the PD profile for $X^1$ is estimated as a horizontal line at 0, as seen in the bottom part of panel A in Figure \@ref(fig:accumulatedLocalEffects). 

This result is due to the fact that the CP profile, given in \@ref(eq:CPtrickyModel), ignores the fact that, given our assumptions, one cannot change $z$  *freely* for a particular value of $X^2$, because $X^1$ and $X^2$ are assumed to be perfectly correlated. In fact, in this case, the CP profile for the $i$-th observation should remain undefined for any values of $z$ different from $x^2_i$. As a consequence, the sum used in \@ref(eq:PDtrickyModel) should involve undefined terms for any $z$.

--->
<p>The issue stems from the fact that, in the definition <a href="partialDependenceProfiles.html#eq:PDPdef0">(18.1)</a> of the PD profile, the expected value of model predictions is computed by using the marginal distribution of <span class="math inline">\(X^2\)</span>, which disregards the value of <span class="math inline">\(X^1\)</span>. Clearly, this is an issue when the explanatory variables are correlated. This observation suggests a modification: instead of the marginal distribution, one might use the conditional distribution of <span class="math inline">\(X^2\)</span> given <span class="math inline">\(X^1\)</span>, because it reflects the association between the two variables. The modification leads to the definition of an LD profile.</p>
<p>It turns out, however, that the modification does not fully address the issue of correlated explanatory variables.
As argued by <span class="citation">Apley and Zhu (<a href="#ref-Apley2019" role="doc-biblioref">2019</a>)</span>, if an explanatory variable is correlated with some other variables, the LD profile for the variable will still capture the effect of the other variables. This is because the profile is obtained by marginalizing over (in fact, ignoring) the remaining variables in the model, which results in an effect similar to the “omitted variable” bias in linear regression. Thus, in this respect, LD profiles share the same limitation as PD profiles. To address the limitation, <span class="citation">Apley and Zhu (<a href="#ref-Apley2019" role="doc-biblioref">2019</a>)</span> proposed the concept of local-dependence effects and accumulated-dependence (AL) profiles.</p>
<!---
If we focus on variable $X^1$ we can conclude that, according to \@ref(eq:trickyModel), the effect of the variable is similar to function $f(x_1) = -x_1 -1$ for values close to $(x_1, x_2) = (-1,-1)$ and similar to function $f(x_1) = x_1 +1$ for values close to $(x_1, x_2) = (1,1)$. This means that the effect is decreasing, at the rate -1,  around $(-1,-1)$ and it is increasing, at the rate 1, around $(1,1)$. The function specified in  \@ref(eq:LDtrickyModel) does not explicitly reflect this behavior. To address this issue, [@Appley2019] proposed the concept of accumulated local effects and accumulated local (AL) profiles, in which the effect of $X^1$ is defined as the cumulative sum of local derivatives of the model function with respect to $X^1$.
--->
<!--
For example, for the `apartments` dataset, one can expect that features like `surface` and `number.of.rooms` are correlated but we can also imagine that each of these variables affects the apartment price somehow. Partial Dependency Profiles show how the average price changes as a function of the surface, keeping all other variables unchanged. Conditional Dependency Profiles show how the average price changes as a function of surface adjusting all other variables to the current value of the surface. Accumulated Local Profiles show how the average price changes as a function of surface adjusting all other variables to the current value of the surface but extracting changes caused by these other features. 
-->
</div>
<div id="ALPMethod" class="section level2" number="19.3">
<h2><span class="header-section-number">19.3</span> Method</h2>
<div id="local-dependence-profile" class="section level3" number="19.3.1">
<h3><span class="header-section-number">19.3.1</span> Local-dependence profile</h3>
<p>Local-dependence (LD) profile for model <span class="math inline">\(f()\)</span> and variable <span class="math inline">\(X^j\)</span> is defined as follows:</p>
<p><span class="math display" id="eq:LDPdef">\[\begin{equation}
g_{LD}^{f, j}(z) = E_{\underline{X}^{-j}|X^j=z}\left\{f\left(\underline{X}^{j|=z}\right)\right\}.
\tag{19.3}
\end{equation}\]</span></p>
<p>Thus, it is the expected value of the model predictions over the conditional distribution of <span class="math inline">\(\underline{X}^{-j}\)</span> given <span class="math inline">\(X^j=z\)</span>, i.e., over the joint distribution of all explanatory variables other than <span class="math inline">\(X^j\)</span> conditional on the value of the latter variable set to <span class="math inline">\(z\)</span>. Or, in other words, it is the expected value of the CP profiles for <span class="math inline">\(X^j\)</span>, defined in <a href="ceterisParibus.html#eq:CPPdef">(11.1)</a>, over the conditional distribution of <span class="math inline">\(\underline{X}^{-j} | X^j = z\)</span>.</p>
<!--
For example, let $f(x_1, x_2) = x_1 + x_2$ and distribution of $(x_1, x_2)$ is given by $x_1 \sim U[0,1]$ and $x_2=x_1$. In this case $g^{CD}_{f, 1}(z) = 2*z$.
-->
<p>As proposed by <span class="citation">Apley and Zhu (<a href="#ref-Apley2019" role="doc-biblioref">2019</a>)</span>, LD profile can be estimated as follows:</p>
<p><span class="math display" id="eq:LDPest">\[\begin{equation}
\hat g_{LD}^{j}(z) = \frac{1}{|N_j|} \sum_{k\in N_j} f\left(\underline{x}_k^{j| = z}\right), 
\tag{19.4}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(N_j\)</span> is the set of observations with the value of <span class="math inline">\(X^j\)</span> “close” to <span class="math inline">\(z\)</span> that is used to estimate the conditional distribution of <span class="math inline">\(\underline{X}^{-j}|X^j=z\)</span>.</p>
<!--
In Figure \@ref(fig:accumulatedLocalEffects) panel C the range of variable $x_i$ is divided into 4 separable intervals. The set $N_i$ contains all observations that fall into the same interval as observation $x_i$. The final CD profile is an average from closest pieces of CP profiles.
-->
<p>Note that, in general, the estimator given in <a href="accumulatedLocalProfiles.html#eq:LDPest">(19.4)</a> is neither smooth nor continuous at boundaries between subsets <span class="math inline">\(N_j\)</span>. A smooth estimator for <span class="math inline">\(g_{LD}^{f,j}(z)\)</span> can be defined as follows:</p>
<p><span class="math display" id="eq:LDPest2">\[\begin{equation}
\tilde g_{LD}^{j}(z) = \frac{1}{\sum_k w_{k}(z)} \sum_{i = 1}^n w_i(z) f\left(\underline{x}_i^{j| = z}\right), 
\tag{19.5}
\end{equation}\]</span></p>
<p>where weights <span class="math inline">\(w_i(z)\)</span> capture the distance between <span class="math inline">\(z\)</span> and <span class="math inline">\(x_i^j\)</span>. In particular, for a categorical variable, we may just use the indicator function <span class="math inline">\(w_i(z) = 1_{z = x^j_i}\)</span>, while for a continuous variable we may use the Gaussian kernel:</p>
<p><span class="math display" id="eq:Gkernel">\[\begin{equation}
w_i(z) = \phi(z - x_i^j, 0, s),
\tag{19.6}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\phi(y,0,s)\)</span> is the density of a normal distribution with mean 0 and standard deviation <span class="math inline">\(s\)</span>. Note that <span class="math inline">\(s\)</span> plays the role of a smoothing factor.</p>
<p>As already mentioned in Section <a href="accumulatedLocalProfiles.html#ALPIntuition">19.2</a>, if an explanatory variable is correlated with some other variables, the LD profile for the variable will capture the effect of all of the variables. For instance, consider model <a href="accumulatedLocalProfiles.html#eq:simpleModel">(19.1)</a>. Assume that <span class="math inline">\(X^1\)</span> has a uniform distribution on <span class="math inline">\([0,1]\)</span> and that <span class="math inline">\(X^1=X^2\)</span>, i.e., the two explanatory variables are perfectly correlated. In that case, the LD profile for <span class="math inline">\(X^1\)</span> is given by</p>
<p><span class="math display">\[
g_{LD}^{1}(z) = E_{X^2|X^1=z}(z+X^2) = z + E_{X^2|X^1=z}(X^2) = 2z.
\]</span>
Hence, it suggests an effect of <span class="math inline">\(X^1\)</span> twice larger than the correct one.</p>
<p>To address the limitation, AL profiles can be used. We present them in the next section.</p>
</div>
<div id="accumulated-local-profile" class="section level3" number="19.3.2">
<h3><span class="header-section-number">19.3.2</span> Accumulated local profile</h3>
<p>Consider model <span class="math inline">\(f()\)</span> and define</p>
<p><span class="math display">\[
q^j(\underline{u})=\left\{ \frac{\partial f(\underline{x})}{\partial x^j} \right\}_{\underline{x}=\underline{u}}.
\]</span>
The Accumulated local (AL) profile for model <span class="math inline">\(f()\)</span> and variable <span class="math inline">\(X^j\)</span> is defined as follows:</p>
<p><span class="math display" id="eq:ALPdef">\[\begin{equation}
g_{AL}^{j}(z) = \int_{z_0}^z \left[E_{\underline{X}^{-j}|X^j=v}\left\{ q^j(\underline{X}^{j|=v}) \right\}\right] dv + c,
\tag{19.7}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(z_0\)</span> is a value close to the lower bound of the effective support of the distribution of <span class="math inline">\(X^j\)</span> and <span class="math inline">\(c\)</span> is a constant, usually selected so that <span class="math inline">\(E_{X^j}\left\{g_{AL}^{j}(X^j)\right\} = 0\)</span>.</p>
<p>To interpret <a href="accumulatedLocalProfiles.html#eq:ALPdef">(19.7)</a> note that <span class="math inline">\(q^j(\underline{x}^{j|=v})\)</span> describes the local effect (change) of the model due to <span class="math inline">\(X^j\)</span>. Or, to put it in other words, <span class="math inline">\(q^j(\underline{x}^{j|=v})\)</span> describes how much the CP profile for <span class="math inline">\(X^j\)</span> changes at <span class="math inline">\((x^1,\ldots,x^{j-1},v,x^{j+1},\ldots,x^p)\)</span>. This effect (change) is averaged over the “relevant” (according to the conditional distribution of <span class="math inline">\(\underline{X}^{-j}|X^j\)</span>) values of <span class="math inline">\(\underline{x}^{-j}\)</span> and, subsequently, accumulated (integrated) over values of <span class="math inline">\(v\)</span> up to <span class="math inline">\(z\)</span>. As argued by <span class="citation">Apley and Zhu (<a href="#ref-Apley2019" role="doc-biblioref">2019</a>)</span>, the averaging of the local effects allows avoiding the issue, present in the PD and LD profiles, of capturing the effect of other variables in the profile for a particular variable in additive models (without interactions). To see this, one can consider the approximation</p>
<p><span class="math display">\[
f(\underline{x}^{j|=v+dv})-f(\underline{x}^{j|=v})  \approx q^j(\underline{x}^{j|=v})dv,
\]</span></p>
<p>and note that the difference <span class="math inline">\(f(\underline{x}^{j|=v+dv})-f(\underline{v}^{j|=v})\)</span>, for a model without interaction, effectively removes the effect of all variables other than <span class="math inline">\(X^j\)</span>.</p>
<p>For example, consider model <a href="accumulatedLocalProfiles.html#eq:simpleModel">(19.1)</a>. In that case, <span class="math inline">\(f(x^1,x^2)=x^1+x^2\)</span> and <span class="math inline">\(q^1(\underline{u}) = 1\)</span>. Thus,</p>
<p><span class="math display">\[
f(u+du,x_2)-f(u,x_2)  = (u + du + x^2) - (u + x^2) = du = q^1(u)du.
\]</span></p>
<p>Consequently, irrespectively of the joint distribution of <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span> and upon setting <span class="math inline">\(c=z_0\)</span>, we get
<span class="math display">\[
g_{AL}^{1}(z) = \int_{z_0}^z \left\{E_{{X}^{2}|X^1=v}(1)\right\} dv + z_0 = z.
\]</span></p>
<p>To estimate an AL profile, one replaces the integral in <a href="accumulatedLocalProfiles.html#eq:ALPdef">(19.7)</a> by a summation and the derivative with a finite difference <span class="citation">(Apley and Zhu <a href="#ref-Apley2019" role="doc-biblioref">2019</a>)</span>. In particular, consider a partition of the range of observed values <span class="math inline">\(x_{i}^j\)</span> of variable <span class="math inline">\(X^j\)</span> into <span class="math inline">\(K\)</span> intervals <span class="math inline">\(N_j(k)=\left(z_{k-1}^j,z_k^j\right]\)</span> (<span class="math inline">\(k=1,\ldots,K\)</span>). Note that <span class="math inline">\(z_0^j\)</span> can be chosen just below <span class="math inline">\(\min(x_1^j,\ldots,x_N^j)\)</span> and <span class="math inline">\(z_K^j=\max(x_1^j,\ldots,x_N^j)\)</span>. Let <span class="math inline">\(n_j(k)\)</span> denote the number of observations <span class="math inline">\(x_i^j\)</span> falling into <span class="math inline">\(N_j(k)\)</span>, with <span class="math inline">\(\sum_{k=1}^K n_j(k)=n\)</span>. An estimator of AL profile for variable <span class="math inline">\(X^j\)</span> can then be constructed as follows:</p>
<p><span class="math display" id="eq:ALPest">\[\begin{equation}
\widehat{g}_{AL}^{j}(z) = \sum_{k=1}^{k_j(z)} \frac{1}{n_j(k)} \sum_{i: x_i^j \in N_j(k)} \left\{ f\left(\underline{x}_i^{j| = z_k^j}\right) - f\left(\underline{x}_i^{j| = z_{k-1}^j}\right) \right\} - \hat{c},
\tag{19.8}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(k_j(z)\)</span> is the index of interval <span class="math inline">\(N_j(k)\)</span> in which <span class="math inline">\(z\)</span> falls, i.e., <span class="math inline">\(z \in N_j\{k_j(z)\}\)</span>, and <span class="math inline">\(\hat{c}\)</span> is selected so that <span class="math inline">\(\sum_{i=1}^n \widehat{g}_{AL}^{f,j}(x_i^j)=0\)</span>.</p>
<p>To interpret <a href="accumulatedLocalProfiles.html#eq:ALPest">(19.8)</a> note that difference <span class="math inline">\(f\left(\underline{x}_i^{j| = z_k^j}\right) - f\left(\underline{x}_i^{j| = z_{k-1}^j}\right)\)</span> corresponds to the difference of the CP profile for the <span class="math inline">\(i\)</span>-th observation at the limits of interval <span class="math inline">\(N_j(k)\)</span>. These differences are then averaged across all observations, for which the observed value of <span class="math inline">\(X^j\)</span> falls into the interval, and accumulated.</p>
<!--
In Figure \@ref(fig:accumulatedLocalEffects) panel D the range of variable $x_i$ is divided into 4 separable intervals. The set $N_i$ contains all observations that fall into the same interval as observation $x_i$. The final ALE profile is constructed from accumulated differences of local CP profiles.
-->
<p>Note that, in general, <span class="math inline">\(\widehat{g}_{AL}^{f,j}(z)\)</span> is not smooth at the boundaries of intervals <span class="math inline">\(N_j(k)\)</span>. A smooth estimate can obtained as follows:</p>
<p><span class="math display" id="eq:ALPest2">\[\begin{equation}
\widetilde{g}_{AL}^{j}(z) = \sum_{k=1}^K \left[ \frac{1}{\sum_{l} w_l(z_k)} \sum_{i=1}^N w_{i}(z_k) \left\{f\left(\underline{x}_i^{j| = z_k}\right) - f\left(\underline{x}_i^{j| = z_k - \Delta}\right)\right\}\right] - \hat{c},
\tag{19.9}
\end{equation}\]</span></p>
<p>where points <span class="math inline">\(z_k\)</span> (<span class="math inline">\(k=0, \ldots, K\)</span>) form a uniform grid covering the interval <span class="math inline">\((z_0,z)\)</span> with step <span class="math inline">\(\Delta = (z-z_0)/K\)</span>, and weight <span class="math inline">\(w_i(z_k)\)</span> captures the distance between point <span class="math inline">\(z_k\)</span> and observation <span class="math inline">\(x_i^j\)</span>. In particular, we may use similar weights as in case of <a href="accumulatedLocalProfiles.html#eq:LDPest2">(19.5)</a>.</p>
<!---
### Illustrative examples {#summaryFeatureEffects}

We will consider a vector of two explanatory variables $\underline{X}=(X^1,X^2)'$ such that $X^1$ is uniformly distributed over $[-1,1]$ and $X^2=X^1$. Hence, $X^2$ is perfectly correlated with $X^1$ and $E({X^2})=E({X^1})=0$. The conditional distribution of $\underline{X}^{-1} \equiv X^2$ given $X^1=z$ is the point mass of 1 at $z$. 

#### An additive model {#summaryFeatureEffectsAdd}

For model \@ref(eq:simpleModel), the PD profile for $X^1$ is given by 

$$
g_{PD}^{x^1+x^2,1}(z) = E_{X^2}(z+X^2) = z + E(X^2) = z.
$$
On the other hand, the LD profile for $X^1$ is given by 

$$
g_{LD}^{x^1+x^2,1}(z) = E_{X^2|X^1=z}(z+X^2) = z + E_{X^2|X^1=z}(X^2) = 2z.
$$
Finally, for model \@ref(eq:simpleModel) we have got 

\begin{equation}
q^1(u^1,u^2)=\left\{ \frac{\partial (x^1+x^2)}{\partial x^1} \right\}_{\underline{x}=(u^1,u^2)}=1,
(\#eq:derivsimpleModel)
\end{equation}

so that  

$$
\int_{-1}^z \left[ E_{X^2|X^1=v}\left\{ q^1(v,X^2) \right\} \right] dv + c = \int_{-1}^z dv + c = z+1+c.
$$

Since $E_{X^1}\left(X^1+1\right) = 1$, then, upon taking $c=-1$, we obtain the following AL profile for $X^1$:

$$
g_{AL}^{x^1+x^2,1}(z) = z,
$$

with $E_{X^1}\left\{g_{AL}^{x^1+x^2,1}(X^1)\right\} = 0$.

Note that the AL profile properly captures the effect of the explanatory variable $X^1$ on the model predictions. As we can see, function $q^1(\underline{u})$, given in \@ref(eq:derivsimpleModel), does not depend on the value of $X^2$. Consequently, the AL profile for $X^1$ does not include the effect of $X^2$. However, the LD profile is biased, due to the fact that it does include the effect of $X^2$, because of averaging of the predictions over that variable, which is correlated with $X^1$. 

#### A model with an interaction {#summaryFeatureEffectsInter}

Let us now consider model \@ref(eq:trickyModel) and the eight observations for $\underline{X}$ from Section \@ref(ALPIntuition).

The top part of panel A of Figure \@ref(fig:accumulatedLocalEffects) [TOMASZ: REMOVE THE CURRENT PANEL A.] shows CP profiles for $X^1$ for the eight observations, as given in \@ref(eq:CPtrickyModel). The bottom part of the panel shows the estimated PD profile obtained by using the mean of the CP profiles. As indicated in   \@ref(eq:PDtrickyModel), the PD profile is estimated at 0. The estimate is correct, because 

$$
g_{PD}^{(x^1+1)\cdot x^2,1}(z) = E_{X^2}\{(z+ 1)\cdot X^2\} = (z+1)\cdot E_{X^2}(X^2) = 0,
$$

given that $X^2$ is uniformly-distributed over $[-1,1]$. However, the PD profile itself is misleading, as there clearly is an effect of $X^1$.  

(ref:accumulatedLocalEffectsDesc) Partial-dependence, local-dependence, and accumulated local profiles for the model (x1+1)x2. Panel A: Ceteris-paribus profiles (top plot) and the corresponding partial-dependence profile (underneath). Panel B: Local-dependence profile. Panel C: Accumulated local profile. 

<div class="figure" style="text-align: center">
<img src="figure/CP_ALL.png" alt="(ref:accumulatedLocalEffectsDesc)" width="90%" />
<p class="caption">(\#fig:accumulatedLocalEffects)(ref:accumulatedLocalEffectsDesc)</p>
</div>

The LD profile for model \@ref(eq:trickyModel) and variable $X^1$ is given by

\begin{equation}
g_{LD}^{(x^1+1)\cdot x^2,1}(z) = E_{X^2|X^1=z}\{f(z,X^2)\} = E_{X^2|X^1=z}\{(z+1)\cdot X^2\} = (z+1)\cdot z.
(\#eq:LDtrickyModel)
\end{equation}

By using estimator \@ref(eq:LDPest), with the data split into four intervals each containing two observations (see the top part of panel B pf Figure \@ref(fig:accumulatedLocalEffects)), we obtain the estimated LD profile shown at the bottom of panel B of Figure \@ref(fig:accumulatedLocalEffects).

Finally, for model \@ref(eq:trickyModel) we have got 

\begin{equation}
q^1(u^1,u^2)=\left\{ \frac{\partial (x^1x^2+x^2)}{\partial x^1} \right\}_{\underline{x}=(u^1,u^2)}=u^2,
(\#eq:derivtrickyModel)
\end{equation}
  
so that  

$$
\int_{-1}^z \left[ E_{X^2|X^1=v}\left\{ q^1(v,X^2) \right\} \right] dv + c = \int_{-1}^z vdv + c = \frac{(z)^2-1}{2}+c.
$$

Since $E_{X^1}\left\{(X^1)^2\right\} = 1/3$, then, upon taking $c=1/3$, we obtain the following AL profile for $X^1$:

\begin{equation}
g_{AL}^{(x^1+1)\cdot x^2,1}(z) = \frac{z^2}{2}-\frac{1}{3},
(\#eq:ALtrickyModel)
\end{equation}

with $E_{X^1}\left\{g_{AL}^{(x^1+1) \cdot x^2,1}(X^1)\right\} = 0$.

By using estimator \@ref(eq:ALPest), with the data split into four intervals containing two observations each (see the plot at the top of panel C of Figure \@ref(fig:accumulatedLocalEffects), we obtain the estimated AL profile shown at the bottom of panel C of Figure \@ref(fig:accumulatedLocalEffects). 

Note that all three profiles are different. The PD profile is clearly wrong, as it indicates no effect of $X^1$. On the other hand, both LD and AL profiles suggest a quadratic effect of the variable, which is also incorrect. For the LD profile, this is due to marginalizing over $X^2$ which is correlated with $X^1$. For the AL profile, the issue is that the model contains the interaction term $x^1x^2$. As a result, function $q^1(\underline{u})$, given in \@ref(eq:derivtrickyModel), depends on the value of $X^2$. Consequently, the AL profile for $X^1$ also includes the effect of $X^2$. 

<!---

As another example, consider model \@ref(eq:trickyModel). In this case, $q^1(x_1,x_2)=x_2$ and the effect of variable $X^2$ will still be present in the AL profile for $X^1$.

Continuing with model in formula \@ref(eq:trickyModel), assume that $X=(X^1,X^2)$ with $X^1$ uniformly distributed over $[-1,1]$ and $X^2=X^1$. In this case, the conditional distribution of $X^2 | X^1=z$ is the point mass of 1 at $z$. Then

\begin{equation}
g_{AL}^{(x_1+1)\cdot x_2,1}(z) = \int_{-1}^z \left[E_{X^2|X^1=u}\left( X^2 \right)\right] du + c = \int_{-1}^z u du + c = \frac{z^2-1}{2}+c.
(\#eq:ALtrickyModel)
\end{equation}

Since $E_{X^1}\left[(X^1)^2\right] = 1/3$, then, upon taking $c=-1/3$, we get $E_{X^1}\left[g_{AL}^{(x_1+1) \cdot x_2,1}(X^1)\right] = 0$.

\begin{equation}
g_{AL}^{(x_1 + 1)\cdot x_2, 1}(z) = 
\int_{-1}^z E \left[\frac{\partial f(x_1, x_2)}{\partial x_1} | X^1 = v \right] dv = 
\int_{-1}^z E \left[X^2 | X^1 = v \right] dv = 
\int_{-1}^z v dv =
(z^2 - 1)/2.
(\#eq:ALtrickyModel)
\end{equation}

--->
</div>
<div id="dependence-profiles-for-a-toy-example" class="section level3" number="19.3.3">
<h3><span class="header-section-number">19.3.3</span> Dependence profiles for a toy example</h3>
<p>In this section, we will show the behaviour of partial dependence, local dependence and accumulated dependence for a model in which the interaction and correlation between variables are present.</p>
<p>Let us consider the following, simple model with for two explanatory variables:
<span class="math display" id="eq:trickyModel">\[\begin{equation}
f(X^1, X^2) = (X^1 + 1)\cdot X^2.
\tag{19.10}
\end{equation}\]</span></p>
<p>Moreover, assume that explanatory variables <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span> are uniformly distributed over the interval <span class="math inline">\([-1,1]\)</span> and perfectly correlated, i.e., <span class="math inline">\(X^2 = X^1\)</span>. Suppose that we have got the following dataset with 8 observations:</p>
<table>
<thead>
<tr class="header">
<th>i</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(X^1\)</span></td>
<td>-1</td>
<td>-0.71</td>
<td>-0.43</td>
<td>-0.14</td>
<td>0.14</td>
<td>0.43</td>
<td>0.71</td>
<td>1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(X^2\)</span></td>
<td>-1</td>
<td>-0.71</td>
<td>-0.43</td>
<td>-0.14</td>
<td>0.14</td>
<td>0.43</td>
<td>0.71</td>
<td>1</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(y\)</span></td>
<td>0</td>
<td>-0.2059</td>
<td>-0.2451</td>
<td>-0.1204</td>
<td>0.1596</td>
<td>0.6149</td>
<td>1.2141</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Note that, for both <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span>, the sum of all observed values is equal to 0.</p>
<div class="figure" style="text-align: center"><span id="fig:accumulatedLocalEffectsNew"></span>
<img src="figure/CP_ALL.png" alt="Partial-dependence, local-dependence, and accumulated-dependence profiles. Panel A: Ceteris-paribus profiles (top plot) and the corresponding partial-dependence profile. Panel B: local-dependence profile. Panel C: accumulated local profile. " width="90%" />
<p class="caption">
Figure 19.4: Partial-dependence, local-dependence, and accumulated-dependence profiles. Panel A: Ceteris-paribus profiles (top plot) and the corresponding partial-dependence profile. Panel B: local-dependence profile. Panel C: accumulated local profile.
</p>
</div>
<p>The top part of Panel A of Figure <a href="accumulatedLocalProfiles.html#fig:accumulatedLocalEffectsNew">19.4</a> shows CP profiles for <span class="math inline">\(X^1\)</span> for model <a href="accumulatedLocalProfiles.html#eq:trickyModel">(19.10)</a> calculated for selected eight observations. The bottom part of the panel presents the corresponding estimate of the PD profile for <span class="math inline">\(X^1\)</span>, i.e., the average of the CP profiles. The profile suggests no effect of variable <span class="math inline">\(X^1\)</span>, which is clearly a misleading conclusion.</p>
<p>To understand the reason, let us explicitly express the CP profile for <span class="math inline">\(X^1\)</span> for model <a href="accumulatedLocalProfiles.html#eq:trickyModel">(19.10)</a>:</p>
<p><span class="math display" id="eq:CPtrickyModel">\[\begin{equation}
h^{1}_{CP}(z) = f(z,X^2) = (z+1)\cdot X^2.
\tag{19.11}
\end{equation}\]</span></p>
<p>By allowing <span class="math inline">\(z\)</span> to take any value in the interval <span class="math inline">\([-1,1]\)</span>, we get the CP profiles as straight lines with the slope equal to the value of variable <span class="math inline">\(X^2\)</span>. Hence, for instance, the CP profile for observation <span class="math inline">\((-1,-1)\)</span> is a straight line with the slope equal to -1.</p>
<p>Recall that the PD profile for <span class="math inline">\(X^j\)</span>, defined in equation <a href="partialDependenceProfiles.html#eq:PDPdef0">(18.1)</a>, is the expected value, over the joint distribution of all explanatory variables other than <span class="math inline">\(X^j\)</span>, of the model predictions when <span class="math inline">\(X^j\)</span> is set to <span class="math inline">\(z\)</span>. This leads to the estimation of the profile by taking the average of CP profiles for <span class="math inline">\(X^j\)</span> (see equation <a href="partialDependenceProfiles.html#eq:PDPest">(18.2)</a>).</p>
<p>In our case, this implies that the PD profile for <span class="math inline">\(X^1\)</span> is the expected value of the model predictions over the distribution of <span class="math inline">\(X^2\)</span>, i.e., over the uniform distribution on the interval <span class="math inline">\([-1,1]\)</span>. Thus, the PD profile is estimated by taking the average of the CP profiles (see <a href="accumulatedLocalProfiles.html#eq:CPtrickyModel">(19.11)</a>) at each value of <span class="math inline">\(z\)</span> in <span class="math inline">\([-1,1]\)</span>:</p>
<p><span class="math display" id="eq:PDtrickyModel">\[\begin{equation}
\hat g_{PD}^{1}(z) =  \frac{1}{8} \sum_{i=1}^{8} (z+1)\cdot X^2_{i} = \frac{z+1}{8}  \sum_{i=1}^{8} X^2_{i} = 0.
\tag{19.12}
\end{equation}\]</span></p>
<p>As a result, the PD profile for <span class="math inline">\(X^1\)</span> is estimated as a horizontal line at 0, as seen in the bottom part of Panel A of Figure <a href="accumulatedLocalProfiles.html#fig:accumulatedLocalEffectsNew">19.4</a>.</p>
<p>The calculations in equation <a href="accumulatedLocalProfiles.html#eq:PDtrickyModel">(19.12)</a> ignore the fact that, given our assumptions, one cannot change <span class="math inline">\(z\)</span> <em>freely</em> for a particular value of <span class="math inline">\(X^2\)</span>, because <span class="math inline">\(X^1\)</span> and <span class="math inline">\(X^2\)</span> are assumed to be perfectly correlated. In fact, in this case, the CP profile for the <span class="math inline">\(i\)</span>-th observation should actually be undefined for any values of <span class="math inline">\(z\)</span> different from <span class="math inline">\(x^2_i\)</span>. As a consequence, the sum used in the calculation of the PD profile in equation <a href="accumulatedLocalProfiles.html#eq:PDtrickyModel">(19.12)</a> would involve undefined terms for any <span class="math inline">\(z\)</span>.</p>
<p>Thus, the issue is related to the fact of using the marginal distribution of <span class="math inline">\(X^2\)</span>, which disregards the value of <span class="math inline">\(X^1\)</span>, in the definition of the PD profile. This observation suggests a modification: instead of the marginal distribution, one might consider the conditional distribution of <span class="math inline">\(X^2 | X^1\)</span>. The modification leads to the definition of the LD profile.</p>
<p>For in our example, the conditional distribution of <span class="math inline">\(X^2\)</span>, given <span class="math inline">\(X^1=z\)</span>, is just a probability mass of 1 at <span class="math inline">\(z\)</span>. Consequently, the Local-dependence (LD) profile, for any <span class="math inline">\(z \in [-1,1]\)</span>, is given by
<span class="math display" id="eq:LDtrickyModel">\[\begin{equation}
g_{LD}^{1}(z) =  z \cdot (z+1).
\tag{19.13}
\end{equation}\]</span></p>
<p>It turns out, however, that the modification does not fully address the issue of correlated explanatory variables.</p>
<!-- Profile LD  -->
<p>Looking at equation <a href="accumulatedLocalProfiles.html#eq:trickyModel">(19.10)</a> one can see that from the perspective of <span class="math inline">\(X^1\)</span> the effect of the variable <span class="math inline">\(x_1\)</span> is similar to the function <span class="math inline">\(f(x_1) = -x_1 -1\)</span> for values close to <span class="math inline">\((x_1, x_2) = (-1,-1)\)</span> and similar to the function <span class="math inline">\(f(x_1) = x_1 +1\)</span> for values close to <span class="math inline">\((x_1, x_2) = (1,1)\)</span>. So first it decreases at the same rate as it increases later. The function in equation <a href="accumulatedLocalProfiles.html#eq:LDtrickyModel">(19.13)</a> does not show this.</p>
<p>In AL profiles the effect of the <span class="math inline">\(X^1\)</span> variable is defined as the cumulative sum of local derivatives due to the <span class="math inline">\(X^1\)</span> variable</p>
<p><span class="math display" id="eq:ALtrickyModel">\[\begin{equation}
g_{AL}^{1}(z) = 
\int_{-1}^z E \left[\frac{\partial f(X^1, X^2)}{\partial X^1} | X^1 = v \right] dv = 
\int_{-1}^z E \left[X^2 | X^1 = v \right] dv = 
\int_{-1}^z v dv =
(z^2 - 1)/2.
\tag{19.14}
\end{equation}\]</span></p>
<p>This formula better reflects the behaviour of function <span class="math inline">\(f(X^1,X^2)\)</span> due to <span class="math inline">\(X^1\)</span> removing the effect of changes in variable <span class="math inline">\(X^2\)</span>.</p>
<!--
Let us consider model \@ref(eq:trickyModel) and explanatory-variable vector $X=(X^1,X^2)$ with $X^1$ uniformly distributed over $[-1,1]$ and $X^2=X^1$. Hence, $X^2$ is perfectly correlated with $X^1$. Moreover, consider the eight observations for $X$ from Section \@ref(ALPIntuition).

The top part of Panel A of Figure \@ref(fig:accumulatedLocalEffects) shows CP profiles for $X^1$ for the eight observations, as computed in formula \@ref(eq:CPtrickyModel). The bottom part of the panel shows the estimated PD profile obtained by using the average of the CP profiles. As indicated by formula  \@ref(eq:PDtrickyModel), the PD profile is estimated at 0. The estimate is correct, as 

$$
g_{PD}^{(x_1+1)\cdot x_2,1}(z) = E_{X^2}[(z+ 1)\cdot X^2] = (z+1)\cdot E_{X^2}(X^2) = 0,
$$
given that $X^2$ is uniformly-distributed over $[-1,1]$. It is, however, misleading, as there clearly is an effect of $X^1$.  

=The LD profile for model \@ref(eq:trickyModel), as computed in \@ref(eq:LDtrickyModel), is

$$
g_{LD}^{(x_1+1)\cdot x_2,1}(z) =  (z+1)\cdot z.
$$
By using estimator \@ref(eq:LDPest), with the data split into four intervals each containing two observations, we obtain the estimated LD profile shown at the bottom of Panel B of Figure \@ref(fig:accumulatedLocalEffects).

As shown in \@ref(eq:ALtrickyModel), the AL profile for model presented in formula \@ref(eq:trickyModel) is up to the constant equal
$$
g_{AL}^{(x_1+1)\cdot x_2,1}(z) =  \frac{z^2-1}{2} + c.
$$

By using estimator \@ref(eq:ALPest), with the data split into four intervals each containing two observations, we obtain the estimated AL profile shown at the bottom of Panel C of Figure \@ref(fig:accumulatedLocalEffects).

-->
</div>
</div>
<div id="CDPExample" class="section level2" number="19.4">
<h2><span class="header-section-number">19.4</span> Example: apartment-prices data</h2>
<p>In this section, we use PD, LD, and AL profiles to evaluate performance of the random-forest model <code>apartments_rf</code> (see Section <a href="dataSetsIntro.html#model-Apartments-rf">5.5.2</a>) for the apartment-prices dataset (see Section <a href="dataSetsIntro.html#ApartmentDataset">5.4</a>). Recall that the goal is to predict the price per square meter of an apartment. In our illustration we focus on two explanatory variables, <em>surface</em> and <em>number of rooms</em>, as they are correlated (see Figure <a href="dataSetsIntro.html#fig:apartmentsSurfaceNorooms">5.9</a>).</p>
<p>Figure <a href="accumulatedLocalProfiles.html#fig:featureEffectsApartment">19.5</a> shows the three types of profiles for both variables estimated according to formulas <a href="partialDependenceProfiles.html#eq:PDPest">(18.2)</a>, <a href="accumulatedLocalProfiles.html#eq:LDPest2">(19.5)</a>, and <a href="accumulatedLocalProfiles.html#eq:ALPest2">(19.9)</a>. As we can see from the plots, the profiles calculated with different methods are different. The LD profiles are steeper than the PD profiles. This is because, for instance, the effect of <em>surface</em> includes the effect of other correlated variables, including <em>number of rooms</em>. The AL profile eliminates the effect of correlated variables. Since the AL and PD profiles are parallel to each other, they suggest that the model is additive for these two explanatory variables.</p>

<div class="figure" style="text-align: center"><span id="fig:featureEffectsApartment"></span>
<img src="ema_files/figure-html/featureEffectsApartment-1.png" alt="Partial-dependence, local-dependence, and accumulated local profiles for the random-forest model for the apartment-prices dataset." width="75%" />
<p class="caption">
Figure 19.5: Partial-dependence, local-dependence, and accumulated local profiles for the random-forest model for the apartment-prices dataset.
</p>
</div>
</div>
<div id="ALPProsCons" class="section level2" number="19.5">
<h2><span class="header-section-number">19.5</span> Pros and cons</h2>
<p>The LD and AL profiles, described in this chapter, are useful to summarize the influence of an explanatory variable on a model’s predictions. The profiles are constructed by using the CP profiles introduced in Chapter <a href="ceterisParibus.html#ceterisParibus">11</a>, but they differ in a way how the CP profiles for individual observations are summarized.</p>
<p>When explanatory variables are independent and there are no interactions in the model, the CP profiles are parallel and their mean, i.e., the PD profile introduced in Chapter <a href="partialDependenceProfiles.html#partialDependenceProfiles">18</a>, adequately summarizes them.</p>
<p>When the model is additive, but an explanatory variable is correlated with some other variables, neither PD nor LD profiles will properly capture the effect of the explanatory variable on the model’s predictions. However, the AL profile will provide a correct summary of the effect.</p>
<p>When there are interactions in the model, none of the profiles will provide a correct assessment of the effect of an explanatory variable involved in the interaction(s). This is because the profiles for the variable will also include the effect of other variables. Comparison of PD, LD, and AL profiles may help in identifying whether there are any interactions in the model and/or whether explanatory variables are correlated. When there are interactions, they may be explored by using a generalization of the PD profiles for two or more dependent variables <span class="citation">(Apley and Zhu <a href="#ref-Apley2019" role="doc-biblioref">2019</a>)</span>.</p>
</div>
<div id="ALPR" class="section level2" number="19.6">
<h2><span class="header-section-number">19.6</span> Code snippets for R</h2>
<p>In this section, we present variable importance metrics as implemented in the <code>DALEX</code> package for R. The package covers the most often used measures and methods presented in this chapter. In particular, it includes wrappers for functions from the <code>ingredients</code> package <span class="citation">(Biecek et al. <a href="#ref-ingredientsRPackage" role="doc-biblioref">2019</a>)</span>. Note that similar functionalities can be found in package <code>ALEPlots</code> <span class="citation">(Apley <a href="#ref-ALEPlotRPackage" role="doc-biblioref">2018</a>)</span> or <code>iml</code> <span class="citation">(Molnar, Bischl, and Casalicchio <a href="#ref-imlRPackage" role="doc-biblioref">2018</a>)</span>.</p>
<p>For illustration purposes, we use the random-forest model <code>apartments_rf</code> (see Section <a href="dataSetsIntro.html#model-Apartments-rf">5.5.2</a>) for the apartment prices dataset (see Section <a href="dataSetsIntro.html#ApartmentDataset">5.4</a>). Recall that the goal is to predict the price per square meter of an apartment. In our illustration, we focus on two explanatory variables, <em>surface</em> and <em>number of rooms</em>.</p>
<p>We first load the model via the <code>archivist</code> hook, as listed in Section <a href="dataSetsIntro.html#ListOfModelsApartments">5.5.6</a>. Then we construct the explainer for the model by using the function <code>explain()</code> from the <code>DALEX</code> package (see Section <a href="dataSetsIntro.html#ExplainersTitanicRCode">5.2.6</a>). Note that, beforehand, we have got to load the <code>randomForest</code> package, as the model was fitted by using function <code>randomForest()</code> from this package (see Section <a href="dataSetsIntro.html#model-titanic-rf">5.2.2</a>) and it is important to have the corresponding <code>predict()</code> function available.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="accumulatedLocalProfiles.html#cb205-1"></a>model_apart_rf &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/fe7a5&quot;</span>)</span>
<span id="cb205-2"><a href="accumulatedLocalProfiles.html#cb205-2"></a><span class="kw">library</span>(<span class="st">&quot;DALEX&quot;</span>)</span>
<span id="cb205-3"><a href="accumulatedLocalProfiles.html#cb205-3"></a><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)</span>
<span id="cb205-4"><a href="accumulatedLocalProfiles.html#cb205-4"></a>model_apart_rf &lt;-<span class="st"> </span>archivist<span class="op">::</span><span class="kw">aread</span>(<span class="st">&quot;pbiecek/models/fe7a5&quot;</span>)</span>
<span id="cb205-5"><a href="accumulatedLocalProfiles.html#cb205-5"></a>explainer_apart_rf &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw">explain</span>(<span class="dt">model =</span> model_apart_rf, </span>
<span id="cb205-6"><a href="accumulatedLocalProfiles.html#cb205-6"></a>                             <span class="dt">data    =</span> apartments_test[,<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb205-7"><a href="accumulatedLocalProfiles.html#cb205-7"></a>                             <span class="dt">y       =</span> apartments_test<span class="op">$</span>m2.price, </span>
<span id="cb205-8"><a href="accumulatedLocalProfiles.html#cb205-8"></a>                             <span class="dt">label   =</span> <span class="st">&quot;Random Forest&quot;</span>, </span>
<span id="cb205-9"><a href="accumulatedLocalProfiles.html#cb205-9"></a>                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>The function that allows the computation of LD and AL profiles in the <code>DALEX</code> package is <code>model_profile()</code>. Its use and arguments were described in Section <a href="partialDependenceProfiles.html#PDPR">18.6</a>. LD profiles are calculated by specifying argument <code>type = "conditional"</code>. In the example below, we calculate the profile only for the explanatory variables <em>surface</em> and * the number of rooms*. By default, the profile is based on 100 randomly selected observations.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="accumulatedLocalProfiles.html#cb206-1"></a>ld_rf &lt;-<span class="st"> </span><span class="kw">model_profile</span>(<span class="dt">explainer =</span> explainer_apart_rf,</span>
<span id="cb206-2"><a href="accumulatedLocalProfiles.html#cb206-2"></a>                      <span class="dt">type       =</span> <span class="st">&quot;conditional&quot;</span>,</span>
<span id="cb206-3"><a href="accumulatedLocalProfiles.html#cb206-3"></a>                      <span class="dt">variables  =</span> <span class="kw">c</span>(<span class="st">&quot;no.rooms&quot;</span>, <span class="st">&quot;surface&quot;</span>))</span></code></pre></div>
<p>The resulting object of class “model_profile” contains the LD profiles for both explanatory variables. By applying the <code>plot()</code> function to the object, we obtain separate plots of the profiles.</p>

<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="accumulatedLocalProfiles.html#cb207-1"></a><span class="kw">plot</span>(ld_rf) <span class="op">+</span></span>
<span id="cb207-2"><a href="accumulatedLocalProfiles.html#cb207-2"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Local-dependence profiles for no. of rooms and surface&quot;</span>, <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:aleExample3Plot"></span>
<img src="ema_files/figure-html/aleExample3Plot-1.png" alt="Local-dependence profiles for the random-forest model and explanatory variables surface and number of rooms for the apartment prices dataset." width="80%" />
<p class="caption">
Figure 19.6: Local-dependence profiles for the random-forest model and explanatory variables surface and number of rooms for the apartment prices dataset.
</p>
</div>
<p>The resulting plot is shown in Figure <a href="accumulatedLocalProfiles.html#fig:aleExample3Plot">19.6</a>. The profiles essentially correspond to those included in Figure <a href="accumulatedLocalProfiles.html#fig:featureEffectsApartment">19.5</a>.</p>
<p>AL profiles are calculated by applying function <code>model_profile()</code> with the additional argument <code>type = "accumulated"</code>.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="accumulatedLocalProfiles.html#cb208-1"></a>al_rf &lt;-<span class="st"> </span><span class="kw">model_profile</span>(<span class="dt">explainer =</span> explainer_apart_rf,</span>
<span id="cb208-2"><a href="accumulatedLocalProfiles.html#cb208-2"></a>                            <span class="dt">type =</span> <span class="st">&quot;accumulated&quot;</span>,</span>
<span id="cb208-3"><a href="accumulatedLocalProfiles.html#cb208-3"></a>                       <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;no.rooms&quot;</span>, <span class="st">&quot;surface&quot;</span>))</span></code></pre></div>
<p>By applying the <code>plot()</code> function to the object, we obtain separate plots of the AL profiles for <em>number of rooms</em> and <em>surface</em>. They are presented in Figure <a href="accumulatedLocalProfiles.html#fig:aleExample2Plot">19.7</a>. The profiles essentially correspond to those included in Figure <a href="accumulatedLocalProfiles.html#fig:featureEffectsApartment">19.5</a>.</p>

<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="accumulatedLocalProfiles.html#cb209-1"></a><span class="kw">plot</span>(al_rf) <span class="op">+</span></span>
<span id="cb209-2"><a href="accumulatedLocalProfiles.html#cb209-2"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Accumulated local profiles for no. of rooms and surface&quot;</span>, <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:aleExample2Plot"></span>
<img src="ema_files/figure-html/aleExample2Plot-1.png" alt="Accumulated local profiles for the random-forest model and explanatory variables surface and number of rooms for the apartment prices dataset" width="80%" />
<p class="caption">
Figure 19.7: Accumulated local profiles for the random-forest model and explanatory variables surface and number of rooms for the apartment prices dataset
</p>
</div>
<p>Function <code>plot()</code> allows including all plots in a single graph. We will show how to apply it in order to obtain Figure <a href="accumulatedLocalProfiles.html#fig:featureEffectsApartment">19.5</a>. Toward this end, we have got to create PD profiles first (see Section <a href="partialDependenceProfiles.html#PDPR">18.6</a>). We also modify the labels of the PD, LD, and AL profiles contained in the <code>agr_profiles</code> components of the “model_profile”-class objects created for the different profiles.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="accumulatedLocalProfiles.html#cb210-1"></a>pd_rf &lt;-<span class="st"> </span><span class="kw">model_profile</span>(<span class="dt">explainer =</span> explainer_apart_rf,</span>
<span id="cb210-2"><a href="accumulatedLocalProfiles.html#cb210-2"></a>                            <span class="dt">type =</span> <span class="st">&quot;partial&quot;</span>,</span>
<span id="cb210-3"><a href="accumulatedLocalProfiles.html#cb210-3"></a>                      <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;no.rooms&quot;</span>, <span class="st">&quot;surface&quot;</span>))</span>
<span id="cb210-4"><a href="accumulatedLocalProfiles.html#cb210-4"></a>pd_rf<span class="op">$</span>agr_profiles<span class="op">$</span><span class="st">`</span><span class="dt">_label_</span><span class="st">`</span> =<span class="st"> &quot;partial dependence&quot;</span></span>
<span id="cb210-5"><a href="accumulatedLocalProfiles.html#cb210-5"></a>ld_rf<span class="op">$</span>agr_profiles<span class="op">$</span><span class="st">`</span><span class="dt">_label_</span><span class="st">`</span> =<span class="st"> &quot;local dependence&quot;</span></span>
<span id="cb210-6"><a href="accumulatedLocalProfiles.html#cb210-6"></a>al_rf<span class="op">$</span>agr_profiles<span class="op">$</span><span class="st">`</span><span class="dt">_label_</span><span class="st">`</span> =<span class="st"> &quot;accumulated local&quot;</span></span></code></pre></div>
<p>Subsequently, we simply apply the <code>plot()</code> function to the <code>agr_profiles</code> components of the “model_profile”-class objects for the different profiles (see Section <a href="partialDependenceProfiles.html#PDPR">18.6</a>).</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="accumulatedLocalProfiles.html#cb211-1"></a><span class="kw">plot</span>(pd_rf<span class="op">$</span>agr_profiles, ld_rf<span class="op">$</span>agr_profiles, al_rf<span class="op">$</span>agr_profiles)</span></code></pre></div>
<p>The resulting plot (not shown) is essentially the same as the one presented in Figure <a href="accumulatedLocalProfiles.html#fig:featureEffectsApartment">19.5</a>, with a possible difference due to the use of a different set of (randomly selected) 100 observations from the apartment-prices dataset.</p>
</div>
<div id="ALPPython" class="section level2" number="19.7">
<h2><span class="header-section-number">19.7</span> Code snippets for Python</h2>
<p>In this section, we use the <code>dalex</code> library for Python. The package covers all methods presented in this chapter. It is available on <code>pip</code> and <code>GitHub</code>. The package covers the most often used measures and methods presented in this chapter.</p>
<p>For illustration purposes, we use the <code>titanic_rf</code> random forest model for the Titanic data developed in Section <a href="dataSetsIntro.html#model-titanic-python-rf">5.3.2</a>. Recall that the model is developed to predict the probability of survival for passengers of Titanic.</p>
<p>In the first step we create an Explainer, an object that will provide a uniform interface for the predictive model. We use the <code>Explainer</code> constructor for this purpose.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb212-1"><a href="accumulatedLocalProfiles.html#cb212-1"></a><span class="im">import</span> dalex <span class="im">as</span> dx</span>
<span id="cb212-2"><a href="accumulatedLocalProfiles.html#cb212-2"></a>titanic_rf_exp <span class="op">=</span> dx.Explainer(titanic_rf, X, y, label <span class="op">=</span> <span class="st">&quot;Titanic RF Pipeline&quot;</span>)</span></code></pre></div>
<p>The function that allows calculations of PD profiles is <code>model_profile()</code>. It was already introduced in Section <a href="partialDependenceProfiles.html#PDPPython">18.7</a>. By defaut, it calculates partial dependency profiles but this may be changed with the <code>type</code> argument. Set <code>type = "conditional"</code> to get LD profiles and <code>type = "accumulated"</code> to get AD profiles.</p>
<p>In the example below, we calculate the LD profile for <em>age</em> and <em>fare</em> by applying the <code>model_profile()</code> function with <code>type = "conditional"</code> option to the Explainer-object for the random-forest model. Results are stored in the <code>ld_rf.result</code> field.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb213-1"><a href="accumulatedLocalProfiles.html#cb213-1"></a>ld_rf <span class="op">=</span> exp_rf.model_profile(<span class="bu">type</span> <span class="op">=</span> <span class="st">&quot;conditional&quot;</span>)</span>
<span id="cb213-2"><a href="accumulatedLocalProfiles.html#cb213-2"></a>ld_rf.result</span></code></pre></div>
<p><img src="figure/python_model_accumulated_1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>The resulting object can be visualised with the <code>plot</code> method.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb214-1"><a href="accumulatedLocalProfiles.html#cb214-1"></a>ld_rf.plot(variables <span class="op">=</span> [<span class="st">&#39;age&#39;</span>, <span class="st">&#39;fare&#39;</span>])</span></code></pre></div>
<p><img src="figure/python_model_accumulated_2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>In order to calculate AL profile for <em>age</em> and <em>fare</em> by applying the <code>model_profile()</code> function with <code>type = "accumulated"</code> option.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="accumulatedLocalProfiles.html#cb215-1"></a>al_rf <span class="op">=</span> exp_rf.model_profile(<span class="bu">type</span> <span class="op">=</span> <span class="st">&quot;accumulated&quot;</span>)</span></code></pre></div>
<p>Both AL and LD profiles can be plotted in a single chart. Just pass the <code>ld_rf</code> object as a first argument to the <code>plot()</code> function.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb216-1"><a href="accumulatedLocalProfiles.html#cb216-1"></a>al_rf.plot(ld_rf, variables <span class="op">=</span> [<span class="st">&#39;age&#39;</span>, <span class="st">&#39;fare&#39;</span>])</span></code></pre></div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-ALEPlotRPackage">
<p>Apley, Dan. 2018. <em>ALEPlot: Accumulated Local Effects (Ale) Plots and Partial Dependence (Pd) Plots</em>. <a href="https://CRAN.R-project.org/package=ALEPlot">https://CRAN.R-project.org/package=ALEPlot</a>.</p>
</div>
<div id="ref-Apley2019">
<p>Apley, D. W., and J. Zhu. 2019. “Visualizing the effects of predictor variables in black box supervised learning models” abs/1604.00825. <a href="https://arxiv.org/abs/1612.08468">https://arxiv.org/abs/1612.08468</a>.</p>
</div>
<div id="ref-ingredientsRPackage">
<p>Biecek, Przemyslaw, Hubert Baniecki, Adam Izdebski, and Katarzyna Pekala. 2019. <em>ingredients: Effects and Importances of Model Ingredients</em>.</p>
</div>
<div id="ref-imlRPackage">
<p>Molnar, Christoph, Bernd Bischl, and Giuseppe Casalicchio. 2018. “iml: An R package for Interpretable Machine Learning.” <em>Joss</em> 3 (26): 786. <a href="https://doi.org/10.21105/joss.00786">https://doi.org/10.21105/joss.00786</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="partialDependenceProfiles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="residualDiagnostic.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ema.pdf", "ema.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
